/**
 * @license
 * Lodash <https://lodash.com/>
 * Copyright JS Foundation and other contributors <https://js.foundation/>
 * Released under MIT license <https://lodash.com/license>
 * Based on Underscore.js 1.8.3 <http://underscorejs.org/LICENSE>
 * Copyright Jeremy Ashkenas, DocumentCloud and Investigative Reporters & Editors
 */
function handleLoadError(n){alert(n.Error)}function openColour(){}function GetBrandingPosition_Ordering(n){for(var i,t=0;t<positions.length;t++)if(i=positions[t],i.PositionCode==n)return i;return null}function GetBrandingPositionOption_Ordering(n,t){for(var r,u,f,i=0;i<positions.length;i++)if(r=positions[i],r.PositionCode==n)for(u=0;u<r.Options.length;u++)if(f=r.Options[u],f.DisplayIndex==t)return f;return null}function GetNotSpecialBrandingPositionOption_Ordering(n,t){for(var r,u,f,i=0;i<positions.length;i++)if(r=positions[i],r.PositionCode==n)for(u=0;u<r.Options.length;u++)if(f=r.Options[u],f.BrandingCode==t&&f.OptionSpecialRule==null)return f;return null}function GetFirstBrandingPositionOptionSpecial_Ordering(n,t,i,r){var u=GetBrandingPositionOptionSpecials_Ordering(n,t,i,r);return u.length>0?u[0]:null}function GetBrandingPositionOptionSpecials_Ordering(n,t,i,r){for(var e,o,u,f=[],s=0;s<positions.length;s++)if(e=positions[s],n==null||e.PositionCode==n)for(o=0;o<e.Options.length;o++)u=e.Options[o],(t==null||u.BrandingCode==t)&&u.OptionSpecialRule!=null&&(r==null||u.OptionSpecialRule.NumberOfColours==null||u.OptionSpecialRule.NumberOfColours==r)&&(i==null?f.push(u):i==1&&u.OptionSpecialRule.BrandingPositionType==-3?f.push(u):i==2&&u.OptionSpecialRule.BrandingPositionType==-2?f.push(u):i==3&&u.OptionSpecialRule.BrandingPositionTypes.length>0&&f.push(u));return f}function GetSpecialBrandingPositionOptionsSelected_Ordering(n,t,i,r,u){for(var o,f,e=[],s=0;s<methods.length;s++)o=methods[s],(r==null||o!=r)&&(f=GetBrandingPositionOption_Ordering(o,$("#ddlBrandingMethods"+o+" option:selected").attr("index")),f!=null&&f.OptionSpecialRule!=null&&f.OptionSpecialRule.BrandingMethod==u&&f.OptionSpecialRule.Name==t&&(i==1&&f.OptionSpecialRule.BrandingPositionType==-3?e.push(f):i==2&&f.OptionSpecialRule.BrandingPositionType==-2?e.push(f):i==3&&f.OptionSpecialRule.BrandingPositionTypes.length>0&&e.push(f)));return e}function GetMutuallyExclusiveSpecialBrandingPositionOptionsSelected_Ordering(n,t,i){for(var u,r,e=[],f=0;f<methods.length;f++)u=methods[f],(t==null||t!=u)&&(r=GetBrandingPositionOption_Ordering(u,$("#ddlBrandingMethods"+u+" option:selected").attr("index")),r!=null&&r.OptionSpecialRule!=null&&(r.OptionSpecialRule.IsMutuallyExclusive&&i||!i)&&r.OptionSpecialRule.Name!=n&&e.push(r));return e}function GetGiftSetBrandingOnOrdering(n,t,i){for(var v,r,s,u,y,f,h,c,e,o="",l=[],a=0;a<positions.length;a++)v=positions[a],v.ComponentItemCode===n&&l.push(v);if(r=GetBrandingPositionOption(t,i),r!=="undefined"&&r!==null&&r.OptionSpecialRule!=="undefined"&&r.OptionSpecialRule!==null){if(r.OptionSpecialRule.IsMutuallyExclusive)for(s=0;s<l.length;s++)u=l[s],u.PositionCode!==t&&(y=$("#ddlBrandingMethods"+u.PositionCode+" option:selected").attr("index"),f=GetBrandingPositionOption(u.PositionCode,y),f!=="undefined"&&f!==null&&f.OptionSpecialRule!=="undefined"&&f.OptionSpecialRule!==null&&($("#ddlBrandingMethods"+u.PositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(u.PositionCode,null),o="Please note selecting the special for this position removed it from another position where the special is currently applied."));if(r.OptionSpecialRule.BrandingPositionType===-2&&(h=GetSpecialBrandingMethodOptionsSelected(r.BrandingCode,r.OptionSpecialRule.Name,2,r.OptionPositionCode,r.OptionSpecialRule.BrandingMethod,"ddlBrandingMethods"),h.length>0))for(c=0;c<h.length;c++){e=h[c];let n=GetBrandingPosition(e.OptionPositionCode).ComponentItemCode,t=GetBrandingPosition(r.OptionPositionCode).ComponentItemCode;e.OptionPositionCode!==r.OptionPositionCode&&n==t&&($("#ddlBrandingMethods"+e.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(e.OptionPositionCode,null),o="Please note selecting the special for this position removed it from another position where the special currently applied.")}}o!==""&&alertMessage(o)}function CheckSpecialsOnOrdering(n,t){var i=GetBrandingPosition_Ordering(n),r=$("#ddlBrandingMethods"+i.PositionCode+" option:selected").attr("index");i.ComponentItemCode===""||i.ComponentItemCode==null||i.ComponentItemCode==="undefined"||i.ComponentItemCode.toLowerCase()==="none"?GetItemBrandingOnOrdering(i.PositionCode,r,t):GetGiftSetBrandingOnOrdering(i.ComponentItemCode,i.PositionCode,r)}function BuildBrandingOptionsForGiftSet(n,t,i){for(var c,r,e,u,l,f,o="",s=[],h=0;h<positions.length;h++)c=positions[h],c.ComponentItemCode===n&&s.push(c);if(r=GetBrandingPositionOption_Ordering(t,i),r!=="undefined"&&r!==null&&r.OptionSpecialRule!=="undefined"&&r.OptionSpecialRule!==null&&r.OptionSpecialRule.IsMutuallyExclusive)for(e=0;e<s.length;e++)u=s[e],u.PositionCode!==t&&(l=$("#ddlBrandingMethods"+u.PositionCode+" option:selected").attr("index"),f=GetBrandingPositionOption_Ordering(u.PositionCode,l),f!=="undefined"&&f!==null&&f.OptionSpecialRule!=="undefined"&&f.OptionSpecialRule!==null&&($("#ddlBrandingMethods"+u.PositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected_Ordering(u.PositionCode,null),o="Please note selecting the special for this position removed it from another position where the special is currently applied."));o!==""&&alertMessage(o)}function GetItemBrandingOnOrdering(n,t,i){var v=$("#ddlColourNumbers"+n).is(":hidden")?null:$("#ddlColourNumbers"+n).val(),r,y,l,p,a,h,u,c,o,s,f,e;if(v==null&&(v=$("#ddlBrandingMethods"+n+" option:selected").attr("maxcolours")),r=GetBrandingPositionOption_Ordering(n,t),r!==null)if(i===2)y=GetFirstBrandingPositionOptionSpecial_Ordering(r.OptionPositionCode,r.BrandingCode,null,v),y!==null?($("#ddlBrandingMethods"+r.OptionPositionCode).prop("selectedIndex",y.DisplayIndex),RenderBrandingTypeSelected_Ordering(r.OptionPositionCode,null)):(l=GetBrandingPositionOptionSpecials_Ordering(r.OptionPositionCode,r.BrandingCode,null,null),l.length>0&&(p=parseInt(l[l.length-1].DisplayIndex)+1,$("#ddlBrandingMethods"+r.OptionPositionCode).prop("selectedIndex",p),RenderBrandingTypeSelected_Ordering(r.OptionPositionCode,null)));else if(r.OptionSpecialRule!==null){if(a=GetMutuallyExclusiveSpecialBrandingPositionOptionsSelected_Ordering(r.OptionSpecialRule.Name,r.OptionPositionCode,!0),h=null,r.OptionSpecialRule.IsMutuallyExclusive&&(u=GetMutuallyExclusiveSpecialBrandingPositionOptionsSelected_Ordering(r.OptionSpecialRule.Name,r.OptionPositionCode,!1),u.length>0))for(f=0;f<u.length;f++)e=u[f],e.OptionPositionCode!==r.OptionPositionCode&&($("#ddlBrandingMethods"+e.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected_Ordering(e.OptionPositionCode,null),h="Please note selecting the mutually exclusive special removed all other mutually exclusive specials where the specials currently applied.");if(r.OptionSpecialRule.BrandingPositionType===-2){if(u=GetSpecialBrandingPositionOptionsSelected_Ordering(r.BrandingCode,r.OptionSpecialRule.Name,2,r.OptionPositionCode,r.OptionSpecialRule.BrandingMethod),u.length>0)for(f=0;f<u.length;f++)e=u[f],e.OptionPositionCode!==r.OptionPositionCode&&($("#ddlBrandingMethods"+e.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected_Ordering(e.OptionPositionCode,null),h="Please note selecting the special for this position removed it from another position where the special currently applied.")}else if(r.OptionSpecialRule.BrandingPositionTypes.length>0&&jQuery.inArray(-1,r.OptionSpecialRule.BrandingPositionTypes)===-1&&(u=GetSpecialBrandingPositionOptionsSelected_Ordering(r.BrandingCode,r.OptionSpecialRule.Name,3,null,r.OptionSpecialRule.BrandingMethod),u.length>r.OptionSpecialRule.BrandingPositionTypes.length)){for(c=null,o=u.length-1;o>=0;o--){if(s=u[o],s.OptionPositionCode===r.OptionPositionCode)break;if(s.OptionPositionCode!==r.OptionPositionCode){c=s;break}}if(c==null)for(o=0;o<u.length;o++){if(s=u[o],s.OptionPositionCode===r.OptionPositionCode)break;if(s.OptionPositionCode!==r.OptionPositionCode){c=s;break}}c!=null&&($("#ddlBrandingMethods"+c.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected_Ordering(c.OptionPositionCode,null),h="Please note selecting the special for this position removed it from another position where the special currently applied.")}if(a.length>0)for(f=0;f<a.length;f++)e=a[f],e.OptionPositionCode!=r.OptionPositionCode&&($("#ddlBrandingMethods"+e.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected_Ordering(e.OptionPositionCode,null),h="Please note selecting the special removed all other mutually exclusive specials where the specials currently applied.");h!=null&&alertMessage(h)}}function SelectCartType(n){$("#modalSelectCart").modal("show");$("#selectCart-standard").attr("onclick","DisplayAddToCartOptions('"+n+"', 'standard')");$("#selectCart-logo24").attr("onclick","DisplayAddToCartOptions('"+n+"', 'logo24')")}function DisplayAddToCartOptions(n,t){$("#modalSelectCart").modal("hide");$("#cartType").val(t);_cartType=t;GetCatalogueQuantities(n).then(function(n){var t=n.TheData.GetCatalogueQuantities;if(t!=null){if(t.Min>0||t.Max>0){minCatalogueQty=t.Min;maxCatalogueQty=t.Max;cartQtyPerCatalogueQty=n.TheData.CartQty;isValidCatalogueQuantities=!0;let i=t.Min>0?"&nbsp;&nbsp;Min: "+t.Min:"",r=t.Max>0?"&nbsp;&nbsp;&nbsp;Max: "+t.Max:"";t.Min==0&&t.Max==0?$("#catalogueQuantities").hide():$("#CataloguetyMinMax").html(i+r)}else $("#catalogueQuantities").hide();t.IncrementBy>0&&(hasIncrementalValue=!0,IncrementalValue=t.IncrementBy)}}).then(function(){$.ajax({url:"AjaxHandler.aspx?a=CheckMixStock&p="+n+"&cType="+t,success:function(i,r){if(showLoading(!1),r=="success")if(i.Success){if(i.TheData!=null){let r=i.TheData,u=r.IsBokProduct,f=r.CartHasCustomCatalog,e=r.IsLockDownValid,o=r.IsEssential,s=r.IsEnabledForDisplayPilot,h=r.IsCustomProductMix;o?u?f?e?s?h?(alertMessage("Custom products cannot be placed on the same order as normal stock when your cart includes delivery. Kindly place your order for custom products separately or remove delivery from your cart and try again."),$("#modalOrderOnline").modal("hide")):$.ajax({url:"AjaxHandler.aspx?a=CheckComponentProductByGuid&p="+n+"&cType="+t,success:function(i,r){var f,u;r==="success"&&i.Success&&i.TheData!=null&&(f=i.TheData[0],_setType=i.TheData[1],u=curProdIndex===-1,addToCartDialog.open(u),components="",curComp="",brandingDone=!1,compIndex=0,curProdIndex===-1?(curProdIndex=$("#cRowIndex").val(),$("#atcLoader").show(),ATCInitialize(n)):(curProdIndex===-2&&($("#cRowIndex").val(""),$("#prevQty").val("")),$.ajax({url:"AjaxHandler.aspx?a=GetNextLineIndex&cType="+t,success:function(t,i){i==="success"?t.Success?t.TheData!=null&&(curProdIndex=t.TheData,$("#atcLoader").show(),ATCInitialize(n)):alertMessage("GetNextLineIndex: data.Success is false"):alertMessage("GetNextLineIndex: statusText is not success.")},error:this.HandleLoadError,dataType:"json",async:!1,cache:!1})))},error:this.HandleLoadError,dataType:"json",async:!1,cache:!1}):(alertMessage("You are currently unable to access this product. For assistance please contact your account manager."),$("#modalOrderOnline").modal("hide")):(alertMessage(r.Message),$("#modalOrderOnline").modal("hide")):(alertMessage("Custom catalogues items cannot be placed on the same order as normal stock. Kindly place your order for custom catalogues items separately."),$("#modalOrderOnline").modal("hide")):(alertMessage("Springbok items cannot be placed on the same order as normal stock or Springbok Sample items. Kindly place your order for Springbok items separately."),$("#modalOrderOnline").modal("hide")):(alertMessage("As part of National Lockdown regulations, we are not permitted to make this item available for general sale. Should you require this item for the use of a Permitted Business under L4 of the lockdown, kindly contact your account manager for assistance. <br/><br/>Please note that we will require a letter/email from your client on their letterhead confirming in writing the Permitted Business use that this item is required for prior to the order being processed. <br/><br/>Thank you for your understanding in these difficult and uncertain times."),$("#modalOrderOnline").modal("hide"))}}else alertMessage(i.Error);else alertMessage(i.Error)},error:this.HandleLoadError,dataType:"json",async:!1,cache:!1})}).catch(function(n){alertMessage(n)})}function ATCInitialize(n){$("#atcColours").show();$("#atcButtons").show();$("#atcNextButton").show();$("#atcQuantities").hide();$("#atcBranding").hide();$("#atcNoBranding").hide();$("#atcDoneButton").hide();$("#atcBackButton").hide();$("#atcDone").hide();$("#atcDoneButtons").hide();$("#logo24MethodQuantities").hide();$("#ddlBrandingPositions").val("-1");$("#prodGuid").val(n);_isWorkWear?LoadWorkWearProduct():LoadProduct();$(".a2cTitle .b").html("Add to Cart:");$("#qty_InStock").html("In Stock");$("#qty_InStock").css("margin-right","48px");$("#qty_Incoming1").show();$("#qty_Incoming2").show();_cartType!="logo24"?($(".logo24-atc-icon").hide(),$(".layout-thumb").hide()):($(".logo24-atc-icon").show(),$(".layout-thumb").show());_logo24BrandingAdded=!1;SetCurrentStep("1");$("#catalogueQuantities").hide()}function SetCurrentStep(n){$(".steps li").each(function(){$(this).removeClass("active")});$("#step"+n).addClass("active");n=="2"&&isValidCatalogueQuantities?$("#catalogueQuantities").show():$("#catalogueQuantities").hide();n=="1"&&isGiftset||isGiftsetNoColourOption&&isGiftset&&n=="2"||isGiftset&&n=="2"&&components!==""?$("#giftsetNote").show():n!=="1"&&$("#giftsetNote").hide()}function EditCartProductOptions(n,t){var i=location.pathname.substring(location.pathname.lastIndexOf("/")+1);i==="ViewQuote.aspx"&&($("#lnkDoneUpdatingQuoteProd").show(),$("#btnViewCart").hide());$("#cRowIndex").val(t);curProdIndex=-1;DisplayAddToCartOptions(n,_cartType)}function EditCartProductOptions_workwear(n,t){var i=location.pathname.substring(location.pathname.lastIndexOf("/")+1);i==="ViewQuote.aspx"&&($("#lnkDoneUpdatingQuoteProd").show(),$("#btnViewCart").hide());$("#cRowIndex").val(t);curProdIndex=-1;addToCartDialog.displayWorkWearAddToCart(n,_cartType)}function openBrandingInfo(){addBrandingInfo=!0;RemoveAndAddToCart()}function atcNext(){var n,t;if($("#atcCancelButton").attr("href","javascript:CloseAddToCart();"),$("#atcColours").is(":visible"))SetCurrentStep("2"),$(".cbSelected").length===0&&$(".colourBlock").length>0&&components===""?(SetCurrentStep("1"),alertMessage("Please select one or more colours to continue")):($("#atcColours").hide(),$("#atcQuantities").show(),$("#atcBackButton").show(),_cartType==="logo24"?($("#logo24MethodQuantities").show(),$.ajax({url:"AjaxHandlers/LogoUploadHandler.aspx?a=GetLogo24Info&p="+_itemCode,success:function(n,t){t==="success"&&(n.Success?n.TheData!=null&&($("#logo24BrandMethod").html(n.TheData.BrandMethod),$("#logo24QtyMinMax").html("Min: "+n.TheData.MinQty+" &nbsp;&nbsp;&nbsp;Max:"+n.TheData.MaxQty),_logo24Branding={brandGuid:n.TheData.BrandGuid,brandMethod:n.TheData.BrandMethod,position:n.TheData.Position,minQty:n.TheData.MinQty,maxQty:n.TheData.MaxQty,numberOfColours:n.TheData.NumberOfColours},$("#atcDoneButton").attr("href","javascript:ConfirmLogo24CartQuantities();")):($("#atcDoneButton").hide(),alertMessage("GetLogo24Info: "+n.Error)))},error:this.HandleLoadError,dataType:"json",cache:!1})):MainItem.isSample&&$("#atcDoneButton").attr("href","javascript:ConfirmBokSampleCartQuantities();"),_isWorkWear?LoadWorkWearSizes():LoadProductSizes(),$("#atcDoneButton").show(),$("#atcNextButton").hide());else if($("#atcQuantities").is(":visible"))if(n=GetTotalQty(),n>0||components!=""){let i=!0,r=0;if(isValidCatalogueQuantities){t=validateQty(n,minCatalogueQty,maxCatalogueQty);let u=maxCatalogueQty==null||maxCatalogueQty==0;if(t)i=!1;else{let n=u?"The quantity must be a minimum of "+minCatalogueQty:"The available range is minimum "+minCatalogueQty+" and maximum "+maxCatalogueQty;alertMessage("The entered quantity does not fall within the available range for"+$("#atcProductCode").html()+". <br/>"+n+". <br/>Please adjust your quantities accordingly to continue.")}cartQtyPerCatalogueQty>0&&(r=n+cartQtyPerCatalogueQty,r>maxCatalogueQty&&!u&&(i=!0,alertMessage("You already have a "+$("#atcProductCode").html()+" on the cart with the quantity of "+cartQtyPerCatalogueQty+". <br/>Please adjust your quantities to not exceed "+maxCatalogueQty)))}else i=!1;i||(SetCurrentStep("3"),$("#atcBranding").show(),$("#atcColours").hide(),$("#atcQuantities").hide(),$("#logo24MethodQuantities").hide(),$("#atcBackButton").show(),$("#atcNoBranding").hide(),$("#atcDoneButton").show(),$("#ddlBrandingPositions").val("-1"),$("#ddlBrandingPositions_chosen").length===0?$("#ddlBrandingPositions").chosen({disable_search:!0}):$("#ddlBrandingPositions").trigger("chosen:updated"),$("#atcNextButton").hide(),$("#atcCancelButton").attr("href","javascript:CancelAddToCart();"),LoadProductBranding())}else alertMessage("Please enter the quantities you require to continue.")}function ConfirmLogo24CartQuantities(){var i=0;$(".form-control.inStock").each(function(){i+=Number($(this).val())});var n=_logo24Branding.minQty,t=_logo24Branding.maxQty,r=CheckLogo24Qty2(i,n,t);r?$.ajax({url:"AjaxHandlers/LogoUploadHandler.aspx?a=ConfirmLogo24CartQuantities&p="+_itemCode+"&minQty="+n+"&maxQty="+t+"&nvalue="+i+"&i="+curProdIndex,success:function(i){i.Success&&(i.TheData===-1?RemoveAndAddToCart():i.TheData===0?alertMessage("Please note you have exceeded the amount you can order of this product for your current cart."):alertMessage("The entered quantity does not fall within the available range for LOGO24. <br/>The available range is minimum "+n+" and maximum "+t+". Please check if you have this product in your cart already and adjust your quantities accordingly to continue."))},error:this.HandleLoadError,dataType:"json",cache:!1}):alertMessage("The entered quantity does not fall within the available range for LOGO24. <br/>The available range is minimum "+n+" and maximum "+t+". <br/>Please adjust your quantities accordingly to continue.")}function GetCatalogueQuantities(n){var t=$.ajax({url:"AjaxHandler.aspx?a=GetCatalogueQuantities",data:{prodGuid:n,ProdIndex:$("#cRowIndex").val()},method:"GET",dataType:"JSON"});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(getAjaxErrorMessage(n))})}function ConfirmBokSampleCartQuantities(){RemoveAndAddToCart()}function getQtynSize(){let n=[];return new Promise(t=>{$("#atcSizeQuantities > div").each(function(){if(typeof($(this).attr("data-color")!=="undefined")){let t=$(this).attr("data-color");$(this).find(".inStock").each(function(){$(this).val()>0&&n.push({color:t,size:$(this).attr("data-sizecode"),value:$(this).val()})})}}),t(n)})}function CheckAvailableStock(){var n=!0;return $(".cSizeRow").each(function(){$("td",this).each(function(){var t=$(".qtyStockLevel",this);if(t.length>0){var i=Number(stringReplace(/of /,$(t).html(),"")),r=$(".qtyInput input",this),u=Number($(r).val());if(u>i)return n=!1,!1}})}),n}function CheckSampleQty(n){event.keyCode!=8&&Number(n.value)>2&&(alertMessage("Sample ordering is limited to a quantity of 2 per SKU."),n.value="2")}function CheckAvailableQty(n,t,i,r,u,f,e){var s,c,l,h,o;event.keyCode!=8&&(isNaN(n.value)&&(n.value=n.value.slice(0,-1),alertMessage("Please only enter valid numbers for the quantities that you require.")),s=Number(n.value),n.value=s,s>t&&(o="Please note that you entered a quantity that is larger than what we currently have in stock.",(r>0||u>0)&&(o=o+" We do have more stock incoming. Please contact your account manager to reserve this stock."),c=alertMessage(o),l=n.value,n.value=t,s=t),h=t-e,s>h?(h<0&&(h=0),n.value=h,o="Please note that some of this stock is reserved for another account. Please contact your account manager to confirm availability.",alertMessage(o)):SampleCheckAvailableQty(n))}function validateOnblur(n){var i,f;let t=!1,r=!1,u=!1;hasIncrementalValue&&(i=0,IncrementalValue>n.value&&(i=IncrementalValue,r=n.value,n.value=i,t=!0),n.value>IncrementalValue&&(i=Math.ceil(n.value/IncrementalValue)*IncrementalValue,u=n.value,t=!0,n.value=i),u==n.value&&(t=!1),r>IncrementalValue&&(t=!0),t&&(f="Please note that this item may only be ordered in multiples of "+IncrementalValue+". The stock quantity you entered will be rounded up to "+n.value+" units.",alertMessage(f)))}function SampleCheckAvailableQty(n){var t,i;event.keyCode!=8&&(t=Number(n.value),MainItem.isSample&&t>2&&(i="",i=typeof MainItem.MainProduct.Code!="undefined"?"Springbok Sample product orders are limited to a maximum of 2 units per line item. If you wish to order a quantity higher this, please place an order for "+MainItem.MainProduct.Code:"Springbok Sample product orders are limited to a maximum of 2 units per line item. If you wish to order a quantity higher this"))}function CheckAvailableComponentQty(n,t,i,r,u,f,e){var c,h,o,s;event.keyCode!=8&&(Number(n.value)>t?(o="Please note that you entered a quantity that is larger than what we currently have in stock.",(r>0||u>0)&&(o=o+" We do have more stock incoming. Please contact your account manager to reserve this stock."),alertMessage(o),c=n.value,n.value=t):(h=t-e,Number(n.value)>h&&(n.value=h,o="Please note that some of this stock is reserved for another account. Please contact your account manager to confirm availability.",alertMessage(o))),s=0,$(".input-group-addon.qtyStockLevel").each(function(){var n=Number($(this).html().replace("of ","").replace(",",""));(s===0||n<s)&&(s=n)}),$(".form-control.inStock").each(function(){Number(n.value)<=Number(s)?$(this).prop("disabled")||$(this).val(Number(n.value)):$(this).val(Number(s))}))}function atcBack(){$("#atcBranding").is(":visible")?($("#atcBranding").hide(),$("#atcNoBranding").hide(),$("#atcColours").hide(),$("#atcQuantities").show(),SetCurrentStep("2"),$("#modalOrderOnline #stepNote").html("Please enter the quantities you would like and click on <strong>Next<\/strong> to continue"),$("#atcDoneButton").hide(),$("#atcNextButton").show()):$("#atcQuantities").is(":visible")&&(SetCurrentStep("1"),$("#modalOrderOnline #stepNote").html("Please select the colours you would like and click on <strong>Next<\/strong> to continue"),$("#atcColours").show(),$("#atcQuantities").hide(),$("#logo24MethodQuantities").hide(),$("#atcBranding").hide(),$("#atcNoBranding").hide(),$("#atcBackButton").hide(),$("#atcDoneButton").hide(),$("#atcNextButton").show())}function toggleSelectedColour(n,t){$(n).hasClass("cbSelected")?($(n).removeClass("cbSelected"),$("input:checkbox",n).prop("checked",!1)):(t&&$(".cbSelected").each(function(){$(this).removeClass("cbSelected");$("input:checkbox",this).prop("checked",!1)}),$(n).addClass("cbSelected"),$("input:checkbox",n).prop("checked",!0))}function LoadProduct(){selectClass=".cbSelected";MainItem.isSample=!1;MainItem.MainProduct={};$(".Springbokitem").text("");$("#atcDoneButton").attr("href","javascript:RemoveAndAddToCart();");$.ajax({url:"AjaxHandler.aspx?a=GetProductDetailsVO&p="+$("#prodGuid").val(),success:function(n,t){var i,r;if(t==="success"&&n.Success&&n.TheData!=null)if(i=n.TheData,i.IsGiftset?(isGiftset=!0,$("#giftsetNote").show()):($("#giftsetNote").hide(),isGiftset=!1),$("#atcProductName").html(i.Name),$("#atcProductCode").html(" ("+i.Code+")"),$("#downloadLayout").attr("onclick",'DisplayBLDialog("'+i.Code+'", "standard")'),components=i.Components,_itemCode=i.Code,i.InventoryType===5&&(isDisplayProduct=!0),_isCustomPackaging=i.InventoryType==7,_isJodam=i.InventoryType==9,$("#divWait").show(),$("#modalOrderOnline .btnLoader").show(),r=IsLockDownSpecialityProduct(i.Code),$.when(r).then(function(){r?$(".essentialItem").show():$(".essentialItem").hide()}),IsCustomCatalogProduct(i.Code)&&(isCustomCatalog=!0,$(".CustomCatalogNote").show()),i.Code.startsWith("SAMPLE-")?$(".sampleItemNote").show():$(".sampleItemNote").hide(),_cartType==="logo24"&&(i.Logo24LayoutThumbnailURL!=null&&i.Logo24LayoutThumbnailURL!=""?($("#imgL24LayoutThumb").attr("src",i.Logo24LayoutThumbnailURL),$("#lnkL24LayoutThumb").attr("href",i.Logo24LayoutURL),$("#imgL24LayoutThumb").show()):$("#lnkViewCartClear").hide()),components!=""&&_setType!="normal")$("#divWait").hide(),$("#modalOrderOnline .btnLoader").fadeOut("slow"),atcNext(),isCustomCatalog?$(".CustomCatalogNote").show():$(".CustomCatalogNote").hide();else{if(gender=i.Gender,gender>0?(selectClass=".gender-"+gender+" "+selectClass,ggender="_"+gender,matchingCode=i.MatchingCode,matchingCode===""?selectClass=".cbSelected":gender===1?(heading=["MENS: "+_itemCode,"LADIES: "+matchingCode],gclass=[1,2],matchingGender=2):gender===2&&(heading=["LADIES: "+_itemCode,"MENS: "+matchingCode],gclass=[2,1],matchingGender=1),matching_selectClass=".gender-"+matchingGender+" .cbSelected"):selectClass=".cbSelected",$.ajax({url:"AjaxHandler.aspx?a=GetSpecialData&p="+i.Code,success:function(n){var t=n.TheData[0];specialImageUrl=t!==""?n.TheData[2]:""},error:this.HandleLoadError,dataType:"json",async:!1,cache:!1}),LoadProductColours(),IsSpringboxProduct(i.Code)||IsSpringboxProductSample(i.Code)){let n="5 working days";$(".Springbokitem .BokleadTime").text(n);$(".Springbokitem").show();let t=i.Code.toLowerCase();IsSpringboxProductSample(i.Code)?(MainItem.isSample=!0,MainItem.MainProduct={},$(".Springbokitem").text("Springbok merchandise, including samples, may not be returned for credit. Orders containing both Springbok sample items and normal stock items will follow bulk Warehouse lead-times and go onto a bulk shipment to a branch, if applicable.")):$(".Springbokitem").text("Please note: Springbok items have a minimum lead-time of "+n+".The lead-time for your order will be confirmed via email once you have placed your order. If you would like to check the lead-times for Springbok items please contact your account manager. As Springbok items are manufactured on order, once a sales order is generated, your order may not be cancelled.")}else $(".Springbokitem").hide();isCustomCatalog?$(".CustomCatalogNote").show():$(".CustomCatalogNote").hide()}},error:this.HandleLoadError,dataType:"json",cache:!1})}function LoadWorkWearProduct(){selectClass=".cbSelected";MainItem.isSample=!1;MainItem.MainProduct={};$(".Springbokitem").text("");$("#atcDoneButton").attr("href","javascript:RemoveAndAddToCart();");$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx?a=GetProductDetailsVO&p="+$("#prodGuid").val(),success:function(n,t){var i,r,u;t==="success"&&n.Success&&n.TheData!=null&&(i=n.TheData,i.IsGiftset?(isGiftset=!0,$("#giftsetNote").show()):$("#giftsetNote").hide(),$("#atcProductName").html(i.Name),$("#atcProductCode").html(" ("+i.Code+")"),$("#downloadLayout").attr("onclick",'DisplayBLDialog("'+i.Code+'", "standard")'),components=i.Components,_itemCode=i.Code,isDisplayProduct=!1,$("#divWait").show(),$("#modalOrderOnline .btnLoader").show(),$(".essentialItem").hide(),_cartType==="logo24"&&(i.Logo24LayoutThumbnailURL!=null&&i.Logo24LayoutThumbnailURL!=""?($("#imgL24LayoutThumb").attr("src",i.Logo24LayoutThumbnailURL),$("#lnkL24LayoutThumb").attr("href",i.Logo24LayoutURL),$("#imgL24LayoutThumb").show()):$("#lnkViewCartClear").hide()),productMatchType=i.ProductMatchType,r=i.Leadtime,productMatchType!=""?(selectClass=".conti-"+productMatchType+" "+selectClass,ggender="_"+productMatchType,matchingCode=i.ProductMatchCode,productMatchType==="MO"?(u=matchingCode!=""?"AVAILABLE IMMEDIATELY: "+matchingCode:"NO MATCHING PRODUCT AVAILABLE IMMEDIATELY",heading=["LEAD TIME: FROM "+r+" (QTY DEPENDENT): "+_itemCode,u],mclass=["MO","AI"],matchingProductType="AI"):productMatchType==="AI"&&(heading=["AVAILABLE IMMEDIATELY: "+_itemCode,"LEAD TIME: FROM "+i.MatchLeadtime+" (QTY DEPENDENT): "+matchingCode],mclass=["AI","MO"],matchingProductType="MO"),matching_selectClass=".conti-"+matchingProductType+" .cbSelected"):selectClass=".cbSelected",$.ajax({url:"AjaxHandler.aspx?a=GetSpecialData&p="+i.Code,success:function(n){var t=n.TheData[0];specialImageUrl=t!==""?n.TheData[2]:""},error:this.HandleLoadError,dataType:"json",async:!1,cache:!1}),LoadProductColours(),$(".Springbokitem").hide(),$(".CustomCatalogNote").hide())},error:this.HandleLoadError,dataType:"json",cache:!1})}function getRelatedProducts(n,t){let i=$.ajax({url:"AjaxHandler.aspx?a=GetRelatedProducts",data:{ProductGuid:n,Code:t},dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.Success?n.TheData:Promise.reject(n.Error)}).catch(function(n){return Promise.reject(n)})}function LoadProductColours(){$("#modalOrderOnline #stepNote").html("Please select the colours you would like and click on <strong>Next<\/strong> to continue");$("#atcColourOptions").html("");_isWorkWear?$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx?a=LoadProductColours&p="+$("#prodGuid").val()+"&cmpnt="+curComp,success:function(n,t){RenderWorkWearProductColours(n,t);GetProductTapeColours()},error:this.HandleLoadError,dataType:"json",cache:!1}):$.ajax({url:"AjaxHandler.aspx?a=LoadProductColours&p="+$("#prodGuid").val()+"&cmpnt="+curComp,success:this.RenderProductColours,error:this.HandleLoadError,dataType:"json",cache:!1})}function RenderProductColours(n,t){var e,h;if(t==="success")if(n.Success){if(n.TheData!=null){var r="",f=!1,u=!1;components!=""&&(u=!0);customeCatalogueProd.filter(n=>n.includes(_itemCode.substr(0,_itemCode.indexOf("-")))).length>0&&(u=!0);_isJodam&&(u=!0);for(e in n.TheData){var i=n.TheData[e],o=gender>0?"tile-gender":"",s="";i.special!=""&&i.special!=null&&(s='<div class="freeBranding-wrap"><div class="freeBrandingRibbon atc '+i.special+'" onclick="showFreeBrandingPopup(\''+specialImageUrl+"')\" >Branding Special * <\/div><\/div>",f=!0);i.code!="-1"?(h=i.name+" ("+i.code+")",r+='<div id="colour_'+i.code+'" onclick="toggleSelectedColour(this, '+u+')" class="colourBlock tile tile-order-online '+o+'">'+s+'<img src="'+i.imageUrl+'" class="img-responsive" /><div class="checkbox"><input type="checkbox" /><label class="title-wrap">'+h+"<\/label><\/div><\/div>"):r+='<div class="noColourBlock tile tile-order-online '+o+'" ><img src="'+i.imageUrl+'" /><\/div>'}r!=""&&f?$(".specialNote").show():$(".specialNote").hide();gender>0&&matchingCode!=""?(r='<div class="container col-md-5 atcGenderColours gender-'+gclass[0]+' "><section class="tile-dash vcard"><span class="title">'+heading[0]+'<\/span><div class="inner">'+r+'<\/div><\/section><\/div><div id="atcColoursGenderMatch" class="container col-md-5 atcGenderColours gender-'+gclass[1]+' "><\/div>',$("#atcColourOptions").html(r),$.ajax({url:"AjaxHandler.aspx?a=LoadProductColours&pc="+matchingCode,success:RenderMatchingProductColours,error:this.HandleLoadError,dataType:"json",cache:!1})):$("#atcColourOptions").html(r);r.indexOf("colourBlock")===-1?(isGiftsetNoColourOption=!0,atcNext()):isGiftsetNoColourOption=!1;$("#atcLoader").hide();components===""?$(".cartProductColour span.prod-base","#RowIndex_"+$("#cRowIndex").val()+" .cartColours").each(function(){var n=$(this).html(),t;n.indexOf("/")!=-1&&(n=n.replace("/","\\/"));n=n.substring(n.indexOf("(")).replace("(","").replace(")","");t=$("#colour_"+n);$(t).hasClass("cbSelected")||($(t).addClass("cbSelected"),$("input:checkbox",t).prop("checked",!0))}):$(".cartProductColour span","#RowIndex_"+$("#cRowIndex").val()+" .cartColours").each(function(){var r=$(this).html(),i,t,n;r===curComp&&(i=$(this).parent().parent().parent(),t=$("span",$(i).children("td").eq(1)).html(),t!="N/A"&&(n=$("#colour_"+t),$(n).hasClass("cbSelected")||($(n).addClass("cbSelected"),$("input:checkbox",n).prop("checked",!0))))})}$("#divWait").hide();$("#modalOrderOnline .btnLoader").fadeOut("slow")}else $("#divWait").hide(),$("#modalOrderOnline .btnLoader").fadeOut("slow"),alertMessage(n.Error);else $("#divWait").hide(),$("#modalOrderOnline .btnLoader").fadeOut("slow"),alertMessage("Error occured")}function RenderMatchingProductColours(n,t){var r,e,i,u,f,o;if(t==="success")if(n.Success){if(n.TheData!=null){r="";for(e in n.TheData)i=n.TheData[e],u=!1,components!=""&&(u=!0),f="",i.special!=""&&i.special!=null&&(f='<div class="freeBranding-wrap"><div class="freeBrandingRibbon atc '+i.special+'">Branding Special<\/div><\/div>'),i.code!="-1"?(o=i.name+" ("+i.code+")",r+='<div id="colour_'+i.code+'" onclick="toggleSelectedColour(this, '+u+')" class="colourBlock tile tile-order-online tile-gender">'+f+'<img src="'+i.imageUrl+'" class="img-responsive" /><div class="checkbox"><input type="checkbox" /><label class="title-wrap">'+o+"<\/label><\/div><\/div>"):r+='<div class="noColourBlock tile tile-order-online tile-gender" ><img src="'+i.imageUrl+'" /><\/div>';r='<section class="tile-dash vcard"><span class="title">'+heading[1]+'<\/span><div class="inner">'+r+"<\/div><\/section>";$("#atcColoursGenderMatch").html(r);$("#atcLoader").hide();components===""?$(".cartProductColour span.prod-match","#RowIndex_"+$("#cRowIndex").val()+" .cartColours").each(function(){var n=$(this).html(),t;n.indexOf("/")!=-1&&(n=n.replace("/","\\/"));n=n.substring(n.indexOf("(")).replace("(","").replace(")","");t=$("#colour_"+n,"#atcColoursGenderMatch");$(t).hasClass("cbSelected")||($(t).addClass("cbSelected"),$("input:checkbox",t).prop("checked",!0))}):$(".cartProductColour span","#RowIndex_"+$("#cRowIndex").val()+" .cartColours").each(function(){var t=$(this).html(),r,i,n;curComp==="GIFT-161"?(i=t.substring(t.lastIndexOf("-")+1),t=t.substring(0,t.lastIndexOf("-")),n=$("#colour_"+i),$(n).hasClass("cbSelected")||($(n).addClass("cbSelected"),$("input:checkbox",n).prop("checked",!0))):t===curComp&&(r=$(this).parent().parent().parent(),i=$("span",$(r).children("td").eq(1)).html(),i!="N/A"&&(n=$("#colour_"+i),$(n).hasClass("cbSelected")||($(n).addClass("cbSelected"),$("input:checkbox",n).prop("checked",!0))))})}}else alertMessage(n.Error)}function GetProductTapeColours(){$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx?a=GetProductTapeColours&p="+$("#prodGuid").val(),success:RenderProductTapeColours,error:this.HandleLoadError,dataType:"json",cache:!1})}function RenderProductTapeColours(n,t){t==="success"?n.Success?n.TheData!=null&&$("#atcTapeColours").html(n.TheData):alertMessage(n.Error):alertMessage("An error occurred.")}function GetProductTapeColoursMatch(n){$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx?a=GetProductTapeColours&pc="+n,success:function(n,t){t==="success"?n.Success?n.TheData!=null&&$("#atcTapeColoursMatch").html(n.TheData):alertMessage(n.Error):alertMessage("An error occurred.")},error:this.HandleLoadError,dataType:"json",cache:!1})}function RenderWorkWearProductColours(n,t){var i,e,c,r,o,s,h,l,u,f;if(t==="success")if(n.Success){if(n.TheData!=null){i="";e=!1;for(c in n.TheData)r=n.TheData[c],o=!1,components!=""&&(o=!0),s=productMatchType!=""?"tile-gender":"",h="",r.special!=""&&r.special!=null&&(h='<div class="freeBranding-wrap"><div class="freeBrandingRibbon atc '+r.special+'" onclick="showFreeBrandingPopup(\''+specialImageUrl+"')\" >Branding Special * <\/div><\/div>",e=!0),r.code!="-1"?(l=r.name+" ("+r.code+")",i+='<div id="colour_'+r.code+'" onclick="toggleSelectedColour(this, '+o+')" class="colourBlock tile tile-order-online '+s+'">'+h+'<img src="'+r.imageUrl+'" class="img-responsive" /><div class="checkbox"><input type="checkbox" /><label class="title-wrap">'+l+"<\/label><\/div><\/div>"):i+='<div class="noColourBlock tile tile-order-online '+s+'" ><img src="'+r.imageUrl+'" /><\/div>';i!=""&&e?$(".specialNote").show():$(".specialNote").hide();productMatchType!=""&&matchingCode!=""?(u='<div class="container col-md-5 atcGenderColours conti-'+mclass[0]+' "><section class="tile-dash vcard"><span class="title wwtitle">'+heading[0]+"<\/span>",u+='<div id="atcTapeColours" class="pdTapeColours pmatchContainer"><\/div>',u+='<div class="inner">'+i+"<\/div><\/section><\/div>",u+='<div id="atcColoursGenderMatch" class="container col-md-5 atcGenderColours conti-'+mclass[1]+' "><\/div>',$("#atcColourOptions").html(u),$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx?a=LoadProductColours&pc="+matchingCode,success:function(n,t){RenderWorkWearMatchingProductColours(n,t);GetProductTapeColoursMatch(matchingCode)},error:this.HandleLoadError,dataType:"json",cache:!1})):productMatchType=="MO"?(f='<section class="tile-dash vcard conti-'+mclass[0]+' "><span class="title wwtitle">'+heading[0]+"<\/span>",f+='<div id="atcTapeColours" class="pdTapeColours pmatchContainer atcNoMatch" ><\/div>',f+='<div class="inner">'+i+"<\/div><\/section>",$("#atcColourOptions").html(f)):productMatchType=="AI"?(i='<div id="atcTapeColours" class="pdTapeColours pmatchContainer atcNoMatch" ><\/div>'+i,$("#atcColourOptions").html(i)):$("#atcColourOptions").html(i);i.indexOf("colourBlock")===-1?(isGiftsetNoColourOption=!0,atcNext()):isGiftsetNoColourOption=!1;$("#atcLoader").hide();$(".cartProductColour span.prod-base","#RowIndex_"+$("#cRowIndex").val()+" .cartColours").each(function(){var n=$(this).html(),t;n.indexOf("/")!=-1&&(n=n.replace("/","\\/"));n=n.substring(n.indexOf("(")).replace("(","").replace(")","");t=$("#colour_"+n);$(t).hasClass("cbSelected")||($(t).addClass("cbSelected"),$("input:checkbox",t).prop("checked",!0))})}$("#divWait").hide();$("#modalOrderOnline .btnLoader").fadeOut("slow")}else $("#divWait").hide(),$("#modalOrderOnline .btnLoader").fadeOut("slow"),alertMessage(n.Error);else $("#divWait").hide(),$("#modalOrderOnline .btnLoader").fadeOut("slow"),alertMessage("Error occured")}function RenderWorkWearMatchingProductColours(n,t){var r,o,i,f,e,s,u;if(t==="success")if(n.Success){if(n.TheData!=null){r="";for(o in n.TheData)i=n.TheData[o],f=!1,components!=""&&(f=!0),e="",i.special!=""&&i.special!=null&&(e='<div class="freeBranding-wrap"><div class="freeBrandingRibbon atc '+i.special+'">Branding Special<\/div><\/div>'),i.code!="-1"?(s=i.name+" ("+i.code+")",r+='<div id="colour_'+i.code+'" onclick="toggleSelectedColour(this, '+f+')" class="colourBlock tile tile-order-online tile-gender">'+e+'<img src="'+i.imageUrl+'" class="img-responsive" /><div class="checkbox"><input type="checkbox" /><label class="title-wrap">'+s+"<\/label><\/div><\/div>"):r+='<div class="noColourBlock tile tile-order-online tile-gender" ><img src="'+i.imageUrl+'" /><\/div>';u='<section class="tile-dash vcard"><span class="title wwtitle">'+heading[1]+"<\/span>";u+='<div id="atcTapeColoursMatch" class="pdTapeColours pmatchContainer"><\/div>';u+='<div class="inner">'+r+"<\/div><\/section>";$("#atcColoursGenderMatch").html(u);$("#atcLoader").hide();$(".cartProductColour span.prod-match","#RowIndex_"+$("#cRowIndex").val()+" .cartColours").each(function(){var n=$(this).html(),t;n.indexOf("/")!=-1&&(n=n.replace("/","\\/"));n=n.substring(n.indexOf("(")).replace("(","").replace(")","");t=$("#colour_"+n,"#atcColoursGenderMatch");$(t).hasClass("cbSelected")||($(t).addClass("cbSelected"),$("input:checkbox",t).prop("checked",!0))})}}else alertMessage(n.Error)}function LoadProductSizes(){$("#modalOrderOnline #stepNote").html("Please enter the quantities you would like and click on <strong>Next<\/strong> to continue");$("#atcLoader").show();components===""?($("#atcBackButton").show(),$("#thSizeColour").html("Size"),$("#atcSizeLevels").removeClass("components-levels"),$("#thSizeColour").removeClass("th-oo-colour"),$("#thSizeColour").addClass("th-oo-size"),$("#thComponentType").hide(),$(".th-oo-product").html("Product"),$.ajax({url:"AjaxHandler.aspx?a=LoadProductSizes&p="+$("#prodGuid").val(),success:this.RenderProductSizes,error:this.HandleLoadError,dataType:"json",cache:!1})):($("#atcSizeLevels").addClass("components-levels"),$("#atcBackButton").hide(),$("#thSizeColour").html("Colour"),$("#thSizeColour").removeClass("th-oo-size"),$("#thSizeColour").addClass("th-oo-colour"),$("#thComponentType").show(),$(".th-oo-product").html("Product Part"),$("#atcSizeQuantities").html(""),$.ajax({url:"AjaxHandlers/ComponentMixMatchAjaxHandler.aspx",data:{a:"LoadComponentDetails",p:_itemCode,pguid:$("#prodGuid").val(),components:components,i:curProdIndex},type:"POST",success:RenderComponentDetails,error:this.HandleLoadError,dataType:"json",cache:!1}))}function LoadWorkWearSizes(){$("#modalOrderOnline #stepNote").html("Please enter the quantities you would like and click on <strong>Next<\/strong> to continue");$("#atcLoader").show();$("#atcBackButton").show();$("#thSizeColour").html("Size");$("#atcSizeLevels").removeClass("components-levels");$("#thSizeColour").removeClass("th-oo-colour");$("#thSizeColour").addClass("th-oo-size");$("#thComponentType").hide();$(".th-oo-product").html("Product");$.ajax({url:"AjaxHandler.aspx?a=LoadProductSizes&p="+$("#prodGuid").val(),success:RenderWorkWearSizes,error:this.HandleLoadError,dataType:"json",cache:!1})}function RenderWorkWearSizes(n,t){var i,r,e,u,o,f,s,h;if(t==="success")if(n.Success){if(n.TheData!=null){i="";r="";for(e in n.TheData)u=n.TheData[e],r===""?r=u.code:r+=","+u.code;$(selectClass).length>0?$(selectClass).each(function(){var f=$("img",this).attr("src"),n=$("label",this).html(),t=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),u="qty_"+t+ggender;i+='<div class="clearfix" data-color="'+t+'"><div class="order-online-image"><div class="tile tile-order-online">';i+='<img src="'+f+'" width="84" class="img-responsive"/>';i+='<label class="sizeColourCode title-wrap">'+n+"<\/label>";i+='<\/div><\/div><div class="order-online-main"><table id="'+u+'" class="table stock-table"><\/table><\/div><\/div><hr />';$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx",type:"POST",data:{a:"GetStockLevels",p:$("#prodGuid").val(),s:r,c:t,id:u,smpl:isSample,shop:sampleShop,cmpnt:curComp,i:curProdIndex,cartType:_cartType},success:RenderStockLevels,error:this.HandleLoadError,dataType:"json",cache:!1})}):(o=$(".noColourBlock img").attr("src"),i+='<div class="clearfix"><div class="order-online-image"><div class="tile tile-order-online">',i+='<img src="'+o+'" width="84" class="img-responsive"/>',i+='<\/div><\/div><div class="order-online-main"><table id="qty_Size" class="table stock-table"><\/table><\/div><\/div><hr />',$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx",type:"POST",data:{a:"GetStockLevels",p:$("#prodGuid").val(),s:r,c:"-1",id:"qty_Size",smpl:isSample,shop:sampleShop,cmpnt:curComp,i:curProdIndex,cartType:_cartType},success:RenderStockLevels,error:this.HandleLoadError,dataType:"json",cache:!1}));i!=""&&(productMatchType!=""&&$(matching_selectClass).length>0?(f='<div class="order-oo-header"><table class="table stock-table"><thead><tr><th class="th-oo-product">Product<\/th><th id="thSizeColour" class="th-oo-size">Size<\/th><th class="th-oo-stock">In Stock<\/th><th class="th-oo-incoming">Incoming 1<\/th><th>Incoming 2<\/th><\/tr><\/thead><\/table><\/div>',i='<div class="container col-md-5 atcGenderSizes atcWorkWearSizes conti-'+mclass[0]+' "><section class="tile-dash vcard"><span class="title wwtitle">'+heading[0]+'<\/span><div class="inner">'+f+'<div class="order-scrollable">'+i+"<\/div><\/div><\/section><\/div>",s='<div class="container col-md-5 atcGenderSizes atcWorkWearSizes conti-'+mclass[1]+' "><section class="tile-dash vcard"><span class="title wwtitle">'+heading[1]+'<\/span><div class="inner">'+f+'<div id="atcSizesGenderMatch" class="order-scrollable"><\/div><\/div><\/section><\/div>',matchingCode!=""&&(i=i+s),$("#atcSizeLevels").html(i),matchingCode!==""&&$.ajax({url:"AjaxHandler.aspx?a=LoadProductSizes&pc="+matchingCode,success:RenderMatchingWorkWearSizes,error:HandleLoadError,dataType:"json",cache:!1})):($("#atcSizeQuantities").length===0&&(h='<div class="order-oo-header"><table class="table stock-table"><thead><tr><th class="th-oo-product">Product<\/th><th id="thSizeColour" class="th-oo-size">Size<\/th><th class="th-oo-stock">In Stock<\/th><th class="th-oo-incoming">Incoming 1<\/th><th>Incoming 2<\/th><\/tr><\/thead><\/table><\/div><div id="atcSizeQuantities" class="order-scrollable"><\/div>',$("#atcSizeLevels").html(h)),$("#atcSizeLevels").addClass("conti-"+mclass[0]),productMatchType=="MO"&&($(".sizeLevelHeading").remove(),$("#atcSizeLevels").prepend('<div class="sizeLevelHeading"><strong>'+heading[0]+"<\/strong><\/div>")),$("#atcSizeQuantities").html(i)))}}else alertMessage(n.Error)}function RenderMatchingWorkWearSizes(n,t){var i,r,f,u;if(t==="success")if(n.Success){if(n.TheData!=null){i="";r="";for(f in n.TheData)u=n.TheData[f],r===""?r=u.code:r+=","+u.code;$(matching_selectClass).length>0&&$(matching_selectClass).each(function(){var f=$("img",this).attr("src"),n=$("label",this).html(),t=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),u="qty_"+t;i+='<div class="clearfix"><div class="order-online-image"><div class="tile tile-order-online">';i+='<img src="'+f+'" width="84" class="img-responsive"/>';i+='<label class="sizeColourCode title-wrap">'+n+"<\/label>";i+='<\/div><\/div><div class="order-online-main"><table id="'+u+'" class="table stock-table"><\/table><\/div><\/div><hr />';$.ajax({url:"AjaxHandlers/WorkWearAjaxHandler.aspx",type:"POST",data:{a:"GetStockLevels",pc:matchingCode,s:r,c:t,id:u,smpl:isSample,shop:sampleShop,cmpnt:curComp,i:curProdIndex,cartType:_cartType},success:RenderStockLevels,error:this.HandleLoadError,dataType:"json",cache:!1})});i!=""&&$("#atcSizesGenderMatch").html(i)}}else alertMessage(n.Error)}function RenderComponentDetails(n,t){var u,r,f;if(t==="success")if(n.Success){if(n.TheData!=null){u=n.TheData;r="";for(f in u){var i=u[f],o=i.Description,e="qty_"+i.Prefix;i.HideOnWebsite?(isHiddenComp=!0,r+='<div class="clearfix" style="display:none;"><div class="order-online-image"><div id="img_'+i.Prefix+'" class="tile tile-component">'):r+='<div class="clearfix"><div class="order-online-image"><div id="img_'+i.Prefix+'" class="tile tile-component">';r+='<img src="'+i.ImageUrl+'" width="84" class="img-responsive" />';r+='<label class="sizeColourCode title-wrap">'+o+"<\/label>";r+='<\/div><\/div><div class="order-online-main"><table id="'+e+'" class="table stock-table">'+i.TableRowHtml+"<\/table><\/div><\/div><hr />";$("#atcSizeQuantities").html(r);i.ContinueLoadingColours&&LoadComponentTypeColours(e,i.Prefix,i.ProductCode)}}}else alert(n.Error);else alert("Error: RenderComponentDetails")}function FormatComponentDescription(n){return n==="UP"?"Upper":n==="LOW"?"Lower":n==="BUTTON"?"Button":n}function RenderComponentTypes(n,t){var i,r,u,f;t==="success"?n.Success?n.TheData!=null&&($("#atcLoader").hide(),i=n.TheData[0],$("#"+i).html(n.TheData[1]),r=n.TheData[2],r==="true"&&(u=n.TheData[3],f=n.TheData[4],LoadComponentTypeColours(i,u,f))):alert(n.Error):alert("Error: RenderComponentTypes")}function LoadComponentTypeColours(n,t){var i=$(".cmptTypeSelect option:selected","#"+n).val(),r;i!=-1?$.ajax({url:"AjaxHandlers/ComponentMixMatchAjaxHandler.aspx",data:{a:"LoadComponentColours",p:_itemCode,id:n,cmpnt:t,i:curProdIndex,compType:i,pguid:$("#prodGuid").val()},type:"POST",success:RenderComponentColour,error:this.HandleLoadError,dataType:"json",cache:!1}):(r='<div class="form-inline"><div class="form-group"><div class="input-group">Please select a colour from the dropdown to see stock and enter quantities<\/div><\/div><\/div>',$(".td-oo-stock","#"+n).html(r),$(".cmptSelect","#"+n).html('<option value="-1">Select colour<\/option>'))}function RenderComponentColour(n,t){var i;if(t==="success")if(n.Success){if(n.TheData!=null){$("#atcLoader").hide();i=n.TheData[0];$(".cmptSelect","#"+i).replaceWith(n.TheData[1]);var u=n.TheData[2],f=n.TheData[3],e=n.TheData[4],o=n.TheData[5],r=$("#"+i).parent().parent();$("label",$(r)).html(e);$("img",$(r)).attr("src",o);f==="True"&&LoadComponentColourStock(i,u,"","")}}else alertMessage(n.Error);else alertMessage("Error: RenderComponentColour")}function LoadComponentColourStock(n,t,i,r){var u="0",f;$(".cmptSelect","#"+n).length>0&&(u=$(".cmptSelect option:selected","#"+n).val());i===""&&(i=_itemCode);r===""&&(r=$(".cmptTypeSelect option:selected","#"+n).val());u!="-1"?$.ajax({url:"AjaxHandlers/ComponentMixMatchAjaxHandler.aspx",data:{a:"LoadComponentStockForColour",p:i,id:n,cmpnt:t,clr:u,compType:r,i:curProdIndex,pguid:$("#prodGuid").val()},type:"POST",success:RenderComponentColourStock,error:this.HandleLoadError,dataType:"json",cache:!1}):(f='<div class="form-inline"><div class="form-group"><div class="input-group">Please select a colour from the dropdown to see stock and enter quantities<\/div><\/div><\/div>',$(".td-oo-stock","#"+n).html(f))}function SelectComponentColourStock(n,t,i){var r=i.split(","),u=r[0].replace("'","").replace("'","").trim(),f=r[1].replace("'","").replace("'","").trim();n!="-1"&&$.ajax({url:"AjaxHandlers/ComponentMixMatchAjaxHandler.aspx",data:{a:"LoadComponentStockForColour",p:t,id:u,cmpnt:f,clr:n},type:"POST",success:this.RenderComponentColourStock,error:this.HandleLoadError,dataType:"json",cache:!1})}function RenderComponentColourStock(n,t){if(t==="success")if(n.Success){if(n.TheData!=null){$("#atcLoader").hide();var i=n.TheData[0],r=n.TheData[1],u=n.TheData[2],f=n.TheData[3];$(".td-oo-stock","#"+i).html(r);$(".td-oo-incoming","#"+i).html(u);$(".td-oo-incoming2","#"+i).html(f)}}else alertMessage(n.Error)}function RenderProductSizes(n,t){var i,r,e,u,o,f,s,h;if(t==="success")if(n.Success){if(n.TheData!=null){i="";r="";for(e in n.TheData)u=n.TheData[e],r===""?r=u.code:r+=","+u.code;$(selectClass).length>0?$(selectClass).each(function(){var f=$("img",this).attr("src"),n=$("label",this).html(),t=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),u="qty_"+t+ggender;i+='<div class="clearfix" data-color="'+t+'"><div class="order-online-image"><div class="tile tile-order-online">';i+='<img src="'+f+'" width="84" class="img-responsive"/>';i+='<label class="sizeColourCode title-wrap">'+n+"<\/label>";i+='<\/div><\/div><div class="order-online-main"><table id="'+u+'" class="table stock-table"><\/table><\/div><\/div><hr />';$.ajax({url:"AjaxHandler.aspx",type:"POST",data:{a:"GetStockLevels",p:$("#prodGuid").val(),s:r,c:t,id:u,smpl:isSample,shop:sampleShop,cmpnt:curComp,i:curProdIndex,cartType:_cartType},success:RenderStockLevels,error:this.HandleLoadError,dataType:"json",cache:!1})}):(o=$(".noColourBlock img").attr("src"),i+='<div class="clearfix"><div class="order-online-image"><div class="tile tile-order-online">',i+='<img src="'+o+'" width="84" class="img-responsive"/>',i+='<\/div><\/div><div class="order-online-main"><table id="qty_Size" class="table stock-table"><\/table><\/div><\/div><hr />',$.ajax({url:"AjaxHandler.aspx",type:"POST",data:{a:"GetStockLevels",p:$("#prodGuid").val(),s:r,c:"-1",id:"qty_Size",smpl:isSample,shop:sampleShop,cmpnt:curComp,i:curProdIndex,cartType:_cartType},success:RenderStockLevels,error:this.HandleLoadError,dataType:"json",cache:!1}));i!=""&&(gender>0&&$(matching_selectClass).length>0?(f='<div class="order-oo-header"><table class="table stock-table"><thead><tr><th class="th-oo-product">Product<\/th><th id="thSizeColour" class="th-oo-size">Size<\/th><th class="th-oo-stock">In Stock<\/th><th class="th-oo-incoming">Incoming 1<\/th><th>Incoming 2<\/th><\/tr><\/thead><\/table><\/div>',i='<div class="container col-md-5 atcGenderSizes gender-'+gclass[0]+' "><section class="tile-dash vcard"><span class="title">'+heading[0]+'<\/span><div class="inner">'+f+'<div class="order-scrollable">'+i+"<\/div><\/div><\/section><\/div>",s='<div class="container col-md-5 atcGenderSizes gender-'+gclass[1]+' "><section class="tile-dash vcard"><span class="title">'+heading[1]+'<\/span><div class="inner">'+f+'<div id="atcSizesGenderMatch" class="order-scrollable"><\/div><\/div><\/section><\/div>',matchingCode!=""&&(i=i+s),$("#atcSizeLevels").html(i),matchingCode!==""&&$.ajax({url:"AjaxHandler.aspx?a=LoadProductSizes&pc="+matchingCode,success:RenderMatchingProductSizes,error:HandleLoadError,dataType:"json",cache:!1})):($("#atcSizeQuantities").length===0&&(h='<div class="order-oo-header"><table class="table stock-table"><thead><tr><th class="th-oo-product">Product<\/th><th id="thSizeColour" class="th-oo-size">Size<\/th><th class="th-oo-stock">In Stock<\/th><th class="th-oo-incoming">Incoming 1<\/th><th>Incoming 2<\/th><\/tr><\/thead><\/table><\/div><div id="atcSizeQuantities" class="order-scrollable"><\/div>',$("#atcSizeLevels").html(h)),$("#atcSizeQuantities").html(i)))}}else alertMessage(n.Error)}function RenderMatchingProductSizes(n,t){var i,r,f,u;if(t==="success")if(n.Success){if(n.TheData!=null){i="";r="";for(f in n.TheData)u=n.TheData[f],r===""?r=u.code:r+=","+u.code;$(matching_selectClass).length>0&&$(matching_selectClass).each(function(){var f=$("img",this).attr("src"),n=$("label",this).html(),t=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),u="qty_"+t;i+='<div class="clearfix"><div class="order-online-image"><div class="tile tile-order-online">';i+='<img src="'+f+'" width="84" class="img-responsive"/>';i+='<label class="sizeColourCode title-wrap">'+n+"<\/label>";i+='<\/div><\/div><div class="order-online-main"><table id="'+u+'" class="table stock-table"><\/table><\/div><\/div><hr />';$.ajax({url:"AjaxHandler.aspx",type:"POST",data:{a:"GetStockLevels",pc:matchingCode,s:r,c:t,id:u,smpl:isSample,shop:sampleShop,cmpnt:curComp,i:curProdIndex,cartType:_cartType},success:RenderStockLevels,error:this.HandleLoadError,dataType:"json",cache:!1})});i!=""&&$("#atcSizesGenderMatch").html(i)}}else alertMessage(n.Error)}function CheckLogo24Qty(n){var u=!0,t=0,i,r;return $(".form-control.inStock").each(function(){t+=Number($(this).val())}),i=_logo24Branding.minQty,r=_logo24Branding.maxQty,(t<i||t>r)&&(n.value=0,u=!1,alertMessage("The entered quantity does not fall within the available range for LOGO24. <br/>The available range is minimum "+i+" and maximum "+r+". <br/>Please adjust your quantities accordingly to continue.")),u}function CheckLogo24Qty2(n,t,i){var r=!0;return(n<t||n>i)&&(r=!1),r}function validateQty(n,t,i){var r=!0;let u=i==null||i==0;return(n<t||n>i)&&(n>i&&!u||n<t)&&(r=!1),r}function RenderStockLevels(n,t){if(t==="success"&&n!=null)if(n.Success)if($("#atcLoader").hide(),isHidden=n.TheData[2],isHidden==="True")RemoveAndAddHidden(Number($("#prevQty").val())),$("#cTotalQty").val($("#prevQty").val());else{var i=n.TheData[0];$("#"+i).html(n.TheData[1])}else alertMessage(n.Error)}function GetTotalQty(){var n=0;return components===""?($(".inStock").each(function(){n+=Number($(this).val())}),$(".incoming1").each(function(){n+=Number($(this).val())}),$(".incoming2").each(function(){n+=Number($(this).val())}),$(".inSampleStock").each(function(){n+=Number($(this).val())})):n=Number($(".inStock").val()),n}function GetTotalWorkWearQty(n){var t=0;return $(".conti-"+n+" .inStock").each(function(){t+=Number($(this).val())}),t}function GetProductColors(){var n=[];return $(selectClass).length>0&&$(selectClass).each(function(){var t=$("label",this).html(),i=t.substring(t.indexOf("(")+1,t.lastIndexOf(")"));n.push(i)}),n}function LoadProductBranding(){var n,r,t,i,u;if($("#bpFields").html('<img src="images/spinner.gif" />'),n=null,_isBrandingRequired=!1,_isNoCoBranding=!1,r=GetTotalQty(),t=GetProductColors(),t!=null&&t.length>0)for(i=0;i<t.length;i++)u=t[i],n==null?n=$("#prodGuid").val()+","+u:n+="|"+$("#prodGuid").val()+","+u;else n=$("#prodGuid").val()+",";_cartType!="logo24"&&$("#atcProductCode").html().includes("BOK")==!1?$.ajax({url:"AjaxHandler.aspx?a=LoadAllBrandingMethods&p="+$("#prodGuid").val()+(n!=null?"&sc="+n:"")+(r!=null?"&q="+r:"")+"&t=2&cartType="+_cartType,success:this.RenderBrandMethods,error:this.HandleLoadError,dataType:"json",cache:!1}):RemoveAndAddToCart()}function RenderBrandMethods(n,t){var c,u,o,s,l,p,i,h,f,e,r;if(t==="success")if(n.Success){if(n.TheData!=null){for(c=!1,_isBrandingRequired=n.TheData.IsBrandingRequired,_isNoCoBranding=n.TheData.IsNoCoBranding,_isBrandingRequired&&($("#modalGlobalLoading").show(),$("#brandingOptions").hide(),n.TheData.Positions.length===0&&(alertMessage("An error occurred while retrieving the branding types for this item"),$("#modalOrderOnline").modal("hide"),$("#modalGlobalLoading").hide())),i=0;i<n.TheData.Positions.length;i++)n.TheData.Positions[i].Options.length>0&&(c=!0);if(n.TheData.Positions.length>0&&c){if(methods=[],positions=[],u="",n.TheData.BrandingSpecialProductsNotIncluded!=null&&n.TheData.BrandingSpecialProductsNotIncluded.length>0)for(o=0;o<n.TheData.BrandingSpecialProductsNotIncluded.length;o++)for(s=n.TheData.BrandingSpecialProductsNotIncluded[o],i=0;i<s.BrandingSpecialProducts.length;i++)l=s.BrandingSpecialProducts[i],u+='<div class="alert alert-danger" role="alert" style="display: block;">Special ('+s.Name+") won’t apply because the following selected colours are not applicable for item ("+l.ItemCode+") : "+l.NoColorNames.join()+"<\/div>";for(u+='<div class="row"><div class="col-sm-2"><div class="form-horizontal form-account"><div class="form-group"><span class="col-xs-12 control-label">Position<\/span><\/div><\/div><\/div><div class="col-sm-4"><div class="form-horizontal form-account"><div class="form-group"><span class="col-xs-12 control-label">Branding Method:<\/span><\/div><\/div><\/div><div class="col-sm-4"><div class="form-horizontal form-account"><div class="form-group"><span id="NumberOfColoursHed" class="col-xs-12 control-label">Number of Colours:<\/span><\/div><\/div><\/div><\/div>',p=1,i=0;i<n.TheData.Positions.length;i++)h=n.TheData.Positions[i],methods.push(h.PositionCode),positions.push(h),u+=BrandingOrderPositionTemplate(h);$("#bpFields").html(u);$("#modalOrderOnline #stepNote").html("Select your branding options below and click on <strong>Next<\/strong> to continue");var a=!1,v=!1,y=!1;if($(".ddlBrandingMethods").each(function(){var n=$(this).attr("position"),u,t;if($(this).find("option").each(function(){var n=this,t=$(n).attr("maxColours");parseInt(t)>0&&(v=!0)}),$("#cRowIndex").length>0){var i=$("#"+$("#cRowIndex").val()+"_pos"+n+"_bMethod"),r=$("#"+$("#cRowIndex").val()+"_pos"+n+"_colourstitchVal"),f=$("#brandPosition_"+n,"#BrandIndex_"+$("#cRowIndex").val()),e=$(f).attr("isRepeat");e==="true"&&(y=!0);i.length>0&&(u=i.attr("brandGuid"),$(this).val(u),a=!0);t=null;r.length>0&&(t=r.html());RenderBrandingTypeSelected_Ordering(n,t);CheckSpecialsOnOrdering(n,2)}}),$(".pnlRepeatJob").hide(),a===!1){let n=$('.ddlBrandingMethods option[isSpecial="1"]').attr("positionCode");f=GetBrandingPositionOptionSpecials_Ordering(n,null,null,null);f.length>0&&($("#ddlBrandingMethods"+f[0].OptionPositionCode).prop("selectedIndex",parseInt(f[0].DisplayIndex)),RenderBrandingTypeSelected_Ordering(f[0].OptionPositionCode,null))}if(v===!1?$("#NumberOfColoursHed").hide():$("#NumberOfColoursHed").show(),specialImageUrl!=""&&showFreeBrandingPopup(specialImageUrl),_isWorkWear||_isCustomPackaging){for(r=0;r<$(".ddlBrandingMethods").length;r++){e=$(".ddlBrandingMethods").eq(r);let n=e.attr("isRequiredBranding");if(n=="true"){e.find("option[index='1']").prop("selected",!0);e.attr("disabled",!0);let n=e.attr("Position");$("#brandStitches"+n).show();$("#brandStitches"+n+" p.embNote").html("<strong>*<\/strong> This branding is included and cannot be selected.")}}$("#modalGlobalLoading").hide();$("#brandingOptions").show()}else if(_isBrandingRequired){if(isCustomCatalog)$(".ddlBrandingMethods").eq(0).find("option[index='1']").prop("selected",!0);else for(r=0;r<$(".ddlBrandingMethods").length;r++)$(".ddlBrandingMethods").eq(r).find("option[index='1']").prop("selected",!0);RemoveAndAddToCart();SetCurrentStep("4");$("#freeBrandingDialog").is(":visible")&&$("#freeBrandingDialog").modal("hide")}}else $("#brandingOptions").hide(),$("#atcDoneButton").show(),$("#atcNoBranding").hide(),$("#modalOrderOnline #stepNote").html('<span style="color:red;">This product does not have any available branding options. Click Next to continue.<\/span>')}}else $("#modalOrderOnline").modal("hide"),$("#modalGlobalLoading").hide(),alertMessage(n.Error)}function IsCustomCatalog(n){var t=$.ajax({url:"AjaxHandler.aspx?a=IsCustomCatalog&code="+n,dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(JSON.parse(n.responseText))})}function CanViewCustomCatalog(n,t){var i=$.ajax({url:"AjaxHandler.aspx?a=IsCustomCatalog&code="+n+"&status="+t,dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n}).catch(function(n){return Promise.reject(JSON.parse(n.responseText))})}function BrandingOrderPositionTemplate(n){var t="",i;for(t+="<div id='brandPosition"+n.PositionCode+"' class='row'><div class='col-sm-2'><div class='form-horizontal form-account'><div class='form-group'>",t+="<div class='col-xs-12' style='padding-right:5px;'>",t+="<p><strong>"+n.PositionCode+" - "+n.PositionName+"<\/strong><\/p><\/div><\/div><\/div><\/div>",t+="<div class='col-sm-4'><div class='form-horizontal form-account'><div class='form-group'>",t+="<div class='col-xs-12'><select id='ddlBrandingMethods"+n.PositionCode+"' onchange='BrandType_Selected_Ordering(\""+n.PositionCode+"\")' position='"+n.PositionCode+"' isRequiredBranding='"+n.IsRequiredBranding+"' isNoCoBranding='"+n.IsNoCoBranding+"' class='form-control ddlBrandingMethods' ><option value='None'>None<\/option>",i=0;i<n.Options.length;i++){let r=n.Options[i].OptionSpecialRule;t+="<option positionCode='"+n.PositionCode+"' isSpecial='"+(r!=null?"1":"0")+"' style=\""+(r!=null?"color : #d43f3a;":"")+"\" maxColours='"+n.Options[i].NumberofColours+"' index='"+n.Options[i].DisplayIndex+"' brandcode='"+n.Options[i].BrandingCode+"' brandname='"+n.Options[i].BrandingName+"' value='"+n.Options[i].BrandingGuid+"'>"+n.Options[i].BrandingName+"<\/option>"}return t+="<\/select><\/div><\/div><\/div><\/div>",t+="<div id='brandColours"+n.PositionCode+"' class='col-sm-4'><div class='form-horizontal form-account'><div class='form-group'>",t+="<div class='col-xs-12'><select id='ddlColourNumbers"+n.PositionCode+"' class='form-control' onchange='ColourNumber_OnChange_Ordering(\""+n.PositionCode+"\")'><option value='None'>None<\/option><\/select><\/div><\/div><\/div><\/div>",t+="<div id='brandStitches"+n.PositionCode+"' style='display:none;' class='col-sm-4'><div class='form-horizontal form-account'>",t+="<div class='form-group'><span class='col-xs-12'><p class='text-left embNote'><strong>*<\/strong> Embroidery price depends on number of stitches. <br />Please contact your account manager for a quote.<\/p><\/span><\/div><\/div><\/div><\/div>"}function toggleOrderBranding(){$("#chkNoBranding").is(":checked")?$.ajax({url:"AjaxHandler.aspx?a=RemoveLineBranding&p="+$("#prodGuid").val()+"&cType="+$("#cartType").val(),success:function(n,t){t==="success"&&(n.Success?n.TheData!=null&&($("#ddlBrandingPositions").val("-1"),BrandPositions_onchange(),$("#ddlBrandingPositions").prop("disabled",!0),$("#atcDoneButton").show(),brandingDone=!0):alertMessage("toggleOrderBranding: "+n.Error))},error:this.HandleLoadError,dataType:"json",cache:!1}):($("#ddlBrandingPositions").prop("disabled",!1),$("#atcDoneButton").hide(),brandingDone=!1)}function BrandPositions_onchange(){var n=$("#ddlBrandingPositions").val();if(n!=-1){for($("#bpFields").show(),$("#brandPosFrom").html("1"),$("#brandPosTo").html(n),$(".row","#bpFields").hide(),i=1;i<=n;i++)$("#brandPosition"+i).show();$("#atcDoneButton").show();DisplayBrandPositions(n)}else $("#bpFields").hide(),$("#atcDoneButton").hide()}function DisplayBrandPositions(n){for(i=1;i<=6;i++)i<=n&&i!=1&&($("#ddlBrandingMethods"+i).html($("#ddlBrandingMethods1").html()),$("#ddlBrandingMethods"+i).val($("#ddlBrandingMethods1 option:selected").val()),$("#brandStitches1").is(":visible")?$("#brandStitches"+i).show():$("#brandStitches"+i).hide(),$("#brandColours1").is(":visible")?($("#brandColours"+i).show(),$("#ddlColourNumbers"+i).html($("#ddlColourNumbers1").html())):$("#brandColours"+i).hide())}function atcNextPosition(){$("#stitchCountEstimate").hide();var n=$("#ddlBrandingPositions").val(),t=$("#brandPosFrom").html();$("#atcNextPosButton img").attr("src","images/btnNextPosition.gif");t<n?($("#brandPosition1").is(":visible")?($("#brandPosFrom").html("2"),$("#brandPosition1").hide(),$("#brandPosition2").show()):$("#brandPosition2").is(":visible")?($("#brandPosFrom").html("3"),$("#brandPosition2").hide(),$("#brandPosition3").show()):$("#brandPosition3").is(":visible")?($("#brandPosFrom").html("4"),$("#brandPosition3").hide(),$("#brandPosition4").show()):$("#brandPosition4").is(":visible")?($("#brandPosFrom").html("5"),$("#brandPosition4").hide(),$("#brandPosition5").show()):$("#brandPosition5").is(":visible")&&($("#brandPosFrom").html("6"),$("#brandPosition5").hide(),$("#brandPosition6").show(),$("#atcNextPosButton img").hide(),$("#atcDoneButton").show()),n=$("#ddlBrandingPositions").val(),t=$("#brandPosFrom").html(),n===t&&($("#atcNextPosButton img").hide(),$("#atcDoneButton").show())):($("#atcNextPosButton img").hide(),$("#atcDoneButton").show())}function ColourNumber_OnChange_Ordering(n){var i=$("#ddlColourNumbers"+n).val(),r=$("#ddlBrandingMethods"+n+" option:selected").attr("brandcode"),t=GetFirstBrandingPositionOptionSpecial_Ordering(n,r,null,i),u,f;t!=null?t.OptionSpecialRule.BrandingPositionType===-2?(u=GetSpecialBrandingPositionOptionsSelected_Ordering(r,t.OptionSpecialRule.Name,2,t.OptionPositionCode,t.OptionSpecialRule.BrandingMethod),u.length===0&&($("#ddlBrandingMethods"+n).prop("selectedIndex",parseInt(t.DisplayIndex)),RenderBrandingTypeSelected_Ordering(n,i))):t.OptionSpecialRule.BrandingPositionTypes.length>0&&jQuery.inArray(-1,t.OptionSpecialRule.BrandingPositionTypes)===-1&&(u=GetSpecialBrandingPositionOptionsSelected_Ordering(r,t.OptionSpecialRule.Name,3,t.OptionPositionCode,t.OptionSpecialRule.BrandingMethod),u.length<t.OptionSpecialRule.BrandingPositionTypes.length&&($("#ddlBrandingMethods"+n).prop("selectedIndex",parseInt(t.DisplayIndex)),RenderBrandingTypeSelected_Ordering(n,i))):(f=GetNotSpecialBrandingPositionOption_Ordering(n,r),f!=null&&($("#ddlBrandingMethods"+n).prop("selectedIndex",parseInt(f.DisplayIndex)),RenderBrandingTypeSelected_Ordering(n,i)));CheckSpecialsOnOrdering(n,1)}function RenderBrandingTypeSelected_Ordering(n,t){var i=$("#ddlBrandingMethods"+n+" option:selected"),y=i.val(),l=i.attr("brandcode"),a=i.attr("index"),v=parseInt(i.attr("maxColours")),p=i.text(),r=GetBrandingPositionOption_Ordering(n,a),u,f,o,e,h,s,c;if(r!=null){if(u=null,t!=null)u=t;else if(r.OptionSpecialRule!=null)r.OptionSpecialRule.NumberOfColours!=null&&(u=r.OptionSpecialRule.NumberOfColours);else if(f=GetBrandingPositionOptionSpecials_Ordering(n,l,null,null),f.length>0){for(o=null,e=1;e<=r.NumberofColours;e++){for(h=0,s=0;s<f.length;s++)c=f[s],c.OptionSpecialRule.NumberOfColours!=null&&e!=c.OptionSpecialRule.NumberOfColours&&h++;if(h===f.length){o=e;break}}o!=null&&(u=o)}RenderBrandFields(v,l,n,u)}else $("#brandStitches"+n).hide(),$("#brandColours"+n).hide(),$("#ddlColourNumbers"+n).hide()}function BrandType_Selected_Ordering(n){RenderBrandingTypeSelected_Ordering(n,null);CheckSpecialsOnOrdering(n,1)}function RenderBrandFields(n,t,r,u){var e=$("#ddlBrandingMethods"+r+" option:selected").attr("index"),o=self.GetBrandingPositionOption_Ordering(r,e),f;if(n===-1||n===-2)$("#brandColours"+r).hide(),o.OptionSpecialRule==null?t.indexOf("EM-")===-1&&t.indexOf("EMB")===-1?$("#brandStitches"+r).hide():$("#brandStitches"+r).show():$("#brandStitches"+r).hide();else{for($("#brandStitches"+r).hide(),$("#brandColours"+r).show(),f="",i=1;i<=n;i++)f+='<option value="'+i+'">'+i+"<\/option>";f!=""?($("#ddlColourNumbers"+r).show(),$("#ddlColourNumbers"+r).html(f),u!=null&&$("#ddlColourNumbers"+r).val(u)):$("#ddlColourNumbers"+r).hide()}}function QuickAdd(n){let t=$("#hdAccountStatus").val(),i=$("#txtQuickAddCode").val();CanViewCustomCatalog(i,t).then(t=>{var i,r;t.Success==!1?alert(t.Error):(i=$("#txtQuickAddCode").val(),addToCartDialog.open(),r=location.pathname.substring(location.pathname.lastIndexOf("/")+1),r==="ViewQuote.aspx"&&($("#lnkDoneUpdatingQuoteProd").show(),$("#btnViewCart").hide()),QuickAddToCart(n,i))}).catch(n=>{console.log(n)})}function QuickAddToCart(n,t){$modalOrderOnline.modal("hide");$.ajax({url:"AjaxHandler.aspx?a=GetProductGuidAndType&p="+t,success:function(n,t){if(t==="success")if($modalOrderOnline.modal("show"),n.Success)if(n.TheData!=null){var r=n.TheData[1]==="6",i=n.TheData[0];r?addToCartDialog.displayWorkWearAddToCart(i,_cartType):(_isWorkWear=!1,DisplayAddToCartOptions(i,"standard"))}else CloseAddToCart(),alertMessage("Product not found");else CloseAddToCart(),alertMessage("Product code entered not found");else CloseAddToCart(),alertMessage("Product not found")},error:this.HandleLoadError,dataType:"json",cache:!1})}function QuickAddSample(n){$.ajax({url:"AjaxHandler.aspx?a=GetProductGuid&p="+n,success:function(n,t){t==="success"?n.Success?n.TheData!=null?DisplayAddToCartOptions(n.TheData,null,!0):alertMessage("Product not found"):alertMessage("Product code entered not found"):alertMessage("Product not found")},error:this.HandleLoadError,dataType:"json",cache:!1})}function RemoveAndAddToCart(){var n=GetTotalQty(),i=$("#prevQty").val(),t,r,u,f;Number(i)>0&&n===0&&(isHidden==="True"||$(".atcComponent").html()==="GIFT-161")&&(n=Number(i));isHiddenComp&&n===0&&$(".inStock").each(function(){Number($(this).val())>0&&(n=Number($(this).val()))});i!=""&&i!=n&&components!=""?alertMessage("The quantity you have entered for this component is different from the quantity you entered for the previous component. Please note all components of this product should have the same quantity."):($("#atcLoader").show(),$("#atcBranding").is(":visible")&&(brandingDone=!0),n<1&&components!=""&&(n=$("#cTotalQty").val()),t=!0,components!=""&&($(".cmptSelect option:selected").each(function(){$(this).val()==="-1"&&(t=!1)}),$(".cmptTypeSelect option:selected").each(function(){$(this).val()==="-1"&&(t=!1)}),r="0",$(".form-control.inStock").each(function(){$(this).val()==="0"?t=!1:r==="0"?r=$(this).val():r!=$(this).val()&&(t=!1)})),n>0&&t?brandingDone?WrapPrintValid()?RemoveAndAddProductBrandingToCart():(alertMessage("Please note that when selecting Wrap Print you need to order a minimum quantity of 1000"),$("#atcLoader").hide()):(u="-1",f=1,$.ajax({url:"AjaxHandler.aspx?a=RemoveFromCart&p="+$("#prodGuid").val()+"&colour=-1&i="+curProdIndex+"&cType="+$("#cartType").val(),success:function(n,t){if(t=="success")if(n.Success)if(matchingCode!=""){let n=_isWorkWear?curProdIndex+1:curProdIndex;wwMatchIndex=n;$.ajax({url:"AjaxHandler.aspx?a=RemoveFromCart&pc="+matchingCode+"&colour=-1&i="+n+"&cType="+$("#cartType").val(),success:function(n,t){t=="success"&&(n.Success?AddToCart():alertMessage(n.Error))},error:this.HandleLoadError,dataType:"json",cache:!1})}else AddToCart();else alertMessage(n.Error)},error:this.HandleLoadError,dataType:"json",cache:!1})):(components!=""?alert("Please make the selections and enter the quantities you require to continue. All quantities must match for components"):alert("Please make the selections and enter the quantities you require to continue."),$("#atcLoader").hide()))}function AddToCart(){var u=0,i,f,r;if($(selectClass).length>0)$(selectClass).each(function(){var t=$("label",this).html(),n=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")),i;n.indexOf("/")!=-1&&(n=n.replace("/","\\/"));i="qty_"+n+ggender;$(".cSizeRow","#"+i).each(function(){var o=$(".sizeColourCode",this).html(),s;o===""&&(o=-1);var r=0,f=$(".inStock",this).val(),t=$(".incoming1",this).val(),i=$(".incoming2",this).val(),e=$(".inSampleStock",this).val();f==null&&(f=0);t==null&&(t=0);i==null&&(i=0);e==null&&(e=0);isSample&&(t=0,i=0);s=f+","+t+","+i+","+e;r=Number(f)+Number(t)+Number(i)+Number(e);r!=0&&(isNaN(r)||(u+=1,$.ajax({url:"AjaxHandler.aspx?a=AddToCart&p="+$("#prodGuid").val()+"&qty="+r+"&colour="+n+"&size="+o+"&ai="+s+"&sampleShop="+sampleShop+"&cmpnt="+curComp+"&i="+curProdIndex+"&cType="+$("#cartType").val(),async:!1,success:AddToCartComplete,error:this.HandleLoadError,dataType:"json",cache:!1})))})});else if($(".cSizeRow","#qty_Size").length>0)$(".cSizeRow","#qty_Size").each(function(){var f=$(".sizeColourCode",this).html(),o;f===""&&(f=-1);var e=0,i=$(".inStock",this).val(),n=$(".incoming1",this).val(),t=$(".incoming2",this).val(),r=$(".inSampleStock",this).val();i==null&&(i=0);n==null&&(n=0);t==null&&(t=0);r==null&&(r=0);isSample&&(n=0,t=0);o=i+","+n+","+t+","+r;e=Number(i)+Number(n)+Number(t)+Number(r);e!=0&&(u+=1,$.ajax({url:"AjaxHandler.aspx?a=AddToCart&p="+$("#prodGuid").val()+"&qty="+e+"&colour=-1&size="+f+"&ai="+o+"&sampleShop="+sampleShop+"&cmpnt="+curComp+"&i="+curProdIndex+"&cType="+$("#cartType").val(),async:!1,success:AddToCartComplete,error:this.HandleLoadError,dataType:"json",cache:!1}))});else{i=components.split(",");for(f in i){var e=i[f],t="#qty_"+e,o=$(".inStock",t).val(),h=$(".cmptTypeSelect option:selected",t).val(),s=o+",0,0,0",n=Number(o);Number.isNaN(n)&&(n=0);isHiddenComp&&n==0&&$(".inStock").each(function(){Number($(this).val())>0&&(n=Number($(this).val()),s=n+",0,0,0")});n!=0&&(r="",$(".cmptSelect",t).length>0&&(r=$(".cmptSelect option:selected",t).val()),$.ajax({url:"AjaxHandler.aspx?a=AddToCart&p="+$("#prodGuid").val()+"&qty="+n+"&colour="+r+"&size=-1&ai="+s+"&cmpnt="+e+"&i="+curProdIndex+"&cType="+$("#cartType").val()+"&compType="+h,async:!1,success:AddToCartComplete,error:this.HandleLoadError,dataType:"json",cache:!1}))}}(gender>0||productMatchType!="")&&AddMatchingProductToCart();$("#atcLoader").hide();AddToCartDone()}function AddMatchingProductToCart(){$(matching_selectClass).length>0&&$(matching_selectClass).each(function(){var t=$("label",this).html(),n=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")),i;n.indexOf("/")!=-1&&(n=n.replace("/","\\/"));i="qty_"+n;$(".cSizeRow","#"+i).each(function(){var e=$(".sizeColourCode",this).html(),o;e===""&&(e=-1);var r=0,u=$(".inStock",this).val(),t=$(".incoming1",this).val(),i=$(".incoming2",this).val(),f=$(".inSampleStock",this).val();u==null&&(u=0);t==null&&(t=0);i==null&&(i=0);f==null&&(f=0);isSample&&(t=0,i=0);o=u+","+t+","+i+","+f;r=Number(u)+Number(t)+Number(i)+Number(f);r!=0&&(isNaN(r)||$.ajax({url:"AjaxHandler.aspx?a=AddToCart&pc="+matchingCode+"&qty="+r+"&colour="+n+"&size="+e+"&ai="+o+"&sampleShop="+sampleShop+"&cmpnt="+curComp+"&i="+wwMatchIndex+"&cType="+$("#cartType").val(),async:!1,success:AddToCartComplete,error:this.HandleLoadError,dataType:"json",cache:!1}))})})}function RemoveAndAddHidden(n){n>0&&$.ajax({url:"AjaxHandler.aspx?a=RemoveFromCart&p="+$("#prodGuid").val()+"&cmpnt="+curComp+"&colour=-1&i="+curProdIndex+"&cType="+$("#cartType").val(),success:function(t,i){if(i==="success")if(t.Success){var u=n+",0,0,0",r="-1";curComp==="GIFT-161"&&(r=$("span",$(".cbSelected")).html());$.ajax({url:"AjaxHandler.aspx?a=AddToCart&p="+$("#prodGuid").val()+"&qty="+n+"&colour="+r+"&size=-1&ai="+u+"&sampleShop="+sampleShop+"&cmpnt="+curComp+"&i="+curProdIndex+"&cType="+$("#cartType").val(),async:!1,success:function(){$("#atcLoader").hide();AddToCartDone()},error:this.HandleLoadError,dataType:"json",cache:!1})}else alertMessage(t.Error)},error:this.HandleLoadError,dataType:"json",cache:!1})}function RemoveAndAddProductBrandingToCart(){var n=$("#atcProductCode").html();let t="";gender>0&&matchingCode!=""&&(_isWorkWear?t=matchingCode+":"+wwMatchIndex:n=matchingCode);$.ajax({url:"AjaxHandler.aspx?a=RemoveLineBranding&p="+n+":"+curProdIndex+"&cType="+_cartType+"&ww="+t,success:function(n,t){t==="success"&&(n.Success?_cartType!="logo24"?AddProductBrandingToCart():AddLogo24BrandingToCart():alertMessage("RemoveAndAddProductBrandingToCart: "+n.Error))},error:this.HandleLoadError,dataType:"json",cache:!1})}function AddLogo24BrandingToCart(){var n=GetTotalQty();n<1&&components!=""&&(n=$("#cTotalQty").val());var i=_logo24Branding.brandGuid,r=_logo24Branding.brandMethod,u=_logo24Branding.position,f=_logo24Branding.numberOfColours>0?1:_logo24Branding.numberOfColours,t=_itemCode;$(matching_selectClass).length>0&&(t=matchingCode===""?_itemCode:matchingCode);$.ajax({url:"AjaxHandler.aspx?a=AddBrandingToCart&p="+t+":"+curProdIndex+"&qty="+n+"&branding="+i+"&colours="+f+"&stitches=-1&methodName="+r+"&position="+u+"&pguid="+$("#prodGuid").val()+"&isSpecial=true&isRepeat=false&cType="+_cartType,success:function(n,t){t==="success"&&(n.Success?($("#atcLoader").show(),$("#atcDoneButtons").hide(),brandingDone=!0,$("#atcLoader").hide(),_logo24BrandingAdded=!0,AddToCartDone()):alertMessage("AddLogo24BrandingToCart: "+n.Error))},error:this.HandleLoadError,async:!1,dataType:"json",cache:!1})}function AddProductBrandingToCart(){Ordering.DataService.getCartSummary(_cartType).then(function(n){var f=0,i,r,u;productPositions=[];$(".ddlBrandingMethods option:selected").each(function(){$(this).text()!="None"&&f++});var e=1,t=0,o=0;if((_isWorkWear?(t=GetTotalWorkWearQty(mclass[0]),o=GetTotalWorkWearQty(mclass[1])):t=GetTotalQty(),t<1&&components!=""&&(t=$("#cTotalQty").val()),i=!1,r=!1,$(".ddlRepeatJob").is(":visible")&&(r=$(".ddlRepeatJob option:selected").val()==="2"?!0:!1),u=!1,$(".ddlBrandingMethods").each(function(){var y=$("#"+this.id+" option:selected").val(),s,l,a,v,p,w;if(y!="None"&&curProdIndex>=0){if(!n.HasBrandingItems&&n.IsDeliveryCart&&n.ProductCount>1)return alertMessage(addToCartDialog.MIX_DELIVERY_MSG),u=!0,!1;s=$("#"+this.id).attr("position");l=!1;$("#"+this.id).attr("isrequiredbranding")=="true"&&(l=!0);a=!1;$("#"+this.id).attr("isNoCoBranding")=="true"&&(a=!0);i=!0;var b=$("#"+this.id+" option:selected").text(),k=$("#"+this.id+" option:selected").attr("index"),h=0,c=0;$("#brandColours"+s).css("display")!="none"?(h=$("#ddlColourNumbers"+s).val(),c=-1):$("#brandStitches"+s).css("display")!="none"?(h=$("#"+this.id+" option:selected").attr("maxcolours"),c="0"):(h=$("#"+this.id+" option:selected").attr("maxcolours"),c=-1);h==="None"&&(h="-1");v=$("#atcProductCode").html();$(matching_selectClass).length>0&&!_isWorkWear&&(v=matchingCode===""?$("#atcProductCode").html():matchingCode);p={position:s,numColours:h};productPositions.push(p);w=GetBrandingPositionOption_Ordering(s,k);let d=_isWorkWear&&matchingCode!=""?matchingCode+":"+wwMatchIndex:"";$.ajax({url:"AjaxHandler.aspx",data:{a:"AddBrandingToCart",p:v+":"+curProdIndex,ww:d,qty:t,matchQty:o,branding:y,colours:h,stitches:c,methodName:b,position:s,pguid:$("#prodGuid").val(),isSpecial:w.OptionSpecialRule!=null?!0:!1,isRepeat:r,cType:$("#cartType").val(),brandingRequired:l,noCoBranding:a},success:function(n,t){t==="success"&&(n.Success?e===f?($("#atcLoader").show(),$("#atcDoneButtons").hide(),brandingDone=!0,$("#atcLoader").hide(),AddToCartDone()):e++:alertMessage("AddBrandingToCart: "+n.Error))},error:this.HandleLoadError,async:!1,dataType:"json",cache:!1})}}),!u)&&!i){if(n.HasBrandingItems&&n.IsDeliveryCart){alertMessage(addToCartDialog.MIX_DELIVERY_MSG);return}$("#atcLoader").hide();AddToCartDone()}})}function AddToCartComplete(n,t){t==="success"&&(n.Success?(n.TheData!=null,addToCartDialog.setAddedToCart(!0)):alertMessage(n.Error),_isBrandingRequired&&$("#modalGlobalLoading").hide())}function AddToCartDone(){$("#atcBranding").hide();$("#atcButtons").hide();$("#atcDoneButtons").show();$("#atcLoader").hide();_cartType==="logo24"?$("#btnViewCart").attr("href","ViewCart.aspx?t=logo24"):$("#atcDone").show();components!=""?isSample||brandingDone||($("#atcDone").hide(),$("#atcDoneButtons").hide(),$("#atcButtons").show(),atcNext()):isSample?$("#atcQuantities").hide():brandingDone?($("#modalOrderOnline #stepNote").html('<span style="color:#26bff1; font-weight:bold;">The product has been added to your cart.<\/span>'),SetCurrentStep("4")):($("#atcDone").hide(),$("#atcDoneButtons").hide(),$("#atcButtons").show(),atcNext());brandingDone&&(_logo24BrandingAdded||_cartType!="logo24")&&(RecalculateCartAndDelivery().then(function(){if(addBrandingInfo){CloseAddToCart();logoUpload.open(curProdIndex,productPositions[0].position);addBrandingInfo=!1;$("body").on("LOGO_UPLOAD_CLOSED",function(){window.location="ViewCart.aspx"})}}),curProdIndex=-2);_isBrandingRequired&&$("#modalGlobalLoading").hide()}function WrapPrintValid(){var t=$("#ddlBrandingPositions").val(),u=GetTotalQty(),i=!0,n,r;if(t!=-1)for(n=1;n<=t;n++)if(r=$("#ddlBrandingMethods"+n+" option:selected").text(),r.indexOf("Wrap Print - PW")!=-1&&u<1e3){i=!1;break}return i}function RecalculateCart(){var n=$("#cartType").val();n===""&&(n=_cartType);$.ajax({url:"AjaxHandler.aspx?a=RecalculateCart&cType="+n,success:function(n,t){t==="success"&&n.Success&&(n.TheData==null?alertMessage(n.Error):$("#atcLoader").hide())},error:this.HandleLoadError,dataType:"json",cache:!1})}function RecalculateCartAndDelivery(){return $("#modalGlobalLoading").show(),Delivery.DataService.recalculateDelivery(_cartType).then(function(n){if($("#modalGlobalLoading").hide(),n!=null){var t=n.QuotePrice,i=n.QuoteNumber;return alertMessage("Please note that as you have delivery added on your cart, we will recalculate the delivery cost and cart totals after any changes made to the products in your cart."),Delivery.DataService.updateShippingCost(t,_cartType,i).then(function(){return Delivery.DataService.recalculateCart(_cartType).then(function(){}).catch(function(n){alertMessage(n)})}).catch(function(n){alertMessage(n)})}return Delivery.DataService.recalculateCart(_cartType).then(function(n){n==null||n.Success||alertMessage('There was a problem calculating the branding prices for your cart. <br/><br/>Please check if any items in your cart have a a setup fee that has not been charged for. If so, click the "edit" button to launch the online ordering wizard for that product and check that the branding has been added correctly. Once done, please click the "Next" button and try placing your order again.')}).catch(function(n){alertMessage(n)})}).catch(function(n){$("#modalGlobalLoading").hide();alertMessage(n)})}function UpdateShippingCost(n){$.ajax({url:"AjaxHandler.aspx?a=UpdateShippingCost&cType="+_cartType+"&c="+n,success:function(n,t){t==="success"&&(n.Success?RecalculateCart():alertMessage("Error on UpdateShippingCost"))},error:this.HandleLoadError,dataType:"json",async:!1,cache:!1})}function CommentCartItem(n){var t="Enter comment here";$.ajax({url:"AjaxHandler.aspx?a=LoadCartItemComment&p="+n+"&cType="+_cartType,success:function(i,r){r==="success"&&i.Success&&i.TheData!=null&&(i.TheData!=""&&(t=i.TheData),bootbox.prompt({title:"Add a comment or special instruction for this cart item.",value:t,callback:function(t){t!==null&&$.ajax({url:"AjaxHandler.aspx?a=SetCartItemComment&p="+n+"&c="+t+"&i="+curProdIndex+"&cType="+$("#cartType").val(),success:function(n,t){t==="success"&&n.Success&&bootbox.alert("Comment added for "+n.TheData)},error:this.HandleLoadError,dataType:"json",cache:!1})}}))},error:this.HandleLoadError,dataType:"json",cache:!1})}function LoadShoppingCart(){$("#cartLoading").show();var n="",t=$("#hfCartType").val();_cartType=t;$("#lnkViewCartClear").attr("onclick",'ConfirmClearCart("'+_cartType+'")');n=_cartType==="logo24"?"btnAddDeliverylogo24, #NoDeliveryinCartPopUp .btnAddDeliveryStd":"btnAddDeliveryStd";$("."+n).click(function(){showPageLoading();Ordering.DataService.getCartSummary(_cartType).then(function(n){if(hidePageLoading(),n.HasBrandingItems&&n.HasNonBrandingItems){alertMessage(addToCartDialog.MIX_DELIVERY_MSG);return}if(n.IsCustomProductMix){alertMessage(addToCartDialog.MIX_DELIVERY_CUSTOM_MSG);return}deliveryAddressSelector.showPopup(1,2)}).catch(function(n){hidePageLoading();alertMessage(n)})});$.ajax({url:"AjaxHandler.aspx?a=LoadShoppingCart&t="+t,success:this.RenderShoppingCart,error:this.HandleLoadError,dataType:"json",cache:!1})}function RenderShoppingCart(n,t){var p,ut,h,ot,y,ni,tt,st,pt,k,s,b,it,d,bt,u,i,ht,nt,a,kt,v,l,ct,lt,rt,o,dt;if(t==="success")if(n.Success){if(n.TheData!=null){$("#btnPlaceOrder").show();p="";p=_cartType==="logo24"?"btnAddDeliverylogo24":"btnAddDeliveryStd";$("#lblCartSubTotal").html($().number_format(n.TheData.CartVO.SubTotal));$("#lblCartBrandingTotal").html($().number_format(n.TheData.CartVO.BrandingTotal));$("#lblCartSetupTotal").html($().number_format(n.TheData.CartVO.SetupTotal));$("#lblDeliveryTotal").html($().number_format(n.TheData.CartVO.DeliveryTotal));$("#lblCartTaxAmount").html($().number_format(n.TheData.CartVO.TaxAmount));$("#lblCartTotal").html($().number_format(n.TheData.CartVO.CartTotal));logo24Flags=n.TheData.CartVO.Logo24Flags;$("#lnkQuickAdd").click(function(){QuickAdd(!1)});ut=n.TheData.CartVO.SampleShop;ut!=""?($("#lblSampleShop").html(ut),$("#cartBrandTotal").hide()):($("#cartTitle").html("Shopping Cart"),$("#selSShop").hide(),$("#cartBrandTotal").show());$("#btnOrderSamples").hide();var ft="",w=n.TheData.CartLinesVO.length,et=!1;for($btnAddAllBrandInfo.hide(),h=0;h<w;h++){var r=n.TheData.CartLinesVO[h],f=template_orderItemRow,at=r.Index,c=r.InventoryType===5?!0:!1,vt=r.InventoryType===6?!0:!1,yt=r.InventoryType===7?!0:!1,gt=r.InventoryType===9?!0:!1;if(r.IsLeadTimeMO&&(_isLeadTimeMO=!0),ot=-1,h>0&&(ot=n.TheData.CartLinesVO[h-1].Index),ot!=at){f=stringReplace(/##PRODUCTCODE##/,f,r.ProductCode);f=stringReplace(/##PRODUCTNAME##/,f,r.ProductName);f=stringReplace(/##PRODUCTIMAGE##/,f,r.DefaultImageURL);f=stringReplace(/##PRODUCTGUID##/,f,r.ProductGuid);f=stringReplace(/##ROWINDEX##/,f,r.Index);f=stringReplace(/##ISSAMPLE##/,f,r.IsSample);f=stringReplace(/##REMOVEPARAMS##/,f,"'"+r.ProductGuid+"'");f=stringReplace(/##FULLPRODUCTCODE##/,f,r.ProductCode+":"+r.Index);f=vt?stringReplace(/##EDITMETHODNAME##/,f,"EditCartProductOptions_workwear"):stringReplace(/##EDITMETHODNAME##/,f,"EditCartProductOptions");y="";ni="";cItemCost=0;tt=r.ProductCode;tt.includes("BOK")&&(springBokFlag=!0);for(b in r.CartItemsVO)st=r.CartItemsVO[b],pt=Number(b)+1!=r.CartItemsVO.length,y+=GetLineData(st,r.HasComponents,pt,!1,r.ProductCode);if(it="",k="",Number(h)+1!=w&&(s=n.TheData.CartLinesVO[h+1],s.Index===at)){tt=s.ProductCode;y+='<tr><td class="colourCell" colspan="5"><h3 style="margin:0px;"><span matching-product-code="'+s.ProductCode+'">'+s.ProductCode+"<\/span>"+s.ProductName+"<\/h3><\/td><\/tr>";for(b in s.CartItemsVO){let n=s.CartItemsVO[b],t=Number(b)+1!=s.CartItemsVO.length;y+=GetLineData(n,s.HasComponents,t,!0,r.ProductCode)}k=s.ProductCode}it="";r.HasComponents?(d=template_itemTotalsRow,d=stringReplace(/##ITEMCOST##/,d,$().number_format(cItemCost)),d=stringReplace(/##TOTALITEMCOST##/,d,$().number_format(cItemCost*st.Quantity)),y+=d,it="<tr><th>Component<\/th><th>Colour<\/th><th>Quantity<\/th><\/tr>"):it="<tr><th>Colour<\/th><th>Size<\/th><th>Quantity<\/th><th>Product Price<\/th><th>Total Product Price<\/th><\/tr>";f=stringReplace(/##CARTITEMHEDS##/,f,it);var e="",wt=0,g=r.CartBrandingVO;k!=""&&(g=n.TheData.CartLinesVO[h+1].CartBrandingVO);et=g.length>0;c&&(g=g.slice(0,1),$("#displayItems").show());for(bt in g){u=g[bt];let n=u.IsNoCoBranding,t=u.IsRequiredBranding;_cartType=="logo24"||c?c?(i=template_brandingRow_display,n&&(i=brandingRow_display_forNoCoBranding),i=stringReplace(/##DISPLAYPRODUCT##/,i,!0)):i=template_logo24_brandingRow:(i=template_brandingRow,n&&(i=brandingRow_forNoCoBranding));i=stringReplace(/##ISNOCOBRANDING##/,i,n);i=stringReplace(/##isRequiredBranding##/,i,t);i=stringReplace(/##isWorkWear##/,i,vt);i=stringReplace(/##POSITION##/,i,u.Position);i=stringReplace(/##POSITIONNAME##/,i,'class="cartTip" data-toggle="tooltip" data-placement="top" data-original-title="'+u.PositionDescription+'"');i=stringReplace(/##BRANDMETHOD##/,i,u.BrandMethodCode);i=stringReplace(/##customBoxes##/,i,yt);i=stringReplace(/##ISTEMPLATE##/,i,yt||gt||c);ht="";u.DyeSize!=""&&(ht="||"+u.DyeSize);i=stringReplace(/##BRANDGUID##/,i,u.BrandingGuid+ht);i=stringReplace(/##FULLPRODUCTCODE##/,i,r.ProductCode+":"+r.Index);i=stringReplace(/##PRODUCTCODE##/,i,tt);i=stringReplace(/##PRODUCTNAME##/,i,r.ProductName);i=u.Status.indexOf("IsAdded")>-1?stringReplace(/##STATUS##/,i,"Edit"):u.Status.indexOf("IsCopy")>-1?stringReplace(/##STATUS##/,i,"Copied"):u.Status.indexOf("IsRepeat")>-1?stringReplace(/##STATUS##/,i,"Repeated"):stringReplace(/##STATUS##/,i,"Info");k===""&&(k=r.ProductCode);i=stringReplace(/##REMOVEBRANDPOSITION-FULLPRODUCTCODE##/,i,k+":"+r.Index);nt=u.BrandMethodName;i=nt==="Sublimation"||nt==="Digital Transfer"||nt==="Digital Print"?stringReplace(/##COLOURSTITCHVALUE##/,i,"Full"):nt==="Laser Engraving"||u.BrandMethodCode==="BOS"?stringReplace(/##COLOURSTITCHVALUE##/,i,"N/A"):nt.indexOf("Embroidery")!=-1?u.NumberOfColours===-2?stringReplace(/##COLOURSTITCHVALUE##/,i,"N/A"):stringReplace(/##COLOURSTITCHVALUE##/,i,"Embroidery Price Depends On Number Of Stitches."):u.BrandMethodCode.indexOf("CMT-CONTI")!=-1?stringReplace(/##COLOURSTITCHVALUE##/,i,"N/A"):u.NumberOfStitches===-1?u.NumberOfColours===-2||u.NumberOfColours===-1?stringReplace(/##COLOURSTITCHVALUE##/,i,"N/A"):stringReplace(/##COLOURSTITCHVALUE##/,i,u.NumberOfColours):stringReplace(/##COLOURSTITCHVALUE##/,i,u.NumberOfStitches);i=stringReplace(/##BRANDSETUP##/,i,$().number_format(u.Setup));i=stringReplace(/##BRANDQTY##/,i,u.Quantity);i=stringReplace(/##LOGOID##/,i,u.LogoId>0?u.LogoId:"");i=stringReplace(/##LOGONAME##/,i,u.LogoName||"");u.PantoneColour&&(i=stringReplace(/##PANTONECOLOUR##/,i,u.PantoneColour));c||(a=u.PricePerUnit,a!==0||u.IsSpecial!=null&&u.IsSpecial?a=$().number_format(a):(kt='<a class="btn-tooltip blue cartTip" data-toggle="tooltip" data-placement="top" title="" data-original-title="Prices for embroidery depend on the stitch count. Please contact your account manager to request a price."><i class="fa fa-info embTip"><\/i><\/a>',a=$().number_format(a),u.BrandMethodName==="Embroidery"?(EM_TBA=!0,a="TBA "+kt):EM_TBA=!1),i=stringReplace(/##BRANDTOTAL##/,i,a),i=stringReplace(/##BRANDTOTAL_STYLE##/,i,u.IsSpecial!=null&&u.IsSpecial?'style="color : #d43f3a;"':""),i=stringReplace(/##TOTALLINEBRANDING##/,i,$().number_format(u.Total)),wt+=Number(u.Total));i=stringReplace(/##ROWINDEX##/,i,r.Index);i=u.IsRepeat!=null&&u.IsRepeat?stringReplace(/##ISREPEAT##/,i,"true"):stringReplace(/##ISREPEAT##/,i,"false");e+=i}if(e!=""){v=_cartType=="logo24"||c?c?'<div class="col-sm-12"><table id="BrandIndex_'+r.Index+'" class="table dt-responsive cart-table data-table cart-table-lg cartBranding" width="100%"><thead><tr><th>Branding<\/th><th>Method<\/th><th>Colours/Stitches<\/th><th>Quantity<\/th><th>Artwork<\/th><th>Remove Branding<\/th><\/tr><\/thead><tbody>':'<div class="col-sm-12"><table id="BrandIndex_'+r.Index+'" class="table dt-responsive cart-table data-table cart-table-lg cartBranding" width="100%"><thead><tr><th>Branding<\/th><th>Method<\/th><th>Colours/Stitches<\/th><th>Quantity<\/th><th>Logo<\/th><th>Pantone Colour<\/th><th>Setup<\/th><\/tr><\/thead><tbody>':'<div class="col-sm-12"><table id="BrandIndex_'+r.Index+'" class="table dt-responsive cart-table data-table cart-table-lg cartBranding" width="100%"><thead><tr><th>Branding<\/th><th>Method<\/th><th>Colours/Stitches<\/th><th>Quantity<\/th><th>Setup<\/th><th>Branding Price<\/th><th>Artwork<\/th><th>Total Branding Cost<\/th><\/tr><\/thead><tbody>';v=stringReplace(/##BRANDINDEX##/,v,"BrandIndex_"+h);v=stringReplace(/##PRODUCTGUID##/,v,r.ProductGuid);let t="On Request";if(r.Leadtime>0)t=r.Leadtime>1?r.Leadtime+" days":r.Leadtime+" day";else if(r.Leadtime==0)for(l=0;l<n.TheData.CartLinesVO.length;++l)ct=-1,l>0&&(ct=n.TheData.CartLinesVO[l-1].Index),n.TheData.CartLinesVO[l].Index==ct&&(t=n.TheData.CartLinesVO[l].Leadtime>1?n.TheData.CartLinesVO[l].Leadtime+" days":n.TheData.CartLinesVO[l].Leadtime+" day");if(_cartType!="logo24"){let n=template_leadtimeRow;c&&(n=template_leadtimeRow_DisplayProducts);e+=stringReplace(/##BRANDING_LEADTIME##/,n,t)}lt="";(e.includes("EM-CLOTHING")||e.includes("EM-OTHER")||e.includes("EMB-A")||e.includes("EM-FREE"))&&(lt='<span style="font-size:12px;margin-top:5px;float:right;" id="EmbroideryExtraInfo">Please note that if the stitch count for this order is higher than 15000 stitches we will require additional day/days to complete branding.<\/span>');e=stringReplace(/##LEADTIME_15000_EMBROIDERY##/,e,lt);e=v+e+"<\/tbody><\/table>";e=e+"<\/div>";c||(e=stringReplace(/##TOTALLINEBRANDING##/,e,$().number_format(wt)))}if(IsSpringboxProduct(tt)){let n=stringReplace(/##BokleadTime##/,template_springBoxleadtimeRow,"orders is 5 working days");y+=stringReplace(/##BRANDING_LEADTIME##/,n,"On Request")}f=stringReplace(/##ITEMDETAILS##/,f,y);f=stringReplace(/##LINEBRANDING##/,f,e);ft+=f}}if(w>0&&et&&_cartType!=="logo24"||springBokFlag==!0){let t="On Request";n.TheData.CartLeadtime>0&&(t=n.TheData.CartLeadtime>1?n.TheData.CartLeadtime+" Working days":n.TheData.CartLeadtime+" Working day");springBokFlag===!0?$("#leadTimeDays").html("On Request"):$("#leadTimeDays").html(t);$("#leadtimeDisclaimer").show()}else $("#leadtimeDisclaimer").hide();n.TheData.CartDeliveryVO!=null&&w>0?(rt=n.TheData.CartDeliveryVO,o=template_delivery,o=stringReplace(/##CARRIERSERVICE##/,o,rt.Service),o=stringReplace(/##DELIVERYDATE##/,o,rt.DeliveryETA+" (From Collection)"),o=stringReplace(/##DELIVERYFROM##/,o,rt.FromAddress),o=stringReplace(/##ADDRESSNAME##/,o,rt.AddressName),o=stringReplace(/##TOTALDELIVERYCOST##/,o,$().number_format(n.TheData.CartVO.DeliveryTotal)),ft+=o,$("."+p).attr("style","visibility: hidden"),_cartHasDelivery=!0):w>0?($("."+p).attr("style","visibility: visible"),$(".deliveryTerms").hide(),_cartHasDelivery=!1):($("."+p).attr("style","visibility: hidden"),$(".deliveryTerms").show(),_cartHasDelivery=!1);w>0&&(dt=customeCatalogueProd.filter(t=>t.includes(n.TheData.CartLinesVO[0].ProductCode.substr(0,n.TheData.CartLinesVO[0].ProductCode.indexOf("-")))).length,dt>0&&$("."+p).attr("style","visibility: hidden"));et&&$btnAddAllBrandInfo.show();$("#scart").html(ft);$("#cartLoading").hide();$(".cartTip").tooltip();_cartType==="logo24"&&$(".cartCommentIcon").hide()}$(".cartTip").tooltip();populateLogo24Columns();populateLogoColumns()}else alertMessage(n.Error)}function IsSpringboxProduct(n){let t=n.toUpperCase();return t.includes("BOK")&&t.includes("BOKSAMPLE")!==!0&&t.includes("SAMPLEBOK")!==!0?!0:!1}function IsSpringboxProductSample(n){let t=n.toUpperCase();return t.includes("BOK")&&(t.includes("BOKSAMPLE")==!0||t.includes("SAMPLEBOK")==!0)?!0:!1}function IsCustomCatalogProduct(n){var t=!1;return $.ajax({url:"AjaxHandler.aspx?a=IsCustomCatalog&code="+n,success:function(n,i){i==="success"&&n.Success&&(t=!0)},error:function(n){n.Error!=null&&alertMessage(n.Error)},dataType:"json",async:!1,cache:!1}),t}function populateLogoColumns(){$("[std-cart-row]").each(function(){var n=$(this),y=parseInt(n.attr("row-index")),p=n.attr("bposition"),v=n.attr("product-code"),s=n.attr("logo-name"),o=n.attr("logo-id"),r=n.attr("display-product"),h=n.attr("isNoCoBranding"),t=n.attr("isRequiredBranding"),u=n.attr("isWorkWear"),w=n.attr("customBoxes"),c,i,f,l,e,a;displayProd=r;isCustomBoxes=w;c=n.attr("BRANDMETHOD");i=n.attr("template");s==="##LOGONAME##"&&(s=null);(o==="##LOGOID##"||o==="-1")&&(o=null);r==="##DISPLAYPRODUCT##"&&(r=!1);h==="##ISNOCOBRANDING##"&&(h=!1);t==="##isRequiredBranding##"&&(t=!1);t=t=="true"?!0:!1;u=u=="true"?!0:!1;isCustomBoxes=isCustomBoxes=="true"?!0:!1;i=i=="true"?!0:!1;f=n.find("[logo-column]");l=n.find("[matching-product-code]",this).attr("matching-product-code");l&&(v=l);e=new DataService;i&&(e=new DisplayDataService);isCustomBoxes&&(c.startsWith("DCB")||c.startsWith("DCP")?e=new DisplayDataService:(e=new DataService,isCustomBoxes=!1,i=!1));a={uploadType:LogoUploadType.Cart,productCode:v,position:p,productIndex:y,logoName:s,logoId:o,displayProd:r,isCustomBoxes:isCustomBoxes,fnGetProducts:function(){return e.getCartProducts()},fnGetLogos:function(){return getCartLogos()}};r||isCustomBoxes||i?f.displayLogoColumn(a):f.logoColumn(a);!u&&h&&(f.empty().text("N/A"),n.find("[total-branding]").text("N/A"));u&&t?f.empty().text("N/A"):t&&!u&&n.find("[total-branding]").text("N/A");$(".cartTip").tooltip()})}function getCartLogos(){cartLogos=[];var n=new DataService;return(displayProd||isCustomBoxes)&&(n=new DisplayDataService),n.getDocumentBrandingLogos().then(function(n){return cartLogos=_.map(n,function(n){return{id:n.ID,name:n.Name}})}).catch(function(n){loadingService.hide();alertMessage(n)})}function CheckBranchSelect(){$("#ddlBranchSelect").val()!=""?springBokFlag?($("#branchSelectPopup").modal("hide"),$("#divBokOrderModal").modal("show")):_isLeadTimeMO?($("#branchSelectPopup").modal("hide"),$("#divWorkwearModal").modal("show")):PlaceCartOrder():alertMessage("Please select a branch from the drop down menu to continue")}function CheckCartStock(){var n="";return $.ajax({url:"AjaxHandler.aspx?a=CheckCartStock&cType="+_cartType,success:function(t,i){i==="success"&&t.Success&&t!=null&&(n=t.TheData)},error:function(n){n.Error!=null&&alertMessage(n.Error)},dataType:"json",async:!1,cache:!1}),n}function CheckCartBranding(){var n="";return $.ajax({url:"AjaxHandler.aspx?a=ValidateCartRequiredBranding&cType="+_cartType,success:function(t,i){i==="success"&&t.Success&&t!=null&&(n=t.TheData)},error:function(n){n.Error!=null&&alertMessage(n.Error)},dataType:"json",async:!1,cache:!1}),n}function RenderFormValues(){$.ajax({url:"AjaxHandler.aspx?a=GetCartFormValues&cType="+$("#cartType").val(),success:function(n,t){var i,r;t==="success"&&n.Success&&(n.TheData[0]&&$("#txtReference").val(n.TheData[0]),n.TheData[1]&&$("#txtEmail").val(n.TheData[1]),n.TheData[2]&&$("#txtConfirmEmail").val(n.TheData[2]),n.TheData[3]&&(i=n.TheData[3],i==="undefined"&&(i=""),$("#txtContactName").val(i)),n.TheData[4]&&(r=n.TheData[4],r==="undefined"&&(r=""),$("#txtContactPhone").val(r)))},error:function(n){n.Error!=null&&alertMessage(n.Error)},dataType:"json",cache:!1})}function populateLogo24Columns(){$("[logo24-row]").each(function(){var n=$(this),e=parseInt(n.attr("row-index")),o=n.attr("bposition"),i=n.attr("product-code"),r=n.attr("pantone-colour"),u=n.attr("logo-name"),t=n.attr("logo-id"),s=!1,v=n.attr("colour-stitch"),f,l,a;isNaN(v)||(s=!0);r==="##PANTONECOLOUR##"&&(r=null);f={id:t,name:u};(u==="##LOGONAME##"||t==="##LOGOID##"||t==="-1"||u===""||t==="")&&(f=null);var h=n.find(".logo-24-col-colour"),y=n.find(".logo-24-col-logo"),c=n.find("[matching-product-code]",this).attr("matching-product-code");c&&(i=c);l={productCode:i,position:o,productIndex:e,pantoneColour:r};s?h.logo24ColourColumn(l,askForLogo24PantoneReplication):h.html("N/A");a={productCode:i,position:o,productIndex:e,logo:f};y.logo24LogoColumn(a,getLogos,askForLogo24LogoReplication)});$("body").on("CONFIRMED_LOGO_REPLICATION_EVENT",function(){logo24Flags=logo24Flags|Logo24UploadFlags.ConfirmedLogoReplication});$("body").on("CONFIRMED_PANTONE_REPLICATION_EVENT",function(){logo24Flags=logo24Flags|Logo24UploadFlags.ConfirmedPantoneReplication})}function askForLogo24PantoneReplication(){return(logo24Flags&Logo24UploadFlags.ConfirmedPantoneReplication)==0}function askForLogo24LogoReplication(){return(logo24Flags&Logo24UploadFlags.ConfirmedLogoReplication)==0}function validateLogo24Fields(){var n=!0;return $(".add-logo24").is(":visible")&&(n=!1),$(".add-logo24").is(":visible")&&(n=!1),n}function getLogos(){var n=$.map($(".edit-logo24"),function(n){var t=$(n);return{id:t.attr("logo-id"),name:t.attr("logo-name")}});return _.filter(n,function(n){return n.id>0})}function GetLineData(n,t,i,r,u){var o="",f,h,e,s;return t?(f=template_componentRow,n.Component!=""?(f=stringReplace(/##PRODUCTCOMPONENT##/,f,n.Component),n.HideOnWebsite?(f=stringReplace(/##HIDEROW##/,f,'style="display:none;"'),cItemCost=n.ItemCost):n.Hide?f=stringReplace(/##HIDEROW##/,f,'style="display:none;"'):(f=stringReplace(/##HIDEROW##/,f,""),cItemCost=n.ItemCost)):f=stringReplace(/##PRODUCTCOMPONENT##/,f,u)):f=template_itemDetailsRow,n.ColourCode!=o||t?(o=n.ColourCode,e=o,e=o==null||e==="-1"?"N/A":n.ColourName+" ("+e+")",f=i?stringReplace(/##HIDEBORDER##/,f,"no-border"):stringReplace(/##HIDEBORDER##/,f,"colourCell"),h=r?"prod-match":"prod-base",f=stringReplace(/##PRODUCTCOLOUR##/,f,'<span class="'+h+'">'+e+"<\/span>")):(f=stringReplace(/##HIDEBORDER##/,f,"colourCell"),f=stringReplace(/##PRODUCTCOLOUR##/,f,""),e=n.ColourCode,e==null&&(e="N/A")),s=n.SizeCode,s==null&&(s="N/A"),f=stringReplace(/##PRODUCTSIZE##/,f,s),f=stringReplace(/##PRODUCTQTY##/,f,n.Quantity),f=stringReplace(/##ITEMCOST##/,f,$().number_format(n.ItemCost)),stringReplace(/##TOTALITEMCOST##/,f,$().number_format(n.ItemCost*n.Quantity))}function RemoveCartItem(n,t){var i=confirm("Are you sure you would like to remove this item from the cart?");i&&$.ajax({url:"AjaxHandler.aspx?a=RemoveItemFromCart&p="+t+"&i="+n+"&cType="+_cartType,success:function(n,t){t==="success"&&(n.Success?n.TheData!=null&&RecalculateCartAndDelivery().then(function(){$("#otherMessageDialog").is(":visible")?$("#btnMainAlertOk").click(function(){location.reload()}):location.reload()}).catch(function(n){alertMessage(n)}):alertMessage(n.Error))},error:this.HandleLoadError,dataType:"json",cache:!1})}function RemoveLineBranding(n,t){$.ajax({url:"AjaxHandler.aspx?a=RemoveLineBranding&p="+t+"&cType="+$("#cartType").val(),success:function(t,i){i==="success"&&(t.Success?t.TheData!=null&&$("#"+n).remove():alertMessage(t.Error))},error:this.HandleLoadError,dataType:"json",cache:!1})}function RemoveBrandPosition(n,t,i){i?alert("Branding can't be removed for this product"):IsCustomCatalog(n).then(i=>{if(i.Success)alert("Branding can't be removed for this product");else{var r=confirm("Are you sure you would like to remove this branding for the product?");r&&dataService.deleteBranding(n.substr(0,n.indexOf(":")),n.substr(n.indexOf(":")+1),t).then(function(){ArtworkLibraryIntegration.ClearSelectedArtwork();$.ajax({url:"AjaxHandler.aspx?a=RemoveBrandPosition&p="+n+"&i="+t+"&cType="+_cartType,success:function(n,t){t==="success"&&(n.Success?n.TheData!=null&&LoadShoppingCart():alertMessage(n.Error))},error:this.HandleLoadError,dataType:"json",cache:!1})}).catch(function(){$.ajax({url:"AjaxHandler.aspx?a=RemoveBrandPosition&p="+n+"&i="+t+"&cType="+_cartType,success:function(n,t){t=="success"&&(n.Success?n.TheData!=null&&LoadShoppingCart():alertMessage(n.Error))},error:this.HandleLoadError,dataType:"json",cache:!1})})}}).catch(n=>{console.log(n)})}function ClearCart(){$.ajax({url:"AjaxHandler.aspx?a=ClearCart&cType="+_cartType,success:this.ClearCart_Completed,error:this.HandleLoadError,dataType:"json",cache:!1})}function ClearCart_Completed(n,t){t==="success"&&(n.Success?n.TheData!=null&&location.reload():alertMessage(n.Error))}function UpdateSampleShop(){var n=$("#ddlSampleShop").val();$.ajax({url:"AjaxHandler.aspx?a=SetSampleShop&shop="+n,success:function(){sampleShop=n},error:this.HandleLoadError,dataType:"json",cache:!1})}function FillEmailBoxes(n){$(n).prop("checked")?($("#txtEmail").val($("#lblCustomerEmail").html()),$("#txtConfirmEmail").val($("#lblCustomerEmail").html())):($("#txtEmail").val(""),$("#txtConfirmEmail").val(""))}function NotSure(){$("#stitchCountEstimate").show();$("#ciStitchPrice").html("R 0.00");$("#ciStitchPricePer1000").html("R 0.00")}function CalculateStitchPrice(){$("#stitchCalcInput").val()!=0||$("#stitchCalcInput").val()!=""?$.ajax({url:"AjaxHandler.aspx?a=GetStitchPrice&s="+$("#stitchCalcInput").val()+"&qty="+GetTotalQty(),success:function(n,t){t==="success"&&(n.Success?n.TheData!=null&&($("#ciStitchPrice").html($().number_format(n.TheData[0])),$("#ciStitchPricePer1000").html($().number_format(n.TheData[1]))):alertMessage(n.Error))},error:this.HandleLoadError,dataType:"json",cache:!1}):alertMessage("Please enter a valid stitch count")}function stringReplace(n,t,i){while(t.match(n))t=t.replace(n,i);return t}function HandleLoadError(n){$("#atcLoader").hide();alertMessage(n.Error)}function CloseAddToCart(){$("#modalOrderOnline").modal("hide");$("#cRowIndex").val("");$("#prevQty").val("");$("#cTotalQty").val("");$("#catalogueQuantities").hide();isValidCatalogueQuantities=!1;hasIncrementalValue=!1}function CancelAddToCart(){_editFromCart&&(RecalculateCart(),location.reload());CloseAddToCart()}function btnContinueShopping(){if(_cartType==="logo24")window.location="catalogueFilter.aspx?logo24=yes";else{var n=window.location.pathname;n.indexOf("ViewCart.aspx")!=-1?window.location="Default.aspx":$("#modalOrderOnline").modal("hide")}}function CheckTerms(){$("#ConfirmPlaceOrder").modal("hide");$("#scart").html()===""?alertMessage("Please add items in your cart to place an order."):$("#cbTermsAccepted").prop("checked")?$("#txtReference").val().length===0?alertMessage("Please enter a reference for this order"):$("#txtEmail").val().length===0||$("#txtConfirmEmail").val().length===0?alertMessage("Please enter an email address"):$("#txtEmail").val().indexOf("@")===-1||$("#txtEmail").val().indexOf(".")===-1?alertMessage("Please enter a valid email address."):$("#txtEmail").val()!=$("#txtConfirmEmail").val()?alertMessage("Please make sure your email is confirmed correctly"):_cartType==="logo24"&&($("#txtContactName").val().length===0||$("#txtContactPhone").val().length===0)?alertMessage("Please include a contact name and number where you can be reached."):_cartType!=="logo24"||validateLogo24Fields()?PlaceOrder():alertMessage("Please add logos and pantone colours to all the required branding lines."):alertMessage("You have to accept the terms and conditions before you can place the order.")}function PlaceOrder(){$("#btnPlaceOrder").hide();var n=!1,n=$.ajax({url:"AjaxHandler.aspx?a=IsSampleOrder",beforeSend:function(){$("#divWait").show()},success:function(t,i){i==="success"&&t.TheData!=null&&(n=t.TheData)},complete:function(){$("#divWait").hide()},error:this.HandleLoadError,dataType:"json",cache:!1});$.when(n).then(function(){var t="AjaxHandler.aspx?a=GetAccountLocation";n&&(t="AjaxHandler.aspx?a=GetAccountLocationWithoutClientAddresses");$.ajax({url:t,beforeSend:function(){$("#divWait").show()},success:function(n,t){var u,r,i;if(t==="success")if(n.Success)if(n.TheData!=null&&n.TheData.length>0&&!_cartHasDelivery){for($("#ddlBranchSelect").empty(),u=document.getElementById("ddlBranchSelect"),i=document.createElement("option"),i.value="JHB",i.innerHTML="Amrod Johannesburg",u.appendChild(i),r=0;r<n.TheData.length;r++)n.TheData[r].BranchCode!=="JHB"&&(i=document.createElement("option"),i.value=n.TheData[r].BranchCode,i.innerHTML=n.TheData[r].CompanyName,u.appendChild(i));$("#branchSelectPopup").modal("show")}else springBokFlag?$("#divBokOrderModal").modal("show"):_isLeadTimeMO?$("#divWorkwearModal").modal("show"):PlaceCartOrder();else $("#btnPlaceOrder").show()},complete:function(){$("#divWait").hide()},error:function(n){$("#btnPlaceOrder").show();alertMessage(n.Error)},dataType:"json",cache:!1})})}function cancelOrder(){$("#divBokOrderModal").modal("hide");$("#btnPlaceOrder").show()}function cancelWorkwearOrder(){$("#divWorkwearModal").modal("hide");$("#btnPlaceOrder").show()}function ProceedPlacingOrderConfirmation(){PlaceCartOrder()}function ViewCartCheckDelivery(){LoadCartValues().then(function(n){n.Success&&(n.TheData.CartDeliveryVO===null&&customeCatalogueProd.filter(t=>t.includes(n.TheData.CartLinesVO[0].ProductCode.substr(0,n.TheData.CartLinesVO[0].ProductCode.indexOf("-")))).length==0?($("#NoDeliveryinCartPopUp").modal("show"),_cartType==="logo24"&&$("#NoDeliveryinCartPopUp .btnPlaceOrder").attr("onclick","$('#ConfirmPlaceOrder').modal('show');")):_cartType==="logo24"?$("#ConfirmPlaceOrder").modal("show"):CheckTerms())}).catch(n=>{alertMessage(n)})}function LoadCartValues(){var n=$.ajax({url:"AjaxHandler.aspx?a=LoadShoppingCart&t="+$("#hfCartType").val(),dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){if(n.Success)return n}).catch(function(n){return Promise.reject(getAjaxErrorMessage(n))})}function PlaceCartOrder(){$("#divBokOrderModal").modal("hide");$("#divWorkwearModal").modal("hide");$("#branchSelectPopup").modal("hide");$("#cartLoading").modal("show");$(".cartButtons").hide();$("#ConfirmPlaceOrder").modal("hide");$(window).scrollTop(0);var t=CheckCartStock(),n=CheckCartBranding(),i="",r="";_cartType==="logo24"&&(i=$("#txtContactName").val(),r=$("#txtContactPhone").val());t===""&&n===""?$.ajax({url:"ViewCart.aspx",type:"POST",data:{a:"PlaceOrder",ref:$("#txtReference").val(),e:$("#txtEmail").val(),warehouse:$("#ddlBranchSelect").val(),cartType:_cartType,contactName:i,contactNumber:r,TBAFlag:EM_TBA},success:function(n,t){t==="success"&&($("#cartLoading").modal("hide"),n.Success?(n.TheData[2]==="TERMS"?($("#TermsConfirmationOrder").modal("show"),$("#lblTermsMessage").html(n.TheData[1])):($("#JadePayment").modal("show"),$("#btnMakePayment").attr("onclick",n.TheData[0]),$("#lblJadePaymentText").html(n.TheData[1]),n.TheData[0].indexOf("OrderPayment")!=-1||n.TheData[0].indexOf("Dashboard")!=-1?($("#btnPayLater").show(),n.TheData[0].indexOf("Dashboard")!=-1&&$("#btnMakePayment").text("Go to Dashboard")):$("#btnPayLater").hide()),$("#txtReference").val(""),$("#txtEmail").val(""),$("#txtConfirmEmail").val("")):($(".cartButtons").show(),alertMessage(n.Error)),$("#btnPlaceOrder").show())},error:function(n){alertMessage(n.Error);$("#cartLoading").modal("hide");$(".cartButtons").show()},dataType:"json",cache:!1}):($("#cartLoading").modal("hide"),t!=""?$("#lblOtherMessageText").html("There is not enough available stock for "+t+". <br/>Please edit this line to confirm the correct stock quantity."):n!=""&&$("#lblOtherMessageText").html("<b>"+n.ProductCode+"<\/b> is missing compulsory branding or CMT in position "+n.Position+". <br/>Please click the edit button and complete all 4 steps in the online ordering wizard to ensure that the branding is added back to the cart before placing your order."),$("#otherMessageDialog").modal("show"),$("#btnPlaceOrder").show())}function EmailCart(n){var i=$(n).attr("emailcart"),t=$("#txtcustomerEmail").val();Type==="Cart"?($("#btnMainAlert").hide(),$("#Alertspinner").show(),$("#otherMessageDialog").modal("show"),$.ajax({url:"AjaxHandler.aspx?a=EmailCart&EmailCart="+i+"&Recipient="+t+"&cType="+$("#cartType").val(),success:function(n,t){t==="success"&&n.Success&&($("#btnMainAlert").show(),$("#Alertspinner").hide(),$("#otherMessageDialog").modal("show"),$("#lblOtherMessageText").html("Email was successfully sent"))},error:function(n){alertMessage(n.Error)},dataType:"json",cache:!1,async:!1})):t===""?($("#otherMessageDialog").modal("show"),$("#lblOtherMessageText").html("Please select a customer, if you already have, please ensure that a valid email address is provided."),ToggleCustomerDetails($("#sptogglecustDetails"))):$.ajax({url:"AjaxHandler.aspx?a=EmailCart&EmailCart="+i+"&Recipient="+t,success:function(n,t){t==="success"&&n.Success&&($("#btnMainAlert").show(),$("#Alertspinner").hide(),$("#otherMessageDialog").modal("show"),$("#lblOtherMessageText").html("Email was successfully sent"))},error:function(n){alertMessage(n.Error)},dataType:"json",cache:!1,async:!1})}function addBrandingPositions(){logoUpload.open()}function getProductsAndPositions(){var n=[];return $(".orderItem").each(function(){var e=$(this),t={},o=$(".cart-thumb",this).attr("src"),r=parseInt(e.attr("id").replace("RowIndex_","")),s=$(".bposition",this).length,i;if(s){var h=$(".row h3 span",this),u=$(h).html(),f=$(this).find("[matching-product-code]",this).attr("matching-product-code");f&&(u=f);i=[];$(".bposition",this).each(function(){var n={},f=0,e=$(this).attr("logo-name"),o=$(this).attr("logo-id"),t=$(this).attr("bposition"),s=$("#"+r+"_pos"+t+"_bMethod").html(),u;t&&(u=$('[id$="_colourstitchVal"]',this).html(),isNaN(u)||(f=parseInt(u)));n.logo={id:o,name:e};n.position=t;n.numColours=f;n.brandingMethod=s;i.push(n)});t.productCode=u;t.productPositions=i;t.productIndex=r;t.imageUrl=o;n.push(t)}}),n}function openBrandingAtProductPosition(n,t){logoUpload.open(n,t)}function showLoading(n){$cartLoading&&(n?$cartLoading.show():$cartLoading.hide())}function IsLockDownSpecialityProduct(n){var t=!1;return $.ajax({url:"AjaxHandler.aspx?a=LockDownSpecialityProduct&prod="+n,success:function(n,i){i==="success"&&n.Success&&(t=!0)},error:function(n){n.Error!=null&&alertMessage(n.Error)},dataType:"json",async:!1,cache:!1}),t}function DisplayCombinedStockLevels(n,t,r,u,f,e){var o,s;$("#modalStockTable").is(":visible")||showLiveStockPopup();f=="False"?$("#productStock").hide():(loginFlag="True",$("#productStock").show());typeof e!="undefined"&&(e=e!==null?e.toString().toLowerCase():!1,e=="true"?(isWorkwear=!0,$("#wwSCLeadTimeNote").show()):e=="false"?(isWorkwear=!1,$("#lblTape").hide(),$("#divProductMatch").html(""),$("#wwSCLeadTimeNote").hide()):isWorkwear=e);$("#stockLevelDataDisplay").empty();$("#stockImage").hide();$("#currentlyInStock").html("");$(".stockComments").html("");$("#hiddenItemCode").html(n);u=="divSizeBtnsContainer"?(sizeDivContainer=t,myContainer=u,$("#vieAllB").show(),hiddenB=$("#hiddenItemCode").html(n)):u=="divSizeBtnsContainer"||u=="showIncoming"||viewAllSizesFlag||(mainProductCode=n);hiddenB!=null&&(viewAllSizes="viewAllSizes",$("#stockLevelDataDisplay").addClass("striped-rows"),$("#stockLevelDataDisplay tbody tr").removeClass("showRow"),$(".table-row-collapse").show());(t=="null"||t=="")&&($("#divSizeBtnsContainer").hide(),$("#stockSizes").empty(),$("#sizeText").hide(),$("#vieAllB").hide());_fromProduct==null?(_fromProduct=n,_fromSize=t,$(".scBack").hide()):($(".scBack").show(),$("#lnkBackToPrevious").html(_fromProduct),isWorkwear&&$(".scBack").hide(),$("a",".scBack").attr("onclick",'GoBack("'+_fromProduct+'", "'+_fromSize+'")'),_fromProduct=n);$("#hfStockSize").val("");o="";showIncoming=!1;u=="showIncoming"&&(u="",showIncoming=!0);t.indexOf("GB")!=-1&&u!=="divSizeBtnsContainer"&&(t=u!=null&&u!=""?$("a.active","#"+u).text():$(".sizeContainer a.active",".pnl"+n).text(),o="&size="+t,$("#hfStockSize").val(t));currentCode=n;$.ajax({url:"AjaxHandler.aspx?a=ProductHasGenderMatch&productList="+n+o,success:function(n,t){if(t=="success"&&n.Success&&n.TheData!=null)if(n.TheData.length>0)for(i=0;i<n.TheData.length;i++)n.TheData[0].length>0&&($("#divGenderBtnsContainer").show(),$("#divGenderBtnsContainer").empty().append(n.TheData[0])),n.TheData[1]>0&&($("#TopBottomContainer").show(),$("#TopBottomContainer").empty().append(n.TheData[1]));else $("#divGenderBtnsContainer").hide(),$("#TopBottomContainer").hide()},error:DisplayCombinedStockLevelsError,dataType:"json",cache:!1});clickedColour=r;$.ajax({url:"AjaxHandler.aspx?a=CheckComponentProductByCode&p="+n+o+"&showIncoming="+showIncoming,success:function(t,i){var f,r;i=="success"&&t.Success&&t.TheData!=null&&(f=$("#stockItemCode").text(),$("#lnkBackToPrevious").html(mainProductCode),isWorkwear&&$(".scBack").hide(),$("a",".scBack").attr("onclick",'GoBack("'+mainProductCode+'", "")'),_isComponent=t.TheData[0],r=t.TheData[1],!_isComponent||r!="normal"||showIncoming||u==="divSizeBtnsContainer"||viewAllSizesFlag||isWorkwear?($(".componentStockDiv").hide(),$(".productStockDiv").show(),$("p",".stockFooter").show(),$("#divSizeBtnsContainer").show(),$("#sizeText").show(),isWorkwear?($("#divTapeButtons","#modalStockTable").show(),$("#lblTape").show(),$("#MO-display").show(),$(".standardProdStock").hide(),WorkWearProducts.Functions.Initialise(currentCode,sizeDivContainer,u,viewAllSizes,r)):($(".standardProdStock").show(),$("#divTapeButtons","#modalStockTable").hide(),$.ajax({url:"AjaxHandler.aspx?a=GetCombinedStockLevelsOf&productList="+n+o+"&size="+sizeDivContainer+"&divSizeBtnsContainer="+u+"&viewAllSizes="+viewAllSizes+"&setType="+r,success:DisplayAmrodStockLevels,error:DisplayCombinedStockLevelsError,dataType:"json",cache:!1}))):($(".componentStockDiv").show(),$(".productStockDiv").hide(),$("#componentStockDataDisplay").html(""),$("#divGenderBtnsContainer").hide(),$("#TopBottomContainer").hide(),$("p",".stockFooter").hide(),$("#divSizeBtnsContainer").hide(),$("#stockSizes").empty(),$("#sizeText").hide(),$("#lblTape").hide(),$("#MO-display").hide(),$.ajax({url:"AjaxHandlers/StockCheck.aspx?a=GetComponentLevels&productCode="+n+o+"&showIncoming="+showIncoming+"&setType="+r,success:DisplayComponentStockLevels,error:DisplayCombinedStockLevelsError,dataType:"json",cache:!1})))},error:DisplayCombinedStockLevelsError,dataType:"json",async:!1,cache:!1});s="";$("#hfStockSize").val()!=""&&(s="&size="+$("#hfStockSize").val());$.ajax({url:"AjaxHandler.aspx?a=GetStockProductDetail&product="+currentCode+s,success:DisplayStockProductDetails,error:DisplayCombinedStockLevelsError,dataType:"json",cache:!1})}function GoBack(n,t){_fromProduct=null;viewAllSizesFlag=!1;DisplayCombinedStockLevels(n,t,"","","",isWorkwear)}function viewAllSIzes(){viewAllSizesFlag=!0;DisplayCombinedStockLevels(currentCode,"","","","",isWorkwear)}function DisplayComponentStockLevels(n,t){var b,o,g,v,e,p;if(t=="success")if(n.Success){if(n.TheData!=null){var w=n.TheData,u=w.Products,f=w.Colours,s=$("#componentStockDataDisplay"),h="<thead><tr><th>Item Code<\/th><th>Description<\/th>";for(c=0;c<f.length;c++)b=f[c]==""?"Common<br/>Components":f[c],h+="<th>"+b+"<\/th>";for(h+="<\/tr><\/thead>",s.append(h),i=0;i<u.length;i++){var r=u[i].ItemCode,l=u[i].ItemName,k=u[i].StockCheckCode,d="",a=u[i].ColourStock;for(c=0;c<f.length;c++)o=f[c].replace(/\s+/g,""),o=o.replace(/\//g,"-"),d+="<td class='"+r+"-"+o+"-stockvalue'>-<\/td>";for(l==null&&(l=r),g="<a class='btn-tooltip blue stockCheckTip' data-toggle='tooltip' data-placement='top' title='' data-original-title='Click on the item code for more detail on the stock on hand and incoming status of this product'><i class='fa fa-info' aria-hidden='true'><\/i><\/a>",v="<a onclick='DisplayCombinedStockLevels(\""+k+'", "", "", "showIncoming","'+loginFlag+"\")'>"+r+"<\/a>",k==""&&(v=r),s.append("<tr><td class='no-wrap ttSC'>"+g+" "+v+'<\/td><td  class="capa" >'+l+"<\/td>"+d+"<\/tr>"),y=0;y<a.length;y++)e=a[y].ColourDisplay.replace(/\s+/g,""),e=e.replace(/\//g,"-"),p=a[y].InStock,$("."+r+"-"+e+"-stockvalue").length>0?$("."+r+"-"+e+"-stockvalue").html(NumberWithCommas(p)):$("."+r+"--stockvalue").html(NumberWithCommas(p))}s.append("<\/table>");$(".stockCheckTip").tooltip()}}else alert(n.Error)}function ShowAllColourStock(){$("#stockImage").hide();let n=isWorkwear?"#WorkwearStockLevelDataDisplay":"#stockLevelDataDisplay";$(n).addClass("striped-rows");$(n+" tbody tr").removeClass("showRow");$(".table-row-collapse").length>0?$(".table-row-collapse").show():$(n+" tbody tr").each(function(){$(this).hasClass("dontshow")||$(this).show()})}function SetStockCheckColour(n,t){var i="";$("#hfStockSize").val()!=""&&(i="&size="+$("#hfStockSize").val());$.ajax({url:"AjaxHandler.aspx?a=GetStockForColour&product="+n+"&colour="+t+i,success:DisplayStockColourDetails,error:DisplayCombinedStockLevelsError,dataType:"json",cache:!1})}function DisplayStockColourDetails(n,t){if(t=="success")if(n.Success){if(n.TheData!=null){var r=n.TheData[0],u=n.TheData[1],f=n.TheData[2],i=n.TheData[3],e=n.TheData[4];$("#selectedColour").show();$("#selectedColour").html(r);$("#selectedColour").css("background-image","url(images/colours/"+i+".jpg)");u.indexOf("#FFFFFF")!=-1?$("#selectedColour").addClass("light"):$("#selectedColour").removeClass("light");$("#currentlyInStock").html("Currently in Stock: <strong>"+f+"<\/strong>");let t=isWorkwear?"#WorkwearStockLevelDataDisplay":"#stockLevelDataDisplay";$(t+" tbody tr").hide();$(t+" tbody tr").removeClass("showRow");$("."+currentCode+"_"+i).length==0&&$(".sc_"+i).show();$(t).removeClass("striped-rows");$(t).hasClass("stock-hidden-rows")||$(t).addClass("stock-hidden-rows");$("."+currentCode+"_"+i).addClass("showRow");$("#stockImage").show();$("#stockImage").attr("src",e);SetWidthBasedOnScrollbar(t)}}else alert(n.Error)}function processValue(n,t){var i=t;return n===1&&t==="Transparent/Frosted White"&&(i="Transparent/<br>Frosted White"),i}function DisplayAmrodStockLevels(n,t){var h,o,ut,d,s,vt,ct,nt,ei,pt;if(t=="success")if(n.Success){if(n.TheData!=null){$("#WorkwearStockLevelDataDisplay").empty();h=$("#stockLevelDataDisplay");$(".productStockDiv").css("max-height","260px");var ii='<a class="btn-tooltip blue stockCheckTip" data-toggle="tooltip" data-placement="top" title="" data-original-title="##tiptext##" ><i class="fa fa-info"><\/i><\/a>',oi=stringReplace(/##tiptext##/,ii,"Products can only be reserved for 24 hours. The below reservation quantities have not reduced the stock on hand. If you have a confirmed order for an item that shows as reserved, please chat to your account manager, who will then give the company who has reserved the goods two hours to confirm them, otherwise they will be available to you."),si=stringReplace(/##tiptext##/,ii,"Nett of confirmed back orders"),tt='<thead><tr><th>Item Code<\/th><th>Description<\/th><th>Colour<\/th><th>Stock on Hand<\/th><th>Reserved ##tip_reserved##<\/th><th>Incoming ##tip_incoming##<\/th><th class="stockTableLastTh_noScroll">Incoming ETA<\/th><\/tr><\/thead>';tt=stringReplace(/##tip_reserved##/,tt,oi);tt=stringReplace(/##tip_incoming##/,tt,si);h.append(tt);$(".stockCheckTip").tooltip();for(var p=0,et="",it="",r=2,f=[],p=0;p<n.TheData.length;p++){var i=n.TheData[p],rt=i[0],c=i[8],w=processValue(1,i[10]),wt=i[1],v=rt+"_"+c,ot=i[9],b=i[5],ri='<a href="javascript:void(0);" class="btn-table-row-collapse"><i class="fa fa-chevron-right"><\/i><\/a>',k=i[6];k=="800080"&&(k="FF0000");k!="FF0000"&&(k="7D7D7D");k!="FF0000"&&b=="No more on order"&&(b="To be confirmed");var bt=i[2],kt=i[3],st=i[4],ht='style="color:#'+k+';"';if(ot.length==0&&(ri=""),o=rt,c!=""&&(o.endsWith("-"+c)||(o=o+"-"+c)),i[9].length==0){$("#stockLevelDataDisplay").addClass("striped-rows");$("#stockLevelDataDisplay").removeClass("stock-hidden-rows");var u=rt+"||"+c+"||",a="",l="";n.TheData.length>p+1&&(a=n.TheData[p+1],l=a[0]+"||"+a[8]+"||");l!=u&&et!=u?h.append("<tr "+ht+" data-itemCode='"+o+"' class=\"sc_"+c+"\"><td class='no-wrap'>"+o+'<\/td><td class="capa">'+wt+"<\/td><td>"+w+"<\/td><td><b>"+FormatNumber(bt)+"<\/b><\/td><td>"+FormatNumber(kt)+"<\/td><td>"+FormatNumber(st)+"<\/td><td>"+b+"<\/td><\/tr>"):l==u&&et!=u?(r=2,it='<tr class="'+v+"_1 sc_"+c+'" '+ht+" data-itemCode='"+o+"' ><td rowspan=\""+r+'">'+o+'<\/td><td class="capa" rowspan="'+r+'">'+wt+'<\/td><td rowspan="'+r+'">'+w+'<\/td><td rowspan="'+r+'"><b>'+FormatNumber(bt)+'<\/b><\/td><td rowspan="'+r+'">'+FormatNumber(kt)+"<\/td><td>"+FormatNumber(st)+"<\/td><td>"+b+"<\/td><\/tr>",h.append(it)):et==u&&(l==u&&(ct=new RegExp('rowspan="'+r+'"',"g"),it=it.replace(ct,'rowspan="'+(r+1)+'"'),r+=1,$("."+v+"_1").replaceWith(it)),h.append("<tr data-itemCode='"+o+"' "+ht+' class="sc_'+c+'"><td style="width:141px;">'+FormatNumber(st)+'<\/td><td style="width:151px;">'+b+"<\/td><\/tr>"));et=u}else{var dt="",lt="",gt=!1;for(i[9].length>1&&(i[9][0][0]==i[9][i[9].length-1][0]&&(gt=!0),i[9][0][9]==="128"?($("#sizeRangePanel").show(),$("#sizeRange").html("Age 7 - 8: Size 128 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 9 - 10: Size 140 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 11 - 12: Size 152")):i[9][0][9]==="104"&&($("#sizeRangePanel").show(),$("#sizeRange").html("Age 4: Size 104 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 6: Size 116 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 8: Size 128&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 10: Size 140&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 12: Size 152&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 14: Size 164"))),i[9].length==1||gt?(dt=b,lt='class="dontshow"',$("#stockLevelDataDisplay").addClass("striped-rows"),$("#stockLevelDataDisplay").removeClass("stock-hidden-rows")):($("#stockLevelDataDisplay").removeClass("striped-rows"),$("#stockLevelDataDisplay").addClass("stock-hidden-rows"),dt='<a href="javascript:void(0);" class="lnkExpandView">Expand to view<\/a>',lt='class="table-row-collapse sc_'+c+'"'),h.append("<tr data-itemCode='"+o+"' "+lt+" "+ht+"><td>"+ri+o+'<\/td><td class="capa">'+wt+"<\/td><td>"+w+"<\/td><td><b>"+FormatNumber(bt)+"<\/b><\/td><td>"+FormatNumber(kt)+"<\/td><td>"+FormatNumber(st)+"<\/td><td>"+dt+"<\/td><\/tr>"),ut="",d="",y=0;y<i[9].length;y++)if(s=ot[y],s!==undefined){var e=s[9],ni=s[0],hi=s[1],ui=s[2],at=s[3],ti=s[4],ft=s[5],fi=rt+"_"+w.replace(" ","-")+"_"+e,g=s[6];g=="800080"&&(g="FF0000");(g!="FF0000"||s[6]==undefined)&&(g="7D7D7D");vt='style="color:#'+g+';"';g!="FF0000"&&ft=="No more on order"&&(ft="To be confirmed");var u=ni+"||"+c+"||"+e,a="",l="",yt=e;if(e!=undefined&&(e.indexOf("GB")!=-1||e.indexOf("BOARD")!=-1||e.indexOf("GIFTBAG")!=-1)&&(yt=hi),ot.length>y+1){if(a=ot[y+1],a===undefined)continue;l=a[0]+"||"+a[8]+"||"+a[9]}i[9].length==1&&lt=='class="dontshow"'?v+=" showRow":gt&&(v+=" showRow");at==undefined&&(at=0);yt==undefined&&(sDesription="");l!=u&&ut!=u&&l.indexOf("undefined")==-1?h.append('<tr class="'+v+' table-row-active" '+vt+" \"><td class='no-wrap'>"+ni+'<\/td><td class="capa">'+yt+"<\/td><td>"+w+"<\/td><td><b>"+FormatNumber(ui)+"<\/b><\/td><td>"+FormatNumber(at)+"<\/td><td>"+FormatNumber(ti)+"<\/td><td>"+ft+"<\/td><\/tr>"):l==u&&ut!=u?(r=2,d='<tr class="'+v+" "+fi+'_1 table-row-active" '+vt+' "><td rowspan="'+r+'">'+ni+'<\/td><td class="capa" rowspan="'+r+'">'+yt+'<\/td><td rowspan="'+r+'">'+w+'<\/td><td rowspan="'+r+'"><b>'+FormatNumber(ui)+'<\/b><\/td><td rowspan="'+r+'">'+FormatNumber(at)+"<\/td><td>"+FormatNumber(ti)+"<\/td><td>"+ft+"<\/td><\/tr>",h.append(d)):ut==u&&(l==u&&(ct=new RegExp('rowspan="'+r+'"',"g"),d=d.replace(ct,'rowspan="'+(r+1)+'"'),r+=1,$("."+fi+"_1").replaceWith(d)),h.append('<tr class="'+v+' table-row-active" '+vt+' "><td style="width:141px;">'+FormatNumber(ti)+'<\/td><td style="width:151px;">'+ft+"<\/td><\/tr>"));(e==null||e=="")&&($("#divSizeBtnsContainer").hide(),$("#stockSizes").empty(),sizeList=[]);myContainer!="divSizeBtnsContainer"&&(sizeList[y]=e);ut=u;f.includes(e)||f.push(e)}}}if(f=f.filter(function(n){return n!=="DUMMY"&&n!==undefined}),f.length==0&&($("#divSizeBtnsContainer").hide(),$("#stockSizes").empty(),$("#sizeText").hide()),f.length>0)for($("#stockSizes").empty(),$("#sizeText").show(),$("#divSizeBtnsContainer").show(),f=Array.from(new Set(f)),nt=0;nt<f.length;++nt)ei="onclick=\"DisplayCombinedStockLevels('"+rt+"', '"+f[nt]+"','','divSizeBtnsContainer','"+loginFlag+"')\"",$("#stockSizes").append("<a "+ei+' class="selection" id=\''+f[nt]+"'>"+f[nt]+" <\/a>");h.append("<\/table>");n.TheData.length==1&&n.TheData[0][9].length>0&&($("#stockLevelDataDisplay tbody tr").hide(),$("#stockLevelDataDisplay tbody tr").removeClass("showRow"),pt="."+n.TheData[0][0]+"_"+n.TheData[0][8],$(pt).addClass("showRow"),$(pt).is(":visible")||$(pt).show());$(".btn-table-row-collapse").click(function(){for(var i,t=$(this).parent().parent().parent().children(),r=$(this).parent().parent().index(),n=0;n<t.length;n++)if(n>r)if($(t).eq(n).hasClass("table-row-active"))$(t).eq(n).toggleClass("showRow");else break;let u=$(this).html();i=$(this).parent().parent();u.indexOf("fa-chevron-right")!=-1?($(this).html('<i class="fa fa-chevron-down" aria-hidden="true"><\/i>'),$(".lnkExpandView",i).html("Collapse View")):($(this).html('<i class="fa fa-chevron-right" aria-hidden="true"><\/i>'),$(".lnkExpandView",i).html("Expand To View"));SetWidthBasedOnScrollbar("#stockLevelDataDisplay")});$(".lnkExpandView").click(function(){var n=$(this).parent().parent();$(".btn-table-row-collapse",n).click()});$("#stockLevelDataDisplay tbody").length>0&&$("#stockLevelDataDisplay tbody").get(0).scrollHeight>$("#stockLevelDataDisplay tbody").get(0).clientHeight?($(".stockTableLastTh_noScroll").removeClass("stockTableLastTh_noScroll").addClass("stockTableLastTh"),$("#stockLevelDataDisplay").width("1076")):$("#stockLevelDataDisplay").width("1060")}}else alert(n.Error)}function SetWidthBasedOnScrollbar(n){let t=$(n+" tbody");t.length>0&&t.get(0).scrollHeight>t.get(0).clientHeight?($(".stockTableLastTh_noScroll").removeClass("stockTableLastTh_noScroll").addClass("stockTableLastTh"),$(n).width("1076")):($(".stockTableLastTh").removeClass("stockTableLastTh").addClass("stockTableLastTh_noScroll"),$(n).width("1060"))}function FormatNumber(n){return $().number_format(n,{numberOfDecimals:0,thousandSeparator:",",symbol:""})}function NumberWithCommas(n){return n.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function DisplayStockProductDetails(n,t){var f,e;if(t=="success")if(n.Success){if(n.TheData!=null){var u=n.TheData[0],o=n.TheData[1],i=n.TheData[2],s=n.TheData[3],h=n.TheData[4],c=n.TheData[6],r=n.TheData[7];$("#stockItemCode").html(u);$("#sProdName").html(o);$("#selectedColour").hide();$(".product-links #productDetails").attr("href",h);$(".product-links #productStockPDF").attr("href","StockLevelInfo.aspx?Action=Download&productCode="+currentCode);$("#stockLevelDataDisplay tbody tr").each(function(){$(this).removeClass("font-weight-bold")});$("#stockLevelDataDisplay tbody tr").each(function(){$(this).attr("data-itemcode")==$("#stockItemCode").text()&&$(this).addClass("font-weight-bold")});n.TheData[5]==!0?$(".flaggedProd").show():$(".flaggedProd").hide();i==""||_isComponent?isWorkwear?($("#stockColours").html(i),$("#stockProductColours").show()):$("#stockProductColours").hide():($("#stockColours").html(i),$("#stockProductColours").show());f=new Date(s).toString();e=new Date(f+"Z");$("#stockUpdated").html(formatDate(e));clickedColour!=""&&SetStockCheckColour(u,clickedColour);$("#lnkTotalStock").html("Total: "+c);r!=""?(_isComponent?$(".stockComments").html(r+"<br/><b>To view detailed stock information for an individual component, including its incoming ETA, please click on the product code.<\/b>"):$(".stockComments").html(r),$(".stockComments").show()):$(".stockComments").hide()}}else alert(n.Error)}function formatDate(n){let i=n.getDate()+" "+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][n.getMonth()]+" "+n.getFullYear(),t=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds(),r=t.split(":")[0]>=12?"PM":"AM";return i+" "+t+" "+r}function DisplayCombinedStockLevelsError(n){n!=null&&alert(n.Error);$("#divWait").hide()}function HandleLoadError(n){alert(n.Error)}function EmailStockLevels(){$("#divWait").show();$.ajax({url:"AjaxHandler.aspx?a=EmailStockLevel",data:{Action:"",ProductCode:currentCode},success:function(n){n!=null&&(n.Success&&($("#otherMessageDialog").modal("show"),$("#lblOtherMessageText").html("Stock level successfully sent to "+n.TheData)),$("#divWait").hide())},error:DisplayCombinedStockLevelsError,dataType:"json",cache:!1})}function closeLiveStockPopup(){sizeList=[];myContainer=null;sizeDivContainer=null;$("#modalStockTable").modal("hide");$("body").addClass("modal-open");$("#btnLiveStockExit").removeAttr("onclick");$("#btnLiveStockExit").attr("data-dismiss","modal")}function Remove_fromProduct(){sizeList=[];myContainer=null;sizeDivContainer=null;_fromProduct=null}function GetBrandingPosition(n){for(var i,t=0;t<positions.length;t++)if(i=positions[t],i.PositionCode==n)return i;return null}function GetBrandingPositionOption(n,t){for(var r,u,f,i=0;i<positions.length;i++)if(r=positions[i],r.PositionCode==n)for(u=0;u<r.Options.length;u++)if(f=r.Options[u],f.DisplayIndex==t)return f;return null}function GetNotSpecialBrandingPositionOption(n,t){for(var r,u,f,i=0;i<positions.length;i++)if(r=positions[i],r.PositionCode==n)for(u=0;u<r.Options.length;u++)if(f=r.Options[u],f.BrandingCode==t&&f.OptionSpecialRule==null)return f;return null}function GetFirstBrandingPositionOptionSpecial(n,t,i,r){var u=GetBrandingPositionOptionSpecials(n,t,i,r);return u.length>0?u[0]:null}function GetBrandingPositionOptionSpecials(n,t,i,r){for(var e,o,u,f=[],s=0;s<positions.length;s++)if(e=positions[s],n==null||e.PositionCode==n)for(o=0;o<e.Options.length;o++)u=e.Options[o],(t==null||u.BrandingCode==t)&&u.OptionSpecialRule!=null&&(r==null||u.OptionSpecialRule.NumberOfColours==null||u.OptionSpecialRule.NumberOfColours==r)&&(i==null?f.push(u):i==1&&u.OptionSpecialRule.BrandingPositionType==-3?f.push(u):i==2&&u.OptionSpecialRule.BrandingPositionType==-2?f.push(u):i==3&&u.OptionSpecialRule.BrandingPositionTypes.length>0&&f.push(u));return f}function GetSpecialBrandingPositionOptionsSelected(n,t,i,r){for(var e,u,f=[],o=0;o<methods.length;o++)e=methods[o],(r==null||r!=e)&&(u=GetBrandingPositionOption(e,$("#ddlAvailableBranding"+e+" option:selected").attr("index")),u!=null&&u.BrandingCode==n&&u.OptionSpecialRule!=null&&u.OptionSpecialRule.Name==t&&(i==1&&u.OptionSpecialRule.BrandingPositionType==-3?f.push(u):i==2&&u.OptionSpecialRule.BrandingPositionType==-2?f.push(u):i==3&&u.OptionSpecialRule.BrandingPositionTypes.length>0&&f.push(u)));return f}function GetSpecialBrandingMethodOptionsSelected(n,t,i,r,u,f){for(var s,e,o=[],h=0;h<methods.length;h++)s=methods[h],(r==null||r!=s)&&(e=GetBrandingPositionOption(s,$("#"+f+s+" option:selected").attr("index")),e!=null&&e.OptionSpecialRule!=null&&e.OptionSpecialRule.BrandingMethod==u&&e.OptionSpecialRule.Name==t&&(i==1&&e.OptionSpecialRule.BrandingPositionType==-3?o.push(e):i==2&&e.OptionSpecialRule.BrandingPositionType==-2?o.push(e):i==3&&e.OptionSpecialRule.BrandingPositionTypes.length>0&&o.push(e)));return o}function GetMutuallyExclusiveSpecialBrandingPositionOptionsSelected(n,t,i){for(var u,r,e=[],f=0;f<methods.length;f++)u=methods[f],(t==null||t!=u)&&(r=GetBrandingPositionOption(u,$("#ddlAvailableBranding"+u+" option:selected").attr("index")),r!=null&&r.OptionSpecialRule!=null&&(r.OptionSpecialRule.IsMutuallyExclusive&&i||!i)&&r.OptionSpecialRule.Name!=n&&e.push(r));return e}function GetItemBrandingOnBranding(n,t){var i=GetBrandingPositionOption(n,t),h,o,c,l,r,s,a,v,e,u,f;if(i!==null&&i.OptionSpecialRule!==null){if(h=GetMutuallyExclusiveSpecialBrandingPositionOptionsSelected(i.OptionSpecialRule.Name,i.OptionPositionCode,!0),o=null,i.OptionSpecialRule.IsMutuallyExclusive&&(r=GetMutuallyExclusiveSpecialBrandingPositionOptionsSelected(i.OptionSpecialRule.Name,i.OptionPositionCode,!1),r.length>0))for(u=0;u<r.length;u++)f=r[u],f.OptionPositionCode!==i.OptionPositionCode&&($("#ddlAvailableBranding"+f.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(f.OptionPositionCode,null),o="Please note selecting the mutually exclusive special removed all other specials where the specials currently applied.");if(i.OptionSpecialRule.BrandingPositionType===-2){if(r=GetSpecialBrandingMethodOptionsSelected(i.BrandingCode,i.OptionSpecialRule.Name,2,i.OptionPositionCode,i.OptionSpecialRule.BrandingMethod,"ddlAvailableBranding"),r.length>0)for(c=0;c<r.length;c++)l=r[c],l.OptionPositionCode!==i.OptionPositionCode&&($("#ddlAvailableBranding"+l.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(l.OptionPositionCode,null),o="Please note selecting the special for this position removed it from another position where the special currently applied.")}else if(i.OptionSpecialRule.BrandingPositionTypes.length>0&&jQuery.inArray(-1,i.OptionSpecialRule.BrandingPositionTypes)===-1&&(r=GetSpecialBrandingPositionOptionsSelected(i.BrandingCode,i.OptionSpecialRule.Name,3,null),r.length>i.OptionSpecialRule.BrandingPositionTypes.length)){for(s=null,a=r.length-1;a>=0;a--){if(e=r[a],e.OptionPositionCode===i.OptionPositionCode)break;if(e.OptionPositionCode!==i.OptionPositionCode){s=e;break}}if(s===null)for(v=0;v<r.length;v++){if(e=r[v],e.OptionPositionCode===i.OptionPositionCode)break;if(e.OptionPositionCode!==i.OptionPositionCode){s=e;break}}s!==null&&($("#ddlAvailableBranding"+s.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(s.OptionPositionCode,null),o="Please note selecting the special for this position removed it from another position where the special currently applied.")}if(h.length>0)for(u=0;u<h.length;u++)f=h[u],f.OptionPositionCode!==i.OptionPositionCode&&($("#ddlAvailableBranding"+f.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(f.OptionPositionCode,null),o="Please note selecting the special removed all other mutually exclusive specials where the specials currently applied.");o!==null&&alertMessage(o)}}function GetGiftSetBrandingOnbranding(n,t,i){for(var v,r,s,u,y,f,h,c,e,o="",l=[],a=0;a<positions.length;a++)v=positions[a],v.ComponentItemCode===n&&l.push(v);if(r=GetBrandingPositionOption(t,i),r!=="undefined"&&r!==null&&r.OptionSpecialRule!=="undefined"&&r.OptionSpecialRule!==null){if(r.OptionSpecialRule.IsMutuallyExclusive)for(s=0;s<l.length;s++)u=l[s],u.PositionCode!==t&&(y=$("#ddlAvailableBranding"+u.PositionCode+" option:selected").attr("index"),f=GetBrandingPositionOption(u.PositionCode,y),f!=="undefined"&&f!==null&&f.OptionSpecialRule!=="undefined"&&f.OptionSpecialRule!==null&&($("#ddlAvailableBranding"+u.PositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(u.PositionCode,null),o="Please note selecting the special for this position removed it from another position where the special is currently applied."));if(r.OptionSpecialRule.BrandingPositionType===-2&&(h=GetSpecialBrandingMethodOptionsSelected(r.BrandingCode,r.OptionSpecialRule.Name,2,r.OptionPositionCode,r.OptionSpecialRule.BrandingMethod,"ddlAvailableBranding"),h.length>0))for(c=0;c<h.length;c++){e=h[c];let n=GetBrandingPosition(e.OptionPositionCode).ComponentItemCode,t=GetBrandingPosition(r.OptionPositionCode).ComponentItemCode;e.OptionPositionCode!==r.OptionPositionCode&&n==t&&($("#ddlAvailableBranding"+e.OptionPositionCode).prop("selectedIndex",parseInt(0)),RenderBrandingTypeSelected(e.OptionPositionCode,null),o="Please note selecting the special for this position removed it from another position where the special currently applied.")}}o!==""&&alertMessage(o)}function CheckSpecialsOnBranding(n){var t=GetBrandingPosition(n),i=$("#ddlAvailableBranding"+t.PositionCode+" option:selected").attr("index"),r=$("#ddlNumberOfColours"+t.PositionCode).is(":hidden")?null:$("#ddlNumberOfColours"+t.PositionCode).val();r===null&&$("#ddlAvailableBranding"+t.PositionCode+" option:selected").attr("maxcolours");let u=t.ComponentItemCode===""||t.ComponentItemCode===null||t.ComponentItemCode==="undefined"||t.ComponentItemCode.toLowerCase()==="none";u?GetItemBrandingOnBranding(t.PositionCode,i):GetGiftSetBrandingOnbranding(t.ComponentItemCode,t.PositionCode,i)}function GetCurrencySymbol(){$.ajax({url:"AjaxHandler.aspx?a=GetCurrencySymbol",success:function(n,t){t=="success"&&(n.Success?n.TheData!=null&&(csymbol=n.TheData):alert(n.Error))},error:this.HandleLoadError,async:!1,dataType:"json",cache:!1})}function loadBrandingCalculator(n){var u,i,r,t;n==2?(r=$("#hfProductGuid").val(),t=$("#hfProductSize").val()):(u=$(n),i=u.closest(".pnlProductBlock"),r=i.attr("data-productguid"),t=i.attr("data-productsize"));isNaN(t)&&(t="");DisplayBrandingCalculator(r,t)}function DisplayBrandingCalculator(n,t){for(GetCurrencySymbol(),$("#modalBrandingCost").modal("show"),$("#brandingResults").hide(),brandingCalculated=!1,currentGuid=n,$("#hfProduct").val(n),$("#ddlAvailableBranding").html(""),$("#bcLoader").show(),$("#bcNotice").hide(),$("#ddlNumberOfPositions").val("1"),$("#ddlNumberOfPositions_chosen").length==0?$("#ddlNumberOfPositions").chosen({disable_search:!0}):$("#ddlNumberOfPositions").trigger("chosen:updated"),$("#dllRepeatJob").chosen({disable_search:!0}),i=1;i<6;i++)$("#brandingPosition"+(i+1)).hide();$.ajax({url:"AjaxHandler.aspx?a=GetProductDetailsVO&p="+n+"&s="+t,success:function(t,i){var r,f,u;if(i=="success")if(t.Success){if(t.TheData!=null){if(r=t.TheData,$("#productNameCode").html(r.Name+" ("+r.Code+")"),$("#hfProductCode").val(r.Code),$("#hfProductPrice").val(r.Price),$("#hfProductPrice2").val(r.PriceRange2),$("#productBrandingDetails").attr("href",r.ProductDetailURL),_isWorkwearBC=!1,$("#pnlWWSizes").hide(),r.HasSize?r.InventoryType==6&&r.HasSize?(_isWorkwearBC=!0,$("#pnlProductQuantity").hide(),$("#pnlSmallSize").hide(),$("#pnlLargeSize").hide(),$("#productPrice0").hide(),$("#productPrice1").hide(),$("#productPrice2").hide(),$("#productPrice3").hide(),$("#productPriceWorkwear").show(),$(".workwearSizeGroup").remove(""),$(".workwearSizePrice").remove(""),$("#pnlWWSizes").show(),_workwearSizes=r.Sizes,$.each(r.Sizes,function(n,t){$("#pnlWWSizes").loadTemplate($("#templateWorkwearSize"),{sizeCode:t.Size},{append:!0});$("#productPriceWorkwear").loadTemplate($("#templateWorkwearPrice"),{priceForSize:"Product Price for size "+t.Size,priceExclBranding:$().number_format(t.Price,{symbol:csymbol})},{append:!0})}),f=function(){var n=0;return function(t,i){clearTimeout(n);n=setTimeout(t,i)}}(),$(".wwProdQuantity").each(function(){$(this).unbind("keyup");$(this).keyup(function(n){n.which!=13&&($("#brandingResults").hide(),UpdateWorkwearQuantities(),f(function(){LoadBrandingMethods(currentGuid,null,$("#txtProductQuantity").val())},500))})})):($("#pnlProductQuantity").hide(),$("#productPrice0").hide(),$("#pnlSmallSize").show(),$("#pnlLargeSize").show(),$("#productPrice1").show(),$("#productPrice2").show(),$("#productPrice3").hide(),$("#lblProductPriceExclBranding1").html($().number_format(r.Price,{symbol:csymbol})),$("#lblProductPriceExclBranding2").html($().number_format(r.PriceRange2,{symbol:csymbol}))):($("#pnlProductQuantity").show(),$("#productPrice0").show(),$("#pnlSmallSize").hide(),$("#pnlLargeSize").hide(),$("#productPrice1").hide(),$("#productPrice2").hide(),$("#productPrice3").hide(),$("#lblProductPriceExclBranding").html($().number_format(r.Price,{symbol:csymbol}))),r.IsUSB&&r.Sizes!=null&&r.Sizes.length>0){for($("#pnlProductQuantity").show(),$("#productPrice0").hide(),$("#pnlSmallSize").hide(),$("#pnlLargeSize").hide(),$("#productPrice1").hide(),$("#productPrice2").hide(),$("#productPrice3").show(),$("#pnlUsbSize").show(),$("#lblProductPriceExclBranding3").html($().number_format(r.Price,{symbol:csymbol})),$("#ddlUsbSize, #lblProductPriceExclBranding3").attr("data-visible",!0),$("#ddlUsbSize").empty(),isUsb=!0,u=0;u<r.Sizes.length;u++)$("#ddlUsbSize").append(new Option(r.Sizes[u].Size,r.Sizes[u].SizeGuid));$("#ddlUsbSize").unbind("change");$("#ddlUsbSize").on("change",function(){var t=$(this).find("option:selected").text();$.ajax({url:"AjaxHandler.aspx?a=GetPricesForSize&pg="+n+"&s="+$(this).val(),success:function(n,t){t=="success"&&(n.Success?($("#lblProductPriceExclBranding3").html(n.TheData[1]),$("#hfProductPrice").val(n.TheData[1].replace("R","")),brandingCalculated&&CalculateBrandingCost(currentGuid)):alert("GetPricesForSize:"+n.Error))},error:function(n){alert(n.Error)},dataType:"json",cache:!1})})}else $("#pnlUsbSize").hide(),$("#ddlUsbSize").attr("data-visible",!1),isUsb=!1;$("#bcLayout").attr("onclick",'alert("The layout PDF will open in a new tab. Depending on the size of the file it might take a couple of seconds to load.");');$("#bcLayout").attr("href","ProductLayout.aspx?Code="+r.Code);$("#bcOrderNow").attr("onclick","OrderNow("+r.HasBrand24+")");$.ajax({url:"AjaxHandler.aspx?a=GetBrandingCalculatorDetails&p="+r.Code+"&pg="+$("#hfProduct").val(),success:function(t,i){var r=!0;i=="success"&&t.Success&&(t.TheData!=null?(t.TheData[0]!=""&&($("#brandComment").show(),$("#brandComment").html(t.TheData[0])),t.TheData[1]!=""?($("#divFreeBrandingImage").show(),$("#freeBrandingImage").attr("src",t.TheData[1]),$("#freeBrandingImage").attr("onclick",'showFreeBrandingPopup("'+t.TheData[1]+'")'),r=!0):$("#divFreeBrandingImage").hide()):$("#brandComment").hide());LoadBrandingMethods(n,null,$("#txtProductQuantity").val())},error:this.HandleLoadError,dataType:"json",cache:!1})}}else alert("GetProductDetails: "+t.Error)},error:this.HandleLoadError,dataType:"json",cache:!1});$(".btnEmailBrandQuote, #productBranding").unbind("click");$(".btnEmailBrandQuote, #productBranding").click(function(){if(brandingCalculated){$("#divWait").show();var t=new BrandCalculatorPdf;$.ajax({url:"AjaxHandler.aspx",data:{a:"SetBrandingQuoteValues",p:n,t:JSON.stringify(t),sendmail:!0},method:"POST",success:function(n,t){t=="success"&&(n.Success?($("#divWait").hide(),$("#otherMessageDialog").modal("show"),$("#lblOtherMessageText").html("Brand calculator totals were successfully emailed to your email address.")):($("#divWait").hide(),$("#otherMessageDialog").modal("show"),$("#lblOtherMessageText").html(n.Error)))},error:function(n){$("#divWait").hide();$("#otherMessageDialog").modal("show");$("#lblOtherMessageText").html(n.Error)},dataType:"json",cache:!1})}else alertMessage("Please submit the branding details first.")});$("#productBrandingPDF").unbind("click");$("#productBrandingPDF").attr("href","javascript:void(0);");$("#productBrandingPDF").click(function(){if(brandingCalculated){$anchor=$(this);$("#divWait").show();var t=new BrandCalculatorPdf;t!=null&&$.ajax({url:"AjaxHandler.aspx",data:{a:"CalculatedBrandingCost",p:n,t:JSON.stringify(t),sendmail:!1},method:"POST",success:function(n,t){t=="success"&&(n.Success?($("#divWait").hide(),window.open(n.TheData)):($("#divWait").hide(),alert("CalculatedBrandingCost: "+n.Error)))},error:function(n){$("#divWait").hide();alert("CalculatedBrandingCost: "+n.Error)},dataType:"json",cache:!1})}else alert("Please click on the submit button below to calculate the branding cost")})}function OrderNow(n){$("#modalBrandingCost").modal("hide");n?SelectCartType(currentGuid):DisplayAddToCartOptions(currentGuid,"standard")}function LoadBrandingMethods(n,t,i){var u=this,r;$("#bCalcMethods").html('<tr><td colspan="4"><img src="images/spinner.gif" /><\/td><\/tr>');r=null;$.ajax({url:"AjaxHandler.aspx?a=LoadAllBrandingMethods&p="+n+"&t=1"+(r!=null?"&sc="+r:"")+(i!=null?"&q="+i:""),success:RenderBrandingMethods,error:this.HandleLoadError,dataType:"json",cache:!1})}function RenderBrandingMethods(n,t){var r,s,u,f,h,c,i,e,o;if(t=="success")if(n.Success){if(n.TheData!=null){for(r="",s=1,methods=[],positions=[],u=0;u<n.TheData.Positions.length;u++)f=n.TheData.Positions[u],methods.push(f.PositionCode),positions.push(f),r+=BrandingPositionTemplate(f);if(n.TheData.SpecialProductColorsHtml!=""?($("#divSpecialColorsHtml").html(n.TheData.SpecialProductColorsHtml),$(".colourTip_ql").tooltip(),$("#divproductColours").show()):$("#divproductColours").hide(),$("#bCalcMethods").html(r),h="",c=null,n.TheData.Positions.length>0){let n=$('.ddlBrandingSelect option[isSpecial="1"]').attr("positionCode");for(i=GetBrandingPositionOptionSpecials(n,null,null,null),i.length>0&&($("#ddlAvailableBranding"+i[0].OptionPositionCode).prop("selectedIndex",parseInt(i[0].DisplayIndex)),RenderBrandingTypeSelected(i[0].OptionPositionCode,null)),$("#bcContainer").show(),r.indexOf("Embroidery")!=-1?$("#pnlRepeatJob").show():$("#pnlRepeatJob").hide(),$(".nostitches").show(),$(".stitches").hide(),e=0;e<$(".ddlBrandingSelect").length;e++){o=$(".ddlBrandingSelect").eq(e);let n=o.attr("isRequiredBranding");n=="true"&&(o.find("option[index='1']").prop("selected",!0),o.attr("disabled",!0))}}else $("#bcContainer").hide(),$("#bcNotice").show();$("#btnSubmit").unbind("click");$("#btnSubmit").click(function(){isBrandingSelected=!1;$(".ddlBrandingSelect").each(function(){var n=$("option:selected",this).text();if(n!=="None")return isBrandingSelected=!0,!1});isBrandingSelected?($("#brandingResultsLoader").show(),$("#brandingResults").hide(),CalculateBrandingCost(currentGuid),brandingCalculated=!0,$("#productBrandingPDF").css("cursor","pointer")):alert("Please select the branding method before clicking the submit button.")});$("#bCalcMethods select").change(function(){brandingCalculated=!1;$("#productBrandingPDF").attr("href","javascript:void(0);");$("#productBrandingPDF").css("cursor","not-allowed")});brandingCalculated===!1?$("#productBrandingPDF").css("cursor","not-allowed"):$("#productBrandingPDF").css("cursor","pointer")}}else alert(n.Error)}function RenderBrandingFields(n,t,r,u,f){var e=n,o;if(e==-1||e==-2)$("#ddlNumberOfColours"+r).hide(),t!="EMB"&&t.indexOf("EM-")==-1?($("#ddlStitches"+r).hide(),$("#noStitches"+r).show()):f?($("#ddlStitches"+r).hide(),$("#noStitches"+r).show()):["EM-CAPFRONT","EM-CAPBACK","EM-CAPSIDE"].includes(t.toUpperCase())?($("#ddlStitches"+r).hide(),$("#noStitches"+r).show()):($("#ddlStitches"+r).show(),$("#noStitches"+r).hide());else{for($("#ddlStitches"+r).hide(),$("#noStitches"+r).show(),$("#ddlNumberOfColours"+r).show(),o="",i=1;i<=e;i++)o+='<option value="'+i+'">'+i+"<\/option>";$("#ddlNumberOfColours"+r).html(o);u!=null&&$("#ddlNumberOfColours"+r).val(u)}}function DisplayBrandingPositions(n){for(i=1;i<=6;i++)if(i<=n){if($("#brandingPosition"+i).is(":hidden")){if($("#brandingPosition"+i).show().attr("data-include",!0),$("#ddlAvailableBranding"+i).html($("#ddlAvailableBranding1").html()),i>1){var t="Direct to Product (1st Position Free) - DP-FREE";$("#ddlAvailableBranding"+i+" option").filter(function(){return this.text==t}).remove()}$("#ddlAvailableBranding"+i+" option:selected").text().indexOf("Embroidery")!=-1?($("#noStitches"+i).hide(),$("#ddlStitches"+i).show(),$("#ddlNumberOfColours"+i).hide()):($("#noStitches"+i).show(),$("#ddlStitches"+i).hide(),$("#ddlNumberOfColours"+i).show(),$("#ddlNumberOfColours1").html()!=""&&$("#ddlNumberOfColours"+i).html($("#ddlNumberOfColours1").html()))}}else $("#brandingPosition"+i).hide().removeAttr("data-include")}function LoadNumberOfPositions(){$("#bcSubmit").hide();DisplayBrandingPositions($("#ddlNumberOfPositions").val());CalculateBrandingCost($("#hfProduct").val())}function ColourNumber_OnChange(n){var u,f;$("#brandingResults").hide();var i=$("#ddlNumberOfColours"+n).val(),r=$("#ddlAvailableBranding"+n+" option:selected").attr("brandcode"),t=GetFirstBrandingPositionOptionSpecial(n,r,null,i);t!=null?t.OptionSpecialRule.BrandingPositionType==-2?(u=GetSpecialBrandingPositionOptionsSelected(r,t.OptionSpecialRule.Name,2,t.OptionPositionCode),u.length==0&&($("#ddlAvailableBranding"+n).prop("selectedIndex",parseInt(t.DisplayIndex)),RenderBrandingTypeSelected(n,i))):t.OptionSpecialRule.BrandingPositionTypes.length>0&&jQuery.inArray(-1,t.OptionSpecialRule.BrandingPositionTypes)==-1&&(u=GetSpecialBrandingPositionOptionsSelected(r,t.OptionSpecialRule.Name,3,t.OptionPositionCode),u.length<t.OptionSpecialRule.BrandingPositionTypes.length&&($("#ddlAvailableBranding"+n).prop("selectedIndex",parseInt(t.DisplayIndex)),RenderBrandingTypeSelected(n,i))):(f=GetNotSpecialBrandingPositionOption(n,r),f!=null&&($("#ddlAvailableBranding"+n).prop("selectedIndex",parseInt(f.DisplayIndex)),RenderBrandingTypeSelected(n,i)));CheckSpecialsOnBranding(n,!1)}function RenderBrandingTypeSelected(n,t){var r=$("#ddlAvailableBranding"+n+" option:selected"),p=r.val(),l=r.attr("brandcode"),v=r.attr("index"),y=parseInt(r.attr("maxColours")),a=r.text(),i=GetBrandingPositionOption(n,v),u,f,o,e,h,s,c;if(i!=null){if(u=null,t!=null)u=t;else if(i.OptionSpecialRule!=null)i.OptionSpecialRule.NumberOfColours!=null&&(u=i.OptionSpecialRule.NumberOfColours);else if(f=GetBrandingPositionOptionSpecials(n,l,null,null),f.length>0){for(o=null,e=1;e<=i.NumberofColours;e++){for(h=0,s=0;s<f.length;s++)c=f[s],c.OptionSpecialRule.NumberOfColours!=null&&e!=c.OptionSpecialRule.NumberOfColours&&h++;if(h==f.length){o=e;break}}o!=null&&(u=o)}a.indexOf("DIE")>0?$("#dyeNote").show():a.indexOf("Wrap Print")>0&&$("#wrapNote").show();RenderBrandingFields(y,l,n,u,i.OptionSpecialRule!=null?!0:!1)}else $("#ddlStitches"+n).hide(),$("#noStitches"+n).hide(),$("#ddlNumberOfColours"+n).hide()}function BrandingType_Selected(n){$("#brandingResults").hide();$("#bcLoader").show();RenderBrandingTypeSelected(n,null);CheckSpecialsOnBranding(n,!0)}function CheckDye(){hasDye=!1;$(".ddlBrandingSelect").each(function(){var n=$("option:selected",this).text();n.indexOf("DIE")>0&&(hasDye=!0)});hasDye?($("#dyeNote").show(),$("#divTotalDYE").show(),$("#thDYE").show()):($("#dyeNote").hide(),$("#divTotalDYE").hide(),$("#thDYE").hide())}function CalculateBrandingCost(n){var r,o,u;$("#bcLoader").show();$("#brandingTotals").hide();currentGuid=n;$("#lblProductPrice").html(csymbol+" 0.00");$("#lblBrandingCost").html(csymbol+" 0.00");$("#lblMarkupTotal").html(csymbol+" 0.00");$("#lblTotalCost").html(csymbol+" 0.00");$("#lblTotalSetupCost").html(csymbol+" 0.00");$("#lblTotalDYECost").html(csymbol+" 0.00");$("#lblCostPricePerUnit").html(csymbol+" 0.00");r=$("#ddlNumberOfPositions").val();brandingCost=0;totalSetupCost=0;totalDYECost=0;var t=new ProductLinePositions,f=!1,e=!1,r="";for(i=0;i<t.Positions.length;i++)o=t.Positions[i].Stitches,u=t.Positions[i].BrandName,o>0&&(f=!0,r+=t.Positions[i].Position+", "),u.includes("EM-OTHER")&&(e=!0);e&&(f?alertMessage("Please note that the embroidery price for this item is on request. <br><br>You have chosen to enter the number of stitches that you estimate the logo(s) for position(s) <b>"+r.replace(/.$/,"")+"<\/b> to be. The number of stitches may differ to the number you have entered.For accurate pricing please contact your account manager."):alertMessage(" Please note that the embroidery price for this item is on request. Kindly contact your account manager for an embroidery quote."));u.includes("Embroidery")?$("#EmbroideryExtraInfo").show():$("#EmbroideryExtraInfo").hide();$.ajax({url:"AjaxHandler.aspx",data:{a:"CalculateBrandingTotals",d:JSON.stringify(t)},method:"POST",success:this.RenderBrandingTotals,error:function(n){$("#divWait").hide();$("#otherMessageDialog").modal("show");$("#lblOtherMessageText").html(n.Error)},dataType:"json",cache:!1});CheckDye()}function RenderBrandingTotals(n,t){var l,a,f,k,w,s,h,u,d,g,e;if(t=="success")if(n.Success)if(n.TheData!=null){$("#brandingResultsLoader").hide();$("#brandingResults").show();$("#divWait").hide();l=parseFloat($("#hfProductPrice").val()).toFixed(2);a=parseFloat($("#hfProductPrice2").val()).toFixed(2);$("#productPrice3 #spUsbSize").text($("#ddlUsbSize").find("option:selected").text());f=$("#bpCostBody");f.html("");var b=n.TheData.AllPrices,v=0,y=n.TheData.globalBrandingLeadTime===-1?"On Request":n.TheData.globalBrandingLeadTime;for(k in b){var i=b[k],r=i[4],nt=i[2],o=i[0],p=i[7],tt=i[5];$("#pnlRepeatJob").is(":visible")&&tt&&$("#dllRepeatJob option:selected").val()==2&&(o=o/2);v+=nt;brandingCost+=i[1];totalSetupCost+=o;totalDYECost+=p;w="";hasDye&&(w=p>0?'<td><span id="lblBrandDYECost'+r+'">'+$().number_format(p,{symbol:csymbol})+"<\/span><\/td>":'<td><span id="lblBrandDYECost'+r+'">N/A<\/span><\/td>');f.append('<tr id="bpCost'+r+'" class="hiddenRow"><td>'+r+"<\/td>"+w+'<td><span id="lblBrandSetupCost'+r+'">'+$().number_format(o,{symbol:csymbol})+'<\/span><\/td><td><span id="lblBrandPerUnit'+r+'">'+$().number_format(i[1],{symbol:csymbol})+"<\/span><\/td><\/tr>");i[6]!=null&&i[6]==!0&&$("#lblBrandPerUnit"+r).css("color","#d43f3a");$("#bpCost"+r).show()}s="2";hasDye&&(s="3");y!="On Request"?f.append('<tr><td colspan="'+s+'"><span style="float:right; background-color: #f5f5f5;"><b>Total Lead Time For Branding After Artwork Approval And Proof Of Payment:<\/b><\/span><\/td><td style="background-color:#f8cecc"><span style="text-transform:capitalize" id="lblLeadtime">'+y+" day(s)<\/span><\/td><\/tr>"):f.append('<tr><td colspan="'+s+'"><span style="float:right; background-color: #f5f5f5;"><b>Total Lead Time For Branding After Artwork Approval And Proof Of Payment:<\/b><\/span><\/td><td style="background-color:#f8cecc"><span style="text-transform:capitalize" id="lblLeadtime">'+y+"<\/span><\/td><\/tr>");h=$("#txtProductQuantity").val();u=0;_isWorkwearBC?$.each(_workwearSizes,function(n,t){let i=t.Size,r=t.Price,f=$('.wwProdQuantity[data-size="'+i+'"]').val();u+=Number(r)*f}):a==0?u=Number(l)*h:(d=parseInt($("#txtClothingQty1").val()),g=parseInt($("#txtClothingQty2").val()),u=Number(l)*d+Number(a)*g);e=totalSetupCost+totalDYECost+v+u;$("#lblBrandingCost").html($().number_format(v,{symbol:csymbol}));$("#lblTotalProductPrice").html($().number_format(u,{symbol:csymbol}));$("#lblTotalSetupCost").html($().number_format(totalSetupCost,{symbol:csymbol}));$("#lblTotalDYECost").html($().number_format(totalDYECost,{symbol:csymbol}));$("#lblTotalCost").html($().number_format(e,{symbol:csymbol}));$("#lblCostPricePerUnit").html($().number_format(e/h,{symbol:csymbol}));var it=1+Number($("#txtMarkup").val())/100,c=e*it,rt=((c-e)/c*100).toFixed(2);$("#lblMarkupTotal").html($().number_format(c,{symbol:csymbol}));$("#lblCostPerUnit").html($().number_format(c/h,{symbol:csymbol}));$("#lblGrossProfitMargin").html(rt+"%");$("#bcLoader").hide();$("#brandingTotals").show()}else alert("RenderBrandingTotals Error: data.TheData = null");else $("#divWait").hide(),$("#otherMessageDialog").modal("show"),$("#lblOtherMessageText").html(n.Error)}function UpdateQuantities(){var n=$("#txtClothingQty1").val(),t=$("#txtClothingQty2").val(),i;n=n==""?0:n;t=t==""?0:t;i=0;i=$("#pnlSmallSize").is(":visible")?parseInt(n)+parseInt(t):$("#txtProductQuantity").val();$("#txtProductQuantity").val(i)}function UpdateWorkwearQuantities(){var n=0;$(".wwProdQuantity").each(function(){let t=$(this).val();t=t==""?0:t;n+=parseInt(t)});$("#txtProductQuantity").val(n)}function CalculateMarkup(){var i=$("#txtMarkup").val(),r,n;if(i==""&&(i=0),$.isNumeric(i)){r=$("#txtProductQuantity").val();n=stringReplace(csymbol+" ",$("#lblTotalCost").text(),"");n=stringReplace(",",n,"");n=Number(n);var u=1+Number($("#txtMarkup").val())/100,t=n*u,f=n*(Number($("#txtMarkup").val())/100),e=((t-n)/t*100).toFixed(2);$("#lblMarkupValue").html($().number_format(f,{symbol:csymbol}));$("#lblMarkupTotal").html($().number_format(t,{symbol:csymbol}));$("#lblCostPerUnit").html($().number_format(t/r,{symbol:csymbol}));$("#lblGrossProfitMargin").html(e+"%")}else alert("Please enter a valid numeric value")}function stringReplace(n,t,i){while(t.match(n))t=t.replace(n,i);return t}function HandleLoadError(n){alert(n.Error)}function EmailQuoteToMe(){}function BrandCalculatorPdf(){var i,t,n,r;for(this.ProdPriceExdclBranding=$("#lblProductPriceExclBranding1").html()!=""?$("#lblProductPriceExclBranding1").html():$("#lblProductPriceExclBranding").html(),this.TotalProductPrice=$("#lblTotalProductPrice").html(),this.BrandingCost=$("#lblBrandingCost").html(),this.TotalSetupCost=$("#lblTotalSetupCost").html(),this.TotalDYECost=$("#lblTotalDYECost").html(),this.TotalCost=$("#lblTotalCost").html(),this.CostPricePUnit=$("#lblCostPricePerUnit").html(),this.MarkupValue=$("#lblMarkupValue").html(),this.MarkupTotal=$("#lblMarkupTotal").html(),this.CostPerUnit=$("#lblCostPerUnit").html(),this.SizeSXL=$("#lblProductPriceExclBranding1").html(),this.Size2XL=$("#lblProductPriceExclBranding2").html(),this.ProductPrice=$("#lblProductPriceExclBranding1").html()!=""?$("#lblProductPriceExclBranding1").html():$("#lblProductPriceExclBranding").html(),this.Leadtime=$("#lblLeadtime").html(),this.Size=$("#ddlUsbSize").attr("data-visible")=="true"?$("#ddlUsbSize").find("option:selected").text():"",this.SizePrice=$("#lblProductPriceExclBranding3").attr("data-visible")=="true"?$("#lblProductPriceExclBranding3").html():"",i=[],t=0;t<methods.length;t++)if(n=methods[t],r=$("#brandingPosition"+n).attr("data-include"),r){var u=n,f=$("#ddlAvailableBranding"+n+" option:selected").text(),e=$("#ddlNumberOfColours"+n).val(),o=$("#txtProductQuantity").val(),s=$("#lblBrandSetupCost"+n).html(),h=$("#lblBrandPerUnit"+n).html();i.push(new BrandingPDFLine(u,f,e,o,s,h))}this.Lines=i}function BrandingPDFLine(n,t,i,r,u,f){this.Position=n;this.Method=t;this.Colours=i;this.Quantity=r;this.Setup=u;this.PricePerUnit=f}function BrandingPositionTemplate(n){var i="",r,t;for(i+="<tr id='brandingPosition"+n.PositionCode+"'><td>"+n.PositionCode+" - "+n.PositionName+"<\/td><td><select id='ddlAvailableBranding"+n.PositionCode+"' class='form-control ddlBrandingSelect' isRequiredBranding='"+n.IsRequiredBranding+"' onchange=\"BrandingType_Selected('"+n.PositionCode+"')\" ><option index='0' value='None'>None<\/option>",r="",t=0;t<n.Options.length;t++){let r=n.Options[t].OptionSpecialRule;i+="<option positionCode='"+n.PositionCode+"' isSpecial='"+(r!=null?"1":"0")+"' style=\""+(r!=null?"color : #d43f3a;":"")+"\" maxColours='"+n.Options[t].NumberofColours+"' index='"+n.Options[t].DisplayIndex+"' brandcode='"+n.Options[t].BrandingCode+"' brandname='"+n.Options[t].BrandingName+"' value='"+n.Options[t].BrandingGuid+"'>"+n.Options[t].BrandingName+"<\/option>"}return i+="<\/select><\/td>",i+="<td><select id='ddlNumberOfColours"+n.PositionCode+"' class='form-control "+(r.length==0?"hiddenRow":"")+"' onchange=\"ColourNumber_OnChange('"+n.PositionCode+"')\""+r+"<\/select><\/td><td><span id='noStitches"+n.PositionCode+"' class='control-label nostitches'>N/A<\/span><input id='ddlStitches"+n.PositionCode+"' class='form-control stitches' value='0' /><\/td><\/tr>"}function ProductLinePositions(){var u,t,f,i,n,e,r,o;for(this.ProductGuid=currentGuid,this.ProductCode=$("#hfProductCode").val(),this.ColourCode=null,this.SizeCode=$("#ddlUsbSize").is(":visible")?$("#ddlUsbSize option:selected").text():null,this.IsRepeat=$("#dllRepeatJob option:selected").val()==2?!0:!1,this.ProductQty=$("#txtProductQuantity").val(),u=[],t=null,this.ColourCode!=null&&(t=[],f=[],f.push(this.ColourCode),t.push(new LineSpecialItemCodes(currentGuid,f))),i=0;i<methods.length;i++)if(n=methods[i],e=$("#ddlAvailableBranding"+n).val(),e!="None"){$("#brandingPosition"+n).attr("data-include",!0);r=$("#ddlNumberOfColours"+n).is(":hidden")?null:$("#ddlNumberOfColours"+n).val();r==null&&(o=$("#ddlAvailableBranding"+n+" option:selected").attr("maxcolours"),r=o);var s=$("#ddlStitches"+n).is(":hidden")?"0":$("#ddlStitches"+n).val(),h=$("#txtProductQuantity").val(),c=$("#ddlAvailableBranding"+n+" option:selected").attr("brandcode"),l=$("#ddlAvailableBranding"+n+" option:selected").attr("brandname"),a=GetBrandingPositionOption(n,$("#ddlAvailableBranding"+n+" option:selected").attr("index"));u.push(new LinePosition(h,s,r,e,n,c,l,a.OptionSpecialRule!=null?!0:!1))}else $("#brandingPosition"+n).removeAttr("data-include");this.Positions=u;this.SpecialItemCodes=t}function LinePosition(n,t,i,r,u,f,e,o){this.Qty=n;this.Stitches=t;this.Colours=i;this.Method=r;this.Position=u;this.BrandCode=f;this.IsSpecial=o;this.BrandName=e}function LineSpecialItemCodes(n,t){this.ProductGuid=n;this.ColourCodes=t}function DisplayAddToLightbox(n,t){n!=null&&n!=""&&t!=null&&t!=""&&(LightBoxExists||LightBoxCreated?LightBox.ShowAddToLighBoxModal(n,t):LightBox.ShowCreateLightBoxModal(n,t))}function DisplayQuickLook(n){$("#modalQuickLook").modal("show");$("#divWait").show();$.ajax({url:"AjaxHandler.aspx?a=GetQuickLookData&product="+n,success:DisplayQuickLookProductDetails,error:function(n){alert(n.Error)},dataType:"json",cache:!1})}function getQuicklookPriceHTML(n,t){return"<tr><td><p class='quicklookPriceContainer'>"+n+":<\/p><span class='spanQuiklookPrice' >"+t+"<\/span><\/td><\/tr>"}function setQuicklookProductHTML(n){var f=n.ProductCode,s=n.ProductName,i,r,e,u,o,t;$("#qlItemCode").html(f);$("#qlItemName").html(s);$("#quickLookDescription").html(n.Description);$("#divComponentsQuicklook2 #btncomponent2").empty();$("#divComponentsQuicklook2 #btnColors2").empty();$("#divComponentsQuicklook #btncomponent").empty();$("#divComponentsQuicklook #btnColors").empty();n.ColoursHTML!=""?($("#quickLookColours").html(n.ColoursHTML),$(".qlColours").show()):$(".qlColours").hide();RenderQuickLookComponents(n.ComponentDetail);$("#qlGenderButtons").html(n.GenderHTML);$("#imgQlMainImage").attr("src",n.ImageURL);$("#imgQlMainImageWrap").attr("href",n.SaveImageURL);$("#lnkViewLarger").attr("href",n.SaveImageURL);$("#lnkViewLarger").attr("download",f+"jpg");$("#lnkDetailedInfo").attr("href",n.DetailedInfoURL);n.ProductMatchHtml!=""?$("#btnProductMatch").html(n.ProductMatchHtml):($("#divTapeButtons").hide(),$("#btnProductMatch").hide());n.HasLogo24Branding?$(".logo24Icon-3").show():$(".logo24Icon-3").hide();IsSpringboxProduct(f)?$(".SpingBokIcon-3").show():$(".SpingBokIcon-3").hide();$(".SpingBokIcon-3 span.lblLeadTime").text("5 working days");i=$("#divqlExtraImages");r="";for(e in n.ExtraImages)u=n.ExtraImages[e],o="<div class='item'><a id='lnkExtraImage'><img src='"+u.ThumbnailImage+"' onmouseover=\"LoadQuickLookExtraImage('"+u.MainImage+"','"+u.LargeImage+"')\" /><\/a> <\/div>",r+=o;if(n.Regions!=""?($("#divSADCBranding").show(),$("#spanRibbon").html(n.Regions)):$("#divSADCBranding").hide(),typeof i.data("owlCarousel")!="undefined")r!=""&&i.trigger("replace.owl.carousel",r),i.trigger("refresh.owl.carousel");else{i.html(r);i.on("initialized.owl.carousel",function(n){owlQuickLookResize(n.target);window.setTimeout(function(){var n,t;document.createEvent?(n=document.createEvent("Event"),n.initEvent("resize",!0,!0),window.dispatchEvent(n)):(element=document.documentElement,t=document.createEventObject(),element.fireEvent("onresize",t))},10)});i.owlCarousel({loop:!1,rewindNav:!1,margin:4,nav:!0,callbacks:!0,navText:['<i class="fa fa-chevron-left"><\/i>','<i class="fa fa-chevron-right"><\/i>'],responsive:{0:{items:4},480:{items:3},600:{items:4},1e3:{items:4}}});i.each(function(){removeNavArrows(this)})}n.LoggedIn&&($("#divPrices").show(),$("#tbQLPrices").empty(),$("#lblStdPrice").html(n.StandardPrice),$("#lblYourPrice").html(n.MyPrice),$("#tbQLPrices").empty(),t=$("#tbQLPrices"),n.JadePrice&&t.append(getQuicklookPriceHTML("Jade",n.JadePrice)),t.append(getQuicklookPriceHTML("Quartz (Standard)",n.StandardPrice)),t.append(getQuicklookPriceHTML("Chrome",n.ChromePrice)),t.append(getQuicklookPriceHTML("Bronze",n.BronzePrice)),t.append(getQuicklookPriceHTML("Cobalt",n.CobaltPrice)),t.append(getQuicklookPriceHTML("Silver",n.SilverPrice)),t.append(getQuicklookPriceHTML("Gold",n.GoldPrice)),t.append(getQuicklookPriceHTML("Platinum",n.PlatinumPrice)),t.append(getQuicklookPriceHTML("Diamond",n.DiamondPrice)),t.append(getQuicklookPriceHTML("Titanium",n.TitaniumPrice)),t.append(getQuicklookPriceHTML("Tanzanite",n.TanzanitePrice)));$("#litPartButtons").html(n.PHTML);$(".colourTip_ql").tooltip();$(".qlSizes").html(n.SizeHTML);$(".qlSizes").removeClass("qlSizes-bottomSpace");$(".qlSizes a").length>5&&$(".qlSizes").addClass("qlSizes-bottomSpace");$("#lblBranding").text(n.AvailableBrandingCodes.join(", "))}function DisplayQuickLookProductDetails(n,t){t=="success"&&(n.Success?(setQuicklookProductHTML(n.TheData),$("#divWait").hide()):alert(n.Error))}function LoadQuickLookExtraImage(n,t){$("#imgQlMainImage").attr("src",n);$("#imgQlMainImageWrap").attr("href",t);$("#lnkViewLarger").attr("href",t)}function owlQuickLookResize(n){$(n).find(".owl-controls").length==0?$(n).width($(".product-stage-get-width-ql").width()):$(n).width($(".product-stage-get-width-ql").width()-66)}function RenderQuickLookComponents(n){var f,u,t,e,l,r,a,i;if(n!=null){for($("#divQlComponents").show(),f="",u=0;u<n.length;u++){t=n[u];e="";e=t.IsHiddenOnWebsite?'<span class ="prefixLabel hideMe">'+t.Prefix+" : <\/span>":'<span class ="prefixLabel">'+t.Prefix+" : <\/span>";var s=e,o="",h="",c=t.ComponentColourStock;for(l in c)r=c[l],r.IsDefaultConfig?(o=t.IsHiddenOnWebsite?'class="qlComponentButton selection active hideMe"':'class="qlComponentButton selection active"',h=r.ColoursHTML):o='class="qlComponentButton selection "',a="componentMixMatch.SetPriceByComponentType('"+r.ComponentCode+"','"+r.ComponentGuid+"','"+t.ProductCode+"','quicklook', 'lblStdPrice')",s+="<a "+o+" id ='ct_"+r.ComponentCode+"' onclick=\""+a+'">'+r.ComponentCode+"<\/a>";i=template_PrefixComponents;i=stringReplace(/##PRODUCTCOMPONENTS##/,i,s);i=stringReplace(/##PRODUCTCOLOURS##/,i,h);i=stringReplace(/##QLPREFIXCLASS##/,i,"qlrow_"+t.Prefix);f+=i}$("#qlProductComponents").html(f)}else $("#divQlComponents").hide()}function handleLoadError(n){alert(n.Error)}function ComponentStockLevels(n){var p=n,r=p.Products,u=p.Colours,o=$("#componentStockDataDisplay"),s="<thead><tr><th>Item Code<\/th><th>Description<\/th>",w,e,d,a,f,v;for(c=0;c<u.length;c++)w=u[c]==""?"Common<br/>Components":u[c],s+="<th>"+w+"<\/th>";for(s+="<\/tr><\/thead>",o.append(s),i=0;i<r.length;i++){var t=r[i].ItemCode,h=r[i].ItemName,b=r[i].StockCheckCode,k="",l=r[i].ColourStock;for(c=0;c<u.length;c++)e=u[c].replace(/\s+/g,""),e=e.replace(/\//g,"-"),k+="<td class='"+t+"-"+e+"-stockvalue'>-<\/td>";for(h==null&&(h=t),d="<a class='btn-tooltip blue stockCheckTip' data-toggle='tooltip' data-placement='top' title='' data-original-title='Click on the item code for more detail on the stock on hand and incoming status of this product'><i class='fa fa-info' aria-hidden='true'><\/i><\/a>",a="<a onclick='DisplayCombinedStockLevels('"+b+"', '', '', 'showIncoming','"+loginFlag+"',true)'>"+t+"<\/a>",b==""&&(a=t),o.append("<tr><td class='no-wrap ttSC'>"+d+" "+a+'<\/td><td  class="capa" >'+h+"<\/td>"+k+"<\/tr>"),y=0;y<l.length;y++)f=l[y].ColourDisplay.replace(/\s+/g,""),f=f.replace(/\//g,"-"),v=l[y].InStock,$("."+t+"-"+f+"-stockvalue").length>0?$("."+t+"-"+f+"-stockvalue").html(NumberWithCommas(v)):$("."+t+"--stockvalue").html(NumberWithCommas(v))}o.append("<\/table>");$(".stockCheckTip").tooltip()}function DisplayWorkwearStockLevelsOf(n,t){var o=n.StockLevel,r=n.ImmediateStock,f,c,k,p,d;$("#WorkwearStockLevelDataDisplay").empty();$("#stockLevelDataDisplay").empty();f=$("#WorkwearStockLevelDataDisplay");$(".productStockDiv").css("max-height","360px");var b='<a class="btn-tooltip blue stockCheckTip" data-toggle="tooltip" data-placement="top" title="" data-original-title="##tiptext##" ><i class="fa fa-info"><\/i><\/a>',g=stringReplace(/##tiptext##/,b,"Products can only be reserved for 24 hours. The below reservation quantities have not reduced the stock on hand. If you have a confirmed order for an item that shows as reserved, please chat to your account manager, who will then give the company who has reserved the goods two hours to confirm them, otherwise they will be available to you."),nt=stringReplace(/##tiptext##/,b,"Nett of confirmed back orders"),h="",s='<thead><tr><th>Item Code<\/th><th>Description<\/th><th>Colour<\/th><th>Stock on Hand<\/th><th class="thReserved">Reserved ##tip_reserved##<\/th><th>Incoming ##tip_incoming##<\/th><th class="stockTableLastTh_noScroll">Incoming ETA<\/th><\/tr><\/thead>',a=!0,e=$("#MO-display a").attr("AI-itemCode");if(r.IAProductCode!=null){let n="onclick=\"DisplayCombinedStockLevels('"+e+"','', '','showIncoming','"+loginFlag+"',true)\"",t="<a "+n+"><u>"+e+"<\/u> <\/a>";h='<tr style="background-color: #f5f5f5"><th><\/th><th><\/th><th><\/th><th class="borderTop wwLeadtimeClmn">From '+r.LeadTime+'<span>*<\/span><\/th><th class="borderTop wwImmedLink"> Immediately<br/>'+t+'<\/th><th><\/th><th><\/th><th class="stockTableLastTh_noScroll"><\/th><\/tr>';s='<thead><tr><th>Item Code<\/th><th>Description<\/th><th>Colour<\/th><th class="wwStockOnHand" colspan="2">Stock on Hand<\/th><th class="thReserved">Reserved ##tip_reserved##<\/th><th>Incoming ##tip_incoming##<\/th><th class="stockTableLastTh_noScroll">Incoming ETA<\/th><\/tr>'+h+"<\/thead>"}else if(e=r.MOProductCode,o[0].Leadtime=="Available Immediately"){e=r.MOProductCode;let n="onclick=\"DisplayCombinedStockLevels('"+e+"','', '','showIncoming','"+loginFlag+"',true)\"",t="<a "+n+"><u>"+e+"<\/u> <\/a>";h='<tr style="background-color: #f5f5f5"><th><\/th><th><\/th><th><\/th><th class="borderTop wwImmedLink"> Immediately<\/th><th class="borderTop wwLeadtimeClmn">From '+r.LeadTime+"<br>"+t+'<span>*<\/span><\/th><th><\/th><th><\/th><th class="stockTableLastTh_noScroll"><\/th><\/tr>';s='<thead><tr><th>Item Code<\/th><th>Description<\/th><th>Colour<\/th><th class="wwStockOnHand" colspan="2">Stock on Hand<\/th><th class="thReserved">Reserved ##tip_reserved##<\/th><th>Incoming ##tip_incoming##<\/th><th class="stockTableLastTh_noScroll">Incoming ETA<\/th><\/tr>'+h+"<\/thead>"}else{a=!1;e=r.MOProductCode;h='<tr style="background-color: #f5f5f5"><th><\/th><th><\/th><th><\/th><th class="borderTop wwImmedLink">From '+r.LeadTime+'<span>*<\/span><\/th><th class="borderTop wwLeadtimeClmn">Immediately<br>-<\/th><th><\/th><th><\/th><th class="stockTableLastTh_noScroll"><\/th><\/tr>';s='<thead><tr><th>Item Code<\/th><th>Description<\/th><th>Colour<\/th><th class="wwStockOnHand" colspan="2">Stock on Hand<\/th><th class="thReserved">Reserved ##tip_reserved##<\/th><th>Incoming ##tip_incoming##<\/th><th class="stockTableLastTh_noScroll">Incoming ETA<\/th><\/tr>'+h+"<\/thead>"}s=stringReplace(/##tip_reserved##/,s,g);s=stringReplace(/##tip_incoming##/,s,nt);f.append(s);$(".stockCheckTip").tooltip();var w=0,v="",l="",i=2,u=[];if($.each(o,function(n,t){var p,et,ut,b,pt,at;w=n;var st=t.ProductCode,c=t.ColourCode,tt=processValue(1,t.ColourName),bt=t.Description,nt=st+"_"+c,ht=t.ItemSizes,it=t.IncomingETA,ri='<a href="javascript:void(0);" class="btn-table-row-collapse"><i class="fa fa-chevron-right"><\/i><\/a>',rt=t.DisplayRGB;rt=="800080"&&(rt="FF0000");rt!="FF0000"&&(rt="7D7D7D");rt!="FF0000"&&it=="No more on order"&&(it="To be confirmed");var kt=t.InStock,dt=t.Reserved,ct=t.Incoming,k="",lt='style="color:#'+rt+';"';if(ht.length==0&&(ri=""),p=st,c!=""&&(p.endsWith("-"+c)||(p=p+"-"+c)),k='<td class="wwImmediatelyTD"><b>-<\/b><\/td>',a&&r.ImmediateStockVO!=null&&r.ImmediateStockVO.forEach(function(n){if(n.TypeCode==c&&n.ImmediateStock>0){let t="onclick=\"DisplayCombinedStockLevels('"+e+"', '"+n.TypeCode+"', '', 'showIncoming','"+loginFlag+"',true)\"";k='<td class="wwImmedLink wwImmediatelyTD"><a '+t+">"+FormatNumber(n.ImmediateStock)+"<\/a><\/td>"}}),t.ItemSizes.length==0){$("#WorkwearStockLevelDataDisplay").addClass("striped-rows");$("#WorkwearStockLevelDataDisplay").removeClass("stock-hidden-rows");var s=st+"||"+c+"||",g="",d="";o.length>w+1&&(g=o[w+1],d=g[0]+"||"+g[8]+"||");d!=s&&v!=s?f.append("<tr "+lt+" data-itemCode='"+p+"' class=\"sc_"+c+"\"><td class='no-wrap'>"+p+'<\/td><td class="capa">'+bt+"<\/td><td>"+tt+'<\/td><td class="wwInstockTD"><b>'+FormatNumber(kt)+'<\/b><\/td class="wwImmediatelyTD">'+k+"<td>"+FormatNumber(dt)+"<\/td><td>"+FormatNumber(ct)+"<\/td><td>"+it+"<\/td><\/tr>"):d==s&&v!=s?(i=2,l='<tr class="'+nt+"_1 sc_"+c+'" '+lt+" data-itemCode='"+p+"' ><td rowspan=\""+i+'">'+p+'<\/td><td class="capa" rowspan="'+i+'">'+bt+'<\/td><td rowspan="'+i+'">'+tt+'<\/td><td class="wwInstockTD" rowspan="'+i+'"><b>'+FormatNumber(kt)+'<\/b><\/td class="wwImmediatelyTD">'+k+'<td rowspan="'+i+'">'+FormatNumber(dt)+"<\/td><td>"+FormatNumber(ct)+"<\/td><td>"+it+"<\/td><\/tr>",f.append(l)):v==s&&(d==s&&(at=new RegExp('rowspan="'+i+'"',"g"),l=l.replace(at,'rowspan="'+(i+1)+'"'),i+=1,$("."+nt+"_1").replaceWith(l)),f.append("<tr data-itemCode='"+p+"' "+lt+' class="sc_'+c+'"><td style="width:141px;">'+FormatNumber(ct)+'<\/td><td style="width:151px;">'+it+"<\/td><\/tr>"));v=s}else{var gt="",vt="",ni=!1;for(t.ItemSizes.length>1&&(t.ItemSizes[0][0]==t.ItemSizes[t.ItemSizes.length-1][0]&&(ni=!0),t.ItemSizes[0][9]==="128"?($("#sizeRangePanel").show(),$("#sizeRange").html("Age 7 - 8: Size 128 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 9 - 10: Size 140 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 11 - 12: Size 152")):t.ItemSizes[0][9]==="104"&&($("#sizeRangePanel").show(),$("#sizeRange").html("Age 4: Size 104 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 6: Size 116 &nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 8: Size 128&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 10: Size 140&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 12: Size 152&nbsp;&nbsp;&nbsp;|&nbsp;&nbsp;&nbsp; Age 14: Size 164"))),t.ItemSizes.length==1||ni?(gt=it,vt='class="dontshow"',$("#WorkwearStockLevelDataDisplay").addClass("striped-rows"),$("#WorkwearStockLevelDataDisplay").removeClass("stock-hidden-rows")):($("#WorkwearStockLevelDataDisplay").removeClass("striped-rows"),$("#WorkwearStockLevelDataDisplay").addClass("stock-hidden-rows"),gt='<a href="javascript:void(0);" class="lnkExpandView">Expand to view<\/a>',vt='class="table-row-collapse sc_'+c+'"'),f.append("<tr data-itemCode='"+p+"' "+vt+" "+lt+"><td>"+ri+p+'<\/td><td class="capa">'+bt+"<\/td><td>"+tt+'<\/td><td class="wwInstockTD"><b>'+FormatNumber(kt)+'<\/b><\/td class="wwImmediatelyTD">'+k+"<td>"+FormatNumber(dt)+"<\/td><td>"+FormatNumber(ct)+"<\/td><td>"+gt+"<\/td><\/tr>"),et="",ut="",y=0;y<t.ItemSizes.length;y++)if(b=ht[y],b!==undefined){var h=b[9],ti=b[0],ei=b[1],ui=b[2],yt=b[3],ii=b[4],ot=b[5],fi=st+"_"+tt.replace(" ","-")+"_"+h,ft=b[6];ft=="800080"&&(ft="FF0000");(ft!="FF0000"||b[6]==undefined)&&(ft="7D7D7D");pt='style="color:#'+ft+';"';ft!="FF0000"&&ot=="No more on order"&&(ot="To be confirmed");var s=ti+"||"+c+"||"+h,g="",d="",wt=h;if(k="<td><b>-<\/b><\/td>",h!=undefined&&(h.indexOf("GB")!=-1||h.indexOf("BOARD")!=-1||h.indexOf("GIFTBAG")!=-1)&&(wt=ei),ht.length>y+1){if(g=ht[y+1],g===undefined)continue;d=g[0]+"||"+g[8]+"||"+g[9]}t.ItemSizes.length==1&&vt=='class="dontshow"'?nt+=" showRow":ni&&(nt+=" showRow");yt==undefined&&(yt=0);wt==undefined&&(sDesription="");d!=s&&et!=s&&d.indexOf("undefined")==-1?(a&&r.ImmediateStockVO!=null&&r.ImmediateStockVO.forEach(function(n){var t=n.ItemSizes;$.each(t,function(t,i){if(i[9]==h&&n.TypeCode==c){let t="onclick=\"DisplayCombinedStockLevels('"+e+"', '"+n.TypeCode+"', '', 'showIncoming','"+loginFlag+"',true)\"";k='<td class="wwImmedLink wwImmediatelyTD"><a '+t+">"+FormatNumber(i[2])+"<\/a><\/td>"}})}),f.append('<tr class="'+nt+' table-row-active" '+pt+" \"><td class='no-wrap'>"+ti+'<\/td><td class="capa">'+wt+"<\/td><td>"+tt+'<\/td><td class="wwInstockTD"><b>'+FormatNumber(ui)+'<\/b><\/td class="wwImmediatelyTD">'+k+"<td>"+FormatNumber(yt)+"<\/td><td>"+FormatNumber(ii)+"<\/td><td>"+ot+"<\/td><\/tr>")):d==s&&et!=s?(a&&r.ImmediateStockVO!=null&&r.ImmediateStockVO.forEach(function(n){var t=n.ItemSizes;$.each(t,function(t,i){if(i[9]==h&&n.TypeCode==c){let t="onclick=\"DisplayCombinedStockLevels('"+e+"', '"+n.TypeCode+"', '', 'showIncoming','"+loginFlag+"',true)\"";k='<td class="wwImmedLink wwImmediatelyTD"  rowspan="2"><a '+t+">"+FormatNumber(i[2])+"<\/a><\/td>"}})}),i=2,ut='<tr class="'+nt+" "+fi+'_1 table-row-active" '+pt+' "><td rowspan="'+i+'">'+ti+'<\/td><td class="capa" rowspan="'+i+'">'+wt+'<\/td><td rowspan="'+i+'">'+tt+'<\/td><td class="wwInstockTD" rowspan="'+i+'"><b>'+FormatNumber(ui)+'<\/b><\/td class="wwImmediatelyTD">'+k+'<td rowspan="'+i+'">'+FormatNumber(yt)+"<\/td><td>"+FormatNumber(ii)+"<\/td><td>"+ot+"<\/td><\/tr>",f.append(ut)):et==s&&(d==s&&(at=new RegExp('rowspan="'+i+'"',"g"),ut=ut.replace(at,'rowspan="'+(i+1)+'"'),i+=1,$("."+fi+"_1").replaceWith(ut)),f.append('<tr class="'+nt+' table-row-active" '+pt+' "><td style="width:122px;">'+FormatNumber(ii)+'<\/td><td style="width:151px;">'+ot+"<\/td><\/tr>"));(h==null||h=="")&&($("#divSizeBtnsContainer").hide(),$("#stockSizes").empty(),sizeList=[]);myContainer!="divSizeBtnsContainer"&&(sizeList[y]=h);et=s;u.includes(h)||u.push(h)}}}),u=u.filter(function(n){return n!=="DUMMY"&&n!==undefined}),u.length==0&&($("#divSizeBtnsContainer").hide(),$("#stockSizes").empty(),$("#sizeText").hide()),u.length>0)for($("#stockSizes").empty(),$("#sizeText").show(),$("#divSizeBtnsContainer").show(),u=Array.from(new Set(u)),c=0;c<u.length;++c)k="onclick=\"DisplayCombinedStockLevels('"+t+"', '"+u[c]+"','','divSizeBtnsContainer','"+loginFlag+"',true)\"",$("#stockSizes").append("<a "+k+' class="selection" id=\''+u[c]+"'>"+u[c]+" <\/a>");f.append("<\/table>");o.length==1&&o[0].ItemSizes.length>0&&($("#WorkwearStockLevelDataDisplay tbody tr").hide(),$("#WorkwearStockLevelDataDisplay tbody tr").removeClass("showRow"),p="."+o[0].ProductCode+"_"+o[0].ColourCode,$(p).addClass("showRow"),$(p).is(":visible")||$(p).show());$(".btn-table-row-collapse").click(function(){for(var i,t=$(this).parent().parent().parent().children(),r=$(this).parent().parent().index(),n=0;n<t.length;n++)if(n>r)if($(t).eq(n).hasClass("table-row-active"))$(t).eq(n).toggleClass("showRow");else break;let u=$(this).html();i=$(this).parent().parent();u.indexOf("fa-chevron-right")!=-1?($(this).html('<i class="fa fa-chevron-down" aria-hidden="true"><\/i>'),$(".lnkExpandView",i).html("Collapse View")):($(this).html('<i class="fa fa-chevron-right" aria-hidden="true"><\/i>'),$(".lnkExpandView",i).html("Expand To View"));$("#WorkwearStockLevelDataDisplay tbody").get(0).scrollHeight>$("#WorkwearStockLevelDataDisplay tbody").get(0).clientHeight?($(".stockTableLastTh_noScroll").removeClass("stockTableLastTh_noScroll").addClass("stockTableLastTh"),$("#WorkwearStockLevelDataDisplay").width("1076")):($(".stockTableLastTh").removeClass("stockTableLastTh").addClass("stockTableLastTh_noScroll"),$("#WorkwearStockLevelDataDisplay").width("1060"))});$(".lnkExpandView").click(function(){var n=$(this).parent().parent();$(".btn-table-row-collapse",n).click()});$("#WorkwearStockLevelDataDisplay tbody").get(0).scrollHeight>$("#WorkwearStockLevelDataDisplay tbody").get(0).clientHeight?($(".stockTableLastTh_noScroll").removeClass("stockTableLastTh_noScroll").addClass("stockTableLastTh"),$("#WorkwearStockLevelDataDisplay").width("1076")):$("#WorkwearStockLevelDataDisplay").width("1060");d="";$("#hfStockSize").val()!=""&&(d="&size="+$("#hfStockSize").val())}var logoUpload,logo24Colour,Ordering,doAjaxBeforeUnloadEnabled,doAjaxBeforeUnload,addToCartDialog,LightBox,template_PrefixComponents,ComponentMixMatch,displayLogoUpload,WorkWearProducts,CustomPackagingDataService;(function(){function ph(n,t){return n.set(t[0],t[1]),n}function wh(n,t){return n.add(t),n}function f(n,t,i){switch(i.length){case 0:return n.call(t);case 1:return n.call(t,i[0]);case 2:return n.call(t,i[0],i[1]);case 3:return n.call(t,i[0],i[1],i[2])}return n.apply(t,i)}function bh(n,t,i,r){for(var f=-1,e=n==null?0:n.length,u;++f<e;)u=n[f],t(r,u,i(u),n);return r}function c(n,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(t(n[i],i,n)===!1)break;return n}function kh(n,t){for(var i=n==null?0:n.length;i--;)if(t(n[i],i,n)===!1)break;return n}function ie(n,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(!t(n[i],i,n))return!1;return!0}function tt(n,t){for(var i=-1,f=n==null?0:n.length,e=0,u=[],r;++i<f;)r=n[i],t(r,i,n)&&(u[e++]=r);return u}function ki(n,t){var i=n==null?0:n.length;return!!i&&vt(n,t,0)>-1}function dr(n,t,i){for(var r=-1,u=n==null?0:n.length;++r<u;)if(i(t,n[r]))return!0;return!1}function r(n,t){for(var i=-1,r=n==null?0:n.length,u=Array(r);++i<r;)u[i]=t(n[i],i,n);return u}function it(n,t){for(var i=-1,r=t.length,u=n.length;++i<r;)n[u+i]=t[i];return n}function ui(n,t,i,r){var u=-1,f=n==null?0:n.length;for(r&&f&&(i=n[++u]);++u<f;)i=t(i,n[u],u,n);return i}function dh(n,t,i,r){var u=n==null?0:n.length;for(r&&u&&(i=n[--u]);u--;)i=t(i,n[u],u,n);return i}function gr(n,t){for(var i=-1,r=n==null?0:n.length;++i<r;)if(t(n[i],i,n))return!0;return!1}function gh(n){return n.split("")}function nc(n){return n.match(ss)||[]}function ue(n,t,i){var r;return i(n,function(n,i,u){if(t(n,i,u))return r=i,!1}),r}function di(n,t,i,r){for(var f=n.length,u=i+(r?1:-1);r?u--:++u<f;)if(t(n[u],u,n))return u;return-1}function vt(n,t,i){return t===t?cc(n,t,i):di(n,fe,i)}function tc(n,t,i,r){for(var u=i-1,f=n.length;++u<f;)if(r(n[u],t))return u;return-1}function fe(n){return n!==n}function ee(n,t){var i=n==null?0:n.length;return i?iu(n,t)/i:hi}function nu(t){return function(i){return i==null?n:i[t]}}function tu(t){return function(i){return t==null?n:t[i]}}function oe(n,t,i,r,u){return u(n,function(n,u,f){i=r?(r=!1,n):t(i,n,u,f)}),i}function ic(n,t){var i=n.length;for(n.sort(t);i--;)n[i]=n[i].value;return n}function iu(t,i){for(var r,f=-1,e=t.length,u;++f<e;)u=i(t[f]),u!==n&&(r=r===n?u:r+u);return r}function ru(n,t){for(var i=-1,r=Array(n);++i<n;)r[i]=t(i);return r}function rc(n,t){return r(t,function(t){return[t,n[t]]})}function e(n){return function(t){return n(t)}}function uu(n,t){return r(t,function(t){return n[t]})}function fi(n,t){return n.has(t)}function se(n,t){for(var i=-1,r=n.length;++i<r&&vt(t,n[i],0)>-1;);return i}function he(n,t){for(var i=n.length;i--&&vt(t,n[i],0)>-1;);return i}function uc(n,t){for(var i=n.length,r=0;i--;)n[i]===t&&++r;return r}function fc(n){return"\\"+lh[n]}function ec(t,i){return t==null?n:t[i]}function yt(n){return oh.test(n)}function oc(n){return sh.test(n)}function sc(n){for(var t,i=[];!(t=n.next()).done;)i.push(t.value);return i}function ei(n){var i=-1,t=Array(n.size);return n.forEach(function(n,r){t[++i]=[r,n]}),t}function ae(n,t){return function(i){return n(t(i))}}function rt(n,t){for(var i=-1,f=n.length,e=0,u=[],r;++i<f;)r=n[i],(r===t||r===oi)&&(n[i]=oi,u[e++]=i);return u}function pt(n){var i=-1,t=Array(n.size);return n.forEach(function(n){t[++i]=n}),t}function hc(n){var i=-1,t=Array(n.size);return n.forEach(function(n){t[++i]=[n,n]}),t}function cc(n,t,i){for(var r=i-1,u=n.length;++r<u;)if(n[r]===t)return r;return-1}function lc(n,t,i){for(var r=i+1;r--;)if(n[r]===t)return r;return r}function wt(n){return yt(n)?ac(n):re(n)}function v(n){return yt(n)?vc(n):gh(n)}function ac(n){for(var t=wr.lastIndex=0;wr.test(n);)++t;return t}function vc(n){return n.match(wr)||[]}function yc(n){return n.match(eh)||[]}var n,ye="4.17.4",gi=200,pe="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",o="Expected a function",nr="__lodash_hash_undefined__",we=500,oi="__lodash_placeholder__",y=1,eu=2,et=4,ot=1,si=2,s=1,ut=2,ou=4,p=8,st=16,w=32,ht=64,k=128,bt=256,tr=512,be=30,ke="...",de=800,ge=16,su=1,no=2,to=3,ft=1/0,nt=9007199254740991,io=17976931348623157e292,hi=NaN,b=4294967295,ro=b-1,uo=b>>>1,fo=[["ary",k],["bind",s],["bindKey",ut],["curry",p],["curryRight",st],["flip",tr],["partial",w],["partialRight",ht],["rearg",bt]],ct="[object Arguments]",ci="[object Array]",eo="[object AsyncFunction]",kt="[object Boolean]",dt="[object Date]",oo="[object DOMException]",li="[object Error]",ai="[object Function]",hu="[object GeneratorFunction]",l="[object Map]",gt="[object Number]",so="[object Null]",d="[object Object]",cu="[object Promise]",ho="[object Proxy]",ni="[object RegExp]",a="[object Set]",ti="[object String]",vi="[object Symbol]",co="[object Undefined]",ii="[object WeakMap]",lo="[object WeakSet]",ri="[object ArrayBuffer]",lt="[object DataView]",ir="[object Float32Array]",rr="[object Float64Array]",ur="[object Int8Array]",fr="[object Int16Array]",er="[object Int32Array]",or="[object Uint8Array]",sr="[object Uint8ClampedArray]",hr="[object Uint16Array]",cr="[object Uint32Array]",ao=/\b__p \+= '';/g,vo=/\b(__p \+=) '' \+/g,yo=/(__e\(.*?\)|\b__t\)) \+\n'';/g,lu=/&(?:amp|lt|gt|quot|#39);/g,au=/[&<>"']/g,po=RegExp(lu.source),wo=RegExp(au.source),bo=/<%-([\s\S]+?)%>/g,ko=/<%([\s\S]+?)%>/g,vu=/<%=([\s\S]+?)%>/g,go=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,ns=/^\w*$/,ts=/^\./,is=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,lr=/[\\^$.*+?()[\]{}|]/g,rs=RegExp(lr.source),yu=/^\s+|\s+$/g,pu=/^\s+/,us=/\s+$/,fs=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,es=/\{\n\/\* \[wrapped with (.+)\] \*/,os=/,? & /,ss=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,hs=/\\(\\)?/g,cs=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,wu=/\w*$/,ls=/^[-+]0x[0-9a-f]+$/i,as=/^0b[01]+$/i,vs=/^\[object .+?Constructor\]$/,ys=/^0o[0-7]+$/i,ps=/^(?:0|[1-9]\d*)$/,ws=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,yi=/($^)/,bs=/['\n\r\u2028\u2029\\]/g,pi="\\ud800-\\udfff",bu="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",ku="\\u2700-\\u27bf",du="a-z\\xdf-\\xf6\\xf8-\\xff",gu="A-Z\\xc0-\\xd6\\xd8-\\xde",nf="\\ufe0e\\ufe0f",tf="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",ar="['’]",ks="["+pi+"]",rf="["+tf+"]",wi="["+bu+"]",uf="\\d+",ds="["+ku+"]",ff="["+du+"]",ef="[^"+pi+tf+uf+ku+du+gu+"]",vr="\\ud83c[\\udffb-\\udfff]",gs="(?:"+wi+"|"+vr+")",of="[^"+pi+"]",yr="(?:\\ud83c[\\udde6-\\uddff]){2}",pr="[\\ud800-\\udbff][\\udc00-\\udfff]",at="["+gu+"]",sf="\\u200d",hf="(?:"+ff+"|"+ef+")",nh="(?:"+at+"|"+ef+")",cf="(?:"+ar+"(?:d|ll|m|re|s|t|ve))?",lf="(?:"+ar+"(?:D|LL|M|RE|S|T|VE))?",af=gs+"?",vf="["+nf+"]?",th="(?:"+sf+"(?:"+[of,yr,pr].join("|")+")"+vf+af+")*",yf=vf+af+th,ih="(?:"+[ds,yr,pr].join("|")+")"+yf,rh="(?:"+[of+wi+"?",wi,yr,pr,ks].join("|")+")",uh=RegExp(ar,"g"),fh=RegExp(wi,"g"),wr=RegExp(vr+"(?="+vr+")|"+rh+yf,"g"),eh=RegExp([at+"?"+ff+"+"+cf+"(?="+[rf,at,"$"].join("|")+")",nh+"+"+lf+"(?="+[rf,at+hf,"$"].join("|")+")",at+"?"+hf+"+"+cf,at+"+"+lf,"\\d*(?:(?:1ST|2ND|3RD|(?![123])\\dTH)\\b)","\\d*(?:(?:1st|2nd|3rd|(?![123])\\dth)\\b)",uf,ih].join("|"),"g"),oh=RegExp("["+sf+pi+bu+nf+"]"),sh=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,hh=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],ch=-1,i={},t,re,ce,le,ve,fu,g;i[ir]=i[rr]=i[ur]=i[fr]=i[er]=i[or]=i[sr]=i[hr]=i[cr]=!0;i[ct]=i[ci]=i[ri]=i[kt]=i[lt]=i[dt]=i[li]=i[ai]=i[l]=i[gt]=i[d]=i[ni]=i[a]=i[ti]=i[ii]=!1;t={};t[ct]=t[ci]=t[ri]=t[lt]=t[kt]=t[dt]=t[ir]=t[rr]=t[ur]=t[fr]=t[er]=t[l]=t[gt]=t[d]=t[ni]=t[a]=t[ti]=t[vi]=t[or]=t[sr]=t[hr]=t[cr]=!0;t[li]=t[ai]=t[ii]=!1;var lh={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},ah=parseFloat,vh=parseInt,pf=typeof global=="object"&&global&&global.Object===Object&&global,yh=typeof self=="object"&&self&&self.Object===Object&&self,u=pf||yh||Function("return this")(),br=typeof exports=="object"&&exports&&!exports.nodeType&&exports,bi=br&&typeof module=="object"&&module&&!module.nodeType&&module,wf=bi&&bi.exports===br,kr=wf&&pf.process,h=function(){try{return kr&&kr.binding&&kr.binding("util")}catch(n){}}(),bf=h&&h.isArrayBuffer,kf=h&&h.isDate,df=h&&h.isMap,gf=h&&h.isRegExp,ne=h&&h.isSet,te=h&&h.isTypedArray;re=nu("length");ce=tu({"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"});le=tu({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});ve=tu({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"});fu=function fu(h){function at(n){if(kr(n)&&!wi(n)&&!(n instanceof vr)){if(n instanceof af)return n;if(pr.call(n,"__wrapped__"))return pd(n)}return new af(n)}function tv(){}function af(t,i){this.__wrapped__=t;this.__actions__=[];this.__chain__=!!i;this.__index__=0;this.__values__=n}function vr(n){this.__wrapped__=n;this.__actions__=[];this.__dir__=1;this.__filtered__=!1;this.__iteratees__=[];this.__takeCount__=b;this.__views__=[]}function yit(){var n=new vr(this.__wrapped__);return n.__actions__=uf(this.__actions__),n.__dir__=this.__dir__,n.__filtered__=this.__filtered__,n.__iteratees__=uf(this.__iteratees__),n.__takeCount__=this.__takeCount__,n.__views__=uf(this.__views__),n}function pit(){if(this.__filtered__){var n=new vr(this);n.__dir__=-1;n.__filtered__=!0}else n=this.clone(),n.__dir__*=-1;return n}function wit(){var n=this.__wrapped__.value(),f=this.__dir__,e=wi(n),o=f<0,s=e?n.length:0,h=kft(0,s,this.__views__),c=h.start,l=h.end,t=l-c,a=o?l:c-1,v=this.__iteratees__,d=v.length,y=0,p=nf(t,this.__takeCount__),r,u,i;if(!e||!o&&s==t&&p==t)return uk(n,this.__actions__);r=[];n:while(t--&&y<p){for(a+=f,u=-1,i=n[a];++u<d;){var w=v[u],g=w.iteratee,b=w.type,k=g(i);if(b==no)i=k;else if(!k)if(b==su)continue n;else break n}r[y++]=i}return r}function dc(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function bit(){this.__data__=wl?wl(null):{};this.size=0}function kit(n){var t=this.has(n)&&delete this.__data__[n];return this.size-=t?1:0,t}function dit(t){var i=this.__data__,r;return wl?(r=i[t],r===nr?n:r):pr.call(i,t)?i[t]:n}function git(t){var i=this.__data__;return wl?i[t]!==n:pr.call(i,t)}function nrt(t,i){var r=this.__data__;return this.size+=this.has(t)?0:1,r[t]=wl&&i===n?nr:i,this}function th(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function trt(){this.__data__=[];this.size=0}function irt(n){var t=this.__data__,i=iv(t,n),r;return i<0?!1:(r=t.length-1,i==r?t.pop():wa.call(t,i,1),--this.size,!0)}function rrt(t){var i=this.__data__,r=iv(i,t);return r<0?n:i[r][1]}function urt(n){return iv(this.__data__,n)>-1}function frt(n,t){var i=this.__data__,r=iv(i,n);return r<0?(++this.size,i.push([n,t])):i[r][1]=t,this}function ih(n){var i=-1,r=n==null?0:n.length,t;for(this.clear();++i<r;)t=n[i],this.set(t[0],t[1])}function ert(){this.size=0;this.__data__={hash:new dc,map:new(yl||th),string:new dc}}function ort(n){var t=wv(this,n)["delete"](n);return this.size-=t?1:0,t}function srt(n){return wv(this,n).get(n)}function hrt(n){return wv(this,n).has(n)}function crt(n,t){var i=wv(this,n),r=i.size;return i.set(n,t),this.size+=i.size==r?0:1,this}function gc(n){var t=-1,i=n==null?0:n.length;for(this.__data__=new ih;++t<i;)this.add(n[t])}function lrt(n){return this.__data__.set(n,nr),this}function art(n){return this.__data__.has(n)}function re(n){var t=this.__data__=new th(n);this.size=t.size}function vrt(){this.__data__=new th;this.size=0}function yrt(n){var t=this.__data__,i=t["delete"](n);return this.size=t.size,i}function prt(n){return this.__data__.get(n)}function wrt(n){return this.__data__.has(n)}function brt(n,t){var i=this.__data__,r;if(i instanceof th){if(r=i.__data__,!yl||r.length<gi-1)return r.push([n,t]),this.size=++i.size,this;i=this.__data__=new ih(r)}return i.set(n,t),this.size=i.size,this}function ub(n,t){var r=wi(n),u=!r&&rl(n),f=!r&&!u&&yh(n),o=!r&&!u&&!f&&ul(n),s=r||u||f||o,e=s?ru(n.length,ytt):[],h=e.length;for(var i in n)!(t||pr.call(n,i))||s&&(i=="length"||f&&(i=="offset"||i=="parent")||o&&(i=="buffer"||i=="byteLength"||i=="byteOffset")||lh(i,h))||e.push(i);return e}function fb(t){var i=t.length;return i?t[np(0,i-1)]:n}function krt(n,t){return bv(uf(n),nl(t,0,n.length))}function drt(n){return bv(uf(n))}function cy(t,i,r){(r===n||nh(t[i],r))&&(r!==n||i in t)||rh(t,i,r)}function dl(t,i,r){var u=t[i];pr.call(t,i)&&nh(u,r)&&(r!==n||i in t)||rh(t,i,r)}function iv(n,t){for(var i=n.length;i--;)if(nh(n[i][0],t))return i;return-1}function grt(n,t,i,r){return eh(n,function(n,u,f){t(r,n,i(n),f)}),r}function eb(n,t){return n&&ds(t,du(t),n)}function nut(n,t){return n&&ds(t,cf(t),n)}function rh(n,t,i){t=="__proto__"&&ba?ba(n,t,{configurable:!0,enumerable:!0,value:i,writable:!0}):n[t]=i}function ly(t,i){for(var r=-1,u=i.length,f=bu(u),e=t==null;++r<u;)f[r]=e?n:uw(t,i[r]);return f}function nl(t,i,r){return t===t&&(r!==n&&(t=t<=r?t:r),i!==n&&(t=t>=i?t:i)),t}function ss(i,r,u,f,e,o){var s,l=r&y,a=r&eu,g=r&et,v,h,p,w,k,b;if(u&&(s=e?u(i,f,e,o):u(i)),s!==n)return s;if(!br(i))return i;if(v=wi(i),v){if(s=gft(i),!l)return uf(i,s)}else{if(h=tf(i),p=h==ai||h==hu,yh(i))return sk(i,l);if(h==d||h==ct||p&&!e){if(s=a||p?{}:ed(i),!l)return a?cft(i,nut(s,i)):hft(i,eb(s,i))}else{if(!t[h])return e?i:{};s=net(i,h,ss,l)}}return(o||(o=new re),w=o.get(i),w)?w:(o.set(i,s),k=g?a?vp:ap:a?cf:du,b=v?n:k(i),c(b||i,function(n,t){b&&(t=n,n=i[t]);dl(s,t,ss(n,r,u,t,i,o))}),s)}function tut(n){var t=du(n);return function(i){return ob(i,n,t)}}function ob(t,i,r){var u=r.length;if(t==null)return!u;for(t=wr(t);u--;){var f=r[u],o=i[f],e=t[f];if(e===n&&!(f in t)||!o(e))return!1}return!0}function sb(t,i,r){if(typeof t!="function")throw new lf(o);return fa(function(){t.apply(n,r)},i)}function gl(n,t,i,u){var a=-1,h=ki,c=!0,v=n.length,s=[],y=t.length,f,o,l;if(!v)return s;i&&(t=r(t,e(i)));u?(h=dr,c=!1):t.length>=gi&&(h=fi,c=!1,t=new gc(t));n:while(++a<v)if(f=n[a],o=i==null?f:i(f),f=u||f!==0?f:0,c&&o===o){for(l=y;l--;)if(t[l]===o)continue n;s.push(f)}else h(t,o,u)||s.push(f);return s}function iut(n,t){var i=!0;return eh(n,function(n,r,u){return i=!!t(n,r,u)}),i}function rv(t,i,r){for(var o=-1,h=t.length,f,u,e,s;++o<h;)f=t[o],u=i(f),u!=null&&(e===n?u===u&&!hf(u):r(u,e))&&(e=u,s=f);return s}function rut(t,i,r,u){var f=t.length;for(r=bi(r),r<0&&(r=-r>f?0:f+r),u=u===n||u>f?f:bi(u),u<0&&(u+=f),u=r>u?0:an(u);r<u;)t[r++]=i;return t}function hb(n,t){var i=[];return eh(n,function(n,r,u){t(n,r,u)&&i.push(n)}),i}function gu(n,t,i,r,u){var e=-1,o=n.length,f;for(i||(i=iet),u||(u=[]);++e<o;)f=n[e],t>0&&i(f)?t>1?gu(f,t-1,i,r,u):it(u,f):r||(u[u.length]=f);return u}function ks(n,t){return n&&uv(n,t,du)}function yy(n,t){return n&&vy(n,t,du)}function fv(n,t){return tt(t,function(t){return gh(n[t])})}function ol(t,i){i=pc(i,t);for(var r=0,u=i.length;t!=null&&r<u;)t=t[gs(i[r++])];return r&&r==u?t:n}function cb(n,t,i){var r=t(n);return wi(n)?r:it(r,i(n))}function rf(t){return t==null?t===n?co:so:bc&&bc in wr(t)?bft(t):set(t)}function py(n,t){return n>t}function uut(n,t){return n!=null&&pr.call(n,t)}function fut(n,t){return n!=null&&t in wr(n)}function eut(n,t,i){return n>=nf(t,i)&&n<ku(t,i)}function wy(t,i,u){for(var b=u?dr:ki,k=t[0].length,a=t.length,f=a,v=bu(a),y=Infinity,l=[],o,p,c,s,h,w;f--;)o=t[f],f&&i&&(o=r(o,e(i))),y=nf(o.length,y),v[f]=!u&&(i||k>=120&&o.length>=120)?new gc(f&&o):n;o=t[0];p=-1;c=v[0];n:while(++p<k&&l.length<y)if(s=o[p],h=i?i(s):s,s=u||s!==0?s:0,!(c?fi(c,h):b(l,h,u))){for(f=a;--f;)if(w=v[f],!(w?fi(w,h):b(t[f],h,u)))continue n;c&&c.push(h);l.push(s)}return l}function out(n,t,i,r){return ks(n,function(n,u,f){t(r,i(n),u,f)}),r}function na(t,i,r){i=pc(i,t);t=ld(t,i);var u=t==null?t:t[gs(yf(i))];return u==null?n:f(u,t,r)}function lb(n){return kr(n)&&rf(n)==ct}function sut(n){return kr(n)&&rf(n)==ri}function hut(n){return kr(n)&&rf(n)==dt}function ta(n,t,i,r,u){return n===t?!0:n==null||t==null||!kr(n)&&!kr(t)?n!==n&&t!==t:cut(n,t,i,r,ta,u)}function cut(n,t,i,r,u,f){var s=wi(n),p=wi(t),e=s?ci:tf(n),o=p?ci:tf(t),l,a,v,y;e=e==ct?d:e;o=o==ct?d:o;var h=e==d,w=o==d,c=e==o;if(c&&yh(n)){if(!yh(t))return!1;s=!0;h=!1}return c&&!h?(f||(f=new re),s||ul(n)?rd(n,t,i,r,u,f):pft(n,t,e,i,r,u,f)):!(i&ot)&&(l=h&&pr.call(n,"__wrapped__"),a=w&&pr.call(t,"__wrapped__"),l||a)?(v=l?n.value():n,y=a?t.value():t,f||(f=new re),u(v,y,i,r,f)):c?(f||(f=new re),wft(n,t,i,r,u,f)):!1}function lut(n){return kr(n)&&tf(n)==l}function by(t,i,r,u){var e=r.length,l=e,a=!u,f,h,c;if(t==null)return!l;for(t=wr(t);e--;)if(f=r[e],a&&f[2]?f[1]!==t[f[0]]:!(f[0]in t))return!1;while(++e<l){f=r[e];var o=f[0],s=t[o],v=f[1];if(a&&f[2]){if(s===n&&!(o in t))return!1}else if(h=new re,u&&(c=u(s,v,o,t,i,h)),!(c===n?ta(v,s,ot|si,u,h):c))return!1}return!0}function ab(n){if(!br(n)||uet(n))return!1;var t=gh(n)?dtt:vs;return t.test(il(n))}function aut(n){return kr(n)&&rf(n)==ni}function vut(n){return kr(n)&&tf(n)==a}function yut(n){return kr(n)&&iy(n.length)&&!!i[rf(n)]}function vb(n){return typeof n=="function"?n:n==null?of:typeof n=="object"?wi(n)?wb(n[0],n[1]):pb(n):ltt(n)}function ky(n){var i,t;if(!ua(n))return fit(n);i=[];for(t in wr(n))pr.call(n,t)&&t!="constructor"&&i.push(t);return i}function put(n){var r,i,t;if(!br(n))return oet(n);r=ua(n);i=[];for(t in n)t=="constructor"&&(r||!pr.call(n,t))||i.push(t);return i}function dy(n,t){return n<t}function yb(n,t){var r=-1,i=ef(n)?bu(n.length):[];return eh(n,function(n,u,f){i[++r]=t(n,u,f)}),i}function pb(n){var t=yp(n);return t.length==1&&t[0][2]?hd(t[0][0],t[0][1]):function(i){return i===n||by(i,n,t)}}function wb(t,i){return wp(t)&&sd(i)?hd(gs(t),i):function(r){var u=uw(r,t);return u===n&&u===i?fw(r,t):ta(i,u,ot|si)}}function ev(t,i,r,u,f){t!==i&&uv(i,function(e,o){if(br(e))f||(f=new re),wut(t,i,o,r,ev,u,f);else{var s=u?u(t[o],e,o+"",t,i,f):n;s===n&&(s=e);cy(t,o,s)}},cf)}function wut(t,i,r,u,f,e,o){var c=t[r],s=i[r],y=o.get(s),h,l;if(y){cy(t,r,y);return}if(h=e?e(c,s,r+"",t,i,o):n,l=h===n,l){var a=wi(s),v=!a&&yh(s),p=!a&&!v&&ul(s);h=s;a||v||p?wi(c)?h=c:tu(c)?h=uf(c):v?(l=!1,h=sk(s,!0)):p?(l=!1,h=hk(s,!0)):h=[]:oa(s)||rl(s)?(h=c,rl(c)?h=vn(c):(!br(c)||u&&gh(c))&&(h=ed(s))):l=!1}l&&(o.set(s,h),f(h,s,u,e,o),o["delete"](s));cy(t,r,h)}function bb(t,i){var r=t.length;if(r)return i+=i<0?r:0,lh(i,r)?t[i]:n}function kb(n,t,i){var f=-1,u;return t=r(t.length?t:[of],e(pi())),u=yb(n,function(n){var i=r(t,function(t){return t(n)});return{criteria:i,index:++f,value:n}}),ic(u,function(n,t){return sft(n,t,i)})}function but(n,t){return db(n,t,function(t,i){return fw(n,i)})}function db(n,t,i){for(var f=-1,o=t.length,e={},r,u;++f<o;)r=t[f],u=ol(n,r),i(u,r)&&ia(e,pc(r,n),u);return e}function kut(n){return function(t){return ol(t,n)}}function gy(n,t,i,u){var c=u?tc:vt,s=-1,l=t.length,f=n;for(n===t&&(t=uf(t)),i&&(f=r(n,e(i)));++s<l;)for(var o=0,h=t[s],a=i?i(h):h;(o=c(f,a,o,u))>-1;)f!==n&&wa.call(f,o,1),wa.call(n,o,1);return n}function gb(n,t){for(var r=n?t.length:0,f=r-1,i,u;r--;)i=t[r],(r==f||i!==u)&&(u=i,lh(i)?wa.call(n,i,1):up(n,i));return n}function np(n,t){return n+da(ib()*(t-n+1))}function dut(n,t,i,r){for(var e=-1,u=ku(ka((t-n)/(i||1)),0),f=bu(u);u--;)f[r?u:++e]=n,n+=i;return f}function tp(n,t){var i="";if(!n||t<1||t>nt)return i;do t%2&&(i+=n),t=da(t/2),t&&(n+=n);while(t);return i}function ar(n,t){return kp(cd(n,t,of),n+"")}function gut(n){return fb(ll(n))}function nft(n,t){var i=ll(n);return bv(i,nl(t,0,i.length))}function ia(t,i,r,u){var e,o,h;if(!br(t))return t;i=pc(i,t);for(var s=-1,c=i.length,l=c-1,f=t;f!=null&&++s<c;)e=gs(i[s]),o=r,s!=l&&(h=f[e],o=u?u(h,e,f):n,o===n&&(o=br(h)?h:lh(i[s+1])?[]:{})),dl(f,e,o),f=f[e];return t}function tft(n){return bv(ll(n))}function vf(n,t,i){var u=-1,r=n.length,f;for(t<0&&(t=-t>r?0:r+t),i=i>r?r:i,i<0&&(i+=r),r=t>i?0:i-t>>>0,t>>>=0,f=bu(r);++u<r;)f[u]=n[u+t];return f}function ift(n,t){var i;return eh(n,function(n,r,u){return i=t(n,r,u),!i}),!!i}function ov(n,t,i){var f=0,r=n==null?f:n.length,e,u;if(typeof t=="number"&&t===t&&r<=uo){while(f<r)e=f+r>>>1,u=n[e],u!==null&&!hf(u)&&(i?u<=t:u<t)?f=e+1:r=e;return r}return rp(n,t,of,i)}function rp(t,i,r,u){var v;i=r(i);for(var s=0,e=t==null?0:t.length,y=i!==i,p=i===null,w=hf(i),b=i===n;s<e;){var h=da((s+e)/2),f=r(t[h]),c=f!==n,l=f===null,o=f===f,a=hf(f);v=y?u||o:b?o&&(u||c):p?o&&c&&(u||!l):w?o&&c&&!l&&(u||!a):l||a?!1:u?f<=i:f<i;v?s=h+1:e=h}return nf(e,ro)}function tk(n,t){for(var r=-1,o=n.length,s=0,f=[],i,u,e;++r<o;)i=n[r],u=t?t(i):i,r&&nh(u,e)||(e=u,f[s++]=i===0?0:i);return f}function ik(n){return typeof n=="number"?n:hf(n)?hi:+n}function sf(n){if(typeof n=="string")return n;if(wi(n))return r(n,sf)+"";if(hf(n))return rb?rb.call(n):"";var t=n+"";return t=="0"&&1/n==-ft?"-0":t}function vc(n,t,i){var l=-1,o=ki,a=n.length,s=!0,e=[],r=e,h,u,f,c;if(i)s=!1,o=dr;else if(a>=gi){if(h=t?null:nd(n),h)return pt(h);s=!1;o=fi;r=new gc}else r=t?[]:e;n:while(++l<a)if(u=n[l],f=t?t(u):u,u=i||u!==0?u:0,s&&f===f){for(c=r.length;c--;)if(r[c]===f)continue n;t&&r.push(f);e.push(u)}else o(r,f,i)||(r!==e&&r.push(f),e.push(u));return e}function up(n,t){return t=pc(t,n),n=ld(n,t),n==null||delete n[gs(yf(t))]}function rk(n,t,i,r){return ia(n,t,i(ol(n,t)),r)}function sv(n,t,i,r){for(var f=n.length,u=r?f:-1;(r?u--:++u<f)&&t(n[u],u,n););return i?vf(n,r?0:u,r?u+1:f):vf(n,r?u+1:0,r?f:u)}function uk(n,t){var i=n;return i instanceof vr&&(i=i.value()),ui(t,function(n,t){return t.func.apply(t.thisArg,it([n],t.args))},i)}function fp(n,t,i){var u=n.length,r,f,o,e;if(u<2)return u?vc(n[0]):[];for(r=-1,f=bu(u);++r<u;)for(o=n[r],e=-1;++e<u;)e!=r&&(f[r]=gl(f[r]||o,n[e],t,i));return vc(gu(f,1),t,i)}function fk(t,i,r){for(var u=-1,o=t.length,s=i.length,f={},e;++u<o;)e=u<s?i[u]:n,r(f,t[u],e);return f}function ep(n){return tu(n)?n:[]}function op(n){return typeof n=="function"?n:of}function pc(n,t){return wi(n)?n:wp(n,t)?[n]:dp(yr(n))}function wc(t,i,r){var u=t.length;return r=r===n?u:r,!i&&r>=u?t:vf(t,i,r)}function sk(n,t){if(t)return n.slice();var i=n.length,r=dw?dw(i):new n.constructor(i);return n.copy(r),r}function sp(n){var t=new n.constructor(n.byteLength);return new ya(t).set(new ya(n)),t}function rft(n,t){var i=t?sp(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.byteLength)}function uft(n,t,i){var r=t?i(ei(n),y):ei(n);return ui(r,ph,new n.constructor)}function fft(n){var t=new n.constructor(n.source,wu.exec(n));return t.lastIndex=n.lastIndex,t}function eft(n,t,i){var r=t?i(pt(n),y):pt(n);return ui(r,wh,new n.constructor)}function oft(n){return kl?wr(kl.call(n)):{}}function hk(n,t){var i=t?sp(n.buffer):n.buffer;return new n.constructor(i,n.byteOffset,n.length)}function ck(t,i){if(t!==i){var o=t!==n,s=t===null,r=t===t,u=hf(t),h=i!==n,c=i===null,f=i===i,e=hf(i);if(!c&&!e&&!u&&t>i||u&&h&&f&&!c&&!e||s&&h&&f||!o&&f||!r)return 1;if(!s&&!u&&!e&&t<i||e&&o&&r&&!s&&!u||c&&o&&r||!h&&r||!f)return-1}return 0}function sft(n,t,i){for(var r=-1,f=n.criteria,o=t.criteria,s=f.length,h=i.length,u,e;++r<s;)if(u=ck(f[r],o[r]),u)return r>=h?u:(e=i[r],u*(e=="desc"?-1:1));return n.index-t.index}function lk(n,t,i,r){for(var u=-1,o=n.length,s=i.length,f=-1,h=t.length,c=ku(o-s,0),e=bu(h+c),l=!r;++f<h;)e[f]=t[f];while(++u<s)(l||u<o)&&(e[i[u]]=n[u]);while(c--)e[f++]=n[u++];return e}function ak(n,t,i,r){for(var u=-1,s=n.length,h=-1,c=i.length,e=-1,l=t.length,a=ku(s-c,0),f=bu(a+l),v=!r,o;++u<a;)f[u]=n[u];for(o=u;++e<l;)f[o+e]=t[e];while(++h<c)(v||u<s)&&(f[o+i[h]]=n[u++]);return f}function uf(n,t){var i=-1,r=n.length;for(t||(t=bu(r));++i<r;)t[i]=n[i];return t}function ds(t,i,r,u){var h=!r,o,s,f,e;for(r||(r={}),o=-1,s=i.length;++o<s;)f=i[o],e=u?u(r[f],t[f],f,r,t):n,e===n&&(e=t[f]),h?rh(r,f,e):dl(r,f,e);return r}function hft(n,t){return ds(n,pp(n),t)}function cft(n,t){return ds(n,ud(n),t)}function hv(n,t){return function(i,r){var u=wi(i)?bh:grt,f=t?t():{};return u(i,n,pi(r,2),f)}}function sl(t){return ar(function(i,r){var e=-1,u=r.length,f=u>1?r[u-1]:n,s=u>2?r[2]:n,o;for(f=t.length>3&&typeof f=="function"?(u--,f):n,s&&ff(r[0],r[1],s)&&(f=u<3?n:f,u=1),i=wr(i);++e<u;)o=r[e],o&&t(i,o,e,f);return i})}function vk(n,t){return function(i,r){if(i==null)return i;if(!ef(i))return n(i,r);for(var f=i.length,u=t?f:-1,e=wr(i);t?u--:++u<f;)if(r(e[u],u,e)===!1)break;return i}}function yk(n){return function(t,i,r){for(var s=-1,f=wr(t),e=r(t),o=e.length,u;o--;)if(u=e[n?o:++s],i(f[u],u,f)===!1)break;return t}}function lft(n,t,i){function r(){var t=this&&this!==u&&this instanceof r?e:n;return t.apply(f?i:this,arguments)}var f=t&s,e=ra(n);return r}function pk(t){return function(i){i=yr(i);var r=yt(i)?v(i):n,u=r?r[0]:i.charAt(0),f=r?wc(r,1).join(""):i.slice(1);return u[t]()+f}}function hl(n){return function(t){return ui(ftt(ttt(t).replace(uh,"")),n,"")}}function ra(n){return function(){var t=arguments,i,r;switch(t.length){case 0:return new n;case 1:return new n(t[0]);case 2:return new n(t[0],t[1]);case 3:return new n(t[0],t[1],t[2]);case 4:return new n(t[0],t[1],t[2],t[3]);case 5:return new n(t[0],t[1],t[2],t[3],t[4]);case 6:return new n(t[0],t[1],t[2],t[3],t[4],t[5]);case 7:return new n(t[0],t[1],t[2],t[3],t[4],t[5],t[6])}return i=kc(n.prototype),r=n.apply(i,t),br(r)?r:i}}function aft(t,i,r){function e(){for(var s=arguments.length,h=bu(s),c=s,l=cl(e),a,v;c--;)h[c]=arguments[c];return(a=s<3&&h[0]!==l&&h[s-1]!==l?[]:rt(h,l),s-=a.length,s<r)?gk(t,i,cv,e.placeholder,n,h,a,n,n,r-s):(v=this&&this!==u&&this instanceof e?o:t,f(v,this,h))}var o=ra(t);return e}function wk(t){return function(i,r,u){var e=wr(i),o,f;return ef(i)||(o=pi(r,3),i=du(i),r=function(n){return o(e[n],n,e)}),f=t(i,r,u),f>-1?e[o?i[f]:f]:n}}function bk(t){return sh(function(i){var s=i.length,e=s,c=af.prototype.thru,u,r,h,f;for(t&&i.reverse();e--;){if(u=i[e],typeof u!="function")throw new lf(o);c&&!r&&pv(u)=="wrapper"&&(r=new af([],!0))}for(e=r?e:s;++e<s;)u=i[e],h=pv(u),f=h=="wrapper"?yv(u):n,r=f&&bp(f[0])&&f[1]==(k|p|w|bt)&&!f[4].length&&f[9]==1?r[pv(f[0])].apply(r,f[3]):u.length==1&&bp(u)?r[h]():r.thru(u);return function(){var u=arguments,f=u[0],n,t;if(r&&u.length==1&&wi(f))return r.plant(f).value();for(n=0,t=s?i[n].apply(this,u):f;++n<s;)t=i[n].call(this,t);return t}})}function cv(t,i,r,f,e,o,h,c,l,a){function y(){for(var s=arguments.length,n=bu(s),k=s,tt,ut,ft,it,p;k--;)n[k]=arguments[k];return(v&&(tt=cl(y),ut=uc(n,tt)),f&&(n=lk(n,f,e,v)),o&&(n=ak(n,o,h,v)),s-=ut,v&&s<a)?(ft=rt(n,tt),gk(t,i,cv,y.placeholder,r,n,ft,c,l,a-s)):(it=d?r:this,p=w?it[t]:t,s=n.length,c?n=het(n,c):g&&s>1&&n.reverse(),b&&l<s&&(n.length=l),this&&this!==u&&this instanceof y&&(p=nt||ra(p)),p.apply(it,n))}var b=i&k,d=i&s,w=i&ut,v=i&(p|st),g=i&tr,nt=w?n:ra(t);return y}function kk(n,t){return function(i,r){return out(i,n,t(r),{})}}function lv(t,i){return function(r,u){var f;if(r===n&&u===n)return i;if(r!==n&&(f=r),u!==n){if(f===n)return u;typeof r=="string"||typeof u=="string"?(r=sf(r),u=sf(u)):(r=ik(r),u=ik(u));f=t(r,u)}return f}}function hp(n){return sh(function(t){return t=r(t,e(pi())),ar(function(i){var r=this;return n(t,function(n){return f(n,r,i)})})})}function av(t,i){var r,u;return(i=i===n?" ":sf(i),r=i.length,r<2)?r?tp(i,t):i:(u=tp(i,ka(t/wt(i))),yt(i)?wc(v(u),0,t).join(""):u.slice(0,t))}function vft(n,t,i,r){function e(){for(var a=-1,c=arguments.length,t=-1,l=r.length,s=bu(l+c),v=this&&this!==u&&this instanceof e?h:n;++t<l;)s[t]=r[t];while(c--)s[t++]=arguments[++a];return f(v,o?i:this,s)}var o=t&s,h=ra(n);return e}function dk(t){return function(i,r,u){return u&&typeof u!="number"&&ff(i,r,u)&&(r=u=n),i=cc(i),r===n?(r=i,i=0):r=cc(r),u=u===n?i<r?1:-1:cc(u),dut(i,r,u,t)}}function vv(n){return function(t,i){return typeof t=="string"&&typeof i=="string"||(t=pf(t),i=pf(i)),n(t,i)}}function gk(t,i,r,u,f,e,o,h,c,l){var a=i&p,b=a?o:n,k=a?n:o,d=a?e:n,g=a?n:e,y,v;return i|=a?w:ht,i&=~(a?ht:w),i&ou||(i&=~(s|ut)),y=[t,i,f,d,b,g,k,h,c,l],v=r.apply(n,y),bp(t)&&ad(v,y),v.placeholder=u,vd(v,t,i)}function cp(n){var t=fl[n];return function(n,i){if(n=pf(n),i=i==null?0:nf(bi(i),292),i){var r=(yr(n)+"e").split("e"),u=t(r[0]+"e"+(+r[1]+i));return r=(yr(u)+"e").split("e"),+(r[0]+"e"+(+r[1]-i))}return t(n)}}function td(n){return function(t){var i=tf(t);return i==l?ei(t):i==a?hc(t):rc(t,n(t))}}function oh(t,i,r,u,f,e,h,c){var y=i&ut,a,b,k,v,l,d,g;if(!y&&typeof t!="function")throw new lf(o);return a=u?u.length:0,a||(i&=~(w|ht),u=f=n),h=h===n?h:ku(bi(h),0),c=c===n?c:bi(c),a-=f?f.length:0,i&ht&&(b=u,k=f,u=f=n),v=y?n:yv(t),l=[t,i,r,u,f,b,k,e,h,c],v&&eet(l,v),t=l[0],i=l[1],r=l[2],u=l[3],f=l[4],c=l[9]=l[9]===n?y?0:t.length:ku(l[9]-a,0),!c&&i&(p|st)&&(i&=~(p|st)),d=i&&i!=s?i==p||i==st?aft(t,i,c):i!=w&&i!=(s|w)||f.length?cv.apply(n,l):vft(t,i,r,u):lft(t,i,r),g=v?ip:ad,vd(g(d,l),t,i)}function lp(t,i,r,u){return t===n||nh(t,al[r])&&!pr.call(u,r)?i:t}function id(t,i,r,u,f,e){return br(t)&&br(i)&&(e.set(i,t),ev(t,i,n,id,e),e["delete"](i)),t}function yft(t){return oa(t)?n:t}function rd(t,i,r,u,f,e){var p=r&ot,l=t.length,w=i.length,a,o,h,y;if(l!=w&&!(p&&w>l))return!1;if(a=e.get(t),a&&e.get(i))return a==i;var s=-1,c=!0,v=r&si?new gc:n;for(e.set(t,i),e.set(i,t);++s<l;){if(o=t[s],h=i[s],u&&(y=p?u(h,o,s,i,t,e):u(o,h,s,t,i,e)),y!==n){if(y)continue;c=!1;break}if(v){if(!gr(i,function(n,t){if(!fi(v,t)&&(o===n||f(o,n,r,u,e)))return v.push(t)})){c=!1;break}}else if(!(o===h||f(o,h,r,u,e))){c=!1;break}}return e["delete"](t),e["delete"](i),c}function pft(n,t,i,r,u,f,e){var o,h,s,c;switch(i){case lt:if(n.byteLength!=t.byteLength||n.byteOffset!=t.byteOffset)return!1;n=n.buffer;t=t.buffer;case ri:return n.byteLength!=t.byteLength||!f(new ya(n),new ya(t))?!1:!0;case kt:case dt:case gt:return nh(+n,+t);case li:return n.name==t.name&&n.message==t.message;case ni:case ti:return n==t+"";case l:o=ei;case a:return(h=r&ot,o||(o=pt),n.size!=t.size&&!h)?!1:(s=e.get(n),s)?s==t:(r|=si,e.set(n,t),c=rd(o(n),o(t),r,u,f,e),e["delete"](n),c);case vi:if(kl)return kl.call(n)==kl.call(t)}return!1}function wft(t,i,r,u,f,e){var y=r&ot,w=ap(t),b=w.length,g=ap(i),nt=g.length,s,o,k,h,p,c,l,d,a,v;if(b!=nt&&!y)return!1;for(s=b;s--;)if(o=w[s],!(y?o in i:pr.call(i,o)))return!1;if(k=e.get(t),k&&e.get(i))return k==i;for(h=!0,e.set(t,i),e.set(i,t),p=y;++s<b;){if(o=w[s],c=t[o],l=i[o],u&&(d=y?u(l,c,o,i,t,e):u(c,l,o,t,i,e)),!(d===n?c===l||f(c,l,r,u,e):d)){h=!1;break}p||(p=o=="constructor")}return h&&!p&&(a=t.constructor,v=i.constructor,a!=v&&"constructor"in t&&"constructor"in i&&!(typeof a=="function"&&a instanceof a&&typeof v=="function"&&v instanceof v)&&(h=!1)),e["delete"](t),e["delete"](i),h}function sh(t){return kp(cd(t,n,kd),t+"")}function ap(n){return cb(n,du,pp)}function vp(n){return cb(n,cf,ud)}function pv(n){for(var t=n.name+"",u=bl[t],f=pr.call(bl,t)?u.length:0,i,r;f--;)if(i=u[f],r=i.func,r==null||r==n)return i.name;return t}function cl(n){var t=pr.call(at,"placeholder")?at:n;return t.placeholder}function pi(){var n=at.iteratee||cw;return n=n===cw?vb:n,arguments.length?n(arguments[0],arguments[1]):n}function wv(n,t){var i=n.__data__;return ret(t)?i[typeof t=="string"?"string":"hash"]:i.map}function yp(n){for(var t=du(n),i=t.length,r,u;i--;)r=t[i],u=n[r],t[i]=[r,u,sd(u)];return t}function tl(t,i){var r=ec(t,i);return ab(r)?r:n}function bft(t){var u=pr.call(t,bc),f=t[bc],i,r;try{t[bc]=n;i=!0}catch(e){}return r=kw.call(t),i&&(u?t[bc]=f:delete t[bc]),r}function kft(n,t,i){for(var f=-1,e=i.length,u,r;++f<e;){u=i[f];r=u.size;switch(u.type){case"drop":n+=r;break;case"dropRight":t-=r;break;case"take":t=nf(t,n+r);break;case"takeRight":n=ku(n,t-r)}}return{start:n,end:t}}function dft(n){var t=n.match(es);return t?t[1].split(os):[]}function fd(n,t,i){var u;t=pc(t,n);for(var f=-1,r=t.length,e=!1;++f<r;){if(u=gs(t[f]),!(e=n!=null&&i(n,u)))break;n=n[u]}return e||++f!=r?e:(r=n==null?0:n.length,!!r&&iy(r)&&lh(u,r)&&(wi(n)||rl(n)))}function gft(n){var i=n.length,t=n.constructor(i);return i&&typeof n[0]=="string"&&pr.call(n,"index")&&(t.index=n.index,t.input=n.input),t}function ed(n){return typeof n.constructor=="function"&&!ua(n)?kc(pa(n)):{}}function net(n,t,i,r){var u=n.constructor;switch(t){case ri:return sp(n);case kt:case dt:return new u(+n);case lt:return rft(n,r);case ir:case rr:case ur:case fr:case er:case or:case sr:case hr:case cr:return hk(n,r);case l:return uft(n,r,i);case gt:case ti:return new u(n);case ni:return fft(n);case a:return eft(n,r,i);case vi:return oft(n)}}function tet(n,t){var i=t.length,r;return i?(r=i-1,t[r]=(i>1?"& ":"")+t[r],t=t.join(i>2?", ":" "),n.replace(fs,"{\n/* [wrapped with "+t+"] */\n")):n}function iet(n){return wi(n)||rl(n)||!!(tb&&n&&n[tb])}function lh(n,t){return t=t==null?nt:t,!!t&&(typeof n=="number"||ps.test(n))&&n>-1&&n%1==0&&n<t}function ff(n,t,i){if(!br(i))return!1;var r=typeof t;return(r=="number"?ef(i)&&lh(t,i.length):r=="string"&&t in i)?nh(i[t],n):!1}function wp(n,t){if(wi(n))return!1;var i=typeof n;return i=="number"||i=="symbol"||i=="boolean"||n==null||hf(n)?!0:ns.test(n)||!go.test(n)||t!=null&&n in wr(t)}function ret(n){var t=typeof n;return t=="string"||t=="number"||t=="symbol"||t=="boolean"?n!=="__proto__":n===null}function bp(n){var r=pv(n),t=at[r],i;return typeof t!="function"||!(r in vr.prototype)?!1:n===t?!0:(i=yv(t),!!i&&n===i[0])}function uet(n){return!!bw&&bw in n}function ua(n){var t=n&&n.constructor,i=typeof t=="function"&&t.prototype||al;return n===i}function sd(n){return n===n&&!br(n)}function hd(t,i){return function(r){return r==null?!1:r[t]===i&&(i!==n||t in wr(r))}}function fet(n){var t=ny(n,function(n){return i.size===we&&i.clear(),n}),i=t.cache;return t}function eet(n,t){var f=n[1],u=t[1],e=f|u,o=e<(s|ut|k),h=u==k&&f==p||u==k&&f==bt&&n[7].length<=t[8]||u==(k|bt)&&t[7].length<=t[8]&&f==p,i,r;return(o||h)?(u&s&&(n[2]=t[2],e|=f&s?0:ou),i=t[3],i&&(r=n[3],n[3]=r?lk(r,i,t[4]):i,n[4]=r?rt(n[3],oi):t[4]),i=t[5],i&&(r=n[5],n[5]=r?ak(r,i,t[6]):i,n[6]=r?rt(n[5],oi):t[6]),i=t[7],i&&(n[7]=i),u&k&&(n[8]=n[8]==null?t[8]:nf(n[8],t[8])),n[9]==null&&(n[9]=t[9]),n[0]=t[0],n[1]=e,n):n}function oet(n){var t=[],i;if(n!=null)for(i in wr(n))t.push(i);return t}function set(n){return kw.call(n)}function cd(t,i,r){return i=ku(i===n?t.length-1:i,0),function(){for(var e=arguments,n=-1,o=ku(e.length-i,0),s=bu(o),u;++n<o;)s[n]=e[i+n];for(n=-1,u=bu(i+1);++n<i;)u[n]=e[n];return u[i]=r(s),f(t,this,u)}}function ld(n,t){return t.length<2?n:ol(n,vf(t,0,-1))}function het(t,i){for(var f=t.length,r=nf(i.length,f),e=uf(t),u;r--;)u=i[r],t[r]=lh(u,f)?e[u]:n;return t}function vd(n,t,i){var r=t+"";return kp(n,tet(r,cet(dft(r),i)))}function yd(t){var i=0,r=0;return function(){var u=eit(),f=ge-(u-r);if(r=u,f>0){if(++i>=de)return arguments[0]}else i=0;return t.apply(n,arguments)}}function bv(t,i){var r=-1,f=t.length,o=f-1,u,e;for(i=i===n?f:i;++r<i;)u=np(r,o),e=t[u],t[u]=t[r],t[r]=e;return t.length=i,t}function gs(n){if(typeof n=="string"||hf(n))return n;var t=n+"";return t=="0"&&1/n==-ft?"-0":t}function il(n){if(n!=null){try{return aa.call(n)}catch(t){}try{return n+""}catch(t){}}return""}function cet(n,t){return c(fo,function(i){var r="_."+i[0];t&i[1]&&!ki(n,r)&&n.push(r)}),n.sort()}function pd(n){if(n instanceof vr)return n.clone();var t=new af(n.__wrapped__,n.__chain__);return t.__actions__=uf(n.__actions__),t.__index__=n.__index__,t.__values__=n.__values__,t}function aet(t,i,r){var u;if(i=(r?ff(t,i,r):i===n)?1:ku(bi(i),0),u=t==null?0:t.length,!u||i<1)return[];for(var f=0,o=0,e=bu(ka(u/i));f<u;)e[o++]=vf(t,f,f+=i);return e}function vet(n){for(var i=-1,u=n==null?0:n.length,f=0,r=[],t;++i<u;)t=n[i],t&&(r[f++]=t);return r}function yet(){var n=arguments.length;if(!n)return[];for(var r=bu(n-1),t=arguments[0],i=n;i--;)r[i-1]=arguments[i];return it(wi(t)?uf(t):[t],gu(r,1))}function ket(t,i,r){var u=t==null?0:t.length;return u?(i=r||i===n?1:bi(i),vf(t,i<0?0:i,u)):[]}function det(t,i,r){var u=t==null?0:t.length;return u?(i=r||i===n?1:bi(i),i=u-i,vf(t,0,i<0?0:i)):[]}function get(n,t){return n&&n.length?sv(n,pi(t,3),!0,!0):[]}function not(n,t){return n&&n.length?sv(n,pi(t,3),!0):[]}function tot(n,t,i,r){var u=n==null?0:n.length;return u?(i&&typeof i!="number"&&ff(n,t,i)&&(i=0,r=u),rut(n,t,i,r)):[]}function wd(n,t,i){var u=n==null?0:n.length,r;return u?(r=i==null?0:bi(i),r<0&&(r=ku(u+r,0)),di(n,pi(t,3),r)):-1}function bd(t,i,r){var f=t==null?0:t.length,u;return f?(u=f-1,r!==n&&(u=bi(r),u=r<0?ku(f+u,0):nf(u,f-1)),di(t,pi(i,3),u,!0)):-1}function kd(n){var t=n==null?0:n.length;return t?gu(n,1):[]}function iot(n){var t=n==null?0:n.length;return t?gu(n,ft):[]}function rot(t,i){var r=t==null?0:t.length;return r?(i=i===n?1:bi(i),gu(t,i)):[]}function uot(n){for(var i=-1,u=n==null?0:n.length,r={},t;++i<u;)t=n[i],r[t[0]]=t[1];return r}function dd(t){return t&&t.length?t[0]:n}function fot(n,t,i){var u=n==null?0:n.length,r;return u?(r=i==null?0:bi(i),r<0&&(r=ku(u+r,0)),vt(n,t,r)):-1}function eot(n){var t=n==null?0:n.length;return t?vf(n,0,-1):[]}function cot(n,t){return n==null?"":uit.call(n,t)}function yf(t){var i=t==null?0:t.length;return i?t[i-1]:n}function lot(t,i,r){var f=t==null?0:t.length,u;return f?(u=f,r!==n&&(u=bi(r),u=u<0?ku(f+u,0):nf(u,f-1)),i===i?lc(t,i,u):di(t,fe,u,!0)):-1}function aot(t,i){return t&&t.length?bb(t,bi(i)):n}function ng(n,t){return n&&n.length&&t&&t.length?gy(n,t):n}function vot(n,t,i){return n&&n.length&&t&&t.length?gy(n,t,pi(i,2)):n}function yot(t,i,r){return t&&t.length&&i&&i.length?gy(t,i,n,r):t}function pot(n,t){var r=[],u;if(!(n&&n.length))return r;var i=-1,f=[],e=n.length;for(t=pi(t,3);++i<e;)u=n[i],t(u,i,n)&&(r.push(u),f.push(i));return gb(n,f),r}function gp(n){return n==null?n:sit.call(n)}function wot(t,i,r){var u=t==null?0:t.length;return u?(r&&typeof r!="number"&&ff(t,i,r)?(i=0,r=u):(i=i==null?0:bi(i),r=r===n?u:bi(r)),vf(t,i,r)):[]}function bot(n,t){return ov(n,t)}function kot(n,t,i){return rp(n,t,pi(i,2))}function dot(n,t){var r=n==null?0:n.length,i;return r&&(i=ov(n,t),i<r&&nh(n[i],t))?i:-1}function got(n,t){return ov(n,t,!0)}function nst(n,t,i){return rp(n,t,pi(i,2),!0)}function tst(n,t){var r=n==null?0:n.length,i;return r&&(i=ov(n,t,!0)-1,nh(n[i],t))?i:-1}function ist(n){return n&&n.length?tk(n):[]}function rst(n,t){return n&&n.length?tk(n,pi(t,2)):[]}function ust(n){var t=n==null?0:n.length;return t?vf(n,1,t):[]}function fst(t,i,r){return(t&&t.length)?(i=r||i===n?1:bi(i),vf(t,0,i<0?0:i)):[]}function est(t,i,r){var u=t==null?0:t.length;return u?(i=r||i===n?1:bi(i),i=u-i,vf(t,i<0?0:i,u)):[]}function ost(n,t){return n&&n.length?sv(n,pi(t,3),!1,!0):[]}function sst(n,t){return n&&n.length?sv(n,pi(t,3)):[]}function ast(n){return n&&n.length?vc(n):[]}function vst(n,t){return n&&n.length?vc(n,pi(t,2)):[]}function yst(t,i){return i=typeof i=="function"?i:n,t&&t.length?vc(t,n,i):[]}function nw(n){if(!(n&&n.length))return[];var t=0;return n=tt(n,function(n){if(tu(n))return t=ku(n.length,t),!0}),ru(t,function(t){return r(n,nu(t))})}function ig(t,i){if(!(t&&t.length))return[];var u=nw(t);return i==null?u:r(u,function(t){return f(i,n,t)})}function gst(n,t){return fk(n||[],t||[],dl)}function nht(n,t){return fk(n||[],t||[],ia)}function ug(n){var t=at(n);return t.__chain__=!0,t}function tht(n,t){return t(n),n}function kv(n,t){return t(n)}function iht(){return ug(this)}function rht(){return new af(this.value(),this.__chain__)}function uht(){this.__values__===n&&(this.__values__=ln(this.value()));var t=this.__index__>=this.__values__.length,i=t?n:this.__values__[this.__index__++];return{done:t,value:i}}function fht(){return this}function eht(t){for(var u,r=this,i,f;r instanceof tv;)i=pd(r),i.__index__=0,i.__values__=n,u?f.__wrapped__=i:u=i,f=i,r=r.__wrapped__;return f.__wrapped__=t,u}function oht(){var i=this.__wrapped__,t;return i instanceof vr?(t=i,this.__actions__.length&&(t=new vr(this)),t=t.reverse(),t.__actions__.push({func:kv,args:[gp],thisArg:n}),new af(t,this.__chain__)):this.thru(gp)}function sht(){return uk(this.__wrapped__,this.__actions__)}function hht(t,i,r){var u=wi(t)?ie:iut;return r&&ff(t,i,r)&&(i=n),u(t,pi(i,3))}function cht(n,t){var i=wi(n)?tt:hb;return i(n,pi(t,3))}function lht(n,t){return gu(dv(n,t),1)}function aht(n,t){return gu(dv(n,t),ft)}function vht(t,i,r){return r=r===n?1:bi(r),gu(dv(t,i),r)}function hg(n,t){var i=wi(n)?c:eh;return i(n,pi(t,3))}function cg(n,t){var i=wi(n)?kh:ay;return i(n,pi(t,3))}function yht(n,t,i,r){n=ef(n)?n:ll(n);i=i&&!r?bi(i):0;var u=n.length;return i<0&&(i=ku(u+i,0)),uy(n)?i<=u&&n.indexOf(t,i)>-1:!!u&&vt(n,t,i)>-1}function dv(n,t){var i=wi(n)?r:yb;return i(n,pi(t,3))}function pht(t,i,r,u){return t==null?[]:(wi(i)||(i=i==null?[]:[i]),r=u?n:r,wi(r)||(r=r==null?[]:[r]),kb(t,i,r))}function wht(n,t,i){var r=wi(n)?ui:oe,u=arguments.length<3;return r(n,pi(t,4),i,u,eh)}function bht(n,t,i){var r=wi(n)?dh:oe,u=arguments.length<3;return r(n,pi(t,4),i,u,ay)}function kht(n,t){var i=wi(n)?tt:hb;return i(n,ty(pi(t,3)))}function dht(n){var t=wi(n)?fb:gut;return t(n)}function ght(t,i,r){i=(r?ff(t,i,r):i===n)?1:bi(i);var u=wi(t)?krt:nft;return u(t,i)}function nct(n){var t=wi(n)?drt:tft;return t(n)}function tct(n){if(n==null)return 0;if(ef(n))return uy(n)?wt(n):n.length;var t=tf(n);return t==l||t==a?n.size:ky(n).length}function ict(t,i,r){var u=wi(t)?gr:ift;return r&&ff(t,i,r)&&(i=n),u(t,pi(i,3))}function rct(n,t){if(typeof t!="function")throw new lf(o);return n=bi(n),function(){if(--n<1)return t.apply(this,arguments)}}function wg(t,i,r){return i=r?n:i,i=t&&i==null?t.length:i,oh(t,k,n,n,n,n,i)}function bg(t,i){var r;if(typeof i!="function")throw new lf(o);return t=bi(t),function(){return--t>0&&(r=i.apply(this,arguments)),t<=1&&(i=n),r}}function kg(t,i,r){i=r?n:i;var u=oh(t,p,n,n,n,n,n,i);return u.placeholder=kg.placeholder,u}function dg(t,i,r){i=r?n:i;var u=oh(t,st,n,n,n,n,n,i);return u.placeholder=dg.placeholder,u}function gg(t,i,r){function p(i){var r=e,u=h;return e=h=n,c=i,s=t.apply(u,r)}function g(n){return c=n,u=fa(v,i),b?p(n):s}function nt(n){var r=n-f,u=n-c,t=i-r;return l?nf(t,a-u):t}function k(t){var r=t-f,u=t-c;return f===n||r>=i||r<0||l&&u>=a}function v(){var n=ea();if(k(n))return d(n);u=fa(v,nt(n))}function d(t){return(u=n,y&&e)?p(t):(e=h=n,s)}function tt(){u!==n&&ok(u);c=0;e=f=h=u=n}function it(){return u===n?s:d(ea())}function w(){var t=ea(),r=k(t);if(e=arguments,h=this,f=t,r){if(u===n)return g(f);if(l)return u=fa(v,i),p(f)}return u===n&&(u=fa(v,i)),s}var e,h,a,s,u,f,c=0,b=!1,l=!1,y=!0;if(typeof t!="function")throw new lf(o);return i=pf(i)||0,br(r)&&(b=!!r.leading,l="maxWait"in r,a=l?ku(pf(r.maxWait)||0,i):a,y="trailing"in r?!!r.trailing:y),w.cancel=tt,w.flush=it,w}function uct(n){return oh(n,tr)}function ny(n,t){if(typeof n!="function"||t!=null&&typeof t!="function")throw new lf(o);var i=function(){var u=arguments,f=t?t.apply(this,u):u[0],r=i.cache,e;return r.has(f)?r.get(f):(e=n.apply(this,u),i.cache=r.set(f,e)||r,e)};return i.cache=new(ny.Cache||ih),i}function ty(n){if(typeof n!="function")throw new lf(o);return function(){var t=arguments;switch(t.length){case 0:return!n.call(this);case 1:return!n.call(this,t[0]);case 2:return!n.call(this,t[0],t[1]);case 3:return!n.call(this,t[0],t[1],t[2])}return!n.apply(this,t)}}function fct(n){return bg(2,n)}function sct(t,i){if(typeof t!="function")throw new lf(o);return i=i===n?i:bi(i),ar(t,i)}function hct(n,t){if(typeof n!="function")throw new lf(o);return t=t==null?0:ku(bi(t),0),ar(function(i){var r=i[t],u=wc(i,0,t);return r&&it(u,r),f(n,this,u)})}function cct(n,t,i){var r=!0,u=!0;if(typeof n!="function")throw new lf(o);return br(i)&&(r="leading"in i?!!i.leading:r,u="trailing"in i?!!i.trailing:u),gg(n,t,{leading:r,maxWait:t,trailing:u})}function lct(n){return wg(n,1)}function act(n,t){return iw(op(t),n)}function vct(){if(!arguments.length)return[];var n=arguments[0];return wi(n)?n:[n]}function yct(n){return ss(n,et)}function pct(t,i){return i=typeof i=="function"?i:n,ss(t,et,i)}function wct(n){return ss(n,y|et)}function bct(t,i){return i=typeof i=="function"?i:n,ss(t,y|et,i)}function kct(n,t){return t==null||ob(n,t,du(t))}function nh(n,t){return n===t||n!==n&&t!==t}function ef(n){return n!=null&&iy(n.length)&&!gh(n)}function tu(n){return kr(n)&&ef(n)}function tlt(n){return n===!0||n===!1||kr(n)&&rf(n)==kt}function ilt(n){return kr(n)&&n.nodeType===1&&!oa(n)}function rlt(n){var t,i;if(n==null)return!0;if(ef(n)&&(wi(n)||typeof n=="string"||typeof n.splice=="function"||yh(n)||ul(n)||rl(n)))return!n.length;if(t=tf(n),t==l||t==a)return!n.size;if(ua(n))return!ky(n).length;for(i in n)if(pr.call(n,i))return!1;return!0}function ult(n,t){return ta(n,t)}function flt(t,i,r){r=typeof r=="function"?r:n;var u=r?r(t,i):n;return u===n?ta(t,i,n,r):!!u}function rw(n){if(!kr(n))return!1;var t=rf(n);return t==li||t==oo||typeof n.message=="string"&&typeof n.name=="string"&&!oa(n)}function elt(n){return typeof n=="number"&&rit(n)}function gh(n){if(!br(n))return!1;var t=rf(n);return t==ai||t==hu||t==eo||t==ho}function fn(n){return typeof n=="number"&&n==bi(n)}function iy(n){return typeof n=="number"&&n>-1&&n%1==0&&n<=nt}function br(n){var t=typeof n;return n!=null&&(t=="object"||t=="function")}function kr(n){return n!=null&&typeof n=="object"}function olt(n,t){return n===t||by(n,t,yp(t))}function slt(t,i,r){return r=typeof r=="function"?r:n,by(t,i,yp(i),r)}function hlt(n){return on(n)&&n!=+n}function clt(n){if(od(n))throw new pw(pe);return ab(n)}function llt(n){return n===null}function alt(n){return n==null}function on(n){return typeof n=="number"||kr(n)&&rf(n)==gt}function oa(n){var i,t;return!kr(n)||rf(n)!=d?!1:(i=pa(n),i===null)?!0:(t=pr.call(i,"constructor")&&i.constructor,typeof t=="function"&&t instanceof t&&aa.call(t)==btt)}function vlt(n){return fn(n)&&n>=-nt&&n<=nt}function uy(n){return typeof n=="string"||!wi(n)&&kr(n)&&rf(n)==ti}function hf(n){return typeof n=="symbol"||kr(n)&&rf(n)==vi}function ylt(t){return t===n}function plt(n){return kr(n)&&tf(n)==ii}function wlt(n){return kr(n)&&rf(n)==lo}function ln(n){if(!n)return[];if(ef(n))return uy(n)?v(n):uf(n);if(vl&&n[vl])return sc(n[vl]());var t=tf(n),i=t==l?ei:t==a?pt:ll;return i(n)}function cc(n){if(!n)return n===0?n:0;if(n=pf(n),n===ft||n===-ft){var t=n<0?-1:1;return t*io}return n===n?n:0}function bi(n){var t=cc(n),i=t%1;return t===t?i?t-i:t:0}function an(n){return n?nl(bi(n),0,b):0}function pf(n){var t,i;return typeof n=="number"?n:hf(n)?hi:(br(n)&&(t=typeof n.valueOf=="function"?n.valueOf():n,n=br(t)?t+"":t),typeof n!="string")?n===0?n:+n:(n=n.replace(yu,""),i=as.test(n),i||ys.test(n)?vh(n.slice(2),i?2:8):ls.test(n)?hi:+n)}function vn(n){return ds(n,cf(n))}function blt(n){return n?nl(bi(n),-nt,nt):n===0?n:0}function yr(n){return n==null?"":sf(n)}function nat(n,t){var i=kc(n);return t==null?i:eb(i,t)}function tat(n,t){return ue(n,pi(t,3),ks)}function iat(n,t){return ue(n,pi(t,3),yy)}function rat(n,t){return n==null?n:uv(n,pi(t,3),cf)}function uat(n,t){return n==null?n:vy(n,pi(t,3),cf)}function fat(n,t){return n&&ks(n,pi(t,3))}function eat(n,t){return n&&yy(n,pi(t,3))}function oat(n){return n==null?[]:fv(n,du(n))}function sat(n){return n==null?[]:fv(n,cf(n))}function uw(t,i,r){var u=t==null?n:ol(t,i);return u===n?r:u}function hat(n,t){return n!=null&&fd(n,t,uut)}function fw(n,t){return n!=null&&fd(n,t,fut)}function du(n){return ef(n)?ub(n):ky(n)}function cf(n){return ef(n)?ub(n,!0):put(n)}function vat(n,t){var i={};return t=pi(t,3),ks(n,function(n,r,u){rh(i,t(n,r,u),n)}),i}function yat(n,t){var i={};return t=pi(t,3),ks(n,function(n,r,u){rh(i,r,t(n,r,u))}),i}function bat(n,t){return dn(n,ty(pi(t)))}function dn(n,t){if(n==null)return{};var i=r(vp(n),function(n){return[n]});return t=pi(t),db(n,i,function(n,i){return t(n,i[0])})}function kat(t,i,r){var e,f,u;for(i=pc(i,t),e=-1,f=i.length,f||(f=1,t=n);++e<f;)u=t==null?n:t[gs(i[e])],u===n&&(e=f,u=r),t=gh(u)?u.call(t):u;return t}function dat(n,t,i){return n==null?n:ia(n,t,i)}function gat(t,i,r,u){return u=typeof u=="function"?u:n,t==null?t:ia(t,i,r,u)}function nvt(n,t,i){var u=wi(n),f=u||yh(n)||ul(n),r;return t=pi(t,4),i==null&&(r=n&&n.constructor,i=f?u?new r:[]:br(n)?gh(r)?kc(pa(n)):{}:{}),(f?c:ks)(n,function(n,r,u){return t(i,n,r,u)}),i}function tvt(n,t){return n==null?!0:up(n,t)}function ivt(n,t,i){return n==null?n:rk(n,t,op(i))}function rvt(t,i,r,u){return u=typeof u=="function"?u:n,t==null?t:rk(t,i,op(r),u)}function ll(n){return n==null?[]:uu(n,du(n))}function uvt(n){return n==null?[]:uu(n,cf(n))}function fvt(t,i,r){return r===n&&(r=i,i=n),r!==n&&(r=pf(r),r=r===r?r:0),i!==n&&(i=pf(i),i=i===i?i:0),nl(pf(t),i,r)}function evt(t,i,r){return i=cc(i),r===n?(r=i,i=0):r=cc(r),t=pf(t),eut(t,i,r)}function ovt(t,i,r){var f,u;return(r&&typeof r!="boolean"&&ff(t,i,r)&&(i=r=n),r===n&&(typeof i=="boolean"?(r=i,i=n):typeof t=="boolean"&&(r=t,t=n)),t===n&&i===n?(t=0,i=1):(t=cc(t),i===n?(i=t,t=0):i=cc(i)),t>i&&(f=t,t=i,i=f),r||t%1||i%1)?(u=ib(),nf(t+u*(i-t+ah("1e-"+((u+"").length-1))),i)):np(t,i)}function ntt(n){return fy(yr(n).toLowerCase())}function ttt(n){return n=yr(n),n&&n.replace(ws,ce).replace(fh,"")}function svt(t,i,r){var u,f;return t=yr(t),i=sf(i),u=t.length,r=r===n?u:nl(bi(r),0,u),f=r,r-=i.length,r>=0&&t.slice(r,f)==i}function hvt(n){return n=yr(n),n&&wo.test(n)?n.replace(au,le):n}function cvt(n){return n=yr(n),n&&rs.test(n)?n.replace(lr,"\\$&"):n}function yvt(n,t,i){var r,u;return(n=yr(n),t=bi(t),r=t?wt(n):0,!t||r>=t)?n:(u=(t-r)/2,av(da(u),i)+n+av(ka(u),i))}function pvt(n,t,i){n=yr(n);t=bi(t);var r=t?wt(n):0;return t&&r<t?n+av(t-r,i):n}function wvt(n,t,i){n=yr(n);t=bi(t);var r=t?wt(n):0;return t&&r<t?av(t-r,i)+n:n}function bvt(n,t,i){return i||t==null?t=0:t&&(t=+t),oit(yr(n).replace(pu,""),t||0)}function kvt(t,i,r){return i=(r?ff(t,i,r):i===n)?1:bi(i),tp(yr(t),i)}function dvt(){var n=arguments,t=yr(n[0]);return n.length<3?t:t.replace(n[1],n[2])}function gvt(t,i,r){return(r&&typeof r!="number"&&ff(t,i,r)&&(i=r=n),r=r===n?b:r>>>0,!r)?[]:(t=yr(t),t&&(typeof i=="string"||i!=null&&!ry(i))&&(i=sf(i),!i&&yt(t)))?wc(v(t),0,r):t.split(i,r)}function nyt(n,t,i){return n=yr(n),i=i==null?0:nl(bi(i),0,n.length),t=sf(t),n.slice(i,i+t.length)==t}function tyt(t,i,r){var s=at.templateSettings,e,f;r&&ff(t,i,r)&&(i=n);t=yr(t);i=sa({},i,s,lp);var h=sa({},i.imports,s.imports,lp),c=du(h),y=uu(h,c),l,o,a=0,v=i.interpolate||yi,u="__p += '",p=ey((i.escape||yi).source+"|"+v.source+"|"+(v===vu?cs:yi).source+"|"+(i.evaluate||yi).source+"|$","g"),w="//# sourceURL="+("sourceURL"in i?i.sourceURL:"lodash.templateSources["+ ++ch+"]")+"\n";if(t.replace(p,function(n,i,r,f,e,s){return r||(r=f),u+=t.slice(a,s).replace(bs,fc),i&&(l=!0,u+="' +\n__e("+i+") +\n'"),e&&(o=!0,u+="';\n"+e+";\n__p += '"),r&&(u+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),a=s+n.length,n}),u+="';\n",e=i.variable,e||(u="with (obj) {\n"+u+"\n}\n"),u=(o?u.replace(ao,""):u).replace(vo,"$1").replace(yo,"$1;"),u="function("+(e||"obj")+") {\n"+(e?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(l?", __e = _.escape":"")+(o?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+u+"return __p\n}",f=sw(function(){return ww(c,w+"return "+u).apply(n,y)}),f.source=u,rw(f))throw f;return f}function iyt(n){return yr(n).toLowerCase()}function ryt(n){return yr(n).toUpperCase()}function uyt(t,i,r){if(t=yr(t),t&&(r||i===n))return t.replace(yu,"");if(!t||!(i=sf(i)))return t;var u=v(t),f=v(i),e=se(u,f),o=he(u,f)+1;return wc(u,e,o).join("")}function fyt(t,i,r){if(t=yr(t),t&&(r||i===n))return t.replace(us,"");if(!t||!(i=sf(i)))return t;var u=v(t),f=he(u,v(i))+1;return wc(u,0,f).join("")}function eyt(t,i,r){if(t=yr(t),t&&(r||i===n))return t.replace(pu,"");if(!t||!(i=sf(i)))return t;var u=v(t),f=se(u,v(i));return wc(u,f).join("")}function oyt(t,i){var s=be,e=ke,r,h,o,u,f,a,y,c,l;if(br(i)&&(r="separator"in i?i.separator:r,s="length"in i?bi(i.length):s,e="omission"in i?sf(i.omission):e),t=yr(t),h=t.length,yt(t)&&(o=v(t),h=o.length),s>=h)return t;if(u=s-wt(e),u<1)return e;if(f=o?wc(o,0,u).join(""):t.slice(0,u),r===n)return f+e;if(o&&(u+=f.length-u),ry(r)){if(t.slice(u).search(r)){for(y=f,r.global||(r=ey(r.source,yr(wu.exec(r))+"g")),r.lastIndex=0;a=r.exec(y);)c=a.index;f=f.slice(0,c===n?u:c)}}else t.indexOf(sf(r),u)!=u&&(l=f.lastIndexOf(r),l>-1&&(f=f.slice(0,l)));return f+e}function syt(n){return n=yr(n),n&&po.test(n)?n.replace(lu,ve):n}function ftt(t,i,r){return(t=yr(t),i=r?n:i,i===n)?oc(t)?yc(t):nc(t):t.match(i)||[]}function hyt(n){var t=n==null?0:n.length,i=pi();return n=t?r(n,function(n){if(typeof n[1]!="function")throw new lf(o);return[i(n[0]),n[1]]}):[],ar(function(i){for(var u=-1,r;++u<t;)if(r=n[u],f(r[0],this,i))return f(r[1],this,i)})}function cyt(n){return tut(ss(n,y))}function hw(n){return function(){return n}}function lyt(n,t){return n==null||n!==n?t:n}function of(n){return n}function cw(n){return vb(typeof n=="function"?n:ss(n,y))}function ayt(n){return pb(ss(n,y))}function vyt(n,t){return wb(n,ss(t,y))}function lw(n,t,i){var u=du(t),r=fv(t,u),f,e;return i!=null||br(t)&&(r.length||!u.length)||(i=t,t=n,n=this,r=fv(t,du(t))),f=!(br(i)&&"chain"in i)||!!i.chain,e=gh(n),c(r,function(i){var r=t[i];n[i]=r;e&&(n.prototype[i]=function(){var i=this.__chain__,t,u;return f||i?(t=n(this.__wrapped__),u=t.__actions__=uf(this.__actions__),u.push({func:r,args:arguments,thisArg:n}),t.__chain__=i,t):r.apply(n,it([this.value()],arguments))})}),n}function yyt(){return u._===this&&(u._=ktt),this}function aw(){}function pyt(n){return n=bi(n),ar(function(t){return bb(t,n)})}function ltt(n){return wp(n)?nu(gs(n)):kut(n)}function dyt(t){return function(i){return t==null?n:ol(t,i)}}function vw(){return[]}function yw(){return!1}function gyt(){return{}}function npt(){return""}function tpt(){return!0}function ipt(n,t){var i,r,u;if(n=bi(n),n<1||n>nt)return[];for(i=b,r=nf(n,b),t=pi(t),n-=b,u=ru(r,t);++i<n;)t(i);return u}function rpt(n){return wi(n)?r(n,gs):hf(n)?[n]:uf(dp(yr(n)))}function upt(n){var t=++wtt;return yr(n)+t}function hpt(t){return t&&t.length?rv(t,of,py):n}function cpt(t,i){return t&&t.length?rv(t,pi(i,2),py):n}function lpt(n){return ee(n,of)}function apt(n,t){return ee(n,pi(t,2))}function vpt(t){return t&&t.length?rv(t,of,dy):n}function ypt(t,i){return t&&t.length?rv(t,pi(i,2),dy):n}function kpt(n){return n&&n.length?iu(n,of):0}function dpt(n,t){return n&&n.length?iu(n,pi(t,2)):0}var kc,eh,ay,uv,vy,ip,nk,ek,ok,nd,yv,od,dp,gd,tg,rg,fg,eg,og,sg,lg,ag,vg,yg,pg,ea,gv,tw,nn,tn,yh,un,en,ry,sn,ul,hn,cn,pn,wn,kn,ew,ow,gn,itt,rtt,utt,fy,sw,ett,ott,stt,htt,ctt,att,vtt;h=h==null?u:g.defaults(u.Object(),h,g.pick(u,hh));var bu=h.Array,ha=h.Date,pw=h.Error,ww=h.Function,fl=h.Math,wr=h.Object,ey=h.RegExp,ytt=h.String,lf=h.TypeError,ca=bu.prototype,ptt=ww.prototype,al=wr.prototype,la=h["__core-js_shared__"],aa=ptt.toString,pr=al.hasOwnProperty,wtt=0,bw=function(){var n=/[^.]+$/.exec(la&&la.keys&&la.keys.IE_PROTO||"");return n?"Symbol(src)_1."+n:""}(),kw=al.toString,btt=aa.call(wr),ktt=u._,dtt=ey("^"+aa.call(pr).replace(lr,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),va=wf?h.Buffer:n,ac=h.Symbol,ya=h.Uint8Array,dw=va?va.allocUnsafe:n,pa=ae(wr.getPrototypeOf,wr),gw=wr.create,nb=al.propertyIsEnumerable,wa=ca.splice,tb=ac?ac.isConcatSpreadable:n,vl=ac?ac.iterator:n,bc=ac?ac.toStringTag:n,ba=function(){try{var n=tl(wr,"defineProperty");return n({},"",{}),n}catch(t){}}(),gtt=h.clearTimeout!==u.clearTimeout&&h.clearTimeout,nit=ha&&ha.now!==u.Date.now&&ha.now,tit=h.setTimeout!==u.setTimeout&&h.setTimeout,ka=fl.ceil,da=fl.floor,oy=wr.getOwnPropertySymbols,iit=va?va.isBuffer:n,rit=h.isFinite,uit=ca.join,fit=ae(wr.keys,wr),ku=fl.max,nf=fl.min,eit=ha.now,oit=h.parseInt,ib=fl.random,sit=ca.reverse,sy=tl(h,"DataView"),yl=tl(h,"Map"),hy=tl(h,"Promise"),el=tl(h,"Set"),pl=tl(h,"WeakMap"),wl=tl(wr,"create"),ga=pl&&new pl,bl={},hit=il(sy),cit=il(yl),lit=il(hy),ait=il(el),vit=il(pl),nv=ac?ac.prototype:n,kl=nv?nv.valueOf:n,rb=nv?nv.toString:n;kc=function(){function t(){}return function(i){if(!br(i))return{};if(gw)return gw(i);t.prototype=i;var r=new t;return t.prototype=n,r}}();at.templateSettings={escape:bo,evaluate:ko,interpolate:vu,variable:"",imports:{_:at}};at.prototype=tv.prototype;at.prototype.constructor=at;af.prototype=kc(tv.prototype);af.prototype.constructor=af;vr.prototype=kc(tv.prototype);vr.prototype.constructor=vr;dc.prototype.clear=bit;dc.prototype["delete"]=kit;dc.prototype.get=dit;dc.prototype.has=git;dc.prototype.set=nrt;th.prototype.clear=trt;th.prototype["delete"]=irt;th.prototype.get=rrt;th.prototype.has=urt;th.prototype.set=frt;ih.prototype.clear=ert;ih.prototype["delete"]=ort;ih.prototype.get=srt;ih.prototype.has=hrt;ih.prototype.set=crt;gc.prototype.add=gc.prototype.push=lrt;gc.prototype.has=art;re.prototype.clear=vrt;re.prototype["delete"]=yrt;re.prototype.get=prt;re.prototype.has=wrt;re.prototype.set=brt;eh=vk(ks);ay=vk(yy,!0);uv=yk();vy=yk(!0);ip=ga?function(n,t){return ga.set(n,t),n}:of;nk=ba?function(n,t){return ba(n,"toString",{configurable:!0,enumerable:!1,value:hw(t),writable:!0})}:of;ek=ar;ok=gtt||function(n){return u.clearTimeout(n)};nd=(el&&1/pt(new el([,-0]))[1]==ft)?function(n){return new el(n)}:aw;yv=ga?function(n){return ga.get(n)}:aw;var pp=oy?function(n){return n==null?[]:(n=wr(n),tt(oy(n),function(t){return nb.call(n,t)}))}:vw,ud=oy?function(n){for(var t=[];n;)it(t,pp(n)),n=pa(n);return t}:vw,tf=rf;(sy&&tf(new sy(new ArrayBuffer(1)))!=lt||yl&&tf(new yl)!=l||hy&&tf(hy.resolve())!=cu||el&&tf(new el)!=a||pl&&tf(new pl)!=ii)&&(tf=function(t){var i=rf(t),r=i==d?t.constructor:n,u=r?il(r):"";if(u)switch(u){case hit:return lt;case cit:return l;case lit:return cu;case ait:return a;case vit:return ii}return i});od=la?gh:yw;var ad=yd(ip),fa=tit||function(n,t){return u.setTimeout(n,t)},kp=yd(nk);dp=fet(function(n){var t=[];return ts.test(n)&&t.push(""),n.replace(is,function(n,i,r,u){t.push(r?u.replace(hs,"$1"):i||n)}),t});var pet=ar(function(n,t){return tu(n)?gl(n,gu(t,1,tu,!0)):[]}),wet=ar(function(t,i){var r=yf(i);return tu(r)&&(r=n),tu(t)?gl(t,gu(i,1,tu,!0),pi(r,2)):[]}),bet=ar(function(t,i){var r=yf(i);return tu(r)&&(r=n),tu(t)?gl(t,gu(i,1,tu,!0),n,r):[]});var oot=ar(function(n){var t=r(n,ep);return t.length&&t[0]===n[0]?wy(t):[]}),sot=ar(function(t){var u=yf(t),i=r(t,ep);return u===yf(i)?u=n:i.pop(),i.length&&i[0]===t[0]?wy(i,pi(u,2)):[]}),hot=ar(function(t){var i=yf(t),u=r(t,ep);return i=typeof i=="function"?i:n,i&&u.pop(),u.length&&u[0]===t[0]?wy(u,n,i):[]});gd=ar(ng);tg=sh(function(n,t){var i=n==null?0:n.length,u=ly(n,t);return gb(n,r(t,function(n){return lh(n,i)?+n:n}).sort(ck)),u});var hst=ar(function(n){return vc(gu(n,1,tu,!0))}),cst=ar(function(t){var i=yf(t);return tu(i)&&(i=n),vc(gu(t,1,tu,!0),pi(i,2))}),lst=ar(function(t){var i=yf(t);return i=typeof i=="function"?i:n,vc(gu(t,1,tu,!0),n,i)});var pst=ar(function(n,t){return tu(n)?gl(n,t):[]}),wst=ar(function(n){return fp(tt(n,tu))}),bst=ar(function(t){var i=yf(t);return tu(i)&&(i=n),fp(tt(t,tu),pi(i,2))}),kst=ar(function(t){var i=yf(t);return i=typeof i=="function"?i:n,fp(tt(t,tu),n,i)}),dst=ar(nw);rg=ar(function(t){var r=t.length,i=r>1?t[r-1]:n;return i=typeof i=="function"?(t.pop(),i):n,ig(t,i)});fg=sh(function(t){var r=t.length,u=r?t[0]:0,i=this.__wrapped__,f=function(n){return ly(n,t)};return r>1||this.__actions__.length||!(i instanceof vr)||!lh(u)?this.thru(f):(i=i.slice(u,+u+(r?1:0)),i.__actions__.push({func:kv,args:[f],thisArg:n}),new af(i,this.__chain__).thru(function(t){return r&&!t.length&&t.push(n),t}))});eg=hv(function(n,t,i){pr.call(n,i)?++n[i]:rh(n,i,1)});og=wk(wd);sg=wk(bd);lg=hv(function(n,t,i){pr.call(n,i)?n[i].push(t):rh(n,i,[t])});ag=ar(function(n,t,i){var u=-1,e=typeof t=="function",r=ef(n)?bu(n.length):[];return eh(n,function(n){r[++u]=e?f(t,n,i):na(n,t,i)}),r});vg=hv(function(n,t,i){rh(n,i,t)});yg=hv(function(n,t,i){n[i?0:1].push(t)},function(){return[[],[]]});pg=ar(function(n,t){if(n==null)return[];var i=t.length;return i>1&&ff(n,t[0],t[1])?t=[]:i>2&&ff(t[0],t[1],t[2])&&(t=[t[0]]),kb(n,gu(t,1),[])});ea=nit||function(){return u.Date.now()};gv=ar(function(n,t,i){var r=s,u;return i.length&&(u=rt(i,cl(gv)),r|=w),oh(n,r,t,i,u)});tw=ar(function(n,t,i){var r=s|ut,u;return i.length&&(u=rt(i,cl(tw)),r|=w),oh(t,r,n,i,u)});nn=ar(function(n,t){return sb(n,1,t)});tn=ar(function(n,t,i){return sb(n,pf(t)||0,i)});ny.Cache=ih;var ect=ek(function(n,t){t=t.length==1&&wi(t[0])?r(t[0],e(pi())):r(gu(t,1),e(pi()));var i=t.length;return ar(function(r){for(var u=-1,e=nf(r.length,i);++u<e;)r[u]=t[u].call(this,r[u]);return f(n,this,r)})}),iw=ar(function(t,i){var r=rt(i,cl(iw));return oh(t,w,n,i,r)}),rn=ar(function(t,i){var r=rt(i,cl(rn));return oh(t,ht,n,i,r)}),oct=sh(function(t,i){return oh(t,bt,n,n,n,i)});var dct=vv(py),gct=vv(function(n,t){return n>=t}),rl=lb(function(){return arguments}())?lb:function(n){return kr(n)&&pr.call(n,"callee")&&!nb.call(n,"callee")},wi=bu.isArray,nlt=bf?e(bf):sut;yh=iit||yw;un=kf?e(kf):hut;en=df?e(df):lut;ry=gf?e(gf):aut;sn=ne?e(ne):vut;ul=te?e(te):yut;hn=vv(dy);cn=vv(function(n,t){return n<=t});var klt=sl(function(n,t){if(ua(t)||ef(t)){ds(t,du(t),n);return}for(var i in t)pr.call(t,i)&&dl(n,i,t[i])}),yn=sl(function(n,t){ds(t,cf(t),n)}),sa=sl(function(n,t,i,r){ds(t,cf(t),n,r)}),dlt=sl(function(n,t,i,r){ds(t,du(t),n,r)}),glt=sh(ly);pn=ar(function(t){return t.push(n,lp),f(sa,n,t)});wn=ar(function(t){return t.push(n,id),f(bn,n,t)});var cat=kk(function(n,t,i){n[t]=i},hw(of)),lat=kk(function(n,t,i){pr.call(n,t)?n[t].push(i):n[t]=[i]},pi),aat=ar(na);var pat=sl(function(n,t,i){ev(n,t,i)}),bn=sl(function(n,t,i,r){ev(n,t,i,r)}),wat=sh(function(n,t){var i={},u,f;if(n==null)return i;for(u=!1,t=r(t,function(t){return t=pc(t,n),u||(u=t.length>1),t}),ds(n,vp(n),i),u&&(i=ss(i,y|eu|et,yft)),f=t.length;f--;)up(i,t[f]);return i});kn=sh(function(n,t){return n==null?{}:but(n,t)});ew=td(du);ow=td(cf);gn=hl(function(n,t,i){return t=t.toLowerCase(),n+(i?ntt(t):t)});var lvt=hl(function(n,t,i){return n+(i?"-":"")+t.toLowerCase()}),avt=hl(function(n,t,i){return n+(i?" ":"")+t.toLowerCase()}),vvt=pk("toLowerCase");itt=hl(function(n,t,i){return n+(i?"_":"")+t.toLowerCase()});rtt=hl(function(n,t,i){return n+(i?" ":"")+fy(t)});utt=hl(function(n,t,i){return n+(i?" ":"")+t.toUpperCase()});fy=pk("toUpperCase");sw=ar(function(t,i){try{return f(t,n,i)}catch(r){return rw(r)?r:new pw(r)}});ett=sh(function(n,t){return c(t,function(t){t=gs(t);rh(n,t,gv(n[t],n))}),n});ott=bk();stt=bk(!0);htt=ar(function(n,t){return function(i){return na(i,n,t)}});ctt=ar(function(n,t){return function(i){return na(n,i,t)}});var wyt=hp(r),byt=hp(ie),kyt=hp(gr);att=dk();vtt=dk(!0);var fpt=lv(function(n,t){return n+t},0),ept=cp("ceil"),opt=lv(function(n,t){return n/t},1),spt=cp("floor");var ppt=lv(function(n,t){return n*t},1),wpt=cp("round"),bpt=lv(function(n,t){return n-t},0);return at.after=rct,at.ary=wg,at.assign=klt,at.assignIn=yn,at.assignInWith=sa,at.assignWith=dlt,at.at=glt,at.before=bg,at.bind=gv,at.bindAll=ett,at.bindKey=tw,at.castArray=vct,at.chain=ug,at.chunk=aet,at.compact=vet,at.concat=yet,at.cond=hyt,at.conforms=cyt,at.constant=hw,at.countBy=eg,at.create=nat,at.curry=kg,at.curryRight=dg,at.debounce=gg,at.defaults=pn,at.defaultsDeep=wn,at.defer=nn,at.delay=tn,at.difference=pet,at.differenceBy=wet,at.differenceWith=bet,at.drop=ket,at.dropRight=det,at.dropRightWhile=get,at.dropWhile=not,at.fill=tot,at.filter=cht,at.flatMap=lht,at.flatMapDeep=aht,at.flatMapDepth=vht,at.flatten=kd,at.flattenDeep=iot,at.flattenDepth=rot,at.flip=uct,at.flow=ott,at.flowRight=stt,at.fromPairs=uot,at.functions=oat,at.functionsIn=sat,at.groupBy=lg,at.initial=eot,at.intersection=oot,at.intersectionBy=sot,at.intersectionWith=hot,at.invert=cat,at.invertBy=lat,at.invokeMap=ag,at.iteratee=cw,at.keyBy=vg,at.keys=du,at.keysIn=cf,at.map=dv,at.mapKeys=vat,at.mapValues=yat,at.matches=ayt,at.matchesProperty=vyt,at.memoize=ny,at.merge=pat,at.mergeWith=bn,at.method=htt,at.methodOf=ctt,at.mixin=lw,at.negate=ty,at.nthArg=pyt,at.omit=wat,at.omitBy=bat,at.once=fct,at.orderBy=pht,at.over=wyt,at.overArgs=ect,at.overEvery=byt,at.overSome=kyt,at.partial=iw,at.partialRight=rn,at.partition=yg,at.pick=kn,at.pickBy=dn,at.property=ltt,at.propertyOf=dyt,at.pull=gd,at.pullAll=ng,at.pullAllBy=vot,at.pullAllWith=yot,at.pullAt=tg,at.range=att,at.rangeRight=vtt,at.rearg=oct,at.reject=kht,at.remove=pot,at.rest=sct,at.reverse=gp,at.sampleSize=ght,at.set=dat,at.setWith=gat,at.shuffle=nct,at.slice=wot,at.sortBy=pg,at.sortedUniq=ist,at.sortedUniqBy=rst,at.split=gvt,at.spread=hct,at.tail=ust,at.take=fst,at.takeRight=est,at.takeRightWhile=ost,at.takeWhile=sst,at.tap=tht,at.throttle=cct,at.thru=kv,at.toArray=ln,at.toPairs=ew,at.toPairsIn=ow,at.toPath=rpt,at.toPlainObject=vn,at.transform=nvt,at.unary=lct,at.union=hst,at.unionBy=cst,at.unionWith=lst,at.uniq=ast,at.uniqBy=vst,at.uniqWith=yst,at.unset=tvt,at.unzip=nw,at.unzipWith=ig,at.update=ivt,at.updateWith=rvt,at.values=ll,at.valuesIn=uvt,at.without=pst,at.words=ftt,at.wrap=act,at.xor=wst,at.xorBy=bst,at.xorWith=kst,at.zip=dst,at.zipObject=gst,at.zipObjectDeep=nht,at.zipWith=rg,at.entries=ew,at.entriesIn=ow,at.extend=yn,at.extendWith=sa,lw(at,at),at.add=fpt,at.attempt=sw,at.camelCase=gn,at.capitalize=ntt,at.ceil=ept,at.clamp=fvt,at.clone=yct,at.cloneDeep=wct,at.cloneDeepWith=bct,at.cloneWith=pct,at.conformsTo=kct,at.deburr=ttt,at.defaultTo=lyt,at.divide=opt,at.endsWith=svt,at.eq=nh,at.escape=hvt,at.escapeRegExp=cvt,at.every=hht,at.find=og,at.findIndex=wd,at.findKey=tat,at.findLast=sg,at.findLastIndex=bd,at.findLastKey=iat,at.floor=spt,at.forEach=hg,at.forEachRight=cg,at.forIn=rat,at.forInRight=uat,at.forOwn=fat,at.forOwnRight=eat,at.get=uw,at.gt=dct,at.gte=gct,at.has=hat,at.hasIn=fw,at.head=dd,at.identity=of,at.includes=yht,at.indexOf=fot,at.inRange=evt,at.invoke=aat,at.isArguments=rl,at.isArray=wi,at.isArrayBuffer=nlt,at.isArrayLike=ef,at.isArrayLikeObject=tu,at.isBoolean=tlt,at.isBuffer=yh,at.isDate=un,at.isElement=ilt,at.isEmpty=rlt,at.isEqual=ult,at.isEqualWith=flt,at.isError=rw,at.isFinite=elt,at.isFunction=gh,at.isInteger=fn,at.isLength=iy,at.isMap=en,at.isMatch=olt,at.isMatchWith=slt,at.isNaN=hlt,at.isNative=clt,at.isNil=alt,at.isNull=llt,at.isNumber=on,at.isObject=br,at.isObjectLike=kr,at.isPlainObject=oa,at.isRegExp=ry,at.isSafeInteger=vlt,at.isSet=sn,at.isString=uy,at.isSymbol=hf,at.isTypedArray=ul,at.isUndefined=ylt,at.isWeakMap=plt,at.isWeakSet=wlt,at.join=cot,at.kebabCase=lvt,at.last=yf,at.lastIndexOf=lot,at.lowerCase=avt,at.lowerFirst=vvt,at.lt=hn,at.lte=cn,at.max=hpt,at.maxBy=cpt,at.mean=lpt,at.meanBy=apt,at.min=vpt,at.minBy=ypt,at.stubArray=vw,at.stubFalse=yw,at.stubObject=gyt,at.stubString=npt,at.stubTrue=tpt,at.multiply=ppt,at.nth=aot,at.noConflict=yyt,at.noop=aw,at.now=ea,at.pad=yvt,at.padEnd=pvt,at.padStart=wvt,at.parseInt=bvt,at.random=ovt,at.reduce=wht,at.reduceRight=bht,at.repeat=kvt,at.replace=dvt,at.result=kat,at.round=wpt,at.runInContext=fu,at.sample=dht,at.size=tct,at.snakeCase=itt,at.some=ict,at.sortedIndex=bot,at.sortedIndexBy=kot,at.sortedIndexOf=dot,at.sortedLastIndex=got,at.sortedLastIndexBy=nst,at.sortedLastIndexOf=tst,at.startCase=rtt,at.startsWith=nyt,at.subtract=bpt,at.sum=kpt,at.sumBy=dpt,at.template=tyt,at.times=ipt,at.toFinite=cc,at.toInteger=bi,at.toLength=an,at.toLower=iyt,at.toNumber=pf,at.toSafeInteger=blt,at.toString=yr,at.toUpper=ryt,at.trim=uyt,at.trimEnd=fyt,at.trimStart=eyt,at.truncate=oyt,at.unescape=syt,at.uniqueId=upt,at.upperCase=utt,at.upperFirst=fy,at.each=hg,at.eachRight=cg,at.first=dd,lw(at,function(){var n={};return ks(at,function(t,i){pr.call(at.prototype,i)||(n[i]=t)}),n}(),{chain:!1}),at.VERSION=ye,c(["bind","bindKey","curry","curryRight","partial","partialRight"],function(n){at[n].placeholder=at}),c(["drop","take"],function(t,i){vr.prototype[t]=function(r){r=r===n?1:ku(bi(r),0);var u=this.__filtered__&&!i?new vr(this):this.clone();return u.__filtered__?u.__takeCount__=nf(r,u.__takeCount__):u.__views__.push({size:nf(r,b),type:t+(u.__dir__<0?"Right":"")}),u};vr.prototype[t+"Right"]=function(n){return this.reverse()[t](n).reverse()}}),c(["filter","map","takeWhile"],function(n,t){var i=t+1,r=i==su||i==to;vr.prototype[n]=function(n){var t=this.clone();return t.__iteratees__.push({iteratee:pi(n,3),type:i}),t.__filtered__=t.__filtered__||r,t}}),c(["head","last"],function(n,t){var i="take"+(t?"Right":"");vr.prototype[n]=function(){return this[i](1).value()[0]}}),c(["initial","tail"],function(n,t){var i="drop"+(t?"":"Right");vr.prototype[n]=function(){return this.__filtered__?new vr(this):this[i](1)}}),vr.prototype.compact=function(){return this.filter(of)},vr.prototype.find=function(n){return this.filter(n).head()},vr.prototype.findLast=function(n){return this.reverse().find(n)},vr.prototype.invokeMap=ar(function(n,t){return typeof n=="function"?new vr(this):this.map(function(i){return na(i,n,t)})}),vr.prototype.reject=function(n){return this.filter(ty(pi(n)))},vr.prototype.slice=function(t,i){t=bi(t);var r=this;return r.__filtered__&&(t>0||i<0)?new vr(r):(t<0?r=r.takeRight(-t):t&&(r=r.drop(t)),i!==n&&(i=bi(i),r=i<0?r.dropRight(-i):r.take(i-t)),r)},vr.prototype.takeRightWhile=function(n){return this.reverse().takeWhile(n).reverse()},vr.prototype.toArray=function(){return this.take(b)},ks(vr.prototype,function(t,i){var e=/^(?:filter|find|map|reject)|While$/.test(i),r=/^(?:head|last)$/.test(i),u=at[r?"take"+(i=="last"?"Right":""):i],f=r||/^find/.test(i);u&&(at.prototype[i]=function(){var o=this.__wrapped__,s=r?[1]:arguments,h=o instanceof vr,a=s[0],c=h||wi(o),v=function(n){var t=u.apply(at,it([n],s));return r&&l?t[0]:t},i;c&&e&&typeof a=="function"&&a.length!=1&&(h=c=!1);var l=this.__chain__,w=!!this.__actions__.length,y=f&&!l,p=h&&!w;return!f&&c?(o=p?o:new vr(this),i=t.apply(o,s),i.__actions__.push({func:kv,args:[v],thisArg:n}),new af(i,l)):y&&p?t.apply(this,s):(i=this.thru(v),y?r?i.value()[0]:i.value():i)})}),c(["pop","push","shift","sort","splice","unshift"],function(n){var t=ca[n],i=/^(?:push|sort|unshift)$/.test(n)?"tap":"thru",r=/^(?:pop|shift)$/.test(n);at.prototype[n]=function(){var u=arguments,n;return r&&!this.__chain__?(n=this.value(),t.apply(wi(n)?n:[],u)):this[i](function(n){return t.apply(wi(n)?n:[],u)})}}),ks(vr.prototype,function(n,t){var i=at[t],r,u;i&&(r=i.name+"",u=bl[r]||(bl[r]=[]),u.push({name:t,func:i}))}),bl[cv(n,ut).name]=[{name:"wrapper",func:n}],vr.prototype.clone=yit,vr.prototype.reverse=pit,vr.prototype.value=wit,at.prototype.at=fg,at.prototype.chain=iht,at.prototype.commit=rht,at.prototype.next=uht,at.prototype.plant=eht,at.prototype.reverse=oht,at.prototype.toJSON=at.prototype.valueOf=at.prototype.value=sht,at.prototype.first=at.prototype.head,vl&&(at.prototype[vl]=fht),at};g=fu();typeof define=="function"&&typeof define.amd=="object"&&define.amd?(u._=g,define(function(){return g})):bi?((bi.exports=g)._=g,br._=g):u._=g}).call(this);
/* @preserve
 * The MIT License (MIT)
 * 
 * Copyright (c) 2013-2017 Petka Antonov
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 * 
 */
!function(n){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=n();else if("function"==typeof define&&define.amd)define([],n);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self);t.Promise=n()}}(function(){return function n(t,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!t[f]){if(h="function"==typeof _dereq_&&_dereq_,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};t[f][0].call(s.exports,function(n){var i=t[f][1][n];return u(i?i:n)},s,s.exports,n,t,i,r)}return i[f].exports}for(var e="function"==typeof _dereq_&&_dereq_,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t){"use strict";t.exports=function(n){function t(n){var t=new i(n),r=t.promise();return t.setHowMany(1),t.setUnwrap(),t.init(),r}var i=n._SomePromiseArray;n.any=function(n){return t(n)};n.prototype.any=function(){return t(this)}}},{}],2:[function(n,t){"use strict";function i(){this._customScheduler=!1;this._isTickUsed=!1;this._lateQueue=new o(16);this._normalQueue=new o(16);this._haveDrainedQueues=!1;this._trampolineEnabled=!0;var n=this;this.drainQueues=function(){n._drainQueues()};this._schedule=c}function r(n,t,i){this._lateQueue.push(n,t,i);this._queueTick()}function u(n,t,i){this._normalQueue.push(n,t,i);this._queueTick()}function f(n){this._normalQueue._pushOne(n);this._queueTick()}var e;try{throw new Error;}catch(h){e=h}var c=n("./schedule"),o=n("./queue"),s=n("./util");i.prototype.setScheduler=function(n){var t=this._schedule;return this._schedule=n,this._customScheduler=!0,t};i.prototype.hasCustomScheduler=function(){return this._customScheduler};i.prototype.enableTrampoline=function(){this._trampolineEnabled=!0};i.prototype.disableTrampolineIfNecessary=function(){s.hasDevTools&&(this._trampolineEnabled=!1)};i.prototype.haveItemsQueued=function(){return this._isTickUsed||this._haveDrainedQueues};i.prototype.fatalError=function(n,t){t?(process.stderr.write("Fatal "+(n instanceof Error?n.stack:n)+"\n"),process.exit(2)):this.throwLater(n)};i.prototype.throwLater=function(n,t){if(1===arguments.length&&(t=n,n=function(){throw t;}),"undefined"!=typeof setTimeout)setTimeout(function(){n(t)},0);else try{this._schedule(function(){n(t)})}catch(i){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");}};s.hasDevTools?(i.prototype.invokeLater=function(n,t,i){this._trampolineEnabled?r.call(this,n,t,i):this._schedule(function(){setTimeout(function(){n.call(t,i)},100)})},i.prototype.invoke=function(n,t,i){this._trampolineEnabled?u.call(this,n,t,i):this._schedule(function(){n.call(t,i)})},i.prototype.settlePromises=function(n){this._trampolineEnabled?f.call(this,n):this._schedule(function(){n._settlePromises()})}):(i.prototype.invokeLater=r,i.prototype.invoke=u,i.prototype.settlePromises=f);i.prototype._drainQueue=function(n){for(var t,i,r;n.length()>0;)t=n.shift(),"function"==typeof t?(i=n.shift(),r=n.shift(),t.call(i,r)):t._settlePromises()};i.prototype._drainQueues=function(){this._drainQueue(this._normalQueue);this._reset();this._haveDrainedQueues=!0;this._drainQueue(this._lateQueue)};i.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))};i.prototype._reset=function(){this._isTickUsed=!1};t.exports=i;t.exports.firstLineError=e},{"./queue":26,"./schedule":29,"./util":36}],3:[function(n,t){"use strict";t.exports=function(n,t,i,r){var u=!1,f=function(n,t){this._reject(t)},e=function(n,t){t.promiseRejectionQueued=!0;t.bindingPromise._then(f,f,null,this,n)},o=function(n,t){0==(50397184&this._bitField)&&this._resolveCallback(t.target)},s=function(n,t){t.promiseRejectionQueued||this._reject(n)};n.prototype.bind=function(f){var c,h,l,a;return u||(u=!0,n.prototype._propagateFrom=r.propagateFromFunction(),n.prototype._boundValue=r.boundValueFunction()),c=i(f),h=new n(t),h._propagateFrom(this,1),l=this._target(),(h._setBoundTo(c),c instanceof n)?(a={promiseRejectionQueued:!1,promise:h,target:l,bindingPromise:c},l._then(t,e,void 0,h,a),c._then(o,s,void 0,h,a),h._setOnCancel(c)):h._resolveCallback(l),h};n.prototype._setBoundTo=function(n){void 0!==n?(this._bitField=2097152|this._bitField,this._boundTo=n):this._bitField=-2097153&this._bitField};n.prototype._isBound=function(){return 2097152==(2097152&this._bitField)};n.bind=function(t,i){return n.resolve(i).bind(t)}}},{}],4:[function(n,t){"use strict";function u(){try{Promise===i&&(Promise=r)}catch(n){}return i}var r,i;"undefined"!=typeof Promise&&(r=Promise);i=n("./promise")();i.noConflict=u;t.exports=i},{"./promise":22}],5:[function(n,t){"use strict";var i=Object.create,r,u;i&&(r=i(null),u=i(null),r[" size"]=u[" size"]=0);t.exports=function(t){function u(n,r){var u,f;if(null!=n&&(u=n[r]),"function"!=typeof u){f="Object "+i.classString(n)+" has no method '"+i.toString(r)+"'";throw new t.TypeError(f);}return u}function f(n){var t=this.pop(),i=u(n,t);return i.apply(n,this)}function r(n){return n[this]}function e(n){var t=+this;return 0>t&&(t=Math.max(0,t+n.length)),n[t]}var o,i=n("./util"),s=i.canEvaluate;i.isIdentifier;t.prototype.call=function(n){var t=[].slice.call(arguments,1);return t.push(n),this._then(f,void 0,void 0,t,void 0)};t.prototype.get=function(n){var t,u="number"==typeof n,i;return u?t=e:s?(i=o(n),t=null!==i?i:r):t=r,this._then(t,void 0,void 0,n,void 0)}}},{"./util":36}],6:[function(n,t){"use strict";t.exports=function(t,i,r,u){var f=n("./util"),o=f.tryCatch,s=f.errorObj,e=t._async;t.prototype["break"]=t.prototype.cancel=function(){var n,t,i;if(!u.cancellation())return this._warn("cancellation is disabled");for(n=this,t=n;n._isCancellable();){if(!n._cancelBy(t)){t._isFollowing()?t._followee().cancel():t._cancelBranched();break}if(i=n._cancellationParent,null==i||!i._isCancellable()){n._isFollowing()?n._followee().cancel():n._cancelBranched();break}n._isFollowing()&&n._followee().cancel();n._setWillBeCancelled();t=n;n=i}};t.prototype._branchHasCancelled=function(){this._branchesRemainingToCancel--};t.prototype._enoughBranchesHaveCancelled=function(){return void 0===this._branchesRemainingToCancel||this._branchesRemainingToCancel<=0};t.prototype._cancelBy=function(n){return n===this?(this._branchesRemainingToCancel=0,this._invokeOnCancel(),!0):(this._branchHasCancelled(),this._enoughBranchesHaveCancelled()?(this._invokeOnCancel(),!0):!1)};t.prototype._cancelBranched=function(){this._enoughBranchesHaveCancelled()&&this._cancel()};t.prototype._cancel=function(){this._isCancellable()&&(this._setCancelled(),e.invoke(this._cancelPromises,this,void 0))};t.prototype._cancelPromises=function(){this._length()>0&&this._settlePromises()};t.prototype._unsetOnCancel=function(){this._onCancelField=void 0};t.prototype._isCancellable=function(){return this.isPending()&&!this._isCancelled()};t.prototype.isCancellable=function(){return this.isPending()&&!this.isCancelled()};t.prototype._doInvokeOnCancel=function(n,t){var i,r;if(f.isArray(n))for(i=0;i<n.length;++i)this._doInvokeOnCancel(n[i],t);else void 0!==n&&("function"==typeof n?t||(r=o(n).call(this._boundValue()),r===s&&(this._attachExtraTrace(r.e),e.throwLater(r.e))):n._resultCancelled(this))};t.prototype._invokeOnCancel=function(){var n=this._onCancel();this._unsetOnCancel();e.invoke(this._doInvokeOnCancel,this,n)};t.prototype._invokeInternalOnCancel=function(){this._isCancellable()&&(this._doInvokeOnCancel(this._onCancel(),!0),this._unsetOnCancel())};t.prototype._resultCancelled=function(){this.cancel()}}},{"./util":36}],7:[function(n,t){"use strict";t.exports=function(t){function u(n,u,o){return function(s){var c=o._boundValue(),l,h,a,y,v,p;n:for(l=0;l<n.length;++l)if(h=n[l],h===Error||null!=h&&h.prototype instanceof Error){if(s instanceof h)return i(u).call(c,s)}else if("function"==typeof h){if(a=i(h).call(c,s),a===e)return a;if(a)return i(u).call(c,s)}else if(r.isObject(s)){for(y=f(h),v=0;v<y.length;++v)if(p=y[v],h[p]!=s[p])continue n;return i(u).call(c,s)}return t}}var r=n("./util"),f=n("./es5").keys,i=r.tryCatch,e=r.errorObj;return u}},{"./es5":13,"./util":36}],8:[function(n,t){"use strict";t.exports=function(n){function t(){this._trace=new t.CapturedTrace(u())}function f(){if(r)return new t}function u(){var n=i.length-1;if(n>=0)return i[n]}var r=!1,i=[];return n.prototype._promiseCreated=function(){},n.prototype._pushContext=function(){},n.prototype._popContext=function(){return null},n._peekContext=n.prototype._peekContext=function(){},t.prototype._pushContext=function(){void 0!==this._trace&&(this._trace._promiseCreated=null,i.push(this._trace))},t.prototype._popContext=function(){if(void 0!==this._trace){var n=i.pop(),t=n._promiseCreated;return n._promiseCreated=null,t}return null},t.CapturedTrace=null,t.create=f,t.deactivateLongStackTraces=function(){},t.activateLongStackTraces=function(){var i=n.prototype._pushContext,f=n.prototype._popContext,e=n._peekContext,o=n.prototype._peekContext,s=n.prototype._promiseCreated;t.deactivateLongStackTraces=function(){n.prototype._pushContext=i;n.prototype._popContext=f;n._peekContext=e;n.prototype._peekContext=o;n.prototype._promiseCreated=s;r=!1};r=!0;n.prototype._pushContext=t.prototype._pushContext;n.prototype._popContext=t.prototype._popContext;n._peekContext=n.prototype._peekContext=u;n.prototype._promiseCreated=function(){var n=this._peekContext();n&&null==n._promiseCreated&&(n._promiseCreated=this)}},t}},{}],9:[function(n,t){"use strict";t.exports=function(t,i){function o(n,t){return{promise:t}}function nt(){return!1}function pt(n,t,i){var u=this;try{n(t,i,function(n){if("function"!=typeof n)throw new TypeError("onCancel must be a function, got: "+r.toString(n));u._attachCancellationCallback(n)})}catch(f){return f}}function wt(n){if(!this._isCancellable())return this;var t=this._onCancel();void 0!==t?r.isArray(t)?t.push(n):this._setOnCancel([t,n]):this._setOnCancel(n)}function bt(){return this._onCancelField}function kt(n){this._onCancelField=n}function dt(){this._cancellationParent=void 0;this._onCancelField=void 0}function tt(n,t){if(0!=(1&t)){this._cancellationParent=n;var i=n._branchesRemainingToCancel;void 0===i&&(i=0);n._branchesRemainingToCancel=i+1}0!=(2&t)&&n._isBound()&&this._setBoundTo(n._boundTo)}function gt(n,t){0!=(2&t)&&n._isBound()&&this._setBoundTo(n._boundTo)}function ni(){var n=this._boundTo;return void 0!==n&&n instanceof t?n.isFulfilled()?n.value():void 0:n}function ti(){this._trace=new e(this._peekContext())}function ii(n,t){var i,u;ai(n)&&(i=this._trace,(void 0!==i&&t&&(i=i._parent),void 0!==i)?i.attachExtraTrace(n):n.__stackCleaned__||(u=y(n),r.notEnumerableProp(n,"stack",u.message+"\n"+u.stack.join("\n")),r.notEnumerableProp(n,"__stackCleaned__",!0)))}function ri(n,t,i,r,u){var h,c,l,e,a,f,y;if(void 0===n&&null!==t&&b){if(void 0!==u&&u._returnedNonUndefined())return;if(0==(65535&r._bitField))return;if(i&&(i+=" "),h="",c="",t._trace){for(var o=t._trace.stack.split("\n"),s=v(o),f=s.length-1;f>=0;--f)if(l=s[f],!vi.test(l)){e=l.match(yi);e&&(h="at "+e[1]+":"+e[2]+":"+e[3]+" ");break}if(s.length>0)for(a=s[0],f=0;f<o.length;++f)if(o[f]===a){f>0&&(c="\n"+o[f-1]);break}}y="a promise was created in a "+i+"handler "+h+"but was not returned from it, see http://goo.gl/rRqMUw"+c;r._warn(y,!0,t)}}function ui(n,t){var i=n+" is deprecated and will be removed in a future version.";return t&&(i+=" Use "+t+" instead."),a(i)}function a(n,i,r){var o,f,e;u.warnings&&(f=new li(n),i?r._attachExtraTrace(f):u.longStackTraces&&(o=t._peekContext())?o.attachExtraTrace(f):(e=y(f),f.stack=e.message+"\n"+e.stack.join("\n")),l("warning",f)||it(f,"",!0))}function fi(n,t){for(var i=0;i<t.length-1;++i)t[i].push("From previous event:"),t[i]=t[i].join("\n");return i<t.length&&(t[i]=t[i].join("\n")),n+"\n"+t.join("\n")}function ei(n){for(var t=0;t<n.length;++t)(0===n[t].length||t+1<n.length&&n[t][0]===n[t+1][0])&&(n.splice(t,1),t--)}function oi(n){for(var t,o,i=n[0],r=1;r<n.length;++r){for(var u=n[r],f=i.length-1,s=i[f],e=-1,t=u.length-1;t>=0;--t)if(u[t]===s){e=t;break}for(t=e;t>=0;--t){if(o=u[t],i[f]!==o)break;i.pop();f--}i=u}}function v(n){for(var r=[],i=0;i<n.length;++i){var t=n[i],u="    (No stack trace)"===t||h.test(t),f=u&&d(t);u&&!f&&(ht&&" "!==t.charAt(0)&&(t="    "+t),r.push(t))}return r}function si(n){for(var r,t=n.stack.replace(/\s+$/g,"").split("\n"),i=0;i<t.length;++i)if(r=t[i],"    (No stack trace)"===r||h.test(r))break;return i>0&&"SyntaxError"!=n.name&&(t=t.slice(i)),t}function y(n){var t=n.stack,i=n.toString();return t="string"==typeof t&&t.length>0?si(n):["    (No stack trace)"],{message:i,stack:"SyntaxError"==n.name?t:v(t)}}function it(n,t,i){var u,f;"undefined"!=typeof console&&(r.isObject(n)?(f=n.stack,u=t+c(f,n)):u=t+String(n),"function"==typeof s?s(u,i):("function"==typeof console.log||"object"==typeof console.log)&&console.log(u))}function rt(n,t,i,r){var u=!1;try{"function"==typeof t&&(u=!0,"rejectionHandled"===n?t(r):t(i,r))}catch(e){f.throwLater(e)}"unhandledRejection"===n?l(n,i,r)||u||it(i,"Unhandled rejection "):l(n,r)}function ut(n){var t,i,u;if("function"==typeof n)t="[function "+(n.name||"anonymous")+"]";else{if(t=n&&"function"==typeof n.toString?n.toString():r.toString(n),i=/\[object [a-zA-Z0-9$_]+\]/,i.test(t))try{u=JSON.stringify(n);t=u}catch(f){}0===t.length&&(t="(empty array)")}return"(<"+hi(t)+">, no stack trace)"}function hi(n){var t=41;return n.length<t?n:n.substr(0,t-3)+"..."}function p(){return"function"==typeof g}function w(n){var t=n.match(bi);if(t)return{fileName:t[1],line:parseInt(t[2],10)}}function ci(n,t){var r,i;if(p()){for(var u,o,s=n.stack.split("\n"),h=t.stack.split("\n"),f=-1,e=-1,r=0;r<s.length;++r)if(i=w(s[r]),i){u=i.fileName;f=i.line;break}for(r=0;r<h.length;++r)if(i=w(h[r]),i){o=i.fileName;e=i.line;break}0>f||0>e||!u||!o||u!==o||f>=e||(d=function(n){if(st.test(n))return!0;var t=w(n);return t&&t.fileName===u&&f<=t.line&&t.line<=e?!0:!1})}}function e(n){this._parent=n;this._promisesCreated=0;var t=this._length=1+(void 0===n?0:n._length);g(this,e);t>32&&this.uncycle()}var ft,et,s,ot=t._getDomain,f=t._async,li=n("./errors").Warning,r=n("./util"),ai=r.canAttachTrace,st=/[\\\/]bluebird[\\\/]js[\\\/](release|debug|instrumented)/,vi=/\((?:timers\.js):\d+:\d+\)/,yi=/[\/<\(](.+?):(\d+):(\d+)\)?\s*$/,h=null,c=null,ht=!1,ct=!(0==r.env("BLUEBIRD_DEBUG")||!r.env("BLUEBIRD_DEBUG")&&"development"!==r.env("NODE_ENV")),lt=!(0==r.env("BLUEBIRD_WARNINGS")||!ct&&!r.env("BLUEBIRD_WARNINGS")),pi=!(0==r.env("BLUEBIRD_LONG_STACK_TRACES")||!ct&&!r.env("BLUEBIRD_LONG_STACK_TRACES")),b=0!=r.env("BLUEBIRD_W_FORGOTTEN_RETURN")&&(lt||!!r.env("BLUEBIRD_W_FORGOTTEN_RETURN")),k,g,u;t.prototype.suppressUnhandledRejections=function(){var n=this._target();n._bitField=-1048577&n._bitField|524288};t.prototype._ensurePossibleRejectionHandled=function(){0==(524288&this._bitField)&&(this._setRejectionIsUnhandled(),f.invokeLater(this._notifyUnhandledRejection,this,void 0))};t.prototype._notifyUnhandledRejectionIsHandled=function(){rt("rejectionHandled",ft,void 0,this)};t.prototype._setReturnedNonUndefined=function(){this._bitField=268435456|this._bitField};t.prototype._returnedNonUndefined=function(){return 0!=(268435456&this._bitField)};t.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var n=this._settledValue();this._setUnhandledRejectionIsNotified();rt("unhandledRejection",et,n,this)}};t.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=262144|this._bitField};t.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-262145&this._bitField};t.prototype._isUnhandledRejectionNotified=function(){return(262144&this._bitField)>0};t.prototype._setRejectionIsUnhandled=function(){this._bitField=1048576|this._bitField};t.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-1048577&this._bitField;this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())};t.prototype._isRejectionUnhandled=function(){return(1048576&this._bitField)>0};t.prototype._warn=function(n,t,i){return a(n,t,i||this)};t.onPossiblyUnhandledRejection=function(n){var t=ot();et="function"==typeof n?null===t?n:r.domainBind(t,n):void 0};t.onUnhandledRejectionHandled=function(n){var t=ot();ft="function"==typeof n?null===t?n:r.domainBind(t,n):void 0};k=function(){};t.longStackTraces=function(){if(f.haveItemsQueued()&&!u.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");if(!u.longStackTraces&&p()){var n=t.prototype._captureStackTrace,r=t.prototype._attachExtraTrace;u.longStackTraces=!0;k=function(){if(f.haveItemsQueued()&&!u.longStackTraces)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/MqrFmX\n");t.prototype._captureStackTrace=n;t.prototype._attachExtraTrace=r;i.deactivateLongStackTraces();f.enableTrampoline();u.longStackTraces=!1};t.prototype._captureStackTrace=ti;t.prototype._attachExtraTrace=ii;i.activateLongStackTraces();f.disableTrampolineIfNecessary()}};t.hasLongStackTraces=function(){return u.longStackTraces&&p()};var at=function(){var n;try{return"function"==typeof CustomEvent?(n=new CustomEvent("CustomEvent"),r.global.dispatchEvent(n),function(n,t){var i=new CustomEvent(n.toLowerCase(),{detail:t,cancelable:!0});return!r.global.dispatchEvent(i)}):"function"==typeof Event?(n=new Event("CustomEvent"),r.global.dispatchEvent(n),function(n,t){var i=new Event(n.toLowerCase(),{cancelable:!0});return i.detail=t,!r.global.dispatchEvent(i)}):(n=document.createEvent("CustomEvent"),n.initCustomEvent("testingtheevent",!1,!0,{}),r.global.dispatchEvent(n),function(n,t){var i=document.createEvent("CustomEvent");return i.initCustomEvent(n.toLowerCase(),!1,!0,t),!r.global.dispatchEvent(i)})}catch(t){}return function(){return!1}}(),vt=function(){return r.isNode?function(){return process.emit.apply(process,arguments)}:r.global?function(n){var i="on"+n.toLowerCase(),t=r.global[i];return t?(t.apply(r.global,[].slice.call(arguments,1)),!0):!1}:function(){return!1}}(),wi={promiseCreated:o,promiseFulfilled:o,promiseRejected:o,promiseResolved:o,promiseCancelled:o,promiseChained:function(n,t,i){return{promise:t,child:i}},warning:function(n,t){return{warning:t}},unhandledRejection:function(n,t,i){return{reason:t,promise:i}},rejectionHandled:o},l=function(n){var i=!1,t;try{i=vt.apply(null,arguments)}catch(r){f.throwLater(r);i=!0}t=!1;try{t=at(n,wi[n].apply(null,arguments))}catch(r){f.throwLater(r);t=!0}return t||i};t.config=function(n){if(n=Object(n),"longStackTraces"in n&&(n.longStackTraces?t.longStackTraces():!n.longStackTraces&&t.hasLongStackTraces()&&k()),"warnings"in n){var i=n.warnings;u.warnings=!!i;b=u.warnings;r.isObject(i)&&"wForgottenReturn"in i&&(b=!!i.wForgottenReturn)}if("cancellation"in n&&n.cancellation&&!u.cancellation){if(f.haveItemsQueued())throw new Error("cannot enable cancellation after promises are in use");t.prototype._clearCancellationData=dt;t.prototype._propagateFrom=tt;t.prototype._onCancel=bt;t.prototype._setOnCancel=kt;t.prototype._attachCancellationCallback=wt;t.prototype._execute=pt;yt=tt;u.cancellation=!0}return"monitoring"in n&&(n.monitoring&&!u.monitoring?(u.monitoring=!0,t.prototype._fireEvent=l):!n.monitoring&&u.monitoring&&(u.monitoring=!1,t.prototype._fireEvent=nt)),t};t.prototype._fireEvent=nt;t.prototype._execute=function(n,t,i){try{n(t,i)}catch(r){return r}};t.prototype._onCancel=function(){};t.prototype._setOnCancel=function(){};t.prototype._attachCancellationCallback=function(){};t.prototype._captureStackTrace=function(){};t.prototype._attachExtraTrace=function(){};t.prototype._clearCancellationData=function(){};t.prototype._propagateFrom=function(){};var yt=gt,d=function(){return!1},bi=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;return r.inherits(e,Error),i.CapturedTrace=e,e.prototype.uncycle=function(){var u=this._length,s,n,c,i,r,h,e;if(!(2>u)){for(var t=[],o={},n=0,f=this;void 0!==f;++n)t.push(f),f=f._parent;for(u=this._length=n,n=u-1;n>=0;--n)s=t[n].stack,void 0===o[s]&&(o[s]=n);for(n=0;u>n;++n)if(c=t[n].stack,i=o[c],void 0!==i&&i!==n){for(i>0&&(t[i-1]._parent=void 0,t[i-1]._length=1),t[n]._parent=void 0,t[n]._length=1,r=n>0?t[n-1]:this,u-1>i?(r._parent=t[i+1],r._parent.uncycle(),r._length=r._parent._length+1):(r._parent=void 0,r._length=1),h=r._length+1,e=n-2;e>=0;--e)t[e]._length=h,h++;return}}},e.prototype.attachExtraTrace=function(n){if(!n.__stackCleaned__){this.uncycle();for(var u=y(n),f=u.message,t=[u.stack],i=this;void 0!==i;)t.push(v(i.stack.split("\n"))),i=i._parent;oi(t);ei(t);r.notEnumerableProp(n,"stack",fi(f,t));r.notEnumerableProp(n,"__stackCleaned__",!0)}},g=function(){var i=/^\s*at\s*/,t=function(n,t){return"string"==typeof n?n:void 0!==t.name&&void 0!==t.message?t.toString():ut(t)},r,n,u;if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace)return Error.stackTraceLimit+=6,h=i,c=t,r=Error.captureStackTrace,d=function(n){return st.test(n)},function(n,t){Error.stackTraceLimit+=6;r(n,t);Error.stackTraceLimit-=6};if(n=new Error,"string"==typeof n.stack&&n.stack.split("\n")[0].indexOf("stackDetection@")>=0)return h=/@/,c=t,ht=!0,function(n){n.stack=(new Error).stack};try{throw new Error;}catch(f){u="stack"in f}return"stack"in n||!u||"number"!=typeof Error.stackTraceLimit?(c=function(n,t){return"string"==typeof n?n:"object"!=typeof t&&"function"!=typeof t||void 0===t.name||void 0===t.message?ut(t):t.toString()},null):(h=i,c=t,function(n){Error.stackTraceLimit+=6;try{throw new Error;}catch(t){n.stack=t.stack}Error.stackTraceLimit-=6})}([]),"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(s=function(n){console.warn(n)},r.isNode&&process.stderr.isTTY?s=function(n,t){var i=t?"\x1b[33m":"\x1b[31m";console.warn(i+n+"\x1b[0m\n")}:r.isNode||"string"!=typeof(new Error).stack||(s=function(n,t){console.warn("%c"+n,t?"color: darkorange":"color: red")})),u={warnings:lt,longStackTraces:!1,cancellation:!1,monitoring:!1},pi&&t.longStackTraces(),{longStackTraces:function(){return u.longStackTraces},warnings:function(){return u.warnings},cancellation:function(){return u.cancellation},monitoring:function(){return u.monitoring},propagateFromFunction:function(){return yt},boundValueFunction:function(){return ni},checkForgottenReturns:ri,setBounds:ci,warn:a,deprecated:ui,CapturedTrace:e,fireDomEvent:at,fireGlobalEvent:vt}}},{"./errors":12,"./util":36}],10:[function(n,t){"use strict";t.exports=function(n){function t(){return this.value}function i(){throw this.reason;}n.prototype["return"]=n.prototype.thenReturn=function(i){return i instanceof n&&i.suppressUnhandledRejections(),this._then(t,void 0,void 0,{value:i},void 0)};n.prototype["throw"]=n.prototype.thenThrow=function(n){return this._then(i,void 0,void 0,{reason:n},void 0)};n.prototype.catchThrow=function(n){if(arguments.length<=1)return this._then(void 0,i,void 0,{reason:n},void 0);var t=arguments[1],r=function(){throw t;};return this.caught(n,r)};n.prototype.catchReturn=function(i){var r,u;return arguments.length<=1?(i instanceof n&&i.suppressUnhandledRejections(),this._then(void 0,t,void 0,{value:i},void 0)):(r=arguments[1],r instanceof n&&r.suppressUnhandledRejections(),u=function(){return r},this.caught(i,u))}}},{}],11:[function(n,t){"use strict";t.exports=function(n,t){function r(){return f(this)}function u(n,r){return i(n,r,t,t)}var i=n.reduce,f=n.all;n.prototype.each=function(n){return i(this,n,t,0)._then(r,void 0,void 0,this,void 0)};n.prototype.mapSeries=function(n){return i(this,n,t,t)};n.each=function(n,u){return i(n,u,t,0)._then(r,void 0,void 0,n,void 0)};n.mapSeries=u}},{}],12:[function(n,t){"use strict";function r(n,t){function i(r){return this instanceof i?(u(this,"message","string"==typeof r?r:t),u(this,"name",n),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new i(r)}return y(i,Error),i}function e(n){return this instanceof e?(u(this,"name","OperationalError"),u(this,"message",n),this.cause=n,this.isOperational=!0,void(n instanceof Error?(u(this,"message",n.message),u(this,"stack",n.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new e(n)}var c,l,a=n("./es5"),p=a.freeze,v=n("./util"),y=v.inherits,u=v.notEnumerableProp,w=r("Warning","warning"),b=r("CancellationError","cancellation error"),k=r("TimeoutError","timeout error"),o=r("AggregateError","aggregate error"),s,f,h,i;try{c=TypeError;l=RangeError}catch(d){c=r("TypeError","type error");l=r("RangeError","range error")}for(s="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),f=0;f<s.length;++f)"function"==typeof Array.prototype[s[f]]&&(o.prototype[s[f]]=Array.prototype[s[f]]);a.defineProperty(o.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0});o.prototype.isOperational=!0;h=0;o.prototype.toString=function(){var r=Array(4*h+1).join(" "),f="\n"+r+"AggregateError of:\n",n;for(h++,r=Array(4*h+1).join(" "),n=0;n<this.length;++n){for(var u=this[n]===this?"[Circular AggregateError]":this[n]+"",t=u.split("\n"),i=0;i<t.length;++i)t[i]=r+t[i];u=t.join("\n");f+=u+"\n"}return h--,f};y(e,Error);i=Error.__BluebirdErrorTypes__;i||(i=p({CancellationError:b,TimeoutError:k,OperationalError:e,RejectionError:e,AggregateError:o}),a.defineProperty(Error,"__BluebirdErrorTypes__",{value:i,writable:!1,enumerable:!1,configurable:!1}));t.exports={Error:Error,TypeError:c,RangeError:l,CancellationError:i.CancellationError,OperationalError:i.OperationalError,TimeoutError:i.TimeoutError,AggregateError:i.AggregateError,Warning:w}},{"./es5":13,"./util":36}],13:[function(n,t){var i=function(){"use strict";return void 0===this}();if(i)t.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:i,propertyIsWritable:function(n,t){var i=Object.getOwnPropertyDescriptor(n,t);return!(i&&!i.writable&&!i.set)}};else{var u={}.hasOwnProperty,f={}.toString,e={}.constructor.prototype,r=function(n){var t=[];for(var i in n)u.call(n,i)&&t.push(i);return t},o=function(n,t){return{value:n[t]}},s=function(n,t,i){return n[t]=i.value,n},h=function(n){return n},c=function(n){try{return Object(n).constructor.prototype}catch(t){return e}},l=function(n){try{return"[object Array]"===f.call(n)}catch(t){return!1}};t.exports={isArray:l,keys:r,names:r,defineProperty:s,getDescriptor:o,freeze:h,getPrototypeOf:c,isES5:i,propertyIsWritable:function(){return!0}}}},{}],14:[function(n,t){"use strict";t.exports=function(n,t){var i=n.map;n.prototype.filter=function(n,r){return i(this,n,r,t)};n.filter=function(n,r,u){return i(n,r,u,t)}}},{}],15:[function(n,t){"use strict";t.exports=function(t,i,r){function o(n,t,i){this.promise=n;this.type=t;this.handler=i;this.called=!1;this.cancelPromise=null}function h(n){this.finallyHandler=n}function e(n,t){return null!=n.cancelPromise?(arguments.length>1?n.cancelPromise._reject(t):n.cancelPromise._cancel(),n.cancelPromise=null,!0):!1}function c(){return u.call(this,this.promise._target()._settledValue())}function l(n){if(!e(this,n))return(f.e=n,f)}function u(n){var u=this.promise,y=this.handler,s,o,v;if(!this.called){if(this.called=!0,s=this.isFinallyHandler()?y.call(u._boundValue()):y.call(u._boundValue(),n),s===r)return s;if(void 0!==s&&(u._setReturnedNonUndefined(),o=i(s,u),o instanceof t)){if(null!=this.cancelPromise){if(o._isCancelled())return v=new a("late cancellation observer"),u._attachExtraTrace(v),f.e=v,f;o.isPending()&&o._attachCancellationCallback(new h(this))}return o._then(c,l,void 0,this,void 0)}}return u.isRejected()?(e(this),f.e=n,f):(e(this),n)}var s=n("./util"),a=t.CancellationError,f=s.errorObj,v=n("./catch_filter")(r);return o.prototype.isFinallyHandler=function(){return 0===this.type},h.prototype._resultCancelled=function(){e(this.finallyHandler)},t.prototype._passThrough=function(n,t,i,r){return"function"!=typeof n?this.then():this._then(i,r,void 0,new o(this,t,n),void 0)},t.prototype.lastly=t.prototype["finally"]=function(n){return this._passThrough(n,0,u,u)},t.prototype.tap=function(n){return this._passThrough(n,1,u)},t.prototype.tapCatch=function(n){var e=arguments.length,i,r,o,f,h;if(1===e)return this._passThrough(n,1,void 0,u);for(r=new Array(e-1),o=0,i=0;e-1>i;++i){if(f=arguments[i],!s.isObject(f))return t.reject(new TypeError("tapCatch statement predicate: expecting an object but got "+s.classString(f)));r[o++]=f}return r.length=o,h=arguments[i],this._passThrough(v(r,h,this),1,void 0,u)},o}},{"./catch_filter":7,"./util":36}],16:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function v(n,i,r){for(var e,h,o,f=0;f<i.length;++f){if(r._pushContext(),e=s(i[f])(n),r._popContext(),e===l)return r._pushContext(),h=t.reject(l.e),r._popContext(),h;if(o=u(e,r),o instanceof t)return o}return null}function o(n,i,u,f){var o,s,h;e.cancellation()?(o=new t(r),s=this._finallyPromise=new t(r),this._promise=o.lastly(function(){return s}),o._captureStackTrace(),o._setOnCancel(this)):(h=this._promise=new t(r),h._captureStackTrace());this._stack=f;this._generatorFunction=n;this._receiver=i;this._generator=void 0;this._yieldHandlers="function"==typeof u?[u].concat(a):a;this._yieldedPromise=null;this._cancellationPhase=!1}var y=n("./errors"),c=y.TypeError,h=n("./util"),l=h.errorObj,s=h.tryCatch,a=[];h.inherits(o,f);o.prototype._isResolved=function(){return null===this._promise};o.prototype._cleanup=function(){this._promise=this._generator=null;e.cancellation()&&null!==this._finallyPromise&&(this._finallyPromise._fulfill(),this._finallyPromise=null)};o.prototype._promiseCancelled=function(){var i,r,n;this._isResolved()||(r="undefined"!=typeof this._generator["return"],r?(this._promise._pushContext(),i=s(this._generator["return"]).call(this._generator,void 0),this._promise._popContext()):(n=new t.CancellationError("generator .return() sentinel"),t.coroutine.returnSentinel=n,this._promise._attachExtraTrace(n),this._promise._pushContext(),i=s(this._generator["throw"]).call(this._generator,n),this._promise._popContext()),this._cancellationPhase=!0,this._yieldedPromise=null,this._continue(i))};o.prototype._promiseFulfilled=function(n){this._yieldedPromise=null;this._promise._pushContext();var t=s(this._generator.next).call(this._generator,n);this._promise._popContext();this._continue(t)};o.prototype._promiseRejected=function(n){this._yieldedPromise=null;this._promise._attachExtraTrace(n);this._promise._pushContext();var t=s(this._generator["throw"]).call(this._generator,n);this._promise._popContext();this._continue(t)};o.prototype._resultCancelled=function(){if(this._yieldedPromise instanceof t){var n=this._yieldedPromise;this._yieldedPromise=null;n.cancel()}};o.prototype.promise=function(){return this._promise};o.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver);this._receiver=this._generatorFunction=void 0;this._promiseFulfilled(void 0)};o.prototype._continue=function(n){var r=this._promise,f,i,e;if(n===l)return this._cleanup(),this._cancellationPhase?r.cancel():r._rejectCallback(n.e,!1);if(f=n.value,n.done===!0)return this._cleanup(),this._cancellationPhase?r.cancel():r._resolveCallback(f);if(i=u(f,this._promise),!(i instanceof t)&&(i=v(i,this._yieldHandlers,this._promise),null===i))return void this._promiseRejected(new c("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/MqrFmX\n\n".replace("%s",String(f))+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));i=i._target();e=i._bitField;0==(50397184&e)?(this._yieldedPromise=i,i._proxy(this,null)):0!=(33554432&e)?t._async.invoke(this._promiseFulfilled,this,i._value()):0!=(16777216&e)?t._async.invoke(this._promiseRejected,this,i._reason()):this._promiseCancelled()};t.coroutine=function(n,t){if("function"!=typeof n)throw new c("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var i=Object(t).yieldHandler,r=o,u=(new Error).stack;return function(){var f=n.apply(this,arguments),t=new r(void 0,void 0,i,u),e=t.promise();return t._generator=f,t._promiseFulfilled(void 0),e}};t.coroutine.addYieldHandler=function(n){if("function"!=typeof n)throw new c("expecting a function but got "+h.classString(n));a.push(n)};t.spawn=function(n){if(e.deprecated("Promise.spawn()","Promise.coroutine()"),"function"!=typeof n)return i("generatorFunction must be a function\n\n    See http://goo.gl/MqrFmX\n");var r=new o(n,this),u=r.promise();return r._run(t.spawn),u}}},{"./errors":12,"./util":36}],17:[function(n,t){"use strict";t.exports=function(t,i){var r=n("./util");r.canEvaluate;r.tryCatch;r.errorObj;t.join=function(){var n,t=arguments.length-1,u,r;return t>0&&"function"==typeof arguments[t]&&(n=arguments[t]),u=[].slice.call(arguments),n&&u.pop(),r=new i(u).promise(),void 0!==n?r.spread(n):r}}},{"./util":36}],18:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function o(n,t,i,r){this.constructor$(n);this._promise._captureStackTrace();var u=c();this._callback=null===u?t:s.domainBind(u,t);this._preservedValues=r===f?new Array(this.length()):null;this._limit=i;this._inFlight=0;this._queue=[];v.invoke(this._asyncInit,this,void 0)}function h(n,i,u,f){if("function"!=typeof i)return r("expecting a function but got "+s.classString(i));var e=0;if(void 0!==u){if("object"!=typeof u||null===u)return t.reject(new TypeError("options argument must be an object but it is "+s.classString(u)));if("number"!=typeof u.concurrency)return t.reject(new TypeError("'concurrency' must be a number but it is "+s.classString(u.concurrency)));e=u.concurrency}return e="number"==typeof e&&isFinite(e)&&e>=1?e:0,new o(n,i,e,f).promise()}var c=t._getDomain,s=n("./util"),l=s.tryCatch,a=s.errorObj,v=t._async;s.inherits(o,i);o.prototype._asyncInit=function(){this._init$(void 0,-2)};o.prototype._init=function(){};o.prototype._promiseFulfilled=function(n,i){var o=this._values,y=this.length(),s=this._preservedValues,h=this._limit,f,p,r,v,w;if(0>i){if(i=-1*i-1,o[i]=n,h>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return!0}else{if(h>=1&&this._inFlight>=h)return o[i]=n,this._queue.push(i),!1;null!==s&&(s[i]=n);var c=this._promise,b=this._callback,k=c._boundValue();if(c._pushContext(),f=l(b).call(k,n,i,y),p=c._popContext(),e.checkForgottenReturns(f,p,null!==s?"Promise.filter":"Promise.map",c),f===a)return this._reject(f.e),!0;if(r=u(f,this._promise),r instanceof t){if(r=r._target(),v=r._bitField,0==(50397184&v))return h>=1&&this._inFlight++,o[i]=r,r._proxy(this,-1*(i+1)),!1;if(0==(33554432&v))return 0!=(16777216&v)?(this._reject(r._reason()),!0):(this._cancel(),!0);f=r._value()}o[i]=f}return w=++this._totalResolved,w>=y?(null!==s?this._filter(o,s):this._resolve(o),!0):!1};o.prototype._drainQueue=function(){for(var n,t=this._queue,i=this._limit,r=this._values;t.length>0&&this._inFlight<i;){if(this._isResolved())return;n=t.pop();this._promiseFulfilled(r[n],n)}};o.prototype._filter=function(n,t){for(var u=t.length,r=new Array(u),f=0,i=0;u>i;++i)n[i]&&(r[f++]=t[i]);r.length=f;this._resolve(r)};o.prototype.preservedValues=function(){return this._preservedValues};t.prototype.map=function(n,t){return h(this,n,t,null)};t.map=function(n,t,i,r){return h(n,t,i,r)}}},{"./util":36}],19:[function(n,t){"use strict";t.exports=function(t,i,r,u,f){var e=n("./util"),o=e.tryCatch;t.method=function(n){if("function"!=typeof n)throw new t.TypeError("expecting a function but got "+e.classString(n));return function(){var r=new t(i),u,e;return r._captureStackTrace(),r._pushContext(),u=o(n).apply(this,arguments),e=r._popContext(),f.checkForgottenReturns(u,e,"Promise.method",r),r._resolveFromSyncValue(u),r}};t.attempt=t["try"]=function(n){var r,s,h,c,l;return"function"!=typeof n?u("expecting a function but got "+e.classString(n)):(r=new t(i),r._captureStackTrace(),r._pushContext(),arguments.length>1?(f.deprecated("calling Promise.try with more than 1 argument"),h=arguments[1],c=arguments[2],s=e.isArray(h)?o(n).apply(c,h):o(n).call(c,h)):s=o(n)(),l=r._popContext(),f.checkForgottenReturns(s,l,"Promise.try",r),r._resolveFromSyncValue(s),r)};t.prototype._resolveFromSyncValue=function(n){n===e.errorObj?this._rejectCallback(n.e,!1):this._resolveCallback(n,!0)}}},{"./util":36}],20:[function(n,t){"use strict";function u(n){return n instanceof Error&&r.getPrototypeOf(n)===Error.prototype}function f(n){var t,o,f,e;if(u(n)){for(t=new h(n),t.name=n.name,t.message=n.message,t.stack=n.stack,o=r.keys(n),f=0;f<o.length;++f)e=o[f],c.test(e)||(t[e]=n[e]);return t}return i.markAsOriginatingFromRejection(n),n}function e(n,t){return function(i,r){var u,e;null!==n&&(i?(u=f(o(i)),n._attachExtraTrace(u),n._reject(u)):t?(e=[].slice.call(arguments,1),n._fulfill(e)):n._fulfill(r),n=null)}}var i=n("./util"),o=i.maybeWrapAsError,s=n("./errors"),h=s.OperationalError,r=n("./es5"),c=/^(?:name|message|stack|cause)$/;t.exports=e},{"./errors":12,"./es5":13,"./util":36}],21:[function(n,t){"use strict";t.exports=function(t){function o(n,t){var s=this,o;if(!r.isArray(n))return e.call(s,n,t);o=i(t).apply(s._boundValue(),[null].concat(n));o===f&&u.throwLater(o.e)}function e(n,t){var o=this,r=o._boundValue(),e=void 0===n?i(t).call(r,null):i(t).call(r,null,n);e===f&&u.throwLater(e.e)}function s(n,t){var o=this,r,e;n||(r=new Error(n+""),r.cause=n,n=r);e=i(t).call(o._boundValue(),n);e===f&&u.throwLater(e.e)}var r=n("./util"),u=t._async,i=r.tryCatch,f=r.errorObj;t.prototype.asCallback=t.prototype.nodeify=function(n,t){if("function"==typeof n){var i=e;void 0!==t&&Object(t).spread&&(i=o);this._then(i,s,void 0,this,n)}return this}}},{"./util":36}],22:[function(n,t){"use strict";t.exports=function(){function y(){}function ut(n,t){if(null==n||n.constructor!==i)throw new a("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/MqrFmX\n");if("function"!=typeof t)throw new a("expecting a function but got "+r.classString(t));}function i(n){n!==u&&ut(this,n);this._bitField=0;this._fulfillmentHandler0=void 0;this._rejectionHandler0=void 0;this._promise0=void 0;this._receiver0=void 0;this._resolveFromExecutor(n);this._promiseCreated();this._fireEvent("promiseCreated",this)}function ft(n){this.promise._resolveCallback(n)}function et(n){this.promise._rejectCallback(n,!1)}function h(n){var t=new i(u);t._fulfillmentHandler0=n;t._rejectionHandler0=n;t._promise0=n;t._receiver0=n}var p,w=function(){return new a("circular promise resolution chain\n\n    See http://goo.gl/MqrFmX\n")},b=function(){return new i.PromiseInspection(this._target())},o=function(n){return i.reject(new a(n))},d={},r=n("./util"),l,a,g;p=r.isNode?function(){var n=process.domain;return void 0===n&&(n=null),n}:function(){return null};r.notEnumerableProp(i,"_getDomain",p);var ot=n("./es5"),tt=n("./async"),c=new tt;ot.defineProperty(i,"_async",{value:c});l=n("./errors");a=i.TypeError=l.TypeError;i.RangeError=l.RangeError;g=i.CancellationError=l.CancellationError;i.TimeoutError=l.TimeoutError;i.OperationalError=l.OperationalError;i.RejectionError=l.OperationalError;i.AggregateError=l.AggregateError;var u=function(){},it={},nt={},e=n("./thenables")(i,u),s=n("./promise_array")(i,u,e,o,y),rt=n("./context")(i),st=rt.create,f=n("./debuggability")(i,rt),ht=(f.CapturedTrace,n("./finally")(i,e,nt)),ct=n("./catch_filter")(nt),lt=n("./nodeback"),v=r.errorObj,k=r.tryCatch;return i.prototype.toString=function(){return"[object Promise]"},i.prototype.caught=i.prototype["catch"]=function(n){var f=arguments.length,t,i,e,u;if(f>1){for(i=new Array(f-1),e=0,t=0;f-1>t;++t){if(u=arguments[t],!r.isObject(u))return o("Catch statement predicate: expecting an object but got "+r.classString(u));i[e++]=u}return i.length=e,n=arguments[t],this.then(void 0,ct(i,n,this))}return this.then(void 0,n)},i.prototype.reflect=function(){return this._then(b,b,void 0,this,void 0)},i.prototype.then=function(n,t){if(f.warnings()&&arguments.length>0&&"function"!=typeof n&&"function"!=typeof t){var i=".then() only accepts functions but was passed: "+r.classString(n);arguments.length>1&&(i+=", "+r.classString(t));this._warn(i)}return this._then(n,t,void 0,void 0,void 0)},i.prototype.done=function(n,t){var i=this._then(n,t,void 0,void 0,void 0);i._setIsFinal()},i.prototype.spread=function(n){return"function"!=typeof n?o("expecting a function but got "+r.classString(n)):this.all()._then(n,void 0,void 0,it,void 0)},i.prototype.toJSON=function(){var n={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(n.fulfillmentValue=this.value(),n.isFulfilled=!0):this.isRejected()&&(n.rejectionReason=this.reason(),n.isRejected=!0),n},i.prototype.all=function(){return arguments.length>0&&this._warn(".all() was passed arguments but it does not take any"),new s(this).promise()},i.prototype.error=function(n){return this.caught(r.originatesFromRejection,n)},i.getNewLibraryCopy=t.exports,i.is=function(n){return n instanceof i},i.fromNode=i.fromCallback=function(n){var t=new i(u),f,r;return t._captureStackTrace(),f=arguments.length>1?!!Object(arguments[1]).multiArgs:!1,r=k(n)(lt(t,f)),r===v&&t._rejectCallback(r.e,!0),t._isFateSealed()||t._setAsyncGuaranteed(),t},i.all=function(n){return new s(n).promise()},i.cast=function(n){var t=e(n);return t instanceof i||(t=new i(u),t._captureStackTrace(),t._setFulfilled(),t._rejectionHandler0=n),t},i.resolve=i.fulfilled=i.cast,i.reject=i.rejected=function(n){var t=new i(u);return t._captureStackTrace(),t._rejectCallback(n,!0),t},i.setScheduler=function(n){if("function"!=typeof n)throw new a("expecting a function but got "+r.classString(n));return c.setScheduler(n)},i.prototype._then=function(n,t,f,e,o){var b=void 0!==o,h=b?o:new i(u),s=this._target(),v=s._bitField,y,l,a,w;return b||(h._propagateFrom(this,3),h._captureStackTrace(),void 0===e&&0!=(2097152&this._bitField)&&(e=0!=(50397184&v)?this._boundValue():s===this?void 0:this._boundTo),this._fireEvent("promiseChained",this,h)),y=p(),0!=(50397184&v)?(w=s._settlePromiseCtx,0!=(33554432&v)?(a=s._rejectionHandler0,l=n):0!=(16777216&v)?(a=s._fulfillmentHandler0,l=t,s._unsetRejectionIsUnhandled()):(w=s._settlePromiseLateCancellationObserver,a=new g("late cancellation observer"),s._attachExtraTrace(a),l=t),c.invoke(w,s,{handler:null===y?l:"function"==typeof l&&r.domainBind(y,l),promise:h,receiver:e,value:a})):s._addCallbacks(n,t,h,e,y),h},i.prototype._length=function(){return 65535&this._bitField},i.prototype._isFateSealed=function(){return 0!=(117506048&this._bitField)},i.prototype._isFollowing=function(){return 67108864==(67108864&this._bitField)},i.prototype._setLength=function(n){this._bitField=-65536&this._bitField|65535&n},i.prototype._setFulfilled=function(){this._bitField=33554432|this._bitField;this._fireEvent("promiseFulfilled",this)},i.prototype._setRejected=function(){this._bitField=16777216|this._bitField;this._fireEvent("promiseRejected",this)},i.prototype._setFollowing=function(){this._bitField=67108864|this._bitField;this._fireEvent("promiseResolved",this)},i.prototype._setIsFinal=function(){this._bitField=4194304|this._bitField},i.prototype._isFinal=function(){return(4194304&this._bitField)>0},i.prototype._unsetCancelled=function(){this._bitField=-65537&this._bitField},i.prototype._setCancelled=function(){this._bitField=65536|this._bitField;this._fireEvent("promiseCancelled",this)},i.prototype._setWillBeCancelled=function(){this._bitField=8388608|this._bitField},i.prototype._setAsyncGuaranteed=function(){c.hasCustomScheduler()||(this._bitField=134217728|this._bitField)},i.prototype._receiverAt=function(n){var t=0===n?this._receiver0:this[4*n-1];if(t!==d)return void 0===t&&this._isBound()?this._boundValue():t},i.prototype._promiseAt=function(n){return this[4*n-2]},i.prototype._fulfillmentHandlerAt=function(n){return this[4*n-4]},i.prototype._rejectionHandlerAt=function(n){return this[4*n-3]},i.prototype._boundValue=function(){},i.prototype._migrateCallback0=function(n){var i=(n._bitField,n._fulfillmentHandler0),r=n._rejectionHandler0,u=n._promise0,t=n._receiverAt(0);void 0===t&&(t=d);this._addCallbacks(i,r,u,t,null)},i.prototype._migrateCallbackAt=function(n,t){var r=n._fulfillmentHandlerAt(t),u=n._rejectionHandlerAt(t),f=n._promiseAt(t),i=n._receiverAt(t);void 0===i&&(i=d);this._addCallbacks(r,u,f,i,null)},i.prototype._addCallbacks=function(n,t,i,u,f){var e=this._length(),o;return(e>=65531&&(e=0,this._setLength(0)),0===e)?(this._promise0=i,this._receiver0=u,"function"==typeof n&&(this._fulfillmentHandler0=null===f?n:r.domainBind(f,n)),"function"==typeof t&&(this._rejectionHandler0=null===f?t:r.domainBind(f,t))):(o=4*e-4,this[o+2]=i,this[o+3]=u,"function"==typeof n&&(this[o+0]=null===f?n:r.domainBind(f,n)),"function"==typeof t&&(this[o+1]=null===f?t:r.domainBind(f,t))),this._setLength(e+1),e},i.prototype._proxy=function(n,t){this._addCallbacks(void 0,void 0,t,n,null)},i.prototype._resolveCallback=function(n,t){var u,r,f,s,o,h;if(0==(117506048&this._bitField)){if(n===this)return this._rejectCallback(w(),!1);if(u=e(n,this),!(u instanceof i))return this._fulfill(n);if(t&&this._propagateFrom(u,2),r=u._target(),r===this)return void this._reject(w());if(f=r._bitField,0==(50397184&f)){for(s=this._length(),s>0&&r._migrateCallback0(this),o=1;s>o;++o)r._migrateCallbackAt(this,o);this._setFollowing();this._setLength(0);this._setFollowee(r)}else 0!=(33554432&f)?this._fulfill(r._value()):0!=(16777216&f)?this._reject(r._reason()):(h=new g("late cancellation observer"),r._attachExtraTrace(h),this._reject(h))}},i.prototype._rejectCallback=function(n,t,i){var u=r.ensureErrorObject(n),e=u===n,o;e||i||!f.warnings()||(o="a promise was rejected with a non-error: "+r.classString(n),this._warn(o,!0));this._attachExtraTrace(u,t?e:!1);this._reject(n)},i.prototype._resolveFromExecutor=function(n){var t,i,r;n!==u&&(t=this,this._captureStackTrace(),this._pushContext(),i=!0,r=this._execute(n,function(n){t._resolveCallback(n)},function(n){t._rejectCallback(n,i)}),i=!1,this._popContext(),void 0!==r&&t._rejectCallback(r,!0))},i.prototype._settlePromiseFromHandler=function(n,t,i,u){var o=u._bitField,e,s;0==(65536&o)&&(u._pushContext(),t===it?i&&"number"==typeof i.length?e=k(n).apply(this._boundValue(),i):(e=v,e.e=new a("cannot .spread() a non-array: "+r.classString(i))):e=k(n).call(t,i),s=u._popContext(),o=u._bitField,0==(65536&o)&&(e===nt?u._reject(i):e===v?u._rejectCallback(e.e,!1):(f.checkForgottenReturns(e,s,"",u,this),u._resolveCallback(e))))},i.prototype._target=function(){for(var n=this;n._isFollowing();)n=n._followee();return n},i.prototype._followee=function(){return this._rejectionHandler0},i.prototype._setFollowee=function(n){this._rejectionHandler0=n},i.prototype._settlePromise=function(n,t,r,u){var f=n instanceof i,e=this._bitField,o=0!=(134217728&e);0!=(65536&e)?(f&&n._invokeInternalOnCancel(),r instanceof ht&&r.isFinallyHandler()?(r.cancelPromise=n,k(t).call(r,u)===v&&n._reject(v.e)):t===b?n._fulfill(b.call(r)):r instanceof y?r._promiseCancelled(n):f||n instanceof s?n._cancel():r.cancel()):"function"==typeof t?f?(o&&n._setAsyncGuaranteed(),this._settlePromiseFromHandler(t,r,u,n)):t.call(r,u,n):r instanceof y?r._isResolved()||(0!=(33554432&e)?r._promiseFulfilled(u,n):r._promiseRejected(u,n)):f&&(o&&n._setAsyncGuaranteed(),0!=(33554432&e)?n._fulfill(u):n._reject(u))},i.prototype._settlePromiseLateCancellationObserver=function(n){var r=n.handler,t=n.promise,f=n.receiver,u=n.value;"function"==typeof r?t instanceof i?this._settlePromiseFromHandler(r,f,u,t):r.call(f,u,t):t instanceof i&&t._reject(u)},i.prototype._settlePromiseCtx=function(n){this._settlePromise(n.promise,n.handler,n.receiver,n.value)},i.prototype._settlePromise0=function(n,t){var i=this._promise0,r=this._receiverAt(0);this._promise0=void 0;this._receiver0=void 0;this._settlePromise(i,n,r,t)},i.prototype._clearCallbackDataAtIndex=function(n){var t=4*n-4;this[t+2]=this[t+3]=this[t+0]=this[t+1]=void 0},i.prototype._fulfill=function(n){var t=this._bitField,i;if(!((117506048&t)>>>16)){if(n===this)return i=w(),this._attachExtraTrace(i),this._reject(i);this._setFulfilled();this._rejectionHandler0=n;(65535&t)>0&&(0!=(134217728&t)?this._settlePromises():c.settlePromises(this))}},i.prototype._reject=function(n){var t=this._bitField;if(!((117506048&t)>>>16))return this._setRejected(),this._fulfillmentHandler0=n,this._isFinal()?c.fatalError(n,r.isNode):void((65535&t)>0?c.settlePromises(this):this._ensurePossibleRejectionHandled())},i.prototype._fulfillPromises=function(n,t){for(var i=1;n>i;i++){var r=this._fulfillmentHandlerAt(i),u=this._promiseAt(i),f=this._receiverAt(i);this._clearCallbackDataAtIndex(i);this._settlePromise(u,r,f,t)}},i.prototype._rejectPromises=function(n,t){for(var i=1;n>i;i++){var r=this._rejectionHandlerAt(i),u=this._promiseAt(i),f=this._receiverAt(i);this._clearCallbackDataAtIndex(i);this._settlePromise(u,r,f,t)}},i.prototype._settlePromises=function(){var n=this._bitField,t=65535&n,i,r;t>0&&(0!=(16842752&n)?(i=this._fulfillmentHandler0,this._settlePromise0(this._rejectionHandler0,i,n),this._rejectPromises(t,i)):(r=this._rejectionHandler0,this._settlePromise0(this._fulfillmentHandler0,r,n),this._fulfillPromises(t,r)),this._setLength(0));this._clearCancellationData()},i.prototype._settledValue=function(){var n=this._bitField;return 0!=(33554432&n)?this._rejectionHandler0:0!=(16777216&n)?this._fulfillmentHandler0:void 0},i.defer=i.pending=function(){f.deprecated("Promise.defer","new Promise");var n=new i(u);return{promise:n,resolve:ft,reject:et}},r.notEnumerableProp(i,"_makeSelfResolutionError",w),n("./method")(i,u,e,o,f),n("./bind")(i,u,e,f),n("./cancel")(i,s,o,f),n("./direct_resolve")(i),n("./synchronous_inspection")(i),n("./join")(i,s,e,u,c,p),i.Promise=i,i.version="3.5.0",n("./map.js")(i,s,o,e,u,f),n("./call_get.js")(i),n("./using.js")(i,o,e,st,u,f),n("./timers.js")(i,u,f),n("./generators.js")(i,o,u,e,y,f),n("./nodeify.js")(i),n("./promisify.js")(i,u),n("./props.js")(i,s,e,o),n("./race.js")(i,u,e,o),n("./reduce.js")(i,s,o,e,u,f),n("./settle.js")(i,s,f),n("./some.js")(i,s,o),n("./filter.js")(i,u),n("./each.js")(i,u),n("./any.js")(i),r.toFastProperties(i),r.toFastProperties(i.prototype),h({a:1}),h({b:2}),h({c:3}),h(1),h(function(){}),h(void 0),h(!1),h(new i(u)),f.setBounds(tt.firstLineError,r.lastLineError),i}},{"./any.js":1,"./async":2,"./bind":3,"./call_get.js":5,"./cancel":6,"./catch_filter":7,"./context":8,"./debuggability":9,"./direct_resolve":10,"./each.js":11,"./errors":12,"./es5":13,"./filter.js":14,"./finally":15,"./generators.js":16,"./join":17,"./map.js":18,"./method":19,"./nodeback":20,"./nodeify.js":21,"./promise_array":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection":32,"./thenables":33,"./timers.js":34,"./using.js":35,"./util":36}],23:[function(n,t){"use strict";t.exports=function(t,i,r,u,f){function s(n){switch(n){case-2:return[];case-3:return{};case-6:return new Map}}function e(n){var r=this._promise=new t(i);n instanceof t&&r._propagateFrom(n,3);r._setOnCancel(this);this._values=n;this._length=0;this._totalResolved=0;this._init(void 0,-2)}var o=n("./util");return o.isArray,o.inherits(e,f),e.prototype.length=function(){return this._length},e.prototype.promise=function(){return this._promise},e.prototype._init=function h(n,i){var f=r(this._values,this._promise),e,c;if(f instanceof t){if(f=f._target(),e=f._bitField,this._values=f,0==(50397184&e))return this._promise._setAsyncGuaranteed(),f._then(h,this._reject,void 0,this,i);if(0==(33554432&e))return 0!=(16777216&e)?this._reject(f._reason()):this._cancel();f=f._value()}return(f=o.asArray(f),null===f)?(c=u("expecting an array or an iterable object but got "+o.classString(f)).reason(),void this._promise._rejectCallback(c,!1)):0===f.length?void(-5===i?this._resolveEmptyArray():this._resolve(s(i))):void this._iterate(f)},e.prototype._iterate=function(n){var o=this.getActualLength(n.length),i;this._length=o;this._values=this.shouldCopyValues()?new Array(o):this._values;for(var s=this._promise,e=!1,f=null,u=0;o>u;++u)i=r(n[u],s),i instanceof t?(i=i._target(),f=i._bitField):f=null,e?null!==f&&i.suppressUnhandledRejections():null!==f?0==(50397184&f)?(i._proxy(this,u),this._values[u]=i):e=0!=(33554432&f)?this._promiseFulfilled(i._value(),u):0!=(16777216&f)?this._promiseRejected(i._reason(),u):this._promiseCancelled(u):e=this._promiseFulfilled(i,u);e||s._setAsyncGuaranteed()},e.prototype._isResolved=function(){return null===this._values},e.prototype._resolve=function(n){this._values=null;this._promise._fulfill(n)},e.prototype._cancel=function(){!this._isResolved()&&this._promise._isCancellable()&&(this._values=null,this._promise._cancel())},e.prototype._reject=function(n){this._values=null;this._promise._rejectCallback(n,!1)},e.prototype._promiseFulfilled=function(n,t){this._values[t]=n;var i=++this._totalResolved;return i>=this._length?(this._resolve(this._values),!0):!1},e.prototype._promiseCancelled=function(){return this._cancel(),!0},e.prototype._promiseRejected=function(n){return this._totalResolved++,this._reject(n),!0},e.prototype._resultCancelled=function(){var n,i;if(!this._isResolved())if(n=this._values,this._cancel(),n instanceof t)n.cancel();else for(i=0;i<n.length;++i)n[i]instanceof t&&n[i].cancel()},e.prototype.shouldCopyValues=function(){return!0},e.prototype.getActualLength=function(n){return n},e}},{"./util":36}],24:[function(n,t){"use strict";t.exports=function(t,i){function c(n){return!it.test(n)}function e(n){try{return n.__isPromisified__===!0}catch(t){return!1}}function l(n,t,i){var u=r.getDataPropertyOrDefault(n,t+i,tt);return u?e(u):!1}function a(n,t,i){for(var f,e,u,r=0;r<n.length;r+=2)if(f=n[r],i.test(f))for(e=f.replace(i,""),u=0;u<n.length;u+=2)if(n[u]===e)throw new s("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/MqrFmX\n".replace("%s",t));}function v(n,t,i,u){for(var v=r.inheritedDataKeys(n),s=[],c=0;c<v.length;++c){var f=v[c],o=n[f],y=u===h?!0:h(f,o,n);"function"!=typeof o||e(o)||l(n,f,t)||!u(f,o,n,y)||s.push(f,o)}return a(s,t,i),s}function y(n,u,e,o,s,h){function l(){var e=u,r,o,s;u===f&&(e=this);r=new t(i);r._captureStackTrace();o="string"==typeof c&&this!==a?this[c]:n;s=b(r,h);try{o.apply(e,k(arguments,s))}catch(l){r._rejectCallback(d(l),!0,!0)}return r._isFateSealed()||r._setAsyncGuaranteed(),r}var a=function(){return this}(),c=n;return"string"==typeof c&&(n=o),r.notEnumerableProp(l,"__isPromisified__",!0),l}function o(n,t,i,e,o){for(var a,p=new RegExp(rt(t)+"$"),c=v(n,t,p,i),h=0,w=c.length;w>h;h+=2){var s=c[h],l=c[h+1],y=s+t;e===u?n[y]=u(s,f,s,l,t,o):(a=e(l,function(){return u(s,f,s,l,t,o)}),r.notEnumerableProp(a,"__isPromisified__",!0),n[y]=a)}return r.toFastProperties(n),n}function p(n,t,i){return u(n,t,void 0,n,null,i)}var w,f={},r=n("./util"),b=n("./nodeback"),k=r.withAppended,d=r.maybeWrapAsError,g=r.canEvaluate,s=n("./errors").TypeError,nt="Async",tt={__isPromisified__:!0},it=new RegExp("^(?:arity|length|name|arguments|caller|callee|prototype|__isPromisified__)$"),h=function(n){return r.isIdentifier(n)&&"_"!==n.charAt(0)&&"constructor"!==n},rt=function(n){return n.replace(/([$])/,"\\$")},u=g?w:y;t.promisify=function(n,t){if("function"!=typeof n)throw new s("expecting a function but got "+r.classString(n));if(e(n))return n;t=Object(t);var u=void 0===t.context?f:t.context,o=!!t.multiArgs,i=p(n,u,o);return r.copyDescriptors(n,i,c),i};t.promisifyAll=function(n,t){var l,i,f,e,a,c,v;if("function"!=typeof n&&"object"!=typeof n)throw new s("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/MqrFmX\n");if(t=Object(t),l=!!t.multiArgs,i=t.suffix,"string"!=typeof i&&(i=nt),f=t.filter,"function"!=typeof f&&(f=h),e=t.promisifier,"function"!=typeof e&&(e=u),!r.isIdentifier(i))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/MqrFmX\n");for(a=r.inheritedDataKeys(n),c=0;c<a.length;++c)v=n[a[c]],"constructor"!==a[c]&&r.isClass(v)&&(o(v.prototype,i,f,e,l),o(v,i,f,e,l));return o(n,i,f,e,l)}}},{"./errors":12,"./nodeback":20,"./util":36}],25:[function(n,t){"use strict";t.exports=function(t,i,r,u){function f(n){var i,u=!1,f,r,t,o;if(void 0!==e&&n instanceof e)i=h(n),u=!0;else for(f=a.keys(n),r=f.length,i=new Array(2*r),t=0;r>t;++t)o=f[t],i[t]=n[o],i[t+r]=o;this.constructor$(i);this._isMap=u;this._init$(void 0,u?-6:-3)}function o(n){var e,i=r(n);return l(i)?(e=i instanceof t?i._then(t.props,void 0,void 0,void 0,void 0):new f(i).promise(),i instanceof t&&e._propagateFrom(i,2),e):u("cannot await properties of a non-object\n\n    See http://goo.gl/MqrFmX\n")}var e,s=n("./util"),l=s.isObject,a=n("./es5"),h,c;"function"==typeof Map&&(e=Map);h=function(){function i(i,r){this[n]=i;this[n+t]=r;n++}var n=0,t=0;return function(r){t=r.size;n=0;var u=new Array(2*r.size);return r.forEach(i,u),u}}();c=function(n){for(var u,f,i=new e,r=n.length/2|0,t=0;r>t;++t)u=n[r+t],f=n[t],i.set(u,f);return i};s.inherits(f,i);f.prototype._init=function(){};f.prototype._promiseFulfilled=function(n,t){var u,i;if(this._values[t]=n,u=++this._totalResolved,u>=this._length){if(this._isMap)i=c(this._values);else{i={};for(var f=this.length(),r=0,e=this.length();e>r;++r)i[this._values[r+f]]=this._values[r]}return this._resolve(i),!0}return!1};f.prototype.shouldCopyValues=function(){return!1};f.prototype.getActualLength=function(n){return n>>1};t.prototype.props=function(){return o(this)};t.props=function(n){return o(n)}}},{"./es5":13,"./util":36}],26:[function(n,t){"use strict";function r(n,t,i,r,u){for(var f=0;u>f;++f)i[f+r]=n[f+t],n[f+t]=void 0}function i(n){this._capacity=n;this._length=0;this._front=0}i.prototype._willBeOverCapacity=function(n){return this._capacity<n};i.prototype._pushOne=function(n){var t=this.length(),i;this._checkCapacity(t+1);i=this._front+t&this._capacity-1;this[i]=n;this._length=t+1};i.prototype.push=function(n,t,i){var r=this.length()+3,u,f;if(this._willBeOverCapacity(r))return this._pushOne(n),this._pushOne(t),void this._pushOne(i);u=this._front+r-3;this._checkCapacity(r);f=this._capacity-1;this[u+0&f]=n;this[u+1&f]=t;this[u+2&f]=i;this._length=r};i.prototype.shift=function(){var n=this._front,t=this[n];return this[n]=void 0,this._front=n+1&this._capacity-1,this._length--,t};i.prototype.length=function(){return this._length};i.prototype._checkCapacity=function(n){this._capacity<n&&this._resizeTo(this._capacity<<1)};i.prototype._resizeTo=function(n){var t=this._capacity;this._capacity=n;var i=this._front,u=this._length,f=i+u&t-1;r(this,0,this,t,f)};t.exports=i},{}],27:[function(n,t){"use strict";t.exports=function(t,i,r,u){function f(n,f){var l=r(n),s,c;if(l instanceof t)return o(l);if(n=e.asArray(n),null===n)return u("expecting an array or an iterable object but got "+e.classString(n));s=new t(i);void 0!==f&&s._propagateFrom(f,3);for(var a=s._fulfill,v=s._reject,h=0,y=n.length;y>h;++h)c=n[h],(void 0!==c||h in n)&&t.cast(c)._then(a,v,void 0,s,null);return s}var e=n("./util"),o=function(n){return n.then(function(t){return f(t,n)})};t.race=function(n){return f(n,void 0)};t.prototype.race=function(){return f(this,void 0)}}},{"./util":36}],28:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function o(n,i,r,u){this.constructor$(n);var e=v();this._fn=null===e?i:s.domainBind(e,i);void 0!==r&&(r=t.resolve(r),r._attachCancellationCallback(this));this._initialValue=r;this._currentCancellable=null;this._eachValues=u===f?Array(this._length):0===u?null:void 0;this._promise._captureStackTrace();this._init$(void 0,-5)}function h(n,t){this.isFulfilled()?t._resolve(n):t._reject(n)}function c(n,t,i,u){if("function"!=typeof t)return r("expecting a function but got "+s.classString(t));var f=new o(n,t,i,u);return f.promise()}function a(n){this.accum=n;this.array._gotAccum(n);var i=u(this.value,this.array._promise);return i instanceof t?(this.array._currentCancellable=i,i._then(l,void 0,void 0,this,void 0)):l.call(this,i)}function l(n){var i=this.array,r=i._promise,f=y(i._fn),u,o;return r._pushContext(),u=void 0!==i._eachValues?f.call(r._boundValue(),n,this.index,this.length):f.call(r._boundValue(),this.accum,n,this.index,this.length),u instanceof t&&(i._currentCancellable=u),o=r._popContext(),e.checkForgottenReturns(u,o,void 0!==i._eachValues?"Promise.each":"Promise.reduce",r),u}var v=t._getDomain,s=n("./util"),y=s.tryCatch;s.inherits(o,i);o.prototype._gotAccum=function(n){void 0!==this._eachValues&&null!==this._eachValues&&n!==f&&this._eachValues.push(n)};o.prototype._eachComplete=function(n){return null!==this._eachValues&&this._eachValues.push(n),this._eachValues};o.prototype._init=function(){};o.prototype._resolveEmptyArray=function(){this._resolve(void 0!==this._eachValues?this._eachValues:this._initialValue)};o.prototype.shouldCopyValues=function(){return!1};o.prototype._resolve=function(n){this._promise._resolveCallback(n);this._values=null};o.prototype._resultCancelled=function(n){return n===this._initialValue?this._cancel():void(this._isResolved()||(this._resultCancelled$(),this._currentCancellable instanceof t&&this._currentCancellable.cancel(),this._initialValue instanceof t&&this._initialValue.cancel()))};o.prototype._iterate=function(n){var i,r,u,f;if(this._values=n,u=n.length,void 0!==this._initialValue?(i=this._initialValue,r=0):(i=t.resolve(n[0]),r=1),this._currentCancellable=i,!i.isRejected())for(;u>r;++r)f={accum:null,value:n[r],index:r,length:u,array:this},i=i._then(a,void 0,void 0,f,void 0);void 0!==this._eachValues&&(i=i._then(this._eachComplete,void 0,void 0,this,void 0));i._then(h,h,void 0,i,this)};t.prototype.reduce=function(n,t){return c(this,n,t,null)};t.reduce=function(n,t,i,r){return c(n,t,i,r)}}},{"./util":36}],29:[function(n,t){"use strict";var i,r=n("./util"),s=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/MqrFmX\n");},u=r.getNativePromise(),f,e,o;r.isNode&&"undefined"==typeof MutationObserver?(f=global.setImmediate,e=process.nextTick,i=r.isRecentNode?function(n){f.call(global,n)}:function(n){e.call(process,n)}):"function"==typeof u&&"function"==typeof u.resolve?(o=u.resolve(),i=function(n){o.then(n)}):i="undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&(window.navigator.standalone||window.cordova)?"undefined"!=typeof setImmediate?function(n){setImmediate(n)}:"undefined"!=typeof setTimeout?function(n){setTimeout(n,0)}:s:function(){var t=document.createElement("div"),i={attributes:!0},n=!1,r=document.createElement("div"),f=new MutationObserver(function(){t.classList.toggle("foo");n=!1}),u;return f.observe(r,i),u=function(){n||(n=!0,r.classList.toggle("foo"))},function(n){var r=new MutationObserver(function(){r.disconnect();n()});r.observe(t,i);u()}}();t.exports=i},{"./util":36}],30:[function(n,t){"use strict";t.exports=function(t,i,r){function u(n){this.constructor$(n)}var f=t.PromiseInspection,e=n("./util");e.inherits(u,i);u.prototype._promiseResolved=function(n,t){this._values[n]=t;var i=++this._totalResolved;return i>=this._length?(this._resolve(this._values),!0):!1};u.prototype._promiseFulfilled=function(n,t){var i=new f;return i._bitField=33554432,i._settledValueField=n,this._promiseResolved(t,i)};u.prototype._promiseRejected=function(n,t){var i=new f;return i._bitField=16777216,i._settledValueField=n,this._promiseResolved(t,i)};t.settle=function(n){return r.deprecated(".settle()",".reflect()"),new u(n).promise()};t.prototype.settle=function(){return t.settle(this)}}},{"./util":36}],31:[function(n,t){"use strict";t.exports=function(t,i,r){function u(n){this.constructor$(n);this._howMany=0;this._unwrap=!1;this._initialized=!1}function f(n,t){if((0|t)!==t||0>t)return r("expecting a positive integer\n\n    See http://goo.gl/MqrFmX\n");var i=new u(n),f=i.promise();return i.setHowMany(t),i.init(),f}var e=n("./util"),s=n("./errors").RangeError,h=n("./errors").AggregateError,c=e.isArray,o={};e.inherits(u,i);u.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var n=c(this._values);!this._isResolved()&&n&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}};u.prototype.init=function(){this._initialized=!0;this._init()};u.prototype.setUnwrap=function(){this._unwrap=!0};u.prototype.howMany=function(){return this._howMany};u.prototype.setHowMany=function(n){this._howMany=n};u.prototype._promiseFulfilled=function(n){return this._addFulfilled(n),this._fulfilled()===this.howMany()?(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values),!0):!1};u.prototype._promiseRejected=function(n){return this._addRejected(n),this._checkOutcome()};u.prototype._promiseCancelled=function(){return this._values instanceof t||null==this._values?this._cancel():(this._addRejected(o),this._checkOutcome())};u.prototype._checkOutcome=function(){if(this.howMany()>this._canPossiblyFulfill()){for(var t=new h,n=this.length();n<this._values.length;++n)this._values[n]!==o&&t.push(this._values[n]);return t.length>0?this._reject(t):this._cancel(),!0}return!1};u.prototype._fulfilled=function(){return this._totalResolved};u.prototype._rejected=function(){return this._values.length-this.length()};u.prototype._addRejected=function(n){this._values.push(n)};u.prototype._addFulfilled=function(n){this._values[this._totalResolved++]=n};u.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()};u.prototype._getRangeError=function(n){var t="Input array must contain at least "+this._howMany+" items but contains only "+n+" items";return new s(t)};u.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))};t.some=function(n,t){return f(n,t)};t.prototype.some=function(n){return f(this,n)};t._SomePromiseArray=u}},{"./errors":12,"./util":36}],32:[function(n,t){"use strict";t.exports=function(n){function t(n){void 0!==n?(n=n._target(),this._bitField=n._bitField,this._settledValueField=n._isFateSealed()?n._settledValue():void 0):(this._bitField=0,this._settledValueField=void 0)}t.prototype._settledValue=function(){return this._settledValueField};var i=t.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},r=t.prototype.error=t.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/MqrFmX\n");return this._settledValue()},u=t.prototype.isFulfilled=function(){return 0!=(33554432&this._bitField)},f=t.prototype.isRejected=function(){return 0!=(16777216&this._bitField)},e=t.prototype.isPending=function(){return 0==(50397184&this._bitField)},o=t.prototype.isResolved=function(){return 0!=(50331648&this._bitField)};t.prototype.isCancelled=function(){return 0!=(8454144&this._bitField)};n.prototype.__isCancelled=function(){return 65536==(65536&this._bitField)};n.prototype._isCancelled=function(){return this._target().__isCancelled()};n.prototype.isCancelled=function(){return 0!=(8454144&this._target()._bitField)};n.prototype.isPending=function(){return e.call(this._target())};n.prototype.isRejected=function(){return f.call(this._target())};n.prototype.isFulfilled=function(){return u.call(this._target())};n.prototype.isResolved=function(){return o.call(this._target())};n.prototype.value=function(){return i.call(this._target())};n.prototype.reason=function(){var n=this._target();return n._unsetRejectionIsUnhandled(),r.call(n)};n.prototype._value=function(){return this._settledValue()};n.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue()};n.PromiseInspection=t}},{}],33:[function(n,t){"use strict";t.exports=function(t,i){function f(n,u){var e,f;if(c(n)){if(n instanceof t)return n;if(e=o(n),e===r)return u&&u._pushContext(),f=t.reject(e.e),u&&u._popContext(),f;if("function"==typeof e)return s(n)?(f=new t(i),n._then(f._fulfill,f._reject,void 0,f,null),f):h(n,e,u)}return n}function e(n){return n.then}function o(n){try{return e(n)}catch(t){return r.e=t,r}}function s(n){try{return l.call(n,"_promise0")}catch(t){return!1}}function h(n,f,e){function c(n){o&&(o._resolveCallback(n),o=null)}function l(n){o&&(o._rejectCallback(n,s,!0),o=null)}var o=new t(i),a=o,s,h;return e&&e._pushContext(),o._captureStackTrace(),e&&e._popContext(),s=!0,h=u.tryCatch(f).call(n,c,l),s=!1,o&&h===r&&(o._rejectCallback(h.e,!0,!0),o=null),a}var u=n("./util"),r=u.errorObj,c=u.isObject,l={}.hasOwnProperty;return f}},{"./util":36}],34:[function(n,t){"use strict";t.exports=function(t,i,r){function u(n){this.handle=n}function e(n){return clearTimeout(this.handle),n}function o(n){throw clearTimeout(this.handle),n;}var l=n("./util"),s=t.TimeoutError,h,f,c;u.prototype._resultCancelled=function(){clearTimeout(this.handle)};h=function(n){return f(+this).thenReturn(n)};f=t.delay=function(n,f){var e,o;return void 0!==f?(e=t.resolve(f)._then(h,null,null,n,void 0),r.cancellation()&&f instanceof t&&e._setOnCancel(f)):(e=new t(i),o=setTimeout(function(){e._fulfill()},+n),r.cancellation()&&e._setOnCancel(new u(o)),e._captureStackTrace()),e._setAsyncGuaranteed(),e};t.prototype.delay=function(n){return f(n,this)};c=function(n,t,i){var r;r="string"!=typeof t?t instanceof Error?t:new s("operation timed out"):new s(t);l.markAsOriginatingFromRejection(r);n._attachExtraTrace(r);n._reject(r);null!=i&&i.cancel()};t.prototype.timeout=function(n,t){n=+n;var i,f,s=new u(setTimeout(function(){i.isPending()&&c(i,t,f)},n));return r.cancellation()?(f=this.then(),i=f._then(e,o,void 0,s,void 0),i._setOnCancel(s)):i=this._then(e,o,void 0,s,void 0),i}}},{"./util":36}],35:[function(n,t){"use strict";t.exports=function(t,i,r,u,f,e){function c(n){setTimeout(function(){throw n;},0)}function y(n){var t=r(n);return t!==n&&"function"==typeof n._isDisposable&&"function"==typeof n._getDisposer&&n._isDisposable()&&t._setDisposable(n._getDisposer()),t}function p(n,i){function u(){if(e>=s)return o._fulfill();var f=y(n[e++]);if(f instanceof t&&f._isDisposable()){try{f=r(f._getDisposer().tryDispose(i),n.promise)}catch(h){return c(h)}if(f instanceof t)return f._then(u,c,null,null,null)}u()}var e=0,s=n.length,o=new t(f);return u(),o}function o(n,t,i){this._data=n;this._promise=t;this._context=i}function s(n,t,i){this.constructor$(n,t,i)}function w(n){return o.isDisposer(n)?(this.resources[this.index]._setDisposable(n),n.promise()):n}function l(n){this.length=n;this.promise=null;this[n-1]=null}var h=n("./util"),b=n("./errors").TypeError,k=n("./util").inherits,a=h.errorObj,d=h.tryCatch,v={};o.prototype.data=function(){return this._data};o.prototype.promise=function(){return this._promise};o.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():v};o.prototype.tryDispose=function(n){var i=this.resource(),t=this._context,r;return void 0!==t&&t._pushContext(),r=i!==v?this.doDispose(i,n):null,void 0!==t&&t._popContext(),this._promise._unsetDisposable(),this._data=null,r};o.isDisposer=function(n){return null!=n&&"function"==typeof n.resource&&"function"==typeof n.tryDispose};k(s,o);s.prototype.doDispose=function(n,t){var i=this.data();return i.call(n,n,t)};l.prototype._resultCancelled=function(){for(var i,r=this.length,n=0;r>n;++n)i=this[n],i instanceof t&&i.cancel()};t.using=function(){var s=arguments.length,c,y,g,f,u,tt,nt,b,n,k,v;if(2>s)return i("you must pass at least 2 arguments to Promise.using");if(c=arguments[s-1],"function"!=typeof c)return i("expecting a function but got "+h.classString(c));for(g=!0,2===s&&Array.isArray(arguments[0])?(y=arguments[0],s=y.length,g=!1):(y=arguments,s--),f=new l(s),n=0;s>n;++n)u=y[n],o.isDisposer(u)?(tt=u,u=u.promise(),u._setDisposable(tt)):(nt=r(u),nt instanceof t&&(u=nt._then(w,null,null,{resources:f,index:n},void 0))),f[n]=u;for(b=new Array(f.length),n=0;n<b.length;++n)b[n]=t.resolve(f[n]).reflect();return k=t.all(b).then(function(n){for(var i,r,u,t=0;t<n.length;++t){if(i=n[t],i.isRejected())return a.e=i.error(),a;if(!i.isFulfilled())return void k.cancel();n[t]=i.value()}return v._pushContext(),c=d(c),r=g?c.apply(void 0,n):c(n),u=v._popContext(),e.checkForgottenReturns(r,u,"Promise.using",v),r}),v=k.lastly(function(){var n=new t.PromiseInspection(k);return p(f,n)}),f.promise=v,v._setOnCancel(f),v};t.prototype._setDisposable=function(n){this._bitField=131072|this._bitField;this._disposer=n};t.prototype._isDisposable=function(){return(131072&this._bitField)>0};t.prototype._getDisposer=function(){return this._disposer};t.prototype._unsetDisposable=function(){this._bitField=-131073&this._bitField;this._disposer=void 0};t.prototype.disposer=function(n){if("function"==typeof n)return new s(n,this,u());throw new b;}}},{"./errors":12,"./util":36}],36:[function(n,t){"use strict";function p(){try{var n=s;return s=null,n.apply(this,arguments)}catch(t){return o.e=t,o}}function w(n){return s=n,p}function f(n){return null==n||n===!0||n===!1||"string"==typeof n||"number"==typeof n}function b(n){return"function"==typeof n||"object"==typeof n&&null!==n}function k(n){return f(n)?new Error(u(n)):n}function d(n,t){for(var u=n.length,r=new Array(u+1),i=0;u>i;++i)r[i]=n[i];return r[i]=t,r}function g(n,t,r){if(!i.isES5)return{}.hasOwnProperty.call(n,t)?n[t]:void 0;var u=Object.getOwnPropertyDescriptor(n,t);if(null!=u)return null==u.get&&null==u.set?u.value:r}function h(n,t,r){if(f(n))return n;var u={value:r,configurable:!0,enumerable:!1,writable:!0};return i.defineProperty(n,t,u),n}function nt(n){throw n;}function tt(n){try{if("function"==typeof n){var t=i.names(n.prototype),r=i.isES5&&t.length>1,u=t.length>0&&!(1===t.length&&"constructor"===t[0]),f=pt.test(n+"")&&i.names(n).length>0;if(r||u||f)return!0}return!1}catch(e){return!1}}function it(n){function t(){}t.prototype=n;for(var i=8;i--;)new t;return n}function rt(n){return wt.test(n)}function ut(n,t,i){for(var u=new Array(n),r=0;n>r;++r)u[r]=t+r+i;return u}function u(n){try{return n+""}catch(t){return"[no string representation]"}}function c(n){return null!==n&&"object"==typeof n&&"string"==typeof n.message&&"string"==typeof n.name}function ft(n){try{h(n,"isOperational",!0)}catch(t){}}function et(n){return null==n?!1:n instanceof Error.__BluebirdErrorTypes__.OperationalError||n.isOperational===!0}function e(n){return c(n)&&i.propertyIsWritable(n,"stack")}function l(n){return{}.toString.call(n)}function ot(n,t,r){for(var f,e=i.names(n),u=0;u<e.length;++u)if(f=e[u],r(f))try{i.defineProperty(t,f,i.getDescriptor(n,f))}catch(o){}}function st(n){if(y)return process.env[n]}function ht(){if("function"==typeof Promise)try{var n=new Promise(function(){});if("[object Promise]"==={}.toString.call(n))return Promise}catch(t){}}function ct(n,t){return n.bind(t)}var i=n("./es5"),lt="undefined"==typeof navigator,o={e:{}},s,at="undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:void 0!==this?this:null,vt=function(n,t){function i(){this.constructor=n;this.constructor$=t;for(var i in t.prototype)r.call(t.prototype,i)&&"$"!==i.charAt(i.length-1)&&(this[i+"$"]=t.prototype[i])}var r={}.hasOwnProperty;return i.prototype=t.prototype,n.prototype=new i,n.prototype},yt=function(){var n=[Array.prototype,Object.prototype,Function.prototype],r=function(t){for(var i=0;i<n.length;++i)if(n[i]===t)return!0;return!1},u,t;return i.isES5?(u=Object.getOwnPropertyNames,function(n){for(var h,e,t,o,f=[],s=Object.create(null);null!=n&&!r(n);){try{h=u(n)}catch(c){return f}for(e=0;e<h.length;++e)t=h[e],s[t]||(s[t]=!0,o=Object.getOwnPropertyDescriptor(n,t),null!=o&&null==o.get&&null==o.set&&f.push(t));n=i.getPrototypeOf(n)}return f}):(t={}.hasOwnProperty,function(i){var f,u,e;if(r(i))return[];f=[];n:for(u in i)if(t.call(i,u))f.push(u);else{for(e=0;e<n.length;++e)if(t.call(n[e],u))continue n;f.push(u)}return f})}(),pt=/this\s*\.\s*\S+\s*=/,wt=/^[a-z$_][a-z$_0-9]*$/i,bt=function(){return"stack"in new Error?function(n){return e(n)?n:new Error(u(n))}:function(n){if(e(n))return n;try{throw new Error(u(n));}catch(t){return t}}}(),a=function(n){return i.isArray(n)?n:null},v;"undefined"!=typeof Symbol&&Symbol.iterator&&(v="function"==typeof Array.from?function(n){return Array.from(n)}:function(n){for(var t,i=[],r=n[Symbol.iterator]();!(t=r.next()).done;)i.push(t.value);return i},a=function(n){return i.isArray(n)?n:null!=n&&"function"==typeof n[Symbol.iterator]?v(n):null});var kt="undefined"!=typeof process&&"[object process]"===l(process).toLowerCase(),y="undefined"!=typeof process&&"undefined"!=typeof process.env,r={isClass:tt,isIdentifier:rt,inheritedDataKeys:yt,getDataPropertyOrDefault:g,thrower:nt,isArray:i.isArray,asArray:a,notEnumerableProp:h,isPrimitive:f,isObject:b,isError:c,canEvaluate:lt,errorObj:o,tryCatch:w,inherits:vt,withAppended:d,maybeWrapAsError:k,toFastProperties:it,filledRange:ut,toString:u,canAttachTrace:e,ensureErrorObject:bt,originatesFromRejection:et,markAsOriginatingFromRejection:ft,classString:l,copyDescriptors:ot,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:kt,hasEnvVariables:y,env:st,global:at,getNativePromise:ht,domainBind:ct};r.isRecentNode=r.isNode&&function(){var n=process.versions.node.split(".").map(Number);return 0===n[0]&&n[1]>10||n[0]>0}();r.isNode&&r.toFastProperties(process);try{throw new Error;}catch(dt){r.lastLineError=dt}t.exports=r},{"./es5":13}]},{},[4])(4)});"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise),function(n){function h(t,i,r){var e=this,o,s,u;return(i=i||{},u=n.extend(!0,{async:!0,overwriteCache:!1,complete:null,success:null,error:function(){n(this).each(function(){n(this).html(u.errorMessage)})},errorMessage:"There was an error loading the template.",paged:!1,pageNo:1,elemPerPage:10,append:!1,prepend:!1,beforeInsert:null,afterInsert:null,bindingOptions:{ignoreUndefined:!1,ignoreNull:!1,ignoreEmptyString:!1}},r),n.type(i)==="array")?(v=!0,p.call(this,t,i,u)):(y(t)||(o=n(t),typeof t=="string"&&t.indexOf("#")===0&&(u.isFile=!1)),s=u.isFile||typeof u.isFile=="undefined"&&(typeof o=="undefined"||o.length===0),s&&!u.overwriteCache&&f[t]?b(t,e,i,u):s&&!u.overwriteCache&&f.hasOwnProperty(t)?w(t,e,i,u):s?d(t,e,i,u):g(o,e,i,u),this)}function c(t,i){i?u[t]=i:u=n.extend(u,t)}function y(n){return typeof n=="string"&&n.indexOf("/")>-1}function p(t,i,r){var o;r=r||{};var f=this,e=i.length,v=r.prepend&&!r.append,s=0,c=0,u=!1,l=[],a;return r.paged&&(o=(r.pageNo-1)*r.elemPerPage,i=i.slice(o,o+r.elemPerPage),e=i.length),r.append||r.prepend||f.html(""),a=n.extend({},r,{append:!r.prepend&&!0,complete:function(){s++;(s===e||u)&&(u&&r&&typeof r.error=="function"&&r.error.call(f,l),r&&typeof r.complete=="function"&&r.complete())},success:function(){c++;c===e&&r&&typeof r.success=="function"&&r.success()},error:function(n){u=!0;l.push(n)}}),v&&i.reverse(),n(i).each(function(){return h.call(f,t,this,a),u?!1:void 0}),this}function w(n,t,i,u){r[n]?r[n].push({data:i,selection:t,settings:u}):r[n]=[{data:i,selection:t,settings:u}]}function b(n,t,i,r){var u=f[n].clone();o.call(t,u,i,r);typeof r.success=="function"&&r.success()}function l(){return(new Date).getTime()}function k(n){return n.indexOf("?")!==-1?n+"&_="+l():n+"?_="+l()}function d(t,i,r,u){f[t]=null;var e=t;u.overwriteCache&&(e=k(e));n.ajax({url:e,async:u.async,success:function(f){tt(n(f),t,i,r,u)},error:function(n){nt(t,i,r,u,n)}})}function g(t,i,r,u){(t.is("script")||t.is("template"))&&(t=n.parseHTML(n.trim(t.html())));o.call(i,t,r,u);typeof u.success=="function"&&u.success()}function o(t,i,r){var t=n("<div/>").append(t);it(t,i,r);n(this).each(function(){var u=t.children().clone(!0);n("select",u).each(function(i){n(this).val(n("select",t).eq(i).val())});r.beforeInsert&&r.beforeInsert(u,i);r.append?n(this).append(u):r.prepend?n(this).prepend(u):n(this).html("").append(u);r.afterInsert&&r.afterInsert(u,i)});typeof r.complete=="function"&&r.complete.call(n(this),i)}function nt(t,i,u,f,e){var o;for(typeof f.error=="function"&&f.error.call(i,e),n(r[t]).each(function(n,t){typeof t.settings.error=="function"&&t.settings.error.call(t.selection,e)}),typeof f.complete=="function"&&f.complete.call(i);r[t]&&(o=r[t].shift());)typeof o.settings.complete=="function"&&o.settings.complete.call(o.selection);typeof r[t]!="undefined"&&r[t].length>0&&(r[t]=[])}function tt(n,t,i,u,e){var s;for(f[t]=n.clone(),o.call(i,n,u,e),typeof e.success=="function"&&e.success.call(i);r[t]&&(s=r[t].shift());)o.call(s.selection,f[t].clone(),s.data,s.settings),typeof s.settings.success=="function"&&s.settings.success.call(s.selection)}function it(r,u,f){u=u||{};t("data-content",r,u,f,function(n,t){n.html(i(n,t,"content",f))});t("data-content-append",r,u,f,function(n,t){n.append(i(n,t,"content",f))});t("data-content-prepend",r,u,f,function(n,t){n.prepend(i(n,t,"content",f))});t("data-content-text",r,u,f,function(n,t){n.text(i(n,t,"content",f))});t("data-innerHTML",r,u,f,function(n,t){n.html(i(n,t,"content",f))});t("data-src",r,u,f,function(n,t){n.attr("src",i(n,t,"src",f))},function(n){n.remove()});t("data-href",r,u,f,function(n,t){n.attr("href",i(n,t,"href",f))},function(n){n.remove()});t("data-alt",r,u,f,function(n,t){n.attr("alt",i(n,t,"alt",f))});t("data-id",r,u,f,function(n,t){n.attr("id",i(n,t,"id",f))});t("data-class",r,u,f,function(n,t){n.addClass(i(n,t,"class",f))});t("data-link",r,u,f,function(t,r){var u=n("<a/>");u.attr("href",i(t,r,"link",f));u.html(t.html());t.html(u)});t("data-link-wrap",r,u,f,function(t,r){var u=n("<a/>");u.attr("href",i(t,r,"link-wrap",f));t.wrap(u)});t("data-options",r,u,f,function(t,i){n(i).each(function(){var i=n("<option/>");i.attr("value",this).text(this).appendTo(t)})});ut(r,u,f);t("data-value",r,u,f,function(n,t){n.val(i(n,t,"value",f))})}function t(t,i,r,u,f,e){n("["+t+"]",i).each(function(){var i=n(this),h=i.attr(t),o=s(r,h);if(!a(i,o,u)){i.remove();return}i.removeAttr(t);typeof o!="undefined"&&f?f(i,o):e&&e(i)});return}function a(n,t,i){var r=rt(n,i);return r.ignoreUndefined&&typeof t=="undefined"?!1:r.ignoreNull&&t===null?!1:r.ignoreEmptyString&&t===""?!1:!0}function rt(t,i){var r={};return t instanceof jQuery&&t.attr("data-binding-options")?(r=n.parseJSON(t.attr("data-binding-options")),t.removeAttr("data-binding-options")):typeof t=="object"&&t.hasOwnProperty("bindingOptions")&&(r=t.bindingOptions),n.extend({},i.bindingOptions,r)}function ut(t,i,r){n("[data-template-bind]",t).each(function(){var t=n(this),u=n.parseJSON(t.attr("data-template-bind"));t.removeAttr("data-template-bind");n(u).each(function(){var u,f;if(u=typeof this.value=="object"?s(i,this.value.data):s(i,this.value),this.attribute){if(!a(this,u,r)){t.remove();return}switch(this.attribute){case"content":case"innerHTML":t.html(e(t,u,this));break;case"contentAppend":t.append(e(t,u,this));break;case"contentPrepend":t.prepend(e(t,u,this));break;case"contentText":t.text(e(t,u,this));break;case"options":f=this;n(u).each(function(){var i=n("<option/>");i.attr("value",this[f.value.value]).text(e(t,this[f.value.content],f)).attr("selected",typeof this[f.value.selected]==undefined?!1:this[f.value.selected]).appendTo(t)});break;default:t.attr(this.attribute,e(t,u,this))}}})})}function e(n,t,i,r){return i.formatter&&u[i.formatter]?function(r){return u[i.formatter].call(n,t,i.formatOptions,r)}(r):t}function s(n,t){if(t==="this")return n;for(var u=t.split("."),r,i=n;(r=u.shift())&&typeof i!="undefined"&&i!=null;)i=i[r];return i}function i(t,i,r,f){var o=t.attr("data-format-target"),e,s;return(o===r||!o&&r==="content")&&(e=t.attr("data-format"),e&&typeof u[e]=="function")?(s=t.attr("data-format-options"),function(r){return u[e].call(t[0],i,s,n.extend({},r))}(f)):i}var f={},r={},u={},v;c("nestedTemplateFormatter",function(t,i,r){if(i){typeof i=="string"&&i[0]==="{"&&(i=n.parseJSON(i));var u=i.parentElement||"div",f=i.template||i;return i.parentElement?n("<"+u+"/>").loadTemplate(f,t,r):n("<"+u+"/>").loadTemplate(f,t,r).children()}});n.fn.loadTemplate=h;n.addTemplateFormatter=c}(jQuery),function(n){"use strict";typeof define=="function"&&define.amd?define(["jquery","jquery.ui.widget"],n):typeof exports=="object"?n(require("jquery"),require("./vendor/jquery.ui.widget")):n(window.jQuery)}(function(n){"use strict";function t(t){var i=t==="dragover";return function(r){r.dataTransfer=r.originalEvent&&r.originalEvent.dataTransfer;var u=r.dataTransfer;u&&n.inArray("Files",u.types)!==-1&&this._trigger(t,n.Event(t,{delegatedEvent:r}))!==!1&&(r.preventDefault(),i&&(u.dropEffect="copy"))}}n.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||n('<input type="file">').prop("disabled"));n.support.xhrFileUpload=!!(window.ProgressEvent&&window.FileReader);n.support.xhrFormDataFileUpload=!!window.FormData;n.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice);n.widget("blueimp.fileupload",{options:{dropZone:n(document),pasteZone:undefined,fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,limitMultiFileUploadSize:undefined,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,redirect:undefined,redirectParamName:undefined,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(t,i){return t=this.messages[t]||t.toString(),i&&n.each(i,function(n,i){t=t.replace("{"+n+"}",i)}),t},formData:function(n){return n.serializeArray()},add:function(t,i){if(t.isDefaultPrevented())return!1;(i.autoUpload||i.autoUpload!==!1&&n(this).fileupload("option","autoUpload"))&&i.process().done(function(){i.submit()})},processData:!1,contentType:!1,cache:!1,timeout:0},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:n.support.blobSlice&&function(){var n=this.slice||this.webkitSlice||this.mozSlice;return n.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime();this.loaded=0;this.bitrate=0;this.getBitrate=function(n,t,i){var r=n-this.timestamp;return(!this.bitrate||!i||r>i)&&(this.bitrate=(t-this.loaded)*(1e3/r)*8,this.loaded=t,this.timestamp=n),this.bitrate}},_isXHRUpload:function(t){return!t.forceIframeTransport&&(!t.multipart&&n.support.xhrFileUpload||n.support.xhrFormDataFileUpload)},_getFormData:function(t){var i;return n.type(t.formData)==="function"?t.formData(t.form):n.isArray(t.formData)?t.formData:n.type(t.formData)==="object"?(i=[],n.each(t.formData,function(n,t){i.push({name:n,value:t})}),i):[]},_getTotal:function(t){var i=0;return n.each(t,function(n,t){i+=t.size||1}),i},_initProgressObject:function(t){var i={loaded:0,total:0,bitrate:0};t._progress?n.extend(t._progress,i):t._progress=i},_initResponseObject:function(n){var t;if(n._response)for(t in n._response)n._response.hasOwnProperty(t)&&delete n._response[t];else n._response={}},_onProgress:function(t,i){if(t.lengthComputable){var r=Date.now?Date.now():(new Date).getTime(),u;if(i._time&&i.progressInterval&&r-i._time<i.progressInterval&&t.loaded!==t.total)return;i._time=r;u=Math.floor(t.loaded/t.total*(i.chunkSize||i._progress.total))+(i.uploadedBytes||0);this._progress.loaded+=u-i._progress.loaded;this._progress.bitrate=this._bitrateTimer.getBitrate(r,this._progress.loaded,i.bitrateInterval);i._progress.loaded=i.loaded=u;i._progress.bitrate=i.bitrate=i._bitrateTimer.getBitrate(r,u,i.bitrateInterval);this._trigger("progress",n.Event("progress",{delegatedEvent:t}),i);this._trigger("progressall",n.Event("progressall",{delegatedEvent:t}),this._progress)}},_initProgressListener:function(t){var r=this,i=t.xhr?t.xhr():n.ajaxSettings.xhr();i.upload&&(n(i.upload).bind("progress",function(n){var i=n.originalEvent;n.lengthComputable=i.lengthComputable;n.loaded=i.loaded;n.total=i.total;r._onProgress(n,t)}),t.xhr=function(){return i})},_isInstanceOf:function(n,t){return Object.prototype.toString.call(t)==="[object "+n+"]"},_initXHRData:function(t){var f=this,i,r=t.files[0],e=t.multipart||!n.support.xhrFileUpload,u=n.type(t.paramName)==="array"?t.paramName[0]:t.paramName;t.headers=n.extend({},t.headers);t.contentRange&&(t.headers["Content-Range"]=t.contentRange);e&&!t.blob&&this._isInstanceOf("File",r)||(t.headers["Content-Disposition"]='attachment; filename="'+encodeURI(r.name)+'"');e?n.support.xhrFormDataFileUpload&&(t.postMessage?(i=this._getFormData(t),t.blob?i.push({name:u,value:t.blob}):n.each(t.files,function(r,f){i.push({name:n.type(t.paramName)==="array"&&t.paramName[r]||u,value:f})})):(f._isInstanceOf("FormData",t.formData)?i=t.formData:(i=new FormData,n.each(this._getFormData(t),function(n,t){i.append(t.name,t.value)})),t.blob?i.append(u,t.blob,r.name):n.each(t.files,function(r,e){(f._isInstanceOf("File",e)||f._isInstanceOf("Blob",e))&&i.append(n.type(t.paramName)==="array"&&t.paramName[r]||u,e,e.uploadName||e.name)})),t.data=i):(t.contentType=r.type||"application/octet-stream",t.data=t.blob||r);t.blob=null},_initIframeSettings:function(t){var i=n("<a><\/a>").prop("href",t.url).prop("host");t.dataType="iframe "+(t.dataType||"");t.formData=this._getFormData(t);t.redirect&&i&&i!==location.host&&t.formData.push({name:t.redirectParamName||"redirect",value:t.redirect})},_initDataSettings:function(n){this._isXHRUpload(n)?(this._chunkedUpload(n,!0)||(n.data||this._initXHRData(n),this._initProgressListener(n)),n.postMessage&&(n.dataType="postmessage "+(n.dataType||""))):this._initIframeSettings(n)},_getParamName:function(t){var r=n(t.fileInput),i=t.paramName;return i?n.isArray(i)||(i=[i]):(i=[],r.each(function(){for(var t=n(this),u=t.prop("name")||"files[]",r=(t.prop("files")||[1]).length;r;)i.push(u),r-=1}),i.length||(i=[r.prop("name")||"files[]"])),i},_initFormSettings:function(t){t.form&&t.form.length||(t.form=n(t.fileInput.prop("form")),t.form.length||(t.form=n(this.options.fileInput.prop("form"))));t.paramName=this._getParamName(t);t.url||(t.url=t.form.prop("action")||location.href);t.type=(t.type||n.type(t.form.prop("method"))==="string"&&t.form.prop("method")||"").toUpperCase();t.type!=="POST"&&t.type!=="PUT"&&t.type!=="PATCH"&&(t.type="POST");t.formAcceptCharset||(t.formAcceptCharset=t.form.attr("accept-charset"))},_getAJAXSettings:function(t){var i=n.extend({},this.options,t);return this._initFormSettings(i),this._initDataSettings(i),i},_getDeferredState:function(n){return n.state?n.state():n.isResolved()?"resolved":n.isRejected()?"rejected":"pending"},_enhancePromise:function(n){return n.success=n.done,n.error=n.fail,n.complete=n.always,n},_getXHRPromise:function(t,i,r){var u=n.Deferred(),f=u.promise();return i=i||this.options.context||f,t===!0?u.resolveWith(i,r):t===!1&&u.rejectWith(i,r),f.abort=u.promise,this._enhancePromise(f)},_addConvenienceMethods:function(t,i){var r=this,u=function(t){return n.Deferred().resolveWith(r,t).promise()};i.process=function(t,f){return(t||f)&&(i._processQueue=this._processQueue=(this._processQueue||u([this])).pipe(function(){return i.errorThrown?n.Deferred().rejectWith(r,[i]).promise():u(arguments)}).pipe(t,f)),this._processQueue||u([this])};i.submit=function(){return this.state()!=="pending"&&(i.jqXHR=this.jqXHR=r._trigger("submit",n.Event("submit",{delegatedEvent:t}),this)!==!1&&r._onSend(t,this)),this.jqXHR||r._getXHRPromise()};i.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",r._trigger("fail",null,this),r._getXHRPromise(!1))};i.state=function(){return this.jqXHR?r._getDeferredState(this.jqXHR):this._processQueue?r._getDeferredState(this._processQueue):void 0};i.processing=function(){return!this.jqXHR&&this._processQueue&&r._getDeferredState(this._processQueue)==="pending"};i.progress=function(){return this._progress};i.response=function(){return this._response}},_getUploadedBytes:function(n){var i=n.getResponseHeader("Range"),t=i&&i.split("-"),r=t&&t.length>1&&parseInt(t[1],10);return r&&r+1},_chunkedUpload:function(t,i){t.uploadedBytes=t.uploadedBytes||0;var u=this,f=t.files[0],e=f.size,r=t.uploadedBytes,c=t.maxChunkSize||e,l=this._blobSlice,o=n.Deferred(),s=o.promise(),a,h;return!(this._isXHRUpload(t)&&l&&(r||c<e))||t.data?!1:i?!0:r>=e?(f.error=t.i18n("uploadedBytes"),this._getXHRPromise(!1,t.context,[null,"error",f.error])):(h=function(){var i=n.extend({},t),s=i._progress.loaded;i.blob=l.call(f,r,r+c,f.type);i.chunkSize=i.blob.size;i.contentRange="bytes "+r+"-"+(r+i.chunkSize-1)+"/"+e;u._initXHRData(i);u._initProgressListener(i);a=(u._trigger("chunksend",null,i)!==!1&&n.ajax(i)||u._getXHRPromise(!1,i.context)).done(function(f,c,l){r=u._getUploadedBytes(l)||r+i.chunkSize;s+i.chunkSize-i._progress.loaded&&u._onProgress(n.Event("progress",{lengthComputable:!0,loaded:r-i.uploadedBytes,total:r-i.uploadedBytes}),i);t.uploadedBytes=i.uploadedBytes=r;i.result=f;i.textStatus=c;i.jqXHR=l;u._trigger("chunkdone",null,i);u._trigger("chunkalways",null,i);r<e?h():o.resolveWith(i.context,[f,c,l])}).fail(function(n,t,r){i.jqXHR=n;i.textStatus=t;i.errorThrown=r;u._trigger("chunkfail",null,i);u._trigger("chunkalways",null,i);o.rejectWith(i.context,[n,t,r])})},this._enhancePromise(s),s.abort=function(){return a.abort()},h(),s)},_beforeSend:function(n,t){this._active===0&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0);this._initResponseObject(t);this._initProgressObject(t);t._progress.loaded=t.loaded=t.uploadedBytes||0;t._progress.total=t.total=this._getTotal(t.files)||1;t._progress.bitrate=t.bitrate=0;this._active+=1;this._progress.loaded+=t.loaded;this._progress.total+=t.total},_onDone:function(t,i,r,u){var f=u._progress.total,e=u._response;u._progress.loaded<f&&this._onProgress(n.Event("progress",{lengthComputable:!0,loaded:f,total:f}),u);e.result=u.result=t;e.textStatus=u.textStatus=i;e.jqXHR=u.jqXHR=r;this._trigger("done",null,u)},_onFail:function(n,t,i,r){var u=r._response;r.recalculateProgress&&(this._progress.loaded-=r._progress.loaded,this._progress.total-=r._progress.total);u.jqXHR=r.jqXHR=n;u.textStatus=r.textStatus=t;u.errorThrown=r.errorThrown=i;this._trigger("fail",null,r)},_onAlways:function(n,t,i,r){this._trigger("always",null,r)},_onSend:function(t,i){i.submit||this._addConvenienceMethods(t,i);var r=this,f,s,e,h,u=r._getAJAXSettings(i),o=function(){return r._sending+=1,u._bitrateTimer=new r._BitrateTimer,f=f||((s||r._trigger("send",n.Event("send",{delegatedEvent:t}),u)===!1)&&r._getXHRPromise(!1,u.context,s)||r._chunkedUpload(u)||n.ajax(u)).done(function(n,t,i){r._onDone(n,t,i,u)}).fail(function(n,t,i){r._onFail(n,t,i,u)}).always(function(n,t,i){if(r._onAlways(n,t,i,u),r._sending-=1,r._active-=1,u.limitConcurrentUploads&&u.limitConcurrentUploads>r._sending)for(var f=r._slots.shift();f;){if(r._getDeferredState(f)==="pending"){f.resolve();break}f=r._slots.shift()}r._active===0&&r._trigger("stop")})};return(this._beforeSend(t,u),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending)?(this.options.limitConcurrentUploads>1?(e=n.Deferred(),this._slots.push(e),h=e.pipe(o)):(this._sequence=this._sequence.pipe(o,o),h=this._sequence),h.abort=function(){return(s=[undefined,"abort","abort"],!f)?(e&&e.rejectWith(u.context,s),o()):f.abort()},this._enhancePromise(h)):o()},_onAdd:function(t,i){var a=this,p=!0,f=n.extend({},this.options,i),u=i.files,v=u.length,o=f.limitMultiFileUploads,c=f.limitMultiFileUploadSize,b=f.limitMultiFileUploadSizeOverhead,w=0,l=this._getParamName(f),s,e,h,r,y=0;if(!v)return!1;if(c&&u[0].size===undefined&&(c=undefined),(f.singleFileUploads||o||c)&&this._isXHRUpload(f))if(f.singleFileUploads||c||!o)if(!f.singleFileUploads&&c)for(h=[],s=[],r=0;r<v;r=r+1)w+=u[r].size+b,(r+1===v||w+u[r+1].size+b>c||o&&r+1-y>=o)&&(h.push(u.slice(y,r+1)),e=l.slice(y,r+1),e.length||(e=l),s.push(e),y=r+1,w=0);else s=l;else for(h=[],s=[],r=0;r<v;r+=o)h.push(u.slice(r,r+o)),e=l.slice(r,r+o),e.length||(e=l),s.push(e);else h=[u],s=[l];return i.originalFiles=u,n.each(h||u,function(r,u){var f=n.extend({},i);return f.files=h?u:[u],f.paramName=s[r],a._initResponseObject(f),a._initProgressObject(f),a._addConvenienceMethods(t,f),p=a._trigger("add",n.Event("add",{delegatedEvent:t}),f)}),p},_replaceFileInput:function(t){var i=t.fileInput,r=i.clone(!0),u=i.is(document.activeElement);t.fileInputClone=r;n("<form><\/form>").append(r)[0].reset();i.after(r).detach();u&&r.focus();n.cleanData(i.unbind("remove"));this.options.fileInput=this.options.fileInput.map(function(n,t){return t===i[0]?r[0]:t});i[0]===this.element[0]&&(this.element=r)},_handleFileTreeEntry:function(t,i){var s=this,r=n.Deferred(),u=function(n){n&&!n.entry&&(n.entry=t);r.resolve([n])},h=function(n){s._handleFileTreeEntries(n,i+t.name+"/").done(function(n){r.resolve(n)}).fail(u)},e=function(){o.readEntries(function(n){n.length?(f=f.concat(n),e()):h(f)},u)},o,f=[];return i=i||"",t.isFile?t._file?(t._file.relativePath=i,r.resolve(t._file)):t.file(function(n){n.relativePath=i;r.resolve(n)},u):t.isDirectory?(o=t.createReader(),e()):r.resolve([]),r.promise()},_handleFileTreeEntries:function(t,i){var r=this;return n.when.apply(n,n.map(t,function(n){return r._handleFileTreeEntry(n,i)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(t){t=t||{};var i=t.items;return i&&i.length&&(i[0].webkitGetAsEntry||i[0].getAsEntry)?this._handleFileTreeEntries(n.map(i,function(n){var t;return n.webkitGetAsEntry?(t=n.webkitGetAsEntry(),t&&(t._file=n.getAsFile()),t):n.getAsEntry()})):n.Deferred().resolve(n.makeArray(t.files)).promise()},_getSingleFileInputFiles:function(t){t=n(t);var r=t.prop("webkitEntries")||t.prop("entries"),i,u;if(r&&r.length)return this._handleFileTreeEntries(r);if(i=n.makeArray(t.prop("files")),i.length)i[0].name===undefined&&i[0].fileName&&n.each(i,function(n,t){t.name=t.fileName;t.size=t.fileSize});else{if(u=t.prop("value"),!u)return n.Deferred().resolve([]).promise();i=[{name:u.replace(/^.*\\/,"")}]}return n.Deferred().resolve(i).promise()},_getFileInputFiles:function(t){return!(t instanceof n)||t.length===1?this._getSingleFileInputFiles(t):n.when.apply(n,n.map(t,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_onChange:function(t){var r=this,i={fileInput:n(t.target),form:n(t.target.form)};this._getFileInputFiles(i.fileInput).always(function(u){i.files=u;r.options.replaceFileInput&&r._replaceFileInput(i);r._trigger("change",n.Event("change",{delegatedEvent:t}),i)!==!1&&r._onAdd(t,i)})},_onPaste:function(t){var i=t.originalEvent&&t.originalEvent.clipboardData&&t.originalEvent.clipboardData.items,r={files:[]};i&&i.length&&(n.each(i,function(n,t){var i=t.getAsFile&&t.getAsFile();i&&r.files.push(i)}),this._trigger("paste",n.Event("paste",{delegatedEvent:t}),r)!==!1&&this._onAdd(t,r))},_onDrop:function(t){t.dataTransfer=t.originalEvent&&t.originalEvent.dataTransfer;var u=this,i=t.dataTransfer,r={};i&&i.files&&i.files.length&&(t.preventDefault(),this._getDroppedFiles(i).always(function(i){r.files=i;u._trigger("drop",n.Event("drop",{delegatedEvent:t}),r)!==!1&&u._onAdd(t,r)}))},_onDragOver:t("dragover"),_onDragEnter:t("dragenter"),_onDragLeave:t("dragleave"),_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop,dragenter:this._onDragEnter,dragleave:this._onDragLeave}),this._on(this.options.pasteZone,{paste:this._onPaste}));n.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragenter dragleave dragover drop");this._off(this.options.pasteZone,"paste");this._off(this.options.fileInput,"change")},_setOption:function(t,i){var r=n.inArray(t,this._specialOptions)!==-1;r&&this._destroyEventHandlers();this._super(t,i);r&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var t=this.options;t.fileInput===undefined?t.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):t.fileInput instanceof n||(t.fileInput=n(t.fileInput));t.dropZone instanceof n||(t.dropZone=n(t.dropZone));t.pasteZone instanceof n||(t.pasteZone=n(t.pasteZone))},_getRegExp:function(n){var t=n.split("/"),i=t.pop();return t.shift(),new RegExp(t.join("/"),i)},_isRegExpOption:function(t,i){return t!=="url"&&n.type(i)==="string"&&/^\/.*\/[igm]{0,3}$/.test(i)},_initDataAttributes:function(){var t=this,i=this.options,r=this.element.data();n.each(this.element[0].attributes,function(n,u){var f=u.name.toLowerCase(),e;/^data-/.test(f)&&(f=f.slice(5).replace(/-[a-z]/g,function(n){return n.charAt(1).toUpperCase()}),e=r[f],t._isRegExpOption(f,e)&&(e=t._getRegExp(e)),i[f]=e)})},_create:function(){this._initDataAttributes();this._initSpecialOptions();this._slots=[];this._sequence=this._getXHRPromise(!0);this._sending=this._active=0;this._initProgressObject(this);this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(t){var i=this;t&&!this.options.disabled&&(t.fileInput&&!t.files?this._getFileInputFiles(t.fileInput).always(function(n){t.files=n;i._onAdd(null,t)}):(t.files=n.makeArray(t.files),this._onAdd(null,t)))},send:function(t){if(t&&!this.options.disabled){if(t.fileInput&&!t.files){var e=this,i=n.Deferred(),u=i.promise(),r,f;return u.abort=function(){return(f=!0,r)?r.abort():(i.reject(null,"abort","abort"),u)},this._getFileInputFiles(t.fileInput).always(function(n){if(!f){if(!n.length){i.reject();return}t.files=n;r=e._onSend(null,t);r.then(function(n,t,r){i.resolve(n,t,r)},function(n,t,r){i.reject(n,t,r)})}}),this._enhancePromise(u)}if(t.files=n.makeArray(t.files),t.files.length)return this._onSend(null,t)}return this._getXHRPromise(!1,t&&t.context)}})});!function(n){"use strict";n.paletteColorPicker=function(t,i){var u="palette-color-picker",e=n(t),r=this,c=e.val(),s=e.attr("id"),o=n("<div>").addClass(u+"-button").attr("data-target",s),f=n("<div>").addClass(u+"-bubble"),l={custom_class:null,colors:null,position:"upside",insert:"before",clear_btn:"first",timeout:2e3},h="ontouchstart"in document.documentElement?"touchstart":"click";r.init=function(){r.settings=n.extend({},l,i);null===r.settings.colors&&(r.settings.colors=e.data("palette"));"string"==typeof r.settings.colors[0]&&(r.settings.colors=n.map(r.settings.colors,function(n){var t={};return t[n]=n,t}));r.settings.insert=r.settings.insert.charAt(0).toUpperCase()+r.settings.insert.slice(1);r.settings.custom_class&&f.addClass(r.settings.custom_class);n.each(r.settings.colors,function(t,i){var r=Object.keys(i)[0],u=i[r],e=n("<span>").addClass("swatch").attr({title:r,"data-color":u,"data-name":r}).css("background-color",u);r===c&&(e.addClass("active"),o.css("background",u));e.appendTo(f)});var t=n("<span>").addClass("swatch clear").attr("title","Clear selection");"last"===r.settings.clear_btn?t.addClass("last").appendTo(f):t.prependTo(f);r.destroy=function(){o.remove();n.removeData(e[0])};o.append(f).on(h,function(t){t.preventDefault();t.stopPropagation();var i=n(this);i.toggleClass("active").find("."+u+"-bubble").fadeToggle();i.hasClass("active")&&(clearTimeout(r.timer),r.timer=setTimeout(function(){i.trigger("pcp.fadeout")},r.settings.timeout))}).on("pcp.fadeout",function(){n(this).removeClass("active").find("."+u+"-bubble").fadeOut()}).on("mouseenter","."+u+"-bubble",function(){clearTimeout(r.timer)}).on("mouseleave","."+u+"-bubble",function(){r.timer=setTimeout(function(){o.trigger("pcp.fadeout")},r.settings.timeout)}).on(h,"span.swatch",function(t){t.preventDefault();t.stopPropagation();var i=n(this).attr("data-color"),f=n(this).attr("data-name"),r=n("."+u+'-button[data-target="'+n(this).closest("."+u+"-button").attr("data-target")+'"]'),e=n(this).closest("."+u+"-bubble");e.find(".active").removeClass("active");n(t.target).is(".clear")?(r.removeAttr("style"),i=""):(n(this).addClass("active"),r.css("background",i));n("#"+s).val(f)})["insert"+r.settings.insert](e);("downside"===r.settings.position||e.offset().top+20<f.outerHeight())&&f.addClass("downside")};r.init()};n.fn.paletteColorPicker=function(t){return this.each(function(){"undefined"==typeof n(this).data("paletteColorPickerPlugin")&&n(this).data("paletteColorPickerPlugin",new n.paletteColorPicker(this,t))})}}(jQuery);var standardColours=[{name:"Gold",pantone:"871 C"},{name:"Silver",pantone:"877 C"},{name:"White",pantone:"00 C"},{name:"Black",pantone:"Black C"},{name:"Dark Grey",pantone:"Cool Gray 11 C"},{name:"Medium Grey",pantone:"Cool Gray 6 C"},{name:"Light Grey",pantone:"Cool Gray 3 C"},{name:"Cream/off White",pantone:"7499 C"},{name:"Dark Red",pantone:"186 C"},{name:"Light Red",pantone:"177 C"},{name:"Red",pantone:"485 C"},{name:"Maroon",pantone:"221 C"},{name:"Dark Pink",pantone:"214 C"},{name:"Light Pink",pantone:"210 C"},{name:"Purple",pantone:"Purple C"},{name:"Violet",pantone:"Violet C"},{name:"Lilac",pantone:"270 C"},{name:"Orange",pantone:"Orange 021 C"},{name:"Burnt Orange",pantone:"7583 C"},{name:"Light Orange",pantone:"1575 C"},{name:"Peach",pantone:"163 C"},{name:"Yellow",pantone:"Yellow C"},{name:"Bright Yellow",pantone:"123 C"},{name:"Pale Yellow",pantone:"100 C"},{name:"Blue",pantone:"Blue 072 C"},{name:"Navy",pantone:"281 C"},{name:"Royal Blue",pantone:"Reflex Blue C"},{name:"Light Blue",pantone:"543 C"},{name:"Turquoise",pantone:"320 C"},{name:"Teal",pantone:"323 C"},{name:"Green",pantone:"Green C"},{name:"Lime",pantone:"375 C"},{name:"Bottle Green",pantone:"340 C"},{name:"Dark Green",pantone:"567 C"},{name:"Army Green",pantone:"5753 C"},{name:"Brown",pantone:"477 C"},{name:"Beige",pantone:"7506 C"},{name:"Light Brown",pantone:"480 C"},{name:"Dark Brown",pantone:"462 C"},{name:"Khaki",pantone:"7502 C"}],CartLoading=function(){function n(){}return n.prototype.show=function(){$("#logoUploadLoading").show()},n.prototype.hide=function(){$("#logoUploadLoading").hide()},n}(),LogoUploadType={Cart:1,JobCard:2},alerterService={info:function(n){alertMessage(n)},error:function(n){alertMessage(n)},confirm:function(){}},DataService=function(n){"use strict";function t(){}function i(n){var t="An error occured.";try{n.Error?t=n.Error:n.responseJSON&&n.responseJSON.Error?t=n.responseJSON.Error:n.TheData&&(t=n.TheData)}catch(i){console.log(i)}return t}var r="AjaxHandlers/LogoUploadHandler.aspx";return t.prototype.loadContactsAndSizes=function(n,t,u,f){var e=$.ajax({url:r+"?a=GetContactsAndBrandingPositionDetails&i="+n+"&c="+t+"&bc="+u+"&colourCode="+f,dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.addJobCardDetails=function(n,t,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,it){var rt=$.ajax({url:r+"?a=SaveLogoBrandingDetails",data:{uploadType:n,finish:t,lId:JSON.stringify(u),width:f,height:e,p:o,jc:s,pc:h,bp:c,cId:l,si:a,pt:v?v.join():null,mt:y?y.join():null,v:p,f:w,reuseLogo:b,reuseColour:k,numColours:d,flags:g,uploadForJobCardNumber:nt,artworkFlag:tt,logoName:it},dataType:"json",cache:!1});return Promise.resolve(rt).then(function(n){return!n.Success&&n.Error?Promise.reject(n):n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getStepDetails=function(n,t,u,f){var e=$.ajax({url:r+"?a=GetDocumentBrandingDetail",data:{uploadType:n,position:t,productCode:u,jobCardNumber:f},dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){if(n.Success)return n.TheData}).catch(function(n){return Promise.reject(i(n))})},t.prototype.searchRepeatJobCard=function(n,t,u,f,e,o,s,h,c,l){var a=$.ajax({url:r+"?a=LoadExactRepeats",data:{name_startsWith:n,productIndex:f,PrintProcessNumberOfColors:t,PrintDepartmentName:u,itemCode:e,colourCode:o,size:s,StartDate:h,EndDate:c,coloursAndSizes:JSON.stringify(l)},dataType:"json",cache:!1});return Promise.resolve(a).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.canJobCardBeExactRepeat=function(n,t,u,f,e,o,s){var h=$.ajax({url:r+"?a=CanJobCardBeExactRepeat",data:{RepeatJobCardNumber:n,PrintProcessNumberOfColors:t,PrintDepartmentName:u,AccountNumber:f,itemCode:e,colourCode:o,size:s},dataType:"json",cache:!1});return Promise.resolve(h).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.changeLogoName=function(n,t,u,f){var e=$.ajax({url:r+"?a=ChangeLogoName",data:{logoId:JSON.stringify(n),logoName:t,productCode:u,position:f},dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getJobCardLogos=function(n,t,u,f,e){var o=$.ajax({url:r+"?a=GetPreviousJobcardsWithLogos",data:{SearchTerm:n,StartDate:t,EndDate:u,Take:f,Skip:e},dataType:"json",cache:!1});return Promise.resolve(o).then(function(n){return n.Success?n:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getAllPantoneColours=function(){var n=$.ajax({url:r+"?a=GetAllPantoneColours",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getAllFoilColours=function(){var n=$.ajax({url:r+"?a=GetAllFoilColours",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.canJobCardLogoBeUsed=function(n,t,u,f){var e=$.ajax({url:r+"?a=CanJobCardLogoBeUsed&AccountNumber="+n+"&JobCardNumber="+f,dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){return n.Success?n:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getPantoneColours=function(n){var t=$.ajax({url:r+"?a=GetPantoneColours&t="+n,dataType:"json"});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getMarathonColours=function(n){var t=$.ajax({url:r+"?a=GetMarathonColours&t="+n,dataType:"json"});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getDocumentBrandingLogos=function(){var n=$.ajax({url:r+"?a=GetDocumentBrandingLogos",dataType:"json"});return Promise.resolve(n).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getShoppingCart=function(){var n=$.ajax({url:"AjaxHandler.aspx?a=LoadShoppingCart",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getJobCardProduct=function(n){var t=$.ajax({url:r+"?a=GetJobCardProduct",data:{jobCardNumber:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getCartProducts=function(){return this.getShoppingCart().then(function(n){var r=[],u=n.CartLinesVO,t=!1,i=!1;return u.forEach(function(n){var f,e,u;n.InventoryType!==5&&n.InventoryType!==9&&(n.InventoryType===7&&(i=!0),n.InventoryType===6?(t=!0,productInventoryType=productTypes.WorkWearProduct):productInventoryType=n.InventoryType===5?productTypes.DisplayProduct:i?productTypes.CustomPackaging:productTypes.NormalProduct,t&&(n.CartBrandingVO=_.reject(n.CartBrandingVO,function(n){return n.IsRequiredBranding===!0})),n.CartBrandingVO.length&&(f=[],e=[],n.CartBrandingVO.forEach(function(n){if(n.IsNoCoBranding!==!0||productInventoryType===productTypes.WorkWearProduct){if(i){if(n.BrandMethodCode.startsWith("DCB")||n.BrandMethodCode.startsWith("DCP"))return;productInventoryType=productTypes.NormalProduct}f.push({position:n.Position,numColours:n.NumberOfColours,brandingMethod:n.BrandMethodCode,description:n.PositionDescription,isRequiredBranding:n.IsRequiredBranding,isWorkWear:t})}}),n.CartItemsVO.forEach(function(n){e.push({Colour:n.ColourCode,Size:n.SizeCode})}),u={productCode:n.ProductCode,productIndex:n.Index,productPositions:f,productName:n.ProductName,imageUrl:n.DefaultImageURL,colourCode:null,size:n.Size,productColoursAndSizes:e,productInventoryType:productInventoryType,customBoxWithBottle:n.InventoryType},n.CartItemsVO.length==1&&(u.colourCode=n.CartItemsVO[0].ColourCode,u.size=n.CartItemsVO[0].SizeCode),r.push(u)))}),r})},t.prototype.addLogo24Details=function(n,t,u,f,e,o){var s=$.ajax({url:r+"?a=AddLogo24BrandingDetail",data:{logoId:f,productCode:n,productIndex:t,brandingPosition:u,pantone:e,flags:o},dataType:"json",cache:!1});return Promise.resolve(s).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getJobCardProductPositions=function(n,t,u=false){var f=$.ajax({url:r+"?a=GetJobCardProductPositions",data:{jobCardNumber:n,brandingMethod:t,FromOnlineApprovals:u},dataType:"json",cache:!1});return Promise.resolve(f).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.isLogoUploadDetailsComplete=function(){var n=$.ajax({url:r+"?a=IsLogoUploadDetailsComplete",method:"GET",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.canUploadLogos=function(n){var t=$.ajax({url:r+"?a=CanUploadLogos",method:"GET",data:{uploadType:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getBrandingMethodExtensions=function(n){var t=$.ajax({url:r+"?a=GetBrandingMethodExtensions",method:"GET",data:{brandingCode:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return _.map(n.TheData,function(n){return _.toLower(n)})}).catch(function(n){return Promise.reject(i(n))})},t.prototype.deleteBranding=function(n,t,u){var f=$.ajax({url:r+"?a=DeleteBranding",method:"POST",data:{productCode:n,productIndex:t,position:u},dataType:"json",cache:!1});return Promise.resolve(f).then(function(){return}).catch(function(n){return Promise.reject(i(n))})},t.prototype.deleteJobCardBranding=function(n){var t=$.ajax({url:r+"?a=DeleteJobCardBranding",method:"POST",data:{jobCardNumber:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(){return}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getInventoryType=function(n){var t=$.ajax({url:r+"?a=GetInventoryType",method:"POST",data:{productCode:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(i(n))})},t}(alerterService.error),LogoUploadFlags={None:0,IsCopy:1,IsRepeat:2,MatchLogoColour:4,MatchToneOnToneColour:8},fromArtwork=!1,exactRepeatCheck=!1,SelectedArtworkTab1=[],ArtworkBrandingMethod=[],isDisplayProduct=!1,LogoUpload=function(n,t,i,r,u,f){"use strict";function re(){return{open:es,showLogoHelp:os,changeLogoName:cs,stepBack:ao,stepForward:po,proceed:tu,finish:go,reuseLogo:ns,reuseColour:ts,closeReplicateModal:ru,changeJobCardImageUpload:ks,clearLogoHeight:rh,clearLogoWidth:uh,searchRepeatJobCard:ou,downloadDocument:bh,submitRepeat:oh,removeUploadedFile:bs,getLogosFromPreviousJobCards:ps,copyJobCardLogo:lh,ValidateUploadArtWork:co,handleColourChange:ni,generateColourSection:eu,showLogoUploadSection:gi,cancelExactRepeatButUseValues:function(){exactRepeatCheck=!1;gi(!1,!0)},onCartLogoSelected:rs,loadProductForLogoUpload:wo,loadPosition:gt,stepToDetailStage:ko,close:fr,confirmClose:hh,onMatchColoursChecked:uc,onMatchToneOnToneChecked:fc,validateImageName:ds,resetExactStep:vh,ResetColours:wh}}function co(n){switch(n){case"tab1":kt.show();$("#pDescription").show();$("#pDescription4").hide();$("#txtLogoName").removeClass("border-red");fromArtwork=!0;$("#tab-1").fadeIn();$("#tab-2,#tab-3,#tab-4").fadeOut();exactRepeatCheck=!1;break;case"tab2":ou();kt.hide();$("#pDescription").hide();$("#pDescription4").hide();fromArtwork=!1;$("#tab-2").fadeIn();$("#tab-1,#tab-3,#tab-4").fadeOut();break;case"tab3":kt.show();$("#pDescription").hide();$("#pDescription3").show();$("#pDescription4").hide();fromArtwork=!1;exactRepeatCheck=!1;$("#loadMoreLogoRepeat").hide();$("#txtLogoName").removeClass("border-red");$("#tab-3").fadeIn();$("#tab-1,#tab-2,#tab-4").fadeOut();break;case"tab4":exactRepeatCheck=!1;kt.show();$("#pDescription").hide();$("#pDescription4").show();$("#txtLogoName").removeClass("border-red");fromArtwork=!0;$("#tab-4").fadeIn();$("#tab-2,#tab-3,#tab-1").fadeOut();ei=[];ArtworkLibraryIntegration.ClearSelectedArtworkTab1()}}function hf(){var n=!0,t=null,i;return h==null||h.length==0?(h=ArtworkLibraryIntegration.GetSelectedArtworkData(),h.length==0&&(h=ArtworkLibraryIntegration.GetSelectedArtworkDataTab1())):h.length==0&&(h=ArtworkLibraryIntegration.GetSelectedArtworkData(),h.length==0&&(h=ArtworkLibraryIntegration.GetSelectedArtworkDataTab1())),nu()&&!et&&h.length==0&&(n=!1,t="Please select logo in order to proceed."),ot()&&!et&&(n=!1,t="please select logo in order to proceed."),i=$("#txtLogoName").val(),i!==""||$("#exactRepeatTab").hasClass("active")||(n=!1,t="The artwork description cannot be empty."),$("#logoRepeatTab").hasClass("active")&&!et&&(n=!1,t="Please select logo in order to proceed."),h!=null&&h.length!=0||nu()||(typeof DashboardJobCardModuleController!="undefined"?DashboardJobCardModuleController.SelectedLogos.length>0?h=DashboardJobCardModuleController.SelectedLogos:(n=!1,t="Please select logo in order to proceed.",exactRepeatCheck&&(n=!0,t=null)):(n=!1,t="Please select logo in order to proceed.",exactRepeatCheck&&(n=!0,t=null))),{valid:n,errorMessage:t}}function cf(){var n=!0,t=null,i=parseFloat(a.val()!=""?a.val():"0"),r=parseFloat(v.val()!=""?v.val():"0"),u=parseFloat(a.get(0).max),f=parseFloat(v.get(0).max),e;return i==0&&r==0?(n=!1,t="Please only enter numeric values for the size."):u>0&&i>u?(n=!1,t="The width for this item cannot be larger than "+u.toString()):f>0&&r>f?(n=!1,t="The height for this item cannot be larger than "+f.toString()):(isNaN(i)||isNaN(r))&&(n=!1,t="Please note only numeric values are allowed for this input."),n&&(e=$("#ddlPosition option:selected").val(),e=="-1"&&(n=!1,t="Please select a position.")),{valid:n,errorMessage:t}}function lf(){return Promise.resolve().then(function(){var n=!0,t=null,i=_.find(k,function(n){return n.index==2});return i.visible?as().then(function(i){if(i){var r=pf(),u=ui.prop("checked"),f=lt.prop("checked");r.length==0&&(r=wf());u||f||(s.numColours>0&&r.length!=s.numColours?(n=!1,t="Please select a value for each colour."):r.length!=0||u||f||(n=!1,t="Please select at least one colour."))}else n=!1,t="The pantone colour you entered is incorrect. Please enter a right one.";return{valid:n,errorMessage:t}}):{valid:n,errorMessage:t}})}function lo(){var n=!0,t=null;return bt.val()==""&&(n=!1,t=null),{valid:n,errorMessage:t}}function nu(){var n=!1;return((o&r.IsCopy)>0&&(n=!0),fromArtwork)?!1:n}function ot(){var n=!1;return(o&r.IsRepeat)>0&&(n=!0),exactRepeatCheck&&n==!1&&(n=!0),n}function ao(){var n=ot();n?vf():y.index==0?vf():yf(gr.Back)}function vo(){if(w.length==1&&w[0].positions.length==1)return!1;return!sr}function yo(){var n=!1,t;return w.length==1&&w[0].positions.length==1?!1:lu()?!1:(t=_.sumBy(w,function(n){var t=_.filter(n.positions,function(n){return cu(n.numColours,n.brandingMethod)});return t.length}),t>1&&(n=!hr),n)}function po(){var n=ot();n?af():hu().then(function(n){n.valid?y.index==0&&vo()?hs():y.index==2&&yo()?ss():tu():($("#txtLogoName").val()!==""?$("#txtLogoName").removeClass("border-red"):$("#txtLogoName").addClass("border-red"),l(n.errorMessage))})}function tu(){di().then(function(){y.index==k.length-1?af():yf(gr.Next)}).catch(function(n){l(n);i.hide()})}function af(){var n,t;s.index==c.positions.length-1?(n=_.find(w,function(n){return n.productIndex==ec()}),n&&ki(n,!0)):(t=_.find(c.positions,function(n){return n.index==s.index+1}),gt(t.position))}function vf(){var n,t;s.index==0?(n=_.find(w,function(n){return n.productIndex==oc()}),n&&ki(n,!0)):(t=_.find(c.positions,function(n){return n.index==s.index-1}),gt(t.position))}function yf(n){var t,i=_.filter(k,function(n){return n.visible});t=n==gr.Next?_.find(i,function(n){return n.index>y.index}):_.findLast(i,function(n){return n.index<y.index});oi(t.index)}function wo(n){if(i.show(),n==c.productIndex){i.hide();return}var t=_.find(w,function(t){return t.productIndex==n});ki(t,!0)}function ki(n,t){be.loadTemplate(we,{productImgUrl:n.productImgUrl,productName:n.productName,brandingLayoutURL:"ProductLayout.aspx?Code="+n.productCode});$(".product-positions a[data-href='brandingLayoutURL']").attr("href","ProductLayout.aspx?Code="+n.productCode);br.empty();n.positions.forEach(function(n){br.loadTemplate(ke,{position:n.position,onClick:n.onClick},{append:!0})});c=n;isDisplayProduct=!1;t&&gt(n.positions[0].position);dr.removeClass("active");var i=_.find(dr,function(t){return $(t).attr("product-index")==n.productIndex});$(i).addClass("active");$(".nav-tabs li.active").removeClass("active");$("#tab-1").fadeOut();$("#tab-2").fadeOut();$("#tab-3").fadeOut();$("#tab-4").fadeOut();exactRepeatCheck=!1;n.positions.length>1?($("#exactRepeatTab").removeAttr("onclick"),$("#exactRepeatIcon").removeClass("TabIcon").addClass("exactRepeatIcon"),$("#spnRepeatText").removeClass("blue").addClass("spnRepeatText"),$("#spnTooltip").removeClass("blue").addClass("spnTooltip"),$("#spnTooltip").attr("data-original-title","Unable to do an exact repeat on a multi position jobcard"),$("#tab-2").fadeOut(),$("#exactRepeatTab").hasClass("active")&&$("#exactRepeatTab").removeClass("active")):($("#exactRepeatIcon").removeClass("exactRepeatIcon").addClass("TabIcon"),$("#spnRepeatText").removeClass("spnRepeatText"),$("#spnTooltip").removeClass("spnTooltip").addClass("btn-tooltip blue"),$("#spnTooltip").attr("data-original-title","An exact repeat constitutes a repeat of the same logo on the same item with the same colour/s and size/s being branded in the same position/s as previously. Please note that only a completed job can be repeated."),document.getElementById("exactRepeatTab").setAttribute("onclick",'logoUpload.ValidateUploadArtWork("tab2")'))}function gt(n){var i,u,f,e;document.getElementById("SelectFromLibraryTab").setAttribute("onclick",'logoUpload.ValidateUploadArtWork("tab4")');$("#logoUploadSection .uploadedListItem").show();ArtworkLibraryIntegration.ClearSelectedArtwork();$tbUploadedFiles.ajax.reload();ArtworkLibraryIntegration.ClearSelectedArtworkTab1();$("#HideContentLoader").fadeIn();vu=n;gi();i=_.find(c.positions,function(t){return t.position==n});typeof i!="undefined"&&(i.index>0||c.productIndex>0)?lr.show():lr.hide();s=i;$("[product-position]").removeClass("active");$('[product-position="'+n+'"]').addClass("active");$("#positionLetter").text(n);k.forEach(function(n){n.visible=!0});fu();typeof s!="undefined"?(u=u=cu(s.numColours,s.brandingMethod),u<=0?(f=_.find(k,function(n){return n.index==2}),s.brandingMethod.indexOf("L")==0?(f.visible=!0,fi.show(),lt.prop("disabled",!0),lt.prop("checked",!0),$("#colourSection .HideColour,.HideShowMarathonColor").hide(),$("#colourSection .ShowFoilColour,.printColorFirstTxt").hide(),fi.addClass("ToneonTone")):f.visible=!1):(eu(u),$(".printColorFirstTxt").show(),fi.removeClass("ToneonTone")),gf(s.brandingMethod)&&(s.brandingMethod.indexOf("EM")==0?(of.show(),fi.show()):s.brandingMethod.indexOf("FL")==0&&($("#colourSection .HideColour,.HideShowMarathonColor").hide(),$("#colourSection .ShowFoilColour").show(),$(tt).val(""),$(".palette-color-picker-button.MarathonControlId").removeAttr("style"),$(d).val(""),$(".cPreview").css("background-color","white"),$(it).val(""),$(".palette-color-picker-button:not(.MarathonControlId)").css("background-color","white"),at(),p.fadeOut(),at(),p.fadeOut(),o=r.None,p.fadeIn())),bo(s.brandingMethod)?$(".digitalPrintUploadNote").show():$(".digitalPrintUploadNote").hide(),fu(),uo.html("("+s.description+")"),e=rc(s.brandingMethod),ct.empty(),ct.append($("<option><\/option>").text("Select Location").val("-1")),e.forEach(function(n){ct.append($("<option><\/option>").text(n))}),ct.val(-1),$("#HideContentLoader").fadeOut(),vs().then(function(){return eh(s.position,c.id)}).then(function(){return t.getBrandingMethodExtensions(s.brandingMethod)}).then(function(n){if(n)if(dt=n,$("#acceptableFiles").empty(),dt.length>0){ArtworkBrandingMethod=n;var t=dt.join(".");$("#acceptableFiles").text("Acceptable formats: "+t+"")}else ArtworkBrandingMethod=["pdf","cdr","eps","ai"],$("#acceptableFiles").text("Acceptable formats: .pdf, .cdr.eps or.ai.");oi(0)}).catch(function(n){oi(0);l(n)})):oi(0)}function bo(n){var t=_.find(["BB-","DCB-","DCP-","DDT-","DB","DC","DP-","DTA","DTB","DTC","HS-","DV","DA","DNB-","HP","HPA","HPB","HPC","HPD","SUB","ZP"],function(t){return n.indexOf(t)==0});return t!=null}function ko(n){var i=ot(),t;if(i){t="You cannot specify branding info if you want to do an exact repeat.";l(t);return}oi(n)}function oi(n){var t=[];return k.forEach(function(i){var r=$("#"+i.elementId),u=$("#"+i.aboutElementId),f=i.validate().then(function(t){var f=$("[detail-step-index="+i.index+"]");t.valid?f.addClass("done"):f.removeClass("done");i.index==n?(y=i,r.show(),u.show()):(r.hide(),u.hide())});t.push(f)}),Promise.all(t).then(function(){$("[detail-step-index]").removeClass("active");var t=$("[detail-step-index="+n+"]");t.addClass("active");iu()}).catch(function(n){l(n)})}function iu(){if(DashboardJobCardModuleController.FromOnlineApprovals)ti.hide(),ii.show();else if(y){y.index>0&&lr.show();ti.hide();ii.hide();var n=_.maxBy(w,function(n){return n.productIndex});typeof s!="undefined"&&(c.productIndex<n.productIndex||s.index<c.positions.length-1?ti.show():y.index<k.length-1?ot()?ii.show():ti.show():c.productIndex==n.productIndex&&s.index==c.positions.length-1&&ii.show())}}function go(){i.show();di(!0).then(function(n){g==LogoUploadType.JobCard&&n.TheData!=null&&st(n.TheData);i.hide();fr()}).catch(function(n){i.hide();l(n)})}function ns(){ru("modalReuseLogo");vt=!0}function ts(){ru("modalReuseColour");yt=!0}function ru(n){$("#"+n).modal("hide");$("body").addClass("modal-open");tu()}function is(){o=0;se.show();he.show();df();gu.hide();ys();hi.hide();wi.hide();ar.hide();$("#loadMoreLogoRepeat").hide();vt=!1;sr=!1;yt=!1;hr=!1;k.forEach(function(n){$("#"+n.elementId).hide();$("#"+n.aboutElementId).hide()})}function rs(){var n=ft[0].selectedIndex,t=parseInt(ft.val()),i=ft.find("option:selected").text();nt=null;n>0&&(h=t,b=i,ai.show())}function uu(){var i=this,n,t;ft.html("");ft.append($("<option>Please select a logo<\/option>"));ht.length>0&&(n=_.clone(ht).reverse(),n=_.uniqBy(n,"name"),t="",n.forEach(function(n){if(t!=n.name){var i=$("<option><\/option>");i.html(n.name);i.val(n.id);ft.append(i)}t=n.name}))}function us(){return ht=[],bi.fnGetLogos().then(function(n){ht=n;uu()})}function fs(){return Promise.resolve().then(function(){return bi.fnGetProducts()})}function es(n,r,u,f,e,o,s){is();g=n;rt=f;nt=f;bi.fnGetProducts=e;bi.fnGetLogos=o;sh();var h=[];i.show();g==LogoUploadType.JobCard&&(productInventoryType=s==5?productTypes.DisplayProduct:s==7?productTypes.CustomPackaging:productTypes.NormalProduct);t.canUploadLogos(g).then(function(n){if(!n.Success)throw n.Error;return fs()}).then(function(n){if(h=n,o)return us()}).then(function(){ArtworkLibraryIntegration.GetArtworkLibrary(g,f)}).then(function(){return th()}).then(function(){return ih()}).then(function(){if(fu(),i.hide(),ls(h),u){var n=_.find(w,function(n){return n.productIndex==r});ki(n,!1);gt(u)}vr.modal({backdrop:"static",keyboard:!1});return}).catch(function(n){i.hide();l(n);fr()})}function os(){var n=pu.html();alertMessage(n)}function st(n){u.info(n)}function ss(){eo.modal({backdrop:"static",keyboard:!1})}function hs(){fo.modal({backdrop:"static",keyboard:!1})}function l(n){u.error(n)}function cs(n){$("#logoNameInput .RanameLogoDescriptionLoader").fadeIn();$("#txtLogoName").removeClass("border-red");n!==""&&(h=ArtworkLibraryIntegration.GetSelectedArtworkData(),h.length>0&&t.changeLogoName(h,n,c.productCode+":"+c.productIndex,s.position).then(function(t){b=n;$("#txtLogoName").val(n);$("#logoNameInput .RanameLogoDescriptionLoader").fadeOut();$("body").trigger(er,{productIndex:c.productIndex,position:s.position,uploadForJobCardNumber:rt,logoId:h,logoName:b});t!="Duplicate product"&&st("The logo name has been updated.")}).catch(function(n){ci.val(b);l(n);$("#logoNameInput .RanameLogoDescriptionLoader").fadeOut();$("#txtLogoName").addClass("border-red")}))}function pf(){var n=[];return $(pi,yu).each(function(){var r=$(d,$(this)),e=$(tt,$(this)),u=$(it,$(this)),f=$(yi,$(this)),i=$(kr,$(this)),t=null;r.val()!=""?t=r.val():u.val()!=""?t=u.val():$(yi,$(this)).index()>0?t=f.val()+cr:i.val()!=""&&i.val()!="0"&&(t=i.val());t&&n.push(t)}),n}function wf(){var n=[];return $(pi,yu).each(function(){var i=$(tt,$(this)),t=null;i.val()!=""&&(t=i.val());t&&n.push(t)}),n}function di(n){var i=this;return n||(n=!1),$("#txtLogoName").removeClass("border-red"),hu().then(function(i){var e,f,u;if(i.valid){var w=a.val()!=""?a.val():0,k=v.val()!=""?v.val():0,d=ct.val(),tt=bt.val(),y="",r=[],p=[];return lu()||ne()||(r=pf(),r.length==0&&(r=[],p=wf())),typeof s!="undefined"?s.brandingMethod.indexOf("FL")==0&&r.length>0&&(y=r[0],r=null):r=null,e=nt,f=SelectedArtwork,f.length==0&&(f=SelectedArtwork1),DashboardJobCardModuleController.FromOnlineApprovals?(u={DateCached:null,Error:null,FromCache:!1,Success:!1,TheData:null},f.length!==0&&(DashboardJobCardModuleController.SelectedLogos=f,DashboardJobCardModuleController.LogoName=$("#txtLogoName").val(),u.Success=!0,u.TheData="Artwork Uploaded.",$("#ApproveUploadArtwork #EditUpload .logo24-logo").text($("#txtLogoName").val()),$("#ApproveUploadArtwork #EditUpload img").attr("onclick","DashboardJobCardModuleController.EditLogoUploader()"),$("#ApproveUploadArtwork #UploadFile").hide(),$("#ApproveUploadArtwork #EditUpload").show()),DashboardJobCardModuleController.SelectedLogos!==0?(f=DashboardJobCardModuleController.SelectedLogos,DashboardJobCardModuleController.LogoName=$("#txtLogoName").val(),u.Success=!0,u.TheData="Artwork Uploaded.",$("#ApproveUploadArtwork #EditUpload .logo24-logo").text($("#txtLogoName").val()),$("#ApproveUploadArtwork #EditUpload img").attr("onclick","DashboardJobCardModuleController.EditLogoUploader()"),$("#ApproveUploadArtwork #UploadFile").hide(),$("#ApproveUploadArtwork #EditUpload").show()):(u.Error="Please upload at least one logo.",u.Success=!1,$("#ApproveUploadArtwork #UploadFile").show(),$("#ApproveUploadArtwork #EditUpload").hide(),$("#ApproveUploadArtwork #EditUpload .logo24-logo").text(""),$("#ApproveUploadArtwork #EditUpload img").attr("onclick","")),Promise.resolve(u)):Promise.resolve(t.addJobCardDetails(g,n,f,w,k,d,e,c.id,s.position,[],tt,r,p,"",y,vt,yt,s.numColours,o,rt,fromArtwork,$("#txtLogoName").val())).then(function(n){if(n.Success){if((h==null||h.length==0)&&(h=SelectedArtwork,h.length==0&&(h=SelectedArtwork1)),(h||ot())&&(b=$("#txtLogoName").val(),$("body").trigger(er,{productIndex:c.productIndex,position:s.position,uploadForJobCardNumber:rt,logoId:h,logoName:b})),vt){var t=b;nu()&&(t="Logo from: "+e);$("body").trigger(ue,{logoId:h,logoName:t})}return yt&&(yt=!1,hr=!0),vt&&(vt=!1,sr=!0),n}l(n.TheData)}).catch(function(n){return l(n),Promise.reject(n)})}return $("#txtLogoName").val()===""&&$("#txtLogoName").addClass("border-red"),l(i.errorMessage),Promise.reject(i.errorMessage)})}function ls(n){w=[];ff.empty();n=_.sortBy(n,["productIndex"]);n.forEach(function(n){var i;if(n.productPositions!=0||DashboardJobCardModuleController.FromOnlineApprovals){var u="logoUpload.loadProductForLogoUpload("+n.productIndex+");",r=[],t=!1;(n.productPositions.forEach(function(i,u){n.customBoxWithBottle===7&&(i.brandingMethod.startsWith("DCB")?t=!0:i.brandingMethod.startsWith("DCP")&&(t=!0),t)||r.push({index:u,position:i.position,numColours:i.numColours,brandingMethod:i.brandingMethod,description:i.description,isRequiredBranding:i.isRequiredBranding,isWorkWear:i.isWorkWear,onClick:"logoUpload.loadPosition('"+i.position+"');"})}),t)||(i={productCode:n.productCode,productName:n.productName,productImgUrl:n.imageUrl,productIndex:n.productIndex,positions:r,colourCode:n.colourCode,size:n.size,id:n.productCode+":"+n.productIndex,onClick:u,productColoursAndSizes:n.productColoursAndSizes},w.push(i),ff.loadTemplate(to,{productIndex:n.productIndex,productCode:n.productCode,onClick:i.onClick},{append:!0}))}});dr=$(".prod-btn")}function at(){$(d).val("");$(it).val("");$(tt).val("");$(de).removeAttr("style");$(no).removeAttr("style");$(ge).removeAttr("style")}function gi(n=true,t=false){h=null;nt=null;n&&(ft.html(""),ci.val(""),a.val(""),$("#txtPreviousJob").val(""),$("#txtlogoRepeatJob").val(""),v.val(""),ct.val(-1),bt.val(""),at());t?bt.prop("disabled",!0):bt.prop("disabled",!1);ur();ui.prop("checked",!1);lt.prop("checked",!1);of.hide();$('.HideShowMarathonColor,div[data-style="HideShowMarathonColor"]').hide();fi.hide();p.show();tf.hide();uf.hide();df();uu();o=r.None;dt=[]}function fu(){ef.empty();DashboardJobCardModuleController.FromOnlineApprovals?(k[1].visible=!1,k[2].visible=!1,k[3].visible=!1,$("#exactRepeatTab,#logoRepeatTab,.product-positions .pos-heading").hide()):$("#exactRepeatTab,#logoRepeatTab,.product-positions .pos-heading").show();k.forEach(function(n){n.visible&&ef.loadTemplate(io,{index:n.index,name:n.name,onClick:"logoUpload.stepToDetailStage("+n.index.toString()+")"},{append:!0})})}function eu(n){var t,e,h,c;if(ku.empty(),n>0){for(t=0;t<n;t++){var i="txtSelectPantoneColour"+(t+1).toString(),a="txtEnterPantoneColour"+(t+1).toString(),u="ddlMatchColour"+(t+1).toString(),v="txtSelectMarathonColour"+(t+1).toString(),f="ddlFoilColour"+(t+1).toString(),y="Mnumber"+(t+1).toString();ku.loadTemplate(ro,{number:t+1,Mnumber:y,exactPantoneControlId:a,selectPantoneControlId:i,ddlMatchColourControlId:u,selectMarathonControlId:v,ddlFoilColourControlId:f,className:"col-md-3 printColourField HideColour",HideShowFoilColor:"display:none;"},{append:!0});e=_.map(pt,function(n){var t={};return t[n.pantone]="#"+n.hex,t});$("#"+i).paletteColorPicker({colors:e,insert:"after"});h=$("#"+u);dh(h);c=$("#"+f);gh(c)}s.brandingMethod.indexOf("FL")==0?($("#colourSection .HideColour,.HideShowMarathonColor").hide(),$("#colourSection .ShowFoilColour").show(),$(tt).val(""),$(".palette-color-picker-button.MarathonControlId").removeAttr("style"),$(d).val(""),$(".cPreview").css("background-color","white"),$(it).val(""),$(".palette-color-picker-button:not(.MarathonControlId)").css("background-color","white"),at(),p.fadeOut(),at(),p.fadeOut(),o=r.None,p.fadeIn()):($("#colourSection .HideColour,.HideShowMarathonColor").show(),$("#colourSection .ShowFoilColour").hide(),gf(s.brandingMethod)?$('.HideShowMarathonColor,div[data-style="HideShowMarathonColor"]').show():$('.HideShowMarathonColor,div[data-style="HideShowMarathonColor"]').hide());gs();nh();$(".swatch").on("click",function(){var n=$(this).parent().parent().prev();ni(n)});$(".MarathonControlId").click(function(){$(".txtEnterPantoneColour,.txtSelectPantoneColour").filter(function(){return $(this).val()}).length>0?l("You may not select a combination of Pantone colours and Marathon Thread colours. Please select only Pantones colours or Marathon Thread colours. You may select a combination of “exact Pantones”, “choose from” and “not sure, match to colour”."):(typeof clickedMarathon=="undefined"?window.clickedMarathon=$(this).attr("id"):clickedMarathon=$(this).attr("id"),$("#MarathonPickerControl").fadeIn(),$("#modalLogoUpload").animate({scrollTop:0},800))});$('#MarathonPickerControl [data-dismiss="MarathonPickerControl"]').click(function(){$("#MarathonPickerControl").fadeOut()})}}function as(){return $(d).removeClass(sf),Promise.resolve().then(function(){var n=[],u=!0;return $(d).each(function(){var e=$(this),i=$(this).val(),f;((o&r.MatchLogoColour)==0||(o&r.MatchToneOnToneColour)==0)&&(i="");i&&(f=t.getPantoneColours(i).then(function(n){var t=_.find(n,function(n){return n[0]==i});t||(u=!1,e.addClass(sf))}),n.push(f))}),n.length&&i.show(),Promise.all(n).then(function(){return i.hide(),u}).catch(function(){return i.hide(),u})})}function vs(){return t.loadContactsAndSizes(c.productCode,s.position,s.brandingMethod,c.colourCode).then(function(n){var t=n.TheData.BrandingPositionDetails.Width,i=n.TheData.BrandingPositionDetails.Height;t>0?a.attr("placeholder","Width (Max "+t.toString()+"mm)"):a.attr("placeholder","Width");i>0?v.attr("placeholder","Height (Max "+i.toString()+"mm)"):v.attr("placeholder","Height");a.attr("max",t===-1?-1:t);v.attr("max",i===-1?-1:i)}).catch(function(n){l(n)})}function ys(){function n(n){var i=parseFloat(n.val()!=""?n.val():"0"),t=parseFloat(n.get(0).max),r;i<0?n.val(0):t>0&&i>t&&(r="Please note you have entered a value larger than the available amount. Your input has been reverted to the maximum value ("+t.toString()+" mm) allowed.",st(r),n.val(t))}v.unbind("change");a.unbind("change");v.change(function(){n($(this))});a.change(function(){n($(this))})}function ou(){if(si(),wu.empty(),productInventoryType===productTypes.NormalProduct){var n=s.numColours,r=c.productIndex,u=$("#txtlogoRepeatJob").val().toUpperCase().trim(),f=$("#logoRepeatInputFilterFromOrder").val(),e=$("#logoRepeatInputFilterToOrder").val();li.removeClass("border-red");i.show();s.brandingMethod=="FL"&&(n=1);t.searchRepeatJobCard(u,n,s.brandingMethod,r,c.productCode,c.colourCode,c.size,f,e,c.productColoursAndSizes).then(function(n){i.hide();var t=n.Repeats;t.length?(t.forEach(function(t){var i=bf(t.JobCardCreatedDate),r=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2);wu.loadTemplate(ye,{jobCardNumber:t.JobCardNumber,orderNumber:t.OrderNumber,logoName:t.LogoName,date:r,previewClick:"logoUpload.downloadDocument('LAYOUT', '"+t.JobCardNumber+"');",selectClick:"logoUpload.submitRepeat('"+t.JobCardNumber+"', '"+t.AccountNumber+"','"+t.PrintProcessNumberOfColors+"','"+n.PrintDepartmentName+"','"+t.LogoName.replace(/'/g,"\\'")+"');"},{append:!0})}),ar.show(),wi.show()):(et=!1,st("You have no previous job cards that can be repeated for this particular product. Jobs that have not been completed in production as yet cannot be used as exact repeat references."))}).catch(function(n){i.hide();l("An error occured: "+n)})}}function bf(n){return new Date(parseInt(n.substr(6)))}function ps(n=false){n!=!0?(bu.empty(),nr=1,si()):hi.show();var r=ri.val().toUpperCase().trim(),u=$("#LogoRepeatInputFilterFrom").val(),f=$("#LogoRepeatInputFilterTo").val();i.show();ri.removeClass("border-red");t.getJobCardLogos(r,u,f,kf,nr).then(function(t){i.hide();t.TheData.length?(t.TheData.forEach(function(n){var t=bf(n.JobCardCreatedDate),i=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2),r=n.LogoName.replace(/[^a-zA-Z ]/g,"");bu.loadTemplate(pe,{jobCardNumber:n.JobCardNumber,orderNumber:"ABC",description:n.LogoName,date:i,productCode:n.ProductBaseCode,previewClick:"logoUpload.downloadDocument('LAYOUT', '"+n.JobCardNumber+"');",selectClick:"logoUpload.copyJobCardLogo('"+n.AccountNumber+"','"+r+"','"+n.JobCardId+"','"+n.JobCardNumber+"');"},{append:!0})}),hi.show(),wi.show(),t.TotalPages!==t.CurrentPage&&n===!0?($("#loadMoreLogoRepeat").fadeIn(),nr=t.CurrentPage+1):t.TotalPages===t.CurrentPage?$("#loadMoreLogoRepeat").hide():n===!1&&r===""?$("#loadMoreLogoRepeat").fadeIn():$("#loadMoreLogoRepeat").hide()):(st("No logos could be found."),et=!1,$("#loadMoreLogoRepeat").hide())}).catch(function(){l("An error occured, so the previous logos cannot be retrieved.");i.hide();$("#loadMoreLogoRepeat").hide()})}function ws(n){i.hide();l(n)}function si(){ar.hide();hi.hide();wi.hide()}function bs(n){return $(n).closest(".ProgressContainer").remove(),console.log(n),!1}function ir(){(o&r.IsCopy)>0&&(o=o-r.IsCopy)}function su(){ot()&&(o=o-r.IsRepeat)}function rr(n,t){au.length>0?(ci.val(n),kt.show(),vi.attr("href",t)):(ut.show(),ut.html("View layout for "+n),ut.attr("onclick","logoUpload.downloadDocument('LAYOUT', '"+n+"');"),vi.hide());n.startsWith("JC0")&&(wr.show(),ut.show(),ut.html("View layout for "+n),ut.attr("onclick","logoUpload.downloadDocument('LAYOUT', '"+n+"');"));ai.show();gu.hide();$("#pDescription3").hide();$("#pDescription").hide()}function ur(){ve.show();kt.show();si();ai.hide();vi.hide();ft.removeAttr("selected")}function ks(){h=null;ir();ur()}function ds(){$("#lnkFileUpload").is(":visible")&&($("#txtLogoName").val()!=""?($("#logoUploadFile").click(),$("#txtLogoName").removeClass("border-red")):(alertMessage("Please enter a description or name for the artwork you are uploading."),$("#txtLogoName").addClass("border-red")))}function gs(){$(d).autocomplete({source:function(n,i){t.getPantoneColours(n.term).then(function(n){var t=$.map(n,function(n){return{label:n[0],value:n[1]}});i(t)}).catch(function(n){l(n)})},minLength:2,select:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background-color","#"+t.item.value),ni($(i)),!1},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")},focus:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background-color","#"+t.item.value),ni($(i)),!1}}).autocomplete("instance")._renderItem=function(n,t){return $("<li>").append(t.label).appendTo(n)}}function nh(){$(tt).autocomplete({source:function(n,i){t.getMarathonColours(n.term).then(function(n){var t=$.map(n,function(n){return{label:n[0],value:n[1]}});i(t)}).catch(function(n){l(n)})},minLength:2,select:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background","#"+t.item.value),ni($(i)),!1},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")},focus:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background","#"+t.item.value),ni($(i)),!1}}).autocomplete("instance")._renderItem=function(n,t){return $("<li>").append(t.label).appendTo(n)}}function th(){return t.getAllPantoneColours().then(function(n){pt=[];n.forEach(function(n){pt.push({pantone:n[0],hex:n[1]})})}).catch(function(n){l(n)})}function ih(){var n=["Black","White","Silver","Gold","Copper","Rose Gold","Rose Pattern","Red","Blue","Light Blue","Green","Orange"];return t.getAllFoilColours().then(function(t){t.Success==!0&&(wt=[],t.TheData.forEach(function(t){var i=t.split(":"),u,r;i[0].toLowerCase().indexOf("pantone")>-1&&(i[0]=i[0].substring(0,i[0].toLowerCase().indexOf("pantone")));u=n.map(n=>n.replace(/\s/g,""));r=$.inArray(i[0],u);r!==-1&&$.grep(wt,function(t){return t.name!==n[r]?!0:!1})&&wt.push({name:n[r],value:i[1]})}))}).catch(function(n){l(n)})}function rh(){a.val()!=""&&(v.val()!=""&&st("You can only specify a width or a height. Because you also entered a width, the height has been cleared."),v.val(""))}function uh(){v.val()!=""&&(a.val()!=""&&st("You can only specify a width or a height. Because you also entered a height, the width has been cleared."),a.val(""))}function fh(n){ae.attr("onclick","logoUpload.downloadDocument('LAYOUT', '"+n+"');")}function eh(n,u){var f=nt;return rt&&(f=rt),t.getStepDetails(g,n,u,f).then(function(n){var t,e,c,u,l,f;if(n){if(t=n,o=r.None,wr.hide(),ut.hide(),n.isRepeat)o=o|r.IsRepeat,le.text(t.jobcardNumber),fh(t.jobcardNumber),yh(),fromArtwork=!1,exactRepeatCheck=!0,$('a[href="#tab-2"]').click();else if(n.isCopyLogo){o=o|r.IsCopy;h=-1;vi.hide();ci.val(t.logoName);nt=t.jobcardNumber;ut.show();et=!0;fromArtwork=!1;let n=t.copyJobCardNumber==null?t.jobcardNumber:t.copyJobCardNumber;rr(n,null);$('a[href="#tab-3"]').click()}g==LogoUploadType.Cart&&t.jobcardNumber?nt=t.jobcardNumber:g==LogoUploadType.JobCard&&n.isRepeat&&t.copyJobCardNumber&&(nt=t.copyJobCardNumber);t.Logo!=null&&(au=t.artworkIDs.split(","),h=t.logoId,b=t.logoName,or=t.Logo.s3Path,rr(b,or));e=t.width;c=t.height;e&&a.val(e);c&&v.val(c);t.position&&ct.val(t.position);bt.val(t.specialInstructions);u=[];t.pantoneColour?u=t.pantoneColour.split(","):t.marathonColour!=null?u=t.marathonColour.split(","):t.foilColour!=null&&(u[0]=t.foilColour);l=cu(s.numColours,s.brandingMethod);eu(l);(o&r.MatchLogoColour)==0&&o==0||(o&r.MatchToneOnToneColour)==0&&o==0||o===r.IsCopy&&u.length>0?(u.length>0||n.foilColour!=null)&&(f=0,$(pi).each(function(){if(f<u.length){var e=$(d,$(this)),s=$(tt,$(this)),l=$(it,$(this)),h=$(yi,$(this)),c=$(kr,$(this)),i=u[f];i&&(i.indexOf(cr)==-1?t.pantoneColour!=null?((n.flags&r.MatchToneOnToneColour)>0?(lt.prop("checked",!0),p.hide(),o=o|r.MatchToneOnToneColour):(n.flags&r.MatchLogoColour)>0&&(ui.prop("checked",!0),p.hide(),o=o|r.MatchLogoColour),e.val(i),e.next().css("background-color","#"+t.colours[f].Hex)):t.marathonColour!=null?(s.val(i),s.next().css("background","#"+t.colours[f].Hex)):t.foilColour!==null&&c.val(i):(i=i.replace(cr,""),h.val(i)))}f++})):o===r.MatchLogoColour?(ui.prop("checked",!0),p.hide(),o=o|r.MatchLogoColour):o===r.MatchToneOnToneColour?(lt.prop("checked",!0),p.hide(),o=o|r.MatchToneOnToneColour):o=o;o===r.None&&(o=o)}i.hide()}).catch(function(n){i.hide();l(n)})}function oh(n,i,r,u,f){b=f;et=!0;t.canJobCardBeExactRepeat(n,r,u,i,c.productCode,c.colourCode,c.size).then(function(){return exactRepeatCheck=!0,ir(),$("body").trigger(er,{productIndex:c.productIndex,position:s.position,uploadForJobCardNumber:rt,logoId:h,logoName:"Logo from: "+n}),ah(n)}).catch(function(n){l(n);li.val("");li.focus();b=null;exactRepeatCheck=!1})}function sh(){li.keypress(function(n){n.keyCode==13&&ou()});ri.keypress(function(n){n.keyCode==13&&logoUpload.getLogosFromPreviousJobCards()});a.keypress(function(n){n.keyCode==13&&(e.preventDefault(),logoUpload.stepForward())});v.keypress(function(n){n.keyCode==13&&(e.preventDefault(),logoUpload.stepForward())})}function hh(){ch().then(function(n){i.hide();n?fr():ce.modal({backdrop:"static",keyboard:!1})}).catch(function(n){i.hide();l(n)})}function ch(){return hu().then(function(n){return n.valid&&g==LogoUploadType.Cart?(i.show(),t.isLogoUploadDetailsComplete()):n.valid})}function fr(n){n||(n=!1);$("body").trigger(ee,{finished:n});vr.modal("hide")}function lh(n,u,f,e){oe=u;i.show();et=!0;exactRepeatCheck=!1;t.canJobCardLogoBeUsed(n,u,f,e).then(function(){return o=o|r.IsCopy,i.hide(),nt=e,di()}).then(function(){h=null;b=null;rr(e);si();st("The logo has been copied. Please fill in the remaining details.");wr.show();$("body").trigger(fe,{productIndex:c.productIndex,position:s.position,uploadForJobCardNumber:rt,logoName:"Logo from "+e})}).catch(function(n){i.hide();(o&r.IsCopy)>0&&(o=o-r.IsCopy);l(n);ri.val("");ri.focus()});$("#loadMoreLogoRepeat").hide()}function ah(n){return nt=n,h=null,o=o|r.IsRepeat,di().then(function(){gt(vu)}).catch(function(){su()})}function df(){pr.show();ur();yr.hide();ir();su();iu()}function vh(){$(".nav-tabs li.active").removeClass("active");$("#tab-1").fadeOut();$("#tab-2").fadeOut();$("#tab-3").fadeOut();$("#tab-4").fadeOut();ii.hide();ti.show();pr.show();ur();yr.hide();exactRepeatCheck=!1;o=r.None;yt=!1;gi(!0,!1)}function yh(){si();pr.hide();yr.show();ai.hide();iu()}function hu(){return Promise.resolve().then(function(){var n=!0,t=y?y.index===k.length-1:!1,u=ot(),i,r;return u?{valid:!0,errorMessage:null}:(y.index===0||t)&&(i=hf(),!i.valid)?i:n&&(y.index===1||t)&&(r=cf(),!r.valid)?r:n&&(y.index===2||t)&&!lu()&&!ne()?lf().then(function(n){return n}):{valid:n,errorMessage:null}})}function ph(n){for(var i=null,t=0;t<pt.length;t++)if(pt[t].pantone===n){i=pt[t].hex;break}return i}function wh(){return $(it).val(""),$(d).val(""),$(".palette-color-picker-button:not(.MarathonControlId)").removeAttr("style"),$(".cPreview").css("background-color","white"),$(it).each(function(){$(this).attr("id",$(this).attr("data-id"));$(this).next().attr("data-target",$(this).attr("data-id"))}),$(d).val(""),$(".cPreview").css("background-color","white"),$(tt).val(""),$(".palette-color-picker-button.MarathonControlId").removeAttr("style"),!1}function ni(n){function h(){u.val("");$(".cPreview",t).css("background-color","white")}function c(){i.val("");$(".palette-color-picker-button:not(.MarathonControlId)",t).removeAttr("style")}function e(){$(tt).val("");$(".palette-color-picker-button.MarathonControlId").removeAttr("style")}function a(){$(it).val("");$(d).val("");$(".palette-color-picker-button:not(.MarathonControlId)").removeAttr("style");$(".cPreview").css("background-color","white");r[0].selectedIndex=0}var t=n.closest(pi),u=$(d,t),o=$(tt,t),i=$(it,t),v=$(kr,t),r=$(yi,t),f,s;if(n.attr("id")!==o.attr("id")&&$(".txtEnterMarathonColour").filter(function(){return $(this).val()}).length>0)a(),i.attr("data-id",i.attr("id")),i.removeAttr("id"),i.next().removeAttr("data-target"),l("You may not select a combination of Pantone colours and Marathon Thread colours. Please select only Pantones colours or Marathon Thread colours. You may select a combination of “exact Pantones”, “choose from” and “not sure, match to colour”.");else switch(n.attr("id")){case u.attr("id"):c();e();r[0].selectedIndex=0;break;case o.attr("id"):a();break;case i.attr("id"):h();e();r[0].selectedIndex=0;break;case r.attr("id"):h();c();e();f=r.val();s=ph(f);u.val(f);u.next().css("background-color","#"+s);r[0].selectedIndex=0}}function bh(n,t){var i="Dashboard/DocumentLoader.aspx"+kh(!1,t,n,!0);document.getElementById("downloadFrame").src=i}function kh(n,t,i,r){var u="";return u+="?Type=JOBCARD",u+="&Widgetid=DashboardJobCards",u+="&CacheMinutes=1000",u+="&FromCache="+n,u+="&DocumentNumber="+t,u+="&DocumentType="+i,u+("&Download="+r)}function dh(n){n.empty();n.append($("<option><\/option>").text("Select a Colour"));f=f.sort(function(n,t){var i=n.name.toLowerCase(),r=t.name.toLowerCase();return i<r?-1:i>r?1:0});f.forEach(function(t){n.append($("<option><\/option>").attr("value",t.pantone).text(t.name))})}function gh(n){n.empty();n.append($("<option><\/option>").attr("value",0).text("Select a Colour"));wt=wt.sort(function(n,t){var i=n.name.toLowerCase(),r=t.name.toLowerCase();return i<r?-1:i>r?1:0});wt.forEach(function(t){n.append($("<option><\/option>").attr("value",t.value).text(t.name))})}function nc(){tf.toggle("slow")}function tc(){uf.toggle("slow")}function cu(n,t){return n<=0&&(n=ic(t)),n}function ic(n){var t=0;return n.indexOf("EM")===0?t=9:n.indexOf("FL")===0&&(t=1),t}function rc(n){return n.indexOf("EM")===0?ie:te}function gf(n){return n.indexOf("EM")===0||n.indexOf("FL")===0?!0:!1}function uc(){var n=ui.prop("checked");n?($("#cbxMatchToneOnToneColour").prop("checked")?$("#cbxMatchToneOnToneColour").prop("checked",!1):(at(),p.fadeOut()),o=o|r.MatchLogoColour):(p.fadeIn(),o=o&~r.MatchLogoColour)}function fc(){var n=lt.prop("checked");n?($("#cbxMatchLogoColour").prop("checked")?$("#cbxMatchLogoColour").prop("checked",!1):(at(),p.fadeOut()),o=o|r.MatchToneOnToneColour):(p.fadeIn(),o=o&~r.MatchToneOnToneColour)}function lu(){return(o&r.MatchLogoColour)>0}function ne(){return(o&r.MatchToneOnToneColour)>0}function ec(){var n=_.map(w,function(n){return n.productIndex});return _.min(_.filter(n,function(n){return n>c.productIndex}))}function oc(){var n=_.map(w,function(n){return n.productIndex});return _.max(_.filter(n,function(n){return n<c.productIndex}))}var g,ue="REUSE_LOGO_EVENT",er="LOGO_UPLOADED_EVENT",fe="LOGO_COPIED_EVENT",ee="LOGO_UPLOAD_CLOSED",o=0,nt,rt,h,au=[],b,or,vt,sr,yt,hr,sc=$("#hfCustomerId").val(),oe=null,w=[],c=null,s=null,vu=null,y=null,pt=[],wt=[],ht=[],cr=" (Match Colour)",yu=$("#modalLogoUpload"),a=$("#txtJCLogoWidth"),v=$("#txtJCLogoHeight"),ct=$("#ddlPosition"),bt=$("#txtMessage"),hc=$("#colourSection"),ti=$("#btnNextBrandStep"),lr=$("#btnPrevBrandStep"),ii=$("#btnFinishBrandStep"),pu=$("#logoHelp"),cc=$("#productImg"),ar=$(".logoUpload-table"),wu=$("#repeatRows"),bu=$("#logoRows"),hi=$("#tableLogos"),ku=$("#printColours"),du=null,lc=$("#downloadFrame"),se=$("#sizeSection"),he=$("#positionSection"),vr=$("#modalLogoUpload"),ce=$("#modalConfirmClose"),ri=$("#txtPreviousJob"),ci=$("#txtLogoName"),ut=$("#linkDownloadCopiedLogo"),li=$("#txtRepeatJobCard"),ac=$("#btnUseDifferentLogo"),vc=$("#btnCancelExactRepeat"),yr=$("#logoRepeatSection"),yc=$("#logoUploadSection"),pr=$("#chooseLogoSection"),le=$("#repeatJobCard"),ai=$("#pnlLogoDetails"),ae=$("#btnViewRepeatJobCard"),ve=$("#lnkFileUpload"),kt=$("#logoNameInput"),vi=$("#lnkDownloadLogo"),wr=$("#divFileUploadResponse"),gu=$("#cartLogos"),ft=$("#ddlCartLogos"),nf=$("#lnkWhatIsVectorArt"),tf=$("#vectorArtDesc"),rf=$("#lnkWhatIsConvertedCurves"),uf=$("#convertedCurvesDesc"),ye=$("#logoRepeatRowTemplate"),pe=$("#logoRowTemplate"),we=$("#productTemplate"),be=$("#productTemplateContainer"),ke=$("#productPositionTemplate"),br=$("#productPositions"),pc=br.find("li"),d=".txtEnterPantoneColour",tt=".txtEnterMarathonColour",kr=".ddlFoilColour",it=".txtSelectPantoneColour",yi=".ddlMatchColour",pi=".printColoursRow",de=".cPreview",ge=".palette-color-picker-button",no=".MarathonControlId",to=$("#productBtnTemplate"),ff=$("#productBtnsContainer"),io=$("#detailTabHeaderTemplate"),ro=$("#printColourTemplate"),ef=$("#detailTabHeaders"),dr=null,uo=$("#lblPositionDesc"),fo=$("#modalReuseLogo"),eo=$("#modalReuseColour"),wi=$("#lblCompletedJobNote"),ui=$("#cbxMatchLogoColour"),lt=$("#cbxMatchToneOnToneColour"),of=$("#pnlMatchColours"),fi=$("#pnlMatchToneOnToneColours"),p=$("#pnlSelectColours"),sf="invalid-field",oo=$("#ProgressContainer"),so=$("#UploadProgressTemplate"),et=!1,ei=[],bi={fnGetProducts:null,fnGetLogos:null},ho=["pdf","eps","cdr","ai"],dt=[],k=[{index:0,name:"Upload Artwork",elementId:"logoUploadSection",aboutElementId:"step1About",visible:!0,validate:function(){return Promise.resolve().then(function(){return hf()})}},{index:1,name:"Logo Size and Print Location",elementId:"sizeSection",aboutElementId:"step2About",visible:!0,validate:function(){return Promise.resolve().then(function(){return cf()})}},{index:2,name:"Print Colours",elementId:"colourSection",aboutElementId:"step3About",visible:!0,validate:function(){return Promise.resolve().then(function(){return lf()})}},{index:3,name:"Special Instructions",elementId:"specialInstructionsSection",aboutElementId:"step4About",visible:!0,validate:function(){return Promise.resolve().then(function(){return lo()})}}],gr={Next:1,Back:2},kf,nr,tr,te,ie;return $(document).ready(function(){du=$("#logoUploadFile");pu.hide();var n=!1,t=0;nf.unbind("click");rf.unbind("click");nf.click(function(){nc()});rf.click(function(){tc()});du.fileupload({dataType:"json",url:"AjaxHandlers/LogoUploadHandler.aspx?a=UploadJobCardLogo",limitMultiFileUploads:3,dropZone:$("#dragdrop"),singleFileUploads:!0,submit:function(n,t){t.formData={logoName:$(txtLogoName).val(),customerId:$("#hfCustomerId").val()};i.show()},add:function(r,u){var o,f,h,c;i.show();o=ho;dt.length>0&&(o=dt);$(txtLogoName).val()==""&&l("Logo name not found");var a=o.join("|"),v="(.?|/)("+a+"|application/postscript)$",y=new RegExp(v,"i"),e=u.files[0],s=e.type;s&&s.indexOf("image/")===-1||(s=e.name.split(".").pop());$(txtLogoName).val()===""?(l("Please enter a description or name for the artwork you are uploading."),$(txtLogoName).focus(),$("#txtLogoName").addClass("border-red"),i.hide()):e.size>20971520?(l("The file is too big. Please upload a logo that is smaller than 20 MB."),n=!0,i.hide()):y.test(s)?(u.context=$("#lblFileUploadResponse").html("Uploading file"),f=e.name,f.length>25&&(h=f.substring(0,f.lastIndexOf(".")),c=f.substring(f.lastIndexOf(".")),f=h.substring(0,20)+".."+c),oo.loadTemplate(so,{fileName:f,ProgressValue:10,ProgressID:"uploadprogress_"+e.size,deleteClick:"return logoUpload.removeUploadedFile(this)"},{append:!0}),$("#logoUploadSection .ShowProgress,#logoUploadSection .uploadedListItem").fadeIn(),$("h3.UploadStatusText").text("Uploading"),u.submit(),n=!1,t++):(l(e.name+" - Invalid file type! Please ensure that you supply artwork in one of the following acceptable formats: "+o.join(", ")),i.hide(),n=!0);$(txtLogoName).val()!==""&&$("#txtLogoName").removeClass("border-red")},done:function(r,u){var l,o,c,s,f,e;if(ArtworkLibraryIntegration.ClearSelectedArtwork(),l=$(".ProgressLoader progress#uploadprogress_"+u.files[0].size),u.result.Success){if($("#lblFileUploadResponse").html("Artwork successfully uploaded."),ei.push(u.result.TheData),o={id:u.result.TheData.logoId,name:$(txtLogoName).val(),URL:u.result.TheData.URL},ht.push(o),uu(),b=o.name,or=o.URL,rr(o.name,o.URL),ir(),su(),u.originalFiles.length===tr||n===!0||t>0){for(i.hide(),tr=0,c=[],s=0;s<ei.length;s++)f=ei[s],e={},e.Preview="<a class='PreviewIcon' onclick=\"ArtworkLibraryIntegration.DownloadContactArtwork("+f.logoId+")\"><i class='fa fa-eye'><\/i><\/a>",e.FileName="<p style='display:none;'>"+f.Name+"<\/p><span class='EditableFileName' data-id='"+f.logoId+"'>",e.FileName+='<input type="text" value=\''+f.Name+"' data-TxtID='"+f.logoId+'\' disabled class="RenameFileName"  onkeypress="ArtworkLibraryIntegration.UpdateArtworkFileNameOnKeypress(\''+f.logoId+'\')" /> <i class="fa fa-circle-o-notch fa-spin RanameLoader"><\/i><i class="fa fa-check RenameDone" style="color: #018001;"><\/i>',e.FileName+='<button type="button" class="btn btn-sm btn-circle" data-BtnID=\''+f.logoId+"'  onclick=\"ArtworkLibraryIntegration.UpdateArtwork('"+f.logoId+'\')"><i class="fa fa-save"><\/i><\/button>',e.FileName+="<\/span>",e.Size=f.Size,e.Select='<input type="checkbox" data-id=\''+f.logoId+"' name=\"select\"  data-checkbox1='"+f.logoId+"' onclick=\"ArtworkLibraryIntegration.CountSelectedArtworkTab1("+f.logoId+')" checked />',e.Select+='<div class="dropdown default-dropdown" style="float: right; cursor: pointer">',e.Select+='<a class="dropbtn" aria-haspopup="true" aria-expanded="false" id="dropdownMenuLink"><i class="fa fa-ellipsis-v"><\/i> <\/a>',e.Select+='<div class="dropdown-content" style="left: -95px; border: 1px solid #b8b8b8;">',e.Select+='<a class="text-primary" onclick="ArtworkLibraryIntegration.ToggleUpdateArtworkFileName('+f.logoId+')"> <i class="fa fa-edit"><\/i>Rename<\/a><\/a>',e.Select+='<a class="text-primary" onclick="ArtworkLibraryIntegration.DeleteArtwork('+f.logoId+')"> <i class="fa fa-times"><\/i>Delete<\/a><\/a>',e.Select+="<\/div>",c.push(e),SelectedArtworkTab1.push(ei[s].logoId);ArtworkLibraryIntegration.GetpreviouslySelectedArtworkTab1();h=[];$("table#tbUploadedFiles1").DataTable({processing:!0,destroy:!0,data:c,columns:[{data:"Preview"},{data:"FileName"},{data:"Size"},{data:"Select"}],info:!1,ordering:!1,pageLength:5}).on("draw.dt",function(){if($.each(SelectedArtworkTab1,function(n,t){$.inArray(t,SelectedArtworkTab1)>-1&&SelectedArtworkTab1.splice(SelectedArtworkTab1.indexOf(t),1)}),DiselectedArtworkCount.length>0)for(var n=0;n<DiselectedArtworkCount.length;n++)$("#tbArtworkData1 input[type='checkbox'][data-checkbox1='"+DiselectedArtworkCount[n]+"']").prop("checked",!1),SelectedArtwork1=jQuery.grep(SelectedArtwork1,function(t){return t!==DiselectedArtworkCount[n]})})}}else $(".ShowProgress .circle strong").text("0%"),$("h3.UploadStatusText").text("Upload Error"),l.addClass("error"),ws(u.result.Error);u=null;tr++},processfail:function(n,t){alert(t.files[t.index].name+"\n"+t.files[t.index].error)}}).bind("fileuploadprogress",function(n,t){var i=parseInt(t.loaded/t.total*100,10);$(".uploadprogress_"+t.files[0].size).each(function(){$(this).hasClass("done")!=!0&&($(this).text(i+"%"),$(this).val(i))})}).bind("fileuploadchunksend",function(){}).bind("fileuploaddone",function(){$(".ShowProgress .circle strong").text("100%");$("h3.UploadStatusText").text("Upload Done");i.hide()}).bind("fileuploadprogressall",function(n,t){var i=parseInt(t.loaded/t.total*100,10);$(".ShowProgress .circle strong").fadeOut("fast",function(){$(".ShowProgress .circle strong").fadeIn("fast")});i==100?$(".ShowProgress .circle strong").text("99%"):$(".ShowProgress .circle strong").text(i+"%");i==100&&(ArtworkLibraryIntegration.GetpreviouslySelectedArtworkTab1(),$("#ProgressContainer progress").addClass("done"),$("#ProgressContainer progress").text("100%"),$("#ProgressContainer progress").val(100))}).bind("fileuploadfail",function(n,t){l("Oops! Failed to upload file.");console.log(t);i.hide()});$("#modalLogoUpload").on("hidden.bs.modal",function(){$("#tbUploadedFiles_filter input").val("");$("#tbUploadedFiles_filter input").trigger("keyup");$("#chooseLogoSection ul.nav-tabs>li").removeClass("active")});$("#modalConfirmClose").on("hidden.bs.modal",function(){$(".modal.in").length==1&&$("body").addClass("modal-open")});$("#LogoRepeatInputFilterTo").datepicker({yearRange:"1999:c+1",changeYear:!0,maxDate:"+30Y"});$("#LogoRepeatInputFilterFrom").change(function(){$("#LogoRepeatInputFilterTo").val("");var n=$(this).val(),t={Year:new Date(n).getFullYear(),Month:new Date(n).getMonth()+1,Day:new Date(n).getDate()},i=new Date(t.Year,t.Month-1,t.Day+1);$("#LogoRepeatInputFilterTo").datepicker("setStartDate",i)});$("#LogoRepeatInputFilterTo").datepicker({yearRange:"1999:c+1",changeYear:!0,maxDate:"+30Y"});$("#logoRepeatInputFilterFromOrder").change(function(){$("#logoRepeatInputFilterToOrder").val("");var n=$(this).val(),t={Year:new Date(n).getFullYear(),Month:new Date(n).getMonth()+1,Day:new Date(n).getDate()},i=new Date(t.Year,t.Month-1,t.Day+1);$("#logoRepeatInputFilterToOrder").datepicker("setStartDate",i)})}),kf=30,nr=1,tr=1,te=["Top-left of branding area","Top-centre of branding area","Top-right top of branding area","Middle-left of branding area","Middle-centre of branding area","Middle-right of branding area","Bottom-left of branding area","Bottom-centre of branding area","Bottom-right of branding area"],ie=["Left","Right","Centered"],re}(handleLoadError,new DataService,new CartLoading,LogoUploadFlags,alerterService,standardColours);logoUpload=new LogoUpload,function(n,t){"use strict";var i='<a class="add-logo24">Upload Artwork <i class="fa fa-exclamation-triangle" aria-hidden="true"><\/i><\/a>',r='<div class="edit-logo24" logo-id="" logo-name="" style="overflow-wrap: anywhere;"><span class="logo24-logo"><\/span><img class="edit-logo24-btn cartTip" src="images/icn-edit-lg.png" alt="edit" data-toggle="tooltip" data-placement="top" data-original-title="Edit branding information" title="Edit branding information" /><i class="fa fa-times cartTip remove-branding-btn" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Remove branding" title="Removing branding"><\/i><\/div>';n.fn.logoColumn=function(u){function k(){n("body").on(a,function(n,t){f.logoName=t.logoName;f.logoId=t.logoId;s(t.logoName,t.logoId)})}function d(){n("body").on(v,function(n,t){f.productIndex==t.productIndex&&f.position==t.position&&f.jobCardNumber==t.uploadForJobCardNumber&&t.logoName&&(f.logoName=t.logoName,f.logoId=t.logoId,f.displayProd=t.displayProd,e.attr("isDisplayProduct",t.displayProd),s(t.logoName,t.logoId))})}function g(){n("body").on(y,function(n,t){f.productIndex==t.productIndex&&f.position==t.position&&f.jobCardNumber==t.uploadForJobCardNumber&&(f.logoName=t.logoName,f.logoId=null,s(t.logoName,null))})}function s(n,t){e.show();e.attr("logo-id",t);e.attr("logo-name",n);p.html(n);h.hide()}function c(){h.show();e.hide()}function l(){DashboardJobCardModuleController.FromOnlineApprovals&&(f.jobCardNumber=DashboardJobCardModuleController.LogoJobCardNumber);t.open(f.uploadType,f.productIndex,f.position,f.jobCardNumber,f.fnGetProducts,f.fnGetLogos,f.inventoryType)}function nt(){return f.uploadType==LogoUploadType.Cart?dataService.deleteBranding(f.productCode,f.productIndex,f.position).then(function(){c();ArtworkLibraryIntegration.ClearSelectedArtwork();alert("The branding details have been removed.")}).catch(function(n){alert(n)}):dataService.deleteJobCardBranding(f.jobCardNumber).then(function(){c();ArtworkLibraryIntegration.ClearSelectedArtwork();alert("The branding details have been removed.")}).catch(function(n){alert(n)})}var a="REUSE_LOGO_EVENT",v="LOGO_UPLOADED_EVENT",y="LOGO_COPIED_EVENT",f=u,o=this;o.html(i+r);var h=o.find(".add-logo24"),e=o.find(".edit-logo24"),p=o.find(".logo24-logo"),w=e.find(".edit-logo24-btn"),b=o.find(".remove-branding-btn");return k(),d(),g(),h.click(function(){l()}),w.click(function(){l()}),b.click(function(){nt()}),f.logoId||f.logoName?s(f.logoName,f.logoId):c(),f.openWithModal&&l(),this}}(jQuery,logoUpload);var Logo24UploadFlags={None:0,ReplicateLogo:1,ReplicatePantone:2,ConfirmedLogoReplication:4,ConfirmedPantoneReplication:8},dataService=new DataService,loadingService=new CartLoading;var Logo24Uploader=function(n,t,i,r){"use strict";function u(n,t,i,u,f,e){this.CONFIRMED_REPLICATION_EVENT="CONFIRMED_LOGO_REPLICATION_EVENT";this.LOGO_ADDED_EVENT="LOGO_ADDED_EVENT";this.dfd=$.Deferred();this.productCode=n;this.productIndex=t;this.position=i;this.logo=u;this.logoNameBeingUploaded=null;this.flags=r.None;this.askForReplication=e;this.replicate=!1;this.logos=f?f:[];this.linkToHTML();this.showRelevant()}return u.prototype.bindDropDown=function(){var t=this,i,n;this.$ddlLogos.html("");this.logos.length>0&&(i=t.logos.slice(0).reverse(),n="",i.forEach(function(i){if(n!=i.name){var r=$("<option><\/option>");r.html(i.name);r.val(i.id);t.$ddlLogos.append(r)}n=i.name}))},u.prototype.linkToHTML=function(){var n=this;this.$logoUploadFile=$("#logoUploadFile");this.helpInfo=$(".logo-help").html();this.$modal=$("#modalLogo24Upload");this.$confirmReplicateModal=$("#modalConfirmLogoReplicate");this.$txtLogoName=$("#txtLogoName");this.$lnkFileUpload=$("#lnkFileUpload");this.$divFileUploadResponse=$("#divFileUploadResponse");this.$lnkLogoFileDelete=$("#lnkLogoFileDelete");this.$pnlLogoDetails=$("#pnlLogoDetails");this.$downloadFrame=$("#downloadFrame");this.$ddlLogos=$("#ddlLogos");this.$uploadColumn=$("#logo24UploadCol");this.$logo24LogosCol=$("#logo24LogosCol");this.$btnUpload=$("#btnUploadlogo24Uploader");this.$lnkWhatIsVectorArt=$("#lnkWhatIsVectorArt");this.$vectorArtDesc=$("#vectorArtDesc");this.$lnkWhatIsConvertedCurves=$("#lnkWhatIsConvertedCurves");this.$convertedCurvesDesc=$("#convertedCurvesDesc");this.initUploadControl();this.bindDropDown();this.$convertedCurvesDesc.hide();this.$vectorArtDesc.hide();this.$lnkWhatIsVectorArt.unbind("click");this.$lnkWhatIsConvertedCurves.unbind("click");this.$lnkWhatIsVectorArt.click(function(){n.toggleVectorArtDesc()});this.$lnkWhatIsConvertedCurves.click(function(){n.toggleConvertedCurvesDesc()})},u.prototype.showRelevant=function(){this.logos.length>0?(this.$logo24LogosCol.show(),this.$btnUpload.show(),this.$uploadColumn.attr("class","col-md-4")):(this.$logo24LogosCol.hide(),this.$btnUpload.hide(),this.$uploadColumn.attr("class","col-md-8"))},u.prototype.showError=function(t){i.hide();n.error(t)},u.prototype.showInfo=function(t){n.info(t)},u.prototype.initUploadControl=function(){var n=this;this.$logoUploadFile.fileupload({dataType:"json",url:"AjaxHandlers/LogoUploadHandler.aspx?a=UploadJobCardLogo24",submit:function(n,t){t.formData={customerId:$("#hfCustomerId").val()};$("#divWait").show()},add:function(t,r){var u=r.files[0],f=u.type;f||(f=u.name.split(".").pop());u.size>5242880?n.showError("The file is too big. Please upload a logo that is smaller than 5 MB."):n.isUniqueLogoName(u.name)?/(\.?|\/)(pdf|eps|cdr|ai|application\/postscript)$/i.test(f)?(i.show(),n.logoNameBeingUploaded=r.files[0].name,r.submit()):n.showError("Invalid file type! Please ensure that you supply artwork in one of the following acceptable formats .pdf, .cdr, .eps, or .ai."):n.showError("You already uploaded a logo with this name.")},done:function(t,r){if(i.hide(),$("#divWait").hide(),r.result.Success){n.showInfo("Artwork successfully uploaded.");var u={id:r.result.TheData.logoId,name:n.logoNameBeingUploaded};n.logos.push(u);n.logoNameBeingUploaded=null;n.bindDropDown();n.showRelevant()}else n.showError(r.result.Error)}})},u.prototype.isUniqueLogoName=function(n){var t=!0,i=_.find(this.logos,function(t){return t.name==n});return i&&(t=!1),t},u.prototype.showHelp=function(){this.showInfo(this.helpInfo)},u.prototype.downloadLogo=function(){var n=window.location.origin+(window.location.href.indexOf("/amrod2015")>0?"/amrod2015":"")+"/AjaxHandlers/LogoUploadHandler.aspx?a=DownloadLogo&logoId="+this.logoId.toString();this.$downloadFrame.attr("src",n)},u.prototype.upload=function(){this.askForReplication?this.showConfirmReplication():this.save()},u.prototype.replicateLogo=function(){this.flags=this.flags|r.ReplicateLogo;this.replicate=!0;this.closeConfirmReplication()},u.prototype.showConfirmReplication=function(){this.$confirmReplicateModal.modal("show")},u.prototype.closeConfirmReplication=function(){this.$confirmReplicateModal.modal("hide");$("body").trigger(this.CONFIRMED_REPLICATION_EVENT);this.save()},u.prototype.closeModal=function(){this.$modal.modal("hide")},u.prototype.cancel=function(){this.closeModal();this.dfd.reject()},u.prototype.showModal=function(){return this.$modal.modal("show"),this.dfd=$.Deferred(),this.dfd.promise()},u.prototype.save=function(){var n=this,i;this.logo={id:this.$ddlLogos.val(),name:this.$ddlLogos.find("option:selected").text()};i={logo:n.logo,replicate:n.replicate};t.addLogo24Details(this.productCode,this.productIndex,this.position,this.logo.id,this.pantoneColour,this.flags).then(function(){n.closeModal();n.showInfo("The logo has been uploaded.");n.dfd.resolve(i);n.flags=r.None},function(t){n.showError(t)})},u.prototype.toggleVectorArtDesc=function(){this.$vectorArtDesc.toggle("slow")},u.prototype.toggleConvertedCurvesDesc=function(){this.$convertedCurvesDesc.toggle("slow")},u}(alerterService,dataService,loadingService,Logo24UploadFlags),logo24Uploader=null,Logo24Colour=function(n,t,i,r,u){function f(n,t,i,u,f,e){this.CONFIRMED_REPLICATION_EVENT="CONFIRMED_PANTONE_REPLICATION_EVENT";this.dfd=$.Deferred();this.productCode=n;this.productIndex=i;this.position=t;this.logoId=u;var o=this;this.linkToHTML();this.flags=r.None;this.askForReplication=e;this.replicate=!1;this.getPantoneColours().then(function(){if(f){var n=o.getPantoneHex(f);o.setSelectedPantone(f,n)}});this.clearExactPantone();this.clearDropDown()}return f.prototype.linkToHTML=function(){var n=this;this.$modal=$("#modalLogo24Colour");this.$txtExactColour=$("#txtExactColour");this.initPantoneAutoComplete();this.$ddlMatchColour=$("#ddlMatchColour");this.$pantoneColourPreview=$("#pantoneColourPreview");this.$confirmReplicateModal=$("#modalConfirmPantoneReplicate");this.$ddlMatchColour.empty();u=u.sort(function(n,t){var i=n.name.toLowerCase(),r=t.name.toLowerCase();return i<r?-1:i>r?1:0});u.forEach(function(t){n.$ddlMatchColour.append($("<option><\/option>").attr("value",t.pantone).text(t.name))})},f.prototype.showError=function(t){i.hide();n.error(t)},f.prototype.showInfo=function(t){n.info(t)},f.prototype.initPantoneAutoComplete=function(){var n=this;this.$txtExactColour.autocomplete({source:function(t,i){var r=_.filter(n.pantoneColours,function(n){return n.pantone.toLowerCase().indexOf(t.term.toLowerCase())>=0}),u=_.map(r,function(n){return{label:n.pantone,value:n.hex}});i(u)},minLength:2,select:function(t,i){return n.clearDropDown(),n.setSelectedPantone(i.item.label,i.item.value),!1},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}}).autocomplete("instance")._renderItem=function(n,t){return $("<li>").append(t.label).appendTo(n)}},f.prototype.setSelectedPantone=function(n,t){this.pantoneColour=n;this.$txtExactColour.val(n);this.$txtExactColour.next().css("background-color","#"+t)},f.prototype.handleDropDownChange=function(){var i=this,n,t;this.clearExactPantone();n=this.$ddlMatchColour.val();t=this.getPantoneHex(n);this.setSelectedPantone(n,t)},f.prototype.getPantoneHex=function(n){for(var i=null,t=0;t<this.pantoneColours.length;t++)if(this.pantoneColours[t].pantone==n){i=this.pantoneColours[t].hex;break}return i},f.prototype.getPantoneColours=function(){var n=this,i=$.Deferred();return t.getAllPantoneColours().then(function(t){n.pantoneColours=[];t.forEach(function(t){n.pantoneColours.push({pantone:t[0],hex:t[1]})});i.resolve()}),i.promise()},f.prototype.clearExactPantone=function(){this.$txtExactColour.val("");this.$pantoneColourPreview.css("background-color","white")},f.prototype.clearDropDown=function(){this.$ddlMatchColour.val("")},f.prototype.upload=function(){this.askForReplication?this.showConfirmReplication():this.save()},f.prototype.replicatePantone=function(){this.flags=this.flags|r.ReplicatePantone;this.replicate=!0;this.closeConfirmReplication()},f.prototype.showConfirmReplication=function(){this.$confirmReplicateModal.modal("show")},f.prototype.closeConfirmReplication=function(){this.$confirmReplicateModal.modal("hide");$("body").trigger(this.CONFIRMED_REPLICATION_EVENT);this.save()},f.prototype.closeModal=function(){this.$modal.modal("hide")},f.prototype.cancel=function(){this.closeModal();this.dfd.reject()},f.prototype.showModal=function(){return this.$modal.modal("show"),this.dfd=$.Deferred(),this.dfd.promise()},f.prototype.save=function(){var n=this;if(!this.pantoneColour){this.showError("Please select a colour.");return}t.addLogo24Details(this.productCode,this.productIndex,this.position,this.logoId,this.pantoneColour,this.flags).then(function(){n.closeModal();n.showInfo("The colour details have been saved.");var t={pantoneColour:n.pantoneColour,replicate:n.replicate};n.dfd.resolve(t)}).catch(function(t){n.showError(t)})},f}(alerterService,dataService,new CartLoading,Logo24UploadFlags,standardColours);(function(n){"use strict";var t='<a class="add-logo24">Click to select colour <i class="fa fa-exclamation-triangle" aria-hidden="true"><\/a><\/i>',i='<div class="edit-logo24"><span class="logo24-colour"><\/span><img class="edit-logo24-btn" src="images/icn-edit-lg.png" alt="edit" /><\/div>';n.fn.logo24ColourColumn=function(r,u){function v(t){n("body").trigger(c,t)}function y(){n("body").on(c,function(n,t){h(t)})}function h(n){s.show();var t=e.find(".logo24-colour");t.html(n);o.hide();f.pantoneColour=n}function p(){o.show();s.hide()}function a(){var n=u();logo24Colour=new Logo24Colour(f.productCode,f.position,f.productIndex,f.logoId,f.pantoneColour,n);logo24Colour.showModal().then(function(n){n.replicate?v(n.pantoneColour):h(n.pantoneColour)})}var c="REPLICATE_PANTONE_EVENT",f=r,e=this,o,s,l;return y(),e.html(t+i),o=e.find(".add-logo24"),s=e.find(".edit-logo24"),o.click(function(){a()}),l=s.find(".edit-logo24-btn"),l.click(function(){a()}),f.pantoneColour?h(f.pantoneColour):p(),this}})(jQuery);logo24Colour=null,function(n){"use strict";var t='<a class="add-logo24">Click to add logo <i class="fa fa-exclamation-triangle" aria-hidden="true"><\/i><\/a>',i='<div class="edit-logo24" logo-id="" logo-name=""><span class="logo24-logo"><\/span><img class="edit-logo24-btn" src="images/icn-edit-lg.png" alt="edit" /><\/div>';n.fn.logo24LogoColumn=function(r,u,f){function w(t){n("body").trigger(l,t)}function b(){n("body").on(l,function(n,t){c(t)})}function c(n){o.show();o.attr("logo-id",n.id);o.attr("logo-name",n.name);y.html(n.name);h.hide();e.logo=n}function k(){h.show();o.hide()}function a(){var n=v(),t=f();logo24Uploader=new Logo24Uploader(e.productCode,e.productIndex,e.position,e.logo,n,t);logo24Uploader.showModal().then(function(n){n.replicate?w(n.logo):c(n.logo)})}var l="REPLICATE_LOGO_EVENT",v=u,e=r,s=this;s.html(t+i);var h=s.find(".add-logo24"),o=s.find(".edit-logo24"),y=s.find(".logo24-logo"),p=o.find(".edit-logo24-btn");return b(),h.click(function(){a()}),p.click(function(){a()}),e.logo?c(e.logo):k(),this}}(jQuery);Ordering={},function(n){var t=function(){"use strict";function t(n){var t="An error occured.";try{n.Error?t=n.Error:n.responseJSON&&n.responseJSON.Error?t=n.responseJSON.Error:n.TheData&&(t=n.TheData)}catch(i){}return t}var i="AjaxHandler.aspx",n=function(){};return n.getCartSummary=function(n){var r=$.ajax({url:i+"?a=GetCartSummary",data:{cartType:n},method:"GET",dataType:"JSON"});return Promise.resolve(r).then(function(n){return n.TheData}).catch(function(n){throw t(n);})},n.removeProductFromCart=function(n,i,r,u){var f=$.ajax({url:"AjaxHandler.aspx?a=RemoveFromCart",data:{p:n,pc:i,colour:-1,i:r,cType:u},dataType:"json"});return Promise.resolve(f).then(function(n){if(n.Success)return n.TheData;throw n.error;}).catch(function(n){throw t(n);})},n}();n.DataService=t}(Ordering);var containerDiv,originalInnerHTML="",posNum,isSample=!1,sampleShop="",components="",curComp="",compIndex=Number(0),brandingDone=!1,curProdIndex=null,wwMatchIndex=null,isHidden=!1,methods,positions,_itemCode="",heading=["",""],matchingCode="",selectClass=".cbSelected",matching_selectClass="",gender=0,matchingGender=0,gclass=[0,0],ggender="",productMatchType="",matchingProductType="",mclass=["",""],mmatch="",specialImageUrl="",addBrandingInfo=!1,$btnAddAllBrandInfo=$("#btnAddAllBrandInfo"),productPositions=[],$modalOrderOnline=$("#modalOrderOnline"),$cartLoading=$("#cartLoading"),_cartType="",_logo24Branding,_logo24BrandingAdded=!1,_timeoutId=0,logo24Flags=0,_setType,_cartHasDelivery=!1,EM_TBA=!1,springBokFlag=!1,minCatalogueQty=0,maxCatalogueQty=0,cartQtyPerCatalogueQty=0,IncrementalValue=0,isValidCatalogueQuantities=!1,hasIncrementalValue=!1,isHiddenComp=!1,isLockdownProduct=!1,isDisplayProduct=!1,displayProd,_isBrandingRequired=!1,_isNoCoBranding=!1,isCustomCatalog=!1,_isWorkWear=!1,_isLeadTimeMO=!1,_editFromCart=!1,_isCustomPackaging=!1,_isJodam=!1,isCustomBoxes=!1,isGiftset=!1,isGiftsetNoColourOption=!1,productTypes={DisplayProduct:1,NormalProduct:2,WorkWearProduct:3,CustomPackaging:4},productInventoryType,MainItem={isSample:!1,MainProduct:{}},customeCatalogueProd=["TEMPLATECAT","UNIQUE","CA-AM-"];$(document).ready(function(){$("#txtQuickAddCode").keypress(function(n){n.which===13&&(n.preventDefault(),$("#lnkQuickAdd").click())});$(window).keydown(function(n){if(n.keyCode===13){if($("#atcColours").is(":visible"))return n.preventDefault(),atcNext(),!1;if($("#atcQuantities").is(":visible"))return _cartType==="logo24"?ConfirmLogo24CartQuantities():RemoveAndAddToCart(),n.preventDefault(),!1;if($("#atcNextPosButton").is(":visible"))return atcNextPosition(),n.preventDefault(),!1;if($("#atcNoBranding").is(":visible")||$("#atcBranding").is(":visible")&&$("#atcDoneButton").is(":visible"))return RemoveAndAddToCart(),n.preventDefault(),!1;if($("#atcDone").is(":visible"))return $("#txtNextProductCode").val().length>0?QuickAddToCart(!1,$("#txtNextProductCode").val()):window.location="ViewCart.aspx",n.preventDefault(),!1}})});var template_orderItemRow='<div id="RowIndex_##ROWINDEX##" class="orderItem"><div class="col-xs-3 col-md-1 text-center"><img src="##PRODUCTIMAGE##" class="img-responsive cart-thumb"><\/div><div class="col-xs-9 col-md-11"><div class="row"><div class="col-xs-10 col-sm-10 col-md-7"><h3><span>##PRODUCTCODE##<\/span>##PRODUCTNAME##<\/h3><\/div><div class="col-sm-12 col-md-5"><ul class="cart-links"><li><a class="cartTip" data-toggle="tooltip" data-placement="top" data-original-title="Edit this line" href="javascript:##EDITMETHODNAME##(\'##PRODUCTGUID##\', ##ROWINDEX##, ##ISSAMPLE##);"><img src="images/icn-edit-lg.png" alt="edit" class="icn-email"><\/a><\/li><li class="cartCommentIcon hidden"><a class="cartTip" data-toggle="tooltip" data-placement="top" data-original-title="Add a comment to this line" href="javascript:CommentCartItem(\'##FULLPRODUCTCODE##\');"><img src="images/icn-chat.png" alt="add comment"><\/a><\/li><li><a href="javascript:RemoveCartItem(\'RowIndex_##ROWINDEX##\', ##REMOVEPARAMS## );" class="remove"><i class="fa fa-times"><\/i><\/a><\/li><\/ul><\/div><div class="col-sm-12"><table class="table dt-responsive cart-table data-table cartColours" width="100%"><thead>##CARTITEMHEDS##<\/thead><tbody>##ITEMDETAILS##<\/tbody><\/table><\/div>##LINEBRANDING##<\/div><\/div><\/div><hr />',template_itemDetailsRow='<tr><td class="##HIDEBORDER##"><div class="cartProductColour">##PRODUCTCOLOUR##<\/div><\/td><td>##PRODUCTSIZE##<\/td><td>##PRODUCTQTY##<\/td><td>##ITEMCOST##<\/td><td>##TOTALITEMCOST##<\/td><\/tr>',template_brandingRow='<tr std-cart-row id="brandPosition_##POSITION##" bposition="##POSITION##" isRepeat="##ISREPEAT##" logo-name="##LOGONAME##" logo-id="##LOGOID##" product-code="##PRODUCTCODE##" row-index="##ROWINDEX##" isRequiredBranding="##isRequiredBranding##" isWorkWear="##isWorkWear##" customBoxes="##customBoxes##" template="##ISTEMPLATE##" BRANDMETHOD="##BRANDMETHOD##" class="colourSizeRow bposition"><td><div ##POSITIONNAME## >Position ##POSITION##:<\/div><\/td><td><span id="##ROWINDEX##_pos##POSITION##_bMethod" brandGuid="##BRANDGUID##">##BRANDMETHOD##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_colourstitchVal">##COLOURSTITCHVALUE##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_qty">##BRANDQTY##<\/span><\/td><td>##BRANDSETUP##<\/td><td ##BRANDTOTAL_STYLE##>##BRANDTOTAL##<\/td><td logo-column><\/td><td>##TOTALLINEBRANDING## <a class="lnkCartItemRemove" href="javascript:RemoveBrandPosition(\'##REMOVEBRANDPOSITION-FULLPRODUCTCODE##\', \'##POSITION##\');" title="Click here to remove this branding position"><i class="fa fa-times" ><\/i><\/a><\/td><\/tr>',template_logo24_brandingRow='<tr logo24-row id="brandPosition_##POSITION##" bposition="##POSITION##" isRepeat="##ISREPEAT##" product-code="##PRODUCTCODE##" row-index="##ROWINDEX##" pantone-colour="##PANTONECOLOUR##" logo-name="##LOGONAME##" logo-id="##LOGOID##" colour-stitch="##COLOURSTITCHVALUE##" class="colourSizeRow bposition"><td><div>Position ##POSITION##:<\/div><\/td><td><span id="##ROWINDEX##_pos##POSITION##_bMethod" brandGuid="##BRANDGUID##">##BRANDMETHOD##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_colourstitchVal">##COLOURSTITCHVALUE##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_qty">##BRANDQTY##<\/span><\/td><td class="logo-24-col-logo">##LOGONAME##<\/td><td class="logo-24-col-colour">##PANTONECOLOUR##<\/td><td>##BRANDSETUP## <a href="javascript:RemoveBrandPosition(\'##REMOVEBRANDPOSITION-FULLPRODUCTCODE##\', \'##POSITION##\');" title="Click here to remove this branding position"><i class="fa fa-times" ><\/i><\/a><\/td><\/tr>',template_leadtimeRow='<tr std-cart-row ><td style="background-color:#f5f5f5; text-align:right; text-transform:unset;" colspan="7"><span style="font-weight:bold;">Total lead time after artwork approval and proof of payment:<\/span>##LEADTIME_15000_EMBROIDERY##<\/td><td style="background-color: #f8cecc;"><span>##BRANDING_LEADTIME##<\/span><\/td><\/tr>',template_leadtimeRow_DisplayProducts='<tr std-cart-row ><td style="background-color:#f5f5f5; text-align:right; text-transform:unset;" colspan="5"><span style="font-weight:bold;">Total lead time after artwork approval and proof of payment:<\/span>##LEADTIME_15000_EMBROIDERY##<\/td><td style="background-color: #f8cecc;"><span>##BRANDING_LEADTIME##<\/span><\/td><\/tr>',template_springBoxleadtimeRow='<tr std-cart-row ><td style="background-color:#f5f5f5; text-align:right; text-transform:unset;" colspan="4"><span style="font-weight:bold;">Total lead-time after proof of payment:<\/span><br/><span style="color:red;">Please note: The minimum lead time for Springbok ##BokleadTime##. The lead time for your order will be confirmed via email.<\/span><\/td><td style="background-color: #f8cecc;"><span>##BRANDING_LEADTIME##<\/span><\/td><\/tr>',template_orderItemRow_Email='<div id="RowIndex_##ROWINDEX##"><div class="col-xs-3 col-md-1 text-center"><img src="##PRODUCTIMAGE##" class="img-responsive cart-thumb"><\/div><div class="col-xs-9 col-md-11"><div class="row"><div class="col-xs-10 col-sm-10 col-md-7"><h3><span>##PRODUCTCODE##<\/span>##PRODUCTNAME##<\/h3><\/div><div class="col-sm-12 col-md-5"><ul class="cart-links-email"><li><a href="javascript:EditCartProductOptions(\'##PRODUCTGUID##\', ##ROWINDEX##, ##ISSAMPLE##);"><img src="images/icn-edit-lg.png"  alt="edit" class="icn-email"><\/a><\/li><li><a href="javascript:CommentCartItem(\'##FULLPRODUCTCODE##\');"><img src="images/icn-chat.png" alt="add comment"><\/a><\/li><li><a href="javascript:RemoveCartItem(\'RowIndex_##ROWINDEX##\', ##REMOVEPARAMS## );" class="remove"><i class="fa fa-times"><\/i><\/a><\/li><\/ul><\/div><div class="col-sm-12"><table class="table dt-responsive cart-table data-table cartColours" width="100%"><thead><tr><th>Colour<\/th><th>Size<\/th><th>Quantity<\/th><th>Product Price<\/th><th>Total Product Price<\/th><\/tr><\/thead><tbody>##ITEMDETAILS##<\/tbody><\/table><\/div>##LINEBRANDING##<\/div><\/div><\/div><hr />',template_componentRow='<tr class="colourSizeRow" ##HIDEROW##><td class="colourCell" ##HIDEBORDER##><div><span>##PRODUCTCOMPONENT##<\/span><\/div><\/td><td><div>##PRODUCTCOLOUR##<\/div><\/td><td><div><span>##PRODUCTQTY##<\/span><\/div><\/td><\/tr>',template_itemTotalsRow='<tr class="colourSizeRow darktopline"><td><\/td><td><div class="cmptTotal">Product Price : <span>##ITEMCOST##<\/span><\/div><\/td><td><div class="cmptTotal">Total Product Price: <span>##TOTALITEMCOST##<\/span><\/div><\/td><\/tr>',template_delivery='<div id="RowIndex_Delivery" class="orderItem"><div class="col-xs-3 col-md-1 text-center"><img src="images/delivery/Delivery_truck-icon.png" class="img-responsive cart-thumb"><\/div><div class="col-xs-9 col-md-11"><div class="row"><div class="col-xs-10 col-sm-10 col-md-7"><h3><span>Delivery<\/span><\/h3><\/div><div class="col-sm-12 col-md-5"><ul class="cart-links"><li><a class="cartTip" data-toggle="tooltip" data-placement="top" data-original-title="Edit delivery" href="javascript:EditCartDelivery();"><img src="images/icn-edit-lg.png" alt="edit" class="icn-email"><\/a><\/li><li><a href="javascript:RemoveCartDelivery();" class="remove"><i class="fa fa-times"><\/i><\/a><\/li><\/ul><\/div><div class="col-sm-12"><table class="table dt-responsive cart-table data-table cartColours" width="100%"><thead><tr><th>Carrier Service<\/th><th>Est Delivery Time<\/th><th>From<\/th><th>Address Name<\/th><th>Total Cost<\/th><\/tr><\/thead><tbody><tr><td>##CARRIERSERVICE##<\/td><td>##DELIVERYDATE##<\/td><td>##DELIVERYFROM##<\/td><td>##ADDRESSNAME##<\/td><td>##TOTALDELIVERYCOST##<\/td><\/tr><\/tbody><\/table><\/div><\/div><\/div><\/div>',template_brandingRow_display='<tr std-cart-row id="brandPosition_##POSITION##" bposition="##POSITION##" isRepeat="##ISREPEAT##" logo-name="##LOGONAME##" display-product="##DISPLAYPRODUCT##" template="##ISTEMPLATE##" logo-id="##LOGOID##" product-code="##PRODUCTCODE##" row-index="##ROWINDEX##" isRequiredBranding="##isRequiredBranding##" class="colourSizeRow bposition"><td><div ##POSITIONNAME## >All Positions<\/div><\/td><td><span id="##ROWINDEX##_pos##POSITION##_bMethod" brandGuid="##BRANDGUID##">##BRANDMETHOD##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_colourstitchVal">##COLOURSTITCHVALUE##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_qty">##BRANDQTY##<\/span><\/td><td logo-column><\/td><td total-branding><a href="javascript:RemoveBrandPosition(\'##REMOVEBRANDPOSITION-FULLPRODUCTCODE##\', \'##POSITION##\',true);" title="Branding cannot be removed for this product"><i class="fa fa-times" ><\/i><\/a><\/td><\/tr>',brandingRow_forNoCoBranding='<tr std-cart-row id="brandPosition_##POSITION##" bposition="##POSITION##" isRepeat="##ISREPEAT##" logo-name="##LOGONAME##" logo-id="##LOGOID##" product-code="##PRODUCTCODE##" row-index="##ROWINDEX##" isNoCoBranding="##ISNOCOBRANDING##" isRequiredBranding="##isRequiredBranding##" isWorkWear="##isWorkWear##" customBoxes="##customBoxes##" class="colourSizeRow bposition"><td><div ##POSITIONNAME## >Position ##POSITION##:<\/div><\/td><td><span id="##ROWINDEX##_pos##POSITION##_bMethod" brandGuid="##BRANDGUID##">##BRANDMETHOD##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_colourstitchVal">##COLOURSTITCHVALUE##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_qty">##BRANDQTY##<\/span><\/td><td>##BRANDSETUP##<\/td><td ##BRANDTOTAL_STYLE##>##BRANDTOTAL##<\/td><td logo-column><\/td total-branding><td>##TOTALLINEBRANDING## <\/td><\/tr>',brandingRow_display_forNoCoBranding='<tr std-cart-row id="brandPosition_##POSITION##" bposition="##POSITION##" isRepeat="##ISREPEAT##" logo-name="##LOGONAME##" display-product="##DISPLAYPRODUCT##" template="##ISTEMPLATE##" logo-id="##LOGOID##" product-code="##PRODUCTCODE##" row-index="##ROWINDEX##" isNoCoBranding="##ISNOCOBRANDING##" isRequiredBranding="##isRequiredBranding##" class="colourSizeRow bposition"><td><div ##POSITIONNAME## >All Positions<\/div><\/td><td><span id="##ROWINDEX##_pos##POSITION##_bMethod" brandGuid="##BRANDGUID##">##BRANDMETHOD##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_colourstitchVal">##COLOURSTITCHVALUE##<\/span><\/td><td><span id="##ROWINDEX##_pos##POSITION##_qty">##BRANDQTY##<\/span><\/td><td logo-column><\/td><td total-branding><\/td><\/tr>',cItemCost=0;doAjaxBeforeUnloadEnabled=!0;doAjaxBeforeUnload=function(){var n=$("#txtContactName").val(),t=$("#txtContactPhone").val();if($("#txtReference").length>0||n||t){if(!doAjaxBeforeUnloadEnabled)return;doAjaxBeforeUnloadEnabled=!1;$.ajax({url:"AjaxHandler.aspx?a=SaveCartFormValues&oNum="+$("#txtReference").val()+"&e1="+$("#txtEmail").val()+"&e2="+$("#txtConfirmEmail").val()+"&cType="+$("#cartType").val()+"&logo24ContactName="+n+"&logo24ContactNumber="+t,success:function(){},error:function(n){alertMessage(n.Error)},dataType:"json",cache:!1,async:!1})}};$(function(){$("#scart").length>0&&(LoadShoppingCart(),RenderFormValues());$(".cartArtwork").length>0&&($(".cartArtwork").html().trim()!=""?$("#cfHed").show():$("#cfHed").hide());$("#txtQuickAddCode").autocomplete({source:function(n,t){$.ajax({url:"AjaxHandler.aspx?a=SearchProducts&t="+n.term,dataType:"json",success:function(n){t($.map(n,function(n){return{label:n,value:n}}))}})},minLength:3,select:function(n,t){$("#txtQuickAddCode").val(t.item.value);QuickAdd(!1)},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})});$(function(){$("#txtNextProductCode").autocomplete({source:function(n,t){$.ajax({url:"AjaxHandler.aspx?a=SearchProducts&t="+n.term,dataType:"json",success:function(n){t($.map(n,function(n){return{label:n,value:n}}))}})},minLength:3,select:function(n,t){QuickAddToCart(!1,t.item.value)},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})});$(document).ready(function(){window.onbeforeunload=doAjaxBeforeUnload;$(window).unload(doAjaxBeforeUnload);$modalOrderOnline.on("show.bs.modal",function(){addBrandingInfo=!1});$(document).ajaxError(function(){showLoading(!1)})});addToCartDialog=function(){"use strict";function a(t){r();n=t||!1;_editFromCart=n;i.modal("show")}function v(n){t=n}function y(){return t}function r(){t=!1;n=!1}function u(){var t=o.val(),n=s.val();return showPageLoading(),Ordering.DataService.removeProductFromCart(t,null,curProdIndex,n).then(function(){return hidePageLoading(),matchingCode?Ordering.DataService.removeProductFromCart(null,matchingCode,curProdIndex,n):void 0}).catch(function(n){hidePageLoading();alertMessage(n)})}function f(){if(!e()&&t&&!n)return u().then(function(){r()}).catch(function(n){alertMessage(n)});$("#catalogueQuantities").hide();isValidCatalogueQuantities=!1;hasIncrementalValue=!1}function e(){return h.is(":visible")}function p(n){_isWorkWear=!0;DisplayAddToCartOptions(n,"standard")}var o=$("#prodGuid"),s=$("#cartType"),h=$("#atcDone"),c=$("#atcBranding"),n=!1,i=$("#modalOrderOnline"),t,l={reset:r,setAddedToCart:v,getAddedToCart:y,removeAddedProductFromCart:u,isAddToCartDone:e,close:f,open:a,MIX_DELIVERY_MSG:"Your cart contains items with branding and items excluding branding.<br><br>Your order will be split into multiple sales orders dependent on the contents of your cart. Standard branded items, custom products (excluding custom packaging items) and unbranded items will be processed on different invoices.<br><br>Should you require delivery via courier, please request this from your dashboard.",MIX_DELIVERY_CUSTOM_MSG:"Unfortunately you will be unable to include delivery if your cart contains both custom products and non-custom products. To continue, either remove delivery from your cart or update your selection of cart products.",displayWorkWearAddToCart:p};i.on("show.bs.modal",function(){});i.on("hide.bs.modal",function(){f()});return l}();var currentCode,clickedColour,_isComponent,_fromProduct=null,_fromSize=null,sizeDivContainer=null,sizeList=[],myContainer,viewAllSizes=null,hiddenB=null,showIncoming=!1,viewAllSizesFlag=!1,mainProductCode,loginFlag="False",isWorkwear=!1;var containerDiv,originalInnerHTML="",currentGuid,active,brandingCost=0,totalSetupCost=0,totalDYECost=0,csymbol="",brandingCalculated=!1,isUsb=!1,methods,positions,hasDye=!1,_isWorkwearBC=!1,_workwearSizes;$(document).keypress(function(n){n.which==13&&($("#txtProductQuantity").is(":focus")||$("#txtMarkup").is(":focus"))});$(function(){var n=function(){var n=0;return function(t,i){clearTimeout(n);n=setTimeout(t,i)}}();$("#txtProductQuantity").unbind("keyup");$("#txtProductQuantity").keyup(function(t){t.which!=13&&($("#brandingResults").hide(),UpdateQuantities(),n(function(){var n=$("#txtProductQuantity").val();n!=""&&LoadBrandingMethods(currentGuid,null,n)},500))});$("#txtClothingQty1").unbind("keyup");$("#txtClothingQty1").keyup(function(t){t.which!=13&&($("#brandingResults").hide(),UpdateQuantities(),n(function(){LoadBrandingMethods(currentGuid,null,$("#txtProductQuantity").val())},500))});$("#txtClothingQty2").unbind("keyup");$("#txtClothingQty2").keyup(function(t){t.which!=13&&($("#brandingResults").hide(),UpdateQuantities(),n(function(){LoadBrandingMethods(currentGuid,null,$("#txtProductQuantity").val())},500))})});var lightboxTour=null,LightBoxExists=!1,LightBoxCreated=!1,CurrentLightBox;$(document).ready(function(){LightBoxExists=$("#hdLightBoxExists").val()=="True"?!0:!1;LightBoxCreated=$("#hdLightBoxCreated").val()=="True"?!0:!1;$.each($("[data-name]"),function(){$(this).attr("name",$(this).attr("data-name"))});$.each($("[data-id]"),function(){$(this).attr("id","item_"+$(this).attr("data-id"))});$("#lnkAddToLightbox, .lnkAddToLightBox").on("click",function(){var n=$(this).attr("data-productCode"),t=$(this).attr("data-productGuid");n!=null&&n!=""&&t!=null&&t!=""&&(LightBoxExists||LightBoxCreated?(LightBox.ShowAddToLighBoxModal(n,t),$(this).hasClass("tour-lightbox-element")&&lightboxTour!=null&&lightboxTour._inited&&lightboxTour.goTo(9)):LightBox.ShowCreateLightBoxModal(n,t))});$("#CreateNewLightBox").on("click",function(){$(this).parent().hasClass("tour-lightbox-element")||LightBox.ShowCreateLightBoxModal()});$("#createLightboxForm, #UpdateLightBoxForm, #addToLightBoxForm, #emailLightBoxModal").on("keyup keypress",function(n){var t=n.keyCode||n.which;if(t==13)return n.preventDefault(),!1});$("#txtLgbQuickAddCode").keypress(function(n){n.which===13&&(n.preventDefault(),$("#btnLgbQuickAdd").click())});$("#btnLgbQuickAdd").click(function(){var n=$("#txtLgbQuickAddCode").val();$.ajax({url:"AjaxHandler.aspx?a=GetProductGuidByCode&p="+n,dataType:"json",success:function(t){t.TheData!=null?LightBox.ShowAddToLighBoxModal(n,t.TheData):alertMessage("Please enter a complete product code, or use the search autocomplete to select a suggestion.")}})});$('#createLightboxForm [name="LightBoxName"]').on("keyup blur",function(){var n=$(this).val();n!=""&&n.length>=3&&LightBox.LightBoxExists(n)});$("#createLightboxForm button").on("click",function(){$('#createLightboxForm [name="LightBoxName"]').val()!=""?(LightBox.HideAlert(),LightBox.SubmitLightBoxCreate($("#createLightboxForm"))):LightBox.Alert("Please give your light box a name")});$("#UpdateLightBoxForm button").on("click",function(){$("#UpdateLightBoxForm #txtChangeLightBoxName").val()!=""?($('#UpdateLightBoxForm [name="lgbGuid"]').val()==""&&$('#UpdateLightBoxForm [name="lgbGuid"]').val($("select.lightbox-select :selected").val()),LightBox.SubmitLightBoxUpdate($("#UpdateLightBoxForm"))):console.log("Please give your light box a name")});$("#addToLightBoxForm button").on("click",function(){var t=$("#ddlLightBoxName").find(":selected").val(),n;t!=null&&t!=""?(n=[],$.each($(".colour-selected"),function(){var t=$(this);n.push({ProductColourGuid:t.attr("data-colourGuid"),ProductColourCode:t.attr("data-colourCode"),ProductColourName:t.attr("data-colourname"),ProductGuid:t.attr("data-productGuid"),ProductCode:t.attr("data-productCode"),lightBoxGuid:$(this).closest("form").find('[name="LighBoxGuid"]').val()})}),n!=null&&n.length>0?LightBox.AddProductToLightBox(n,t):console.log("No product colour(s) selected. Please select the product colour(s) to add to the lightbox")):console.log("No lightbox selected. Please select a lightbox to the add the products to")});$("#lightBoxModal").on("show.bs.modal",function(){$("#lightBoxModal").find(".info").hide();lightboxTour!=null&&lightboxTour._inited&&lightboxTour.pause();LightBox.GetLightAllBoxes("customer")});$("#lightBoxModal .btn-group label").on("click",function(){var n=$(this).find('[type="radio"]').attr("data-content");$("#lightBoxModal").find(".info").show();$("#lightBoxModal").find(".info span").html(n)});$("select.lightbox-select").on("change",function(){var n=$(this).val();n!=""&&($(".lightbox .page-hed span").html($(this).find(":selected").text()),LightBox.CurrentLightBoxGuid=n,$('[name="LighBoxGuid"]').val(n),$('#UpdateLightBoxForm [name="lgbGuid"]').val(n),$(this).closest(".modal").length==0&&LightBox.GetLightBox(n))});$(".current-lightbox-products .tile").on("click",function(n){n.stopPropagation();var t=$(this).attr("data-productcode");t!=""&&DisplayQuickLook(t)});$(".current-lightbox-products .tile .fa-times").on("click",function(n){var t,i,r;n.stopPropagation();t=$(this).closest(".tile");t==null&&(t=$(this).closest(".tile"));t!=null&&(i=$("select.lightbox-select :selected").val(),i!=null&&i!=""&&(r={Id:t.attr("data-id"),Guid:t.attr("data-guid"),ProductGuid:t.attr("data-productguid"),ProductCode:t.attr("data-productcode"),ProductColourGuid:t.attr("data-colourguid"),ProductColourCode:t.attr("data-colourcode")},LightBox.RemoveProductFromLightBox(i,r)),t.remove())});$("#emailLightBoxModal").on("show.bs.modal",function(){$("#emailLighBoxForm").show();$("#spinner").hide();$("#emailLightBoxModal .alert").hide();$("#emailLightBoxModal .modal-footer").show();$("#emailLightBoxModal .alert span").html("")});$("#emailLightBoxModal #btnEmailLightBox").on("click",function(n){n.stopPropagation();n.preventDefault();$('[name="FromEmailAddress"]').val()!=""&&$('[name="RecipientEmailAddress"]').val()!=""?($("#emailLightBoxModal .alert").hide(),$("#emailLighBoxForm").hide(),$("#spinner").show(),$.post("AjaxHandler.aspx",{a:"EmailLightBox",FromName:$("#emailLightBoxModal [name=FromName]").val(),FromEmailAddress:$("#emailLightBoxModal [name=FromEmailAddress]").val(),RecipientName:$("#emailLightBoxModal [name=RecipientName]").val(),RecipientEmailAddress:$("#emailLightBoxModal [name=RecipientEmailAddress]").val()},function(n){n!=null?n.Success?n.TheData!=null&&($("#lblOtherMessageText").html("Lightbox successfully sent to "+n.TheData),$("#emailLightBoxModal").modal("hide"),$("#otherMessageDialog").modal("show")):($("#emailLightBoxModal").modal("hide"),bootbox.alert("Could not send lightbox. Please try again later")):($("#emailLightBoxModal").modal("hide"),bootbox.alert("Could not send lightbox. Please try again later"))},"json")):($("#emailLightBoxModal .alert span").html("* fields are mandetory"),$("#emailLightBoxModal .modal-footer").hide(),$("#emailLightBoxModal .alert").show())});$(".current-lightbox-products").ApplySortable();$("#txtLgbQuickAddCode").autocomplete({source:function(n,t){$.ajax({url:"AjaxHandler.aspx?a=SearchProducts&t="+n.term,dataType:"json",success:function(n){t($.map(n,function(n){return{label:n,value:n}}))}})},minLength:3,select:function(n,t){LightBox.ShowAddToLighBoxModal(t.item.value,t.item.value)},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")}})});LightBox={CurrentLightBoxGuid:"",HandlerUrl:"AjaxHandler.aspx",Created:!1,RemoveRecentlyAddedTiles:function(n,t){var i,r,u;t.stopPropagation();i=$(n).closest(".tile");i==null&&(i=$(n).closest(".tile"));i!=null&&(r=$("select.lightbox-select :selected").val(),r!=null&&r!=""&&(u={Id:i.attr("data-id"),Guid:i.attr("data-guid"),ProductGuid:i.attr("data-productguid"),ProductCode:i.attr("data-productcode"),ProductColourGuid:i.attr("data-colourguid"),ProductColourCode:i.attr("data-colourcode")},LightBox.RemoveProductFromLightBox(r,u)),i.remove())},ShowCreateLightBoxModal:function(n,t){$(".modal-lightbox .modal-title").html("Create a Lightbox");$('#createLightboxForm [name="ProductCode"]').val(n);$('#createLightboxForm [name="ProductGuid"]').val(t);$("#lightBoxModal form").hide();$("#lightBoxModal #createLightboxForm").show();$("#lightBoxModal").modal("show")},LightBoxExists:function(n){n!=""&&n.length>=3&&$.post(LightBox.HandlerUrl,{a:"LightBoxExists",lgbName:n},function(t){t!=null&&(t?($("#createLightboxForm button").prop("disabled",!0),LightBox.Alert("The lightbox <b>"+n+"<\/b> already exists. Please choose a different name.")):($("#createLightboxForm button").prop("disabled",!1),LightBox.HideAlert()))},"json")},SubmitLightBoxCreate:function(n){var t=n,i=n.find('[name="ProductGuid"]').val(),r=n.find('[name="ProductCode"]').val();t!=null&&$.post(LightBox.HandlerUrl,t.serialize(),function(n){if(n!=null)if(n.Success){if(LightBoxCreated=!0,LightBoxExists=!0,n.TheData!=null){$("#txtLightBoxName").val("");$("#LightBoxPanelContainer").show();var t=n.TheData;$("select.lightbox-select").append($("<option>").html(t.Details.Name).attr({value:t.Details.Guid}));$("select.lightbox-select").val(t.Details.Guid);$("select.lightbox-select").trigger("chosen:updated");lightboxTour!=null&&lightboxTour._inited&&(lightboxTour.resume(),lightboxTour.goTo(5));r!=""&&i!=""?LightBox.ShowAddToLighBoxModal(r,i):($(".current-lightbox-products").empty(),$("#lightBoxModal").modal("hide"),$(".lightbox-mini .panel-body").show(),$(".lightbox-mini").slideDown())}}else n.Error!=""&&LightBox.Alert(n.Error);else LightBox.Alert("An error occured. Could not create lightbox. Please try again later")},"json")},SubmitLightBoxUpdate:function(n){n!=null&&$.post(LightBox.HandlerUrl,n.serialize(),function(n){n!=null?n.Success?($('select option[value="'+n.TheData.Guid+'"]').text(n.TheData.Name),$(".lightbox .page-hed span").html(n.TheData.Name),$("select.lightbox-select").trigger("chosen:updated"),$("#lightBoxModal").modal("hide"),AmrodAlert("lightbox updated")):AmrodAlert("An error occured. Could not update this lightbox. Please try again later"):AmrodAlert("An error occured. Could not update this lightbox. Please try again later")},"json")},SubmitLightBoxEmail:function(n){n!=null&&($("#emailLighBoxForm").ShowLightBoxSpinner(),$.post(LightBox.HandlerUrl,n.serialize(),function(n){n!=null?n.Success?n.TheData!=null&&($("#lblOtherMessageText").html("Lightbox successfully sent to "+n.TheData),$("#emailLightBoxModal").modal("hide"),$("#otherMessageDialog").modal("show"),$('#emailLighBoxForm [type="text"]').text(""),$('#emailLighBoxForm [type="text"]').val("")):AmrodAlert("An error occured. Could not email this lightbox. Please try again later"):AmrodAlert("An error occured. Could not email this lightbox. Please try again later")}))},ShowAddToLighBoxModal:function(n,t){n!=""&&t!=""?($(".modal-lightbox .modal-title").html("Add to lightbox"),$("#lightBoxModal form").hide(),$("#lightBoxModal #addToLightBoxForm").show(),$("#lightBoxModal").is(":visible")||$("#lightBoxModal").modal("show"),LightBox.GetProductColours(n,t)):console.log("product guid & product code is empty")},AddProductToLightBox:function(n,t){n!=null&&n!=""&&$.post(LightBox.HandlerUrl,{a:"AddProductToLightBox",p:JSON.stringify(n),lgbGuid:t},function(n){n!=null&&(n.Success?($("#lightBoxModal").modal("hide"),$(".lightbox-mini .panel-body").show(),$(".lightbox-mini").slideDown(),LightBox.GetLightBox(t)):console.log(n.TheData))},"json")},RemoveProductFromLightBox:function(n,t){t!=null&&t!=""&&n!=null&&n!=""&&$.post(LightBox.HandlerUrl,{a:"RemoveProductFromLightBox",lgbProduct:JSON.stringify(t),lgbGuid:n,id:t.Id},function(n){n!=null&&n.Success&&console.log("product removed");$("#modalQuickLook").modal("hide")},"json")},GetLightBox:function(n){n!=null&&n!=""&&$.post(LightBox.HandlerUrl,{a:"GetLightBox",lgbGuid:n},function(t){t!=null?t.Success&&(t.TheData!=null&&t.TheData.Details&&$(".lightbox .page-hed span").html(t.TheData.Details.Name),t.TheData!=null&&t.TheData.Products!=null?($("select.lightbox-select").val(n),$("select.lightbox-select").trigger("chosen:updated"),$(".current-lightbox-products").empty(),$(".current-lightbox-products").sortable("destroy"),$.each(t.TheData.Products,function(t,i){var r=$(".lightbox-mini .lightbox-templates .lightbox-product").clone();$(".lightbox-mini .lightbox-templates .lightbox-product").length>0?r=$(".lightbox-mini .lightbox-templates .lightbox-product").clone():$(".lightbox-templates .lightbox-product").length>0&&(r=$(".lightbox-templates .lightbox-product").clone());r!=null&&r!=""&&(r.find(".lightBox-tile").attr("id","item_"+i.Id),r.find(".lightBox-tile").attr("data-id",i.Id),r.find(".lightBox-tile").attr("data-guid",i.Guid),r.find(".lightBox-tile").attr("data-colourGuid",i.ProductColourGuid),r.find(".lightBox-tile").attr("data-colourName",i.ProductColourName),r.find(".lightBox-tile").attr("data-colourCode",i.ProductColourCode),r.find(".lightBox-tile").attr("data-productcode",i.ProductCode),r.find(".lightBox-tile img").attr("src",i.ImageUrl),r.find(".lightBox-tile #lblCode").text(i.ProductCode),r.find(".lightBox-tile #lblColourName").text(i.ProductColourName),r.find(".lightBox-tile #lnkProduct").text(i.ProductName),r.find(".lightBox-tile #lnkProduct").attr("href",i.ProductNavigateUrl),r.find(".lightBox-tile .color-hex").css("background",i.Hex),r.find("img.lightbox-img").bind("click",function(){var n=$(this).find(".lightBox-tile");n!=null&&n!=""&&DisplayQuickLook(""+i.ProductCode+"")}),r.find(".fa-times").bind("click",function(t){var i,u;t.stopPropagation();i=r.find(".lightBox-tile");i!=null&&(u={Id:i.attr("data-id"),Guid:i.attr("data-guid"),ProductGuid:i.attr("data-productguid"),ProductCode:i.attr("data-productcode"),ProductColourGuid:i.attr("data-colourguid"),ProductColourCode:i.attr("data-colourcode")},LightBox.RemoveProductFromLightBox(n,u),r.remove())}),$(".current-lightbox-products").append(r))}),$(".current-lightbox-products").ApplySortable()):($(".current-lightbox-products").empty(),$(".current-lightbox-products").append($("<div>").addClass("product-hover").html("There are no product in this lightbox"))),lightboxTour!=null&&lightboxTour._inited&&lightboxTour.goTo(11)):$(".current-lightbox-products").empty()},"json")},SetLightBox:function(n){n!=""&&$.post(LightBox.HandlerUrl,{a:"",lgbGuid:n},function(n){n!=null&&n&&console.log("lightbox set")},"json")},GetLightAllBoxes:function(n){var t=$("select.lightbox-select :selected").val();$.post(LightBox.HandlerUrl,{a:"GetAllLightBoxes",f:n},function(n){var i,r;if(n!=null&&n.Success&&n.TheData!=null&&n.TheData.length>0){for(i=n.TheData,$("select.lightbox-select").empty(),r=0;r<i.length;r++)$("select.lightbox-select").append($("<option>").html(i[r].Details.Name).attr({value:i[r].Details.Guid}));t!=""&&t!=null?($("select.lightbox-select").val(t),$("select.lightbox-select").trigger("chosen:updated")):($("select.lightbox-select").val(i[0].Details.Guid),$("select.lightbox-select").trigger("chosen:updated"))}},"json")},GetProductColours:function(n,t){t!=""?($("#addToLightBoxForm .product-colours").ShowLightBoxSpinner(),$("#lightBoxModal form").hide(),$("#lightBoxModal #addToLightBoxForm").show(),$("#lightBoxModal .modal-lightbox .modal-title").html("Add to lightbox"),$.post(LightBox.HandlerUrl,{a:"GetAvailableColours",p:t,pCode:n},function(i){var r,u;i!=null&&(i.Success?i.TheData!=null&&i.TheData.length>0&&($("#addToLightBoxForm .product-colours").empty(),$('#addToLightBoxForm [name="ProductGuid"]').val(t),$('#addToLightBoxForm [name="ProductCode"]').val(n),i.TheData.length>1?$.each(i.TheData,function(n,t){var i=$(".lightbox-templates .lightbox-product-colour").clone();i!=null&&(i.find(".tile-add-lightbox").attr("data-productGuid",t.productGuid),i.find(".tile-add-lightbox").attr("data-productCode",t.productCode),i.find(".tile-add-lightbox").attr("data-colourGuid",t.guid),i.find(".tile-add-lightbox").attr("data-colourName",t.name),i.find(".tile-add-lightbox").attr("data-colourCode",t.code),i.find(".tile-add-lightbox img").attr("src",t.imageUrl),i.find(".tile-add-lightbox label").text(t.name),i.find(".tile-add-lightbox .color-hex").css("background",t.hex),i.bind("click",function(){var n=$(this).find(".tile-add-lightbox"),i;n!=null&&n!=""&&(i=n.find('[type="checkbox"]'),i.is(":checked")?i.prop("checked",!1):i.prop("checked",!0),n.hasClass("colour-selected")?n.removeAttr("style").removeClass("colour-selected"):n.css("background",t.Hex).addClass("colour-selected"))}),$("#addToLightBoxForm .product-colours").append(i))}):i.TheData.length==1&&(r=$("select.lightbox-select :selected").val(),r!=null&&r!=""&&(u=[],u.push({ProductColourGuid:i.TheData[0].guid,ProductColourCode:i.TheData[0].code,ProductColourName:i.TheData[0].name,ProductGuid:i.TheData[0].productGuid,ProductCode:i.TheData[0].productCode,lightBoxGuid:r}),u.length>0&&LightBox.AddProductToLightBox(u,r)))):($("#addToLightBoxForm .product-colours").empty(),$("#addToLightBoxForm .product-colours").append($("<div>").html("Could not find product colours"))))},"json")):console.log("product guid is empty")},AddLightBoxToQuote:function(){alert("add lightbox to quote")},EmailLightBox:function(){$('#emailLighBoxForm [type="text"]').text("");$('#emailLighBoxForm [type="text"]').val("");$("#emailLightBoxModal .modal-lightbox .modal-title").html("Email Lightbox");$("#emailLightBoxModal").modal("show")},EditLightBox:function(){LightBoxExists&&LightBoxCreated&&($("#txtChangeLightBoxName").val($("select.lightbox-select :selected").eq(0).text()),$("#lightBoxModal form").hide(),$("#lightBoxModal #UpdateLightBoxForm").show(),$(".modal-lightbox .modal-title").html("Update Lightbox"),$("#lightBoxModal").modal("show"))},DeleteLightBox:function(n){if(LightBoxExists&&LightBoxCreated){var t=$("select.lightbox-select :selected").eq(0).text();bootbox.confirm("Are you sure you want to delete the "+t+" lightbox.",function(t){t&&((n==null||n=="")&&(n=$("select.lightbox-select :selected").val()),$.post(LightBox.HandlerUrl,{a:"DeleteLightBox",lgbGuid:n},function(t){if(t!=null)if(t.Success)if(AmrodAlert("Lightbox has been removed"),$('select.lightbox-select option[value="'+n+'"]').remove(),$("select.lightbox-select").trigger("chosen:updated"),$("select.lightbox-select option").length>0){var i=$("select.lightbox-select option:first").val();i!=null&&i!=""&&($(".lightbox .page-hed span").html($("select.lightbox-select option:first").eq(0).text()),LightBox.GetLightBox(i))}else $(".current-lightbox-products").empty(),$(".lightbox .page-hed span").html(""),LightBoxExists=!1,LightBoxCreated=!1;else AmrodAlert("An error occured. Could not delete this lightbox. Please try again later");else AmrodAlert("An error occured. Could not delete this lightbox. Please try again later")},"json"))})}},DownloadLightBox:function(){window.location="lightboxemail.aspx?action=download-lightbox"},Alert:function(n){$("#lightBoxModal .alert span").html(n);$("#lightBoxModal .modal-footer").hide();$("#lightBoxModal .alert").show()},HideAlert:function(){$("#lightBoxModal .alert").hide();$("#lightBoxModal .modal-footer").show();$("#lightBoxModal .alert span").html("")}};AmrodAlert=function(n){n!=null&&n!=""&&($("#lblOtherMessageText").html(n),$("#otherMessageDialog").modal("show"))};$.fn.ShowLightBoxSpinner=function(){$(this).empty();$(this).append(" <div class='col-sm-12' style='padding: 25px; text-align: center;'> <img src='images/spinner.gif'> <\/div> ")};$.fn.ApplySortable=function(){$(this).hasClass("ui-sortable")&&$(this).sortable("refresh");$(this).sortable({cursor:"move",update:function(){console.log($(this).sortable("serialize"));console.log($(this).sortable("toArray"));$.post(LightBox.HandlerUrl,{a:"SortLightBoxItems",sort:$(this).sortable("toArray")},function(n){n!=null&&n.Success&&console.log("lightbox items sort order updated")})}}).disableSelection()};template_PrefixComponents='<div class="divComponentsQuicklook ##QLPREFIXCLASS##"><div class="clearfix sizeContainer product-option-details">##PRODUCTCOMPONENTS##<\/div><div class="product-color qlColours"><div class="product-color-wrap product-color">##PRODUCTCOLOURS##<\/div><\/div><\/div>';ComponentMixMatch={},function(n){var t=function(){"use strict";function t(n){var t="An error occured.";try{n.Error?t=n.Error:n.responseJSON&&n.responseJSON.Error?t=n.responseJSON.Error:n.TheData&&(t=n.TheData)}catch(i){}return t}var i="AjaxHandlers/ComponentMixMatchAjaxHandler.aspx",n=function(){};return n.getMatchComponent=function(n){var r=$.ajax({url:i,data:{a:"GetMatchComponent",code:n},dataType:"json",cache:!1});return Promise.resolve(r).then(function(n){return _.map(n.TheData,function(n){return n})}).catch(function(n){return Promise.reject(t(n))})},n.setComponent=function(n,r,u,f,e,o){var s=$.ajax({url:i,data:{a:"SetComponent",c:n,guidId:r,Code:u,invoker:f,defaultComponent:e,selectedComponents:o},dataType:"json",cache:!1});return Promise.resolve(s).then(function(n){return _.map(n.TheData,function(n){return n})}).catch(function(n){return Promise.reject(t(n))})},n.setProductExtraImages=function(n,i){var r=$.ajax({url:"AjaxHandler.aspx",data:{a:"GetProductExtraImages",pc:n,invoker:i},dataType:"json",cache:!1});return Promise.resolve(r).then(function(n){return _.map(n.TheData,function(n){return n})}).catch(function(n){return Promise.reject(t(n))})},n}();n.DataService=t}(ComponentMixMatch);var defaultComponent=[],componentMixMatch=function(){"use strict";function t(n,t,i){ComponentMixMatch.DataService.getMatchComponent(i).then(function(){}).catch(function(n){return Promise.reject(n)})}function i(n,t,i,u,f,e,o,s,h){var v,p,a,c,y,w,l;$("#divWait").show();r(n,u,o,s);v=$("#"+h).closest("[data-productcode]");v.attr("data-productcode",n);p=$(".ctProductImageHover",v);p.hide();a=$("#"+h).parent();c=$("#"+h);u!="cataloguePage"?(c=$("#ct_"+n),a=c.parent(),$("a",a).removeClass("active"),c.addClass("active"),y=$("a.active",".ProductComponentsPanel")):(w=c.attr("prefix"),$("a[prefix='"+w+"']",a).removeClass("active"),c.addClass("active"),y=$("a.active",a));l="";y.each(function(){l+=","+$(this).html()});l=l.substring(l.indexOf(",")+1);ComponentMixMatch.DataService.setComponent(n,t,i,u,null,l).then(function(t){var r=t[0],v=t[1],h=t[2],i=t[4],l=t[5],a=t[6],c=r+v;defaultComponent=[];u=="cataloguePage"?s=="GetNextPageProducts"?($("."+f).html(r),$("."+e).html(h),i!=""&&$('[data-productCode="'+n+'"]  #imgCategoryProductImage').attr("src",i),$('[data-productCode="'+n+'"] #priceTierTable').html(c)):($("#"+f+"_lblQuartzPrice").html(r),$("#"+e+"_lblMyGroupPrice").html(h),i!=""&&$("#"+o+"_imgCategoryProductImage").attr("src",i),$('[data-productCode="'+n+'"] #comparePricesTable').html(c)):u=="quicklook"?($(".product-color-wrap",".qlrow_"+a).html(l),i!=""&&$("#imgQlMainImage").attr("src",i),$("#lblStdPrice").html(r),$("#lblYourPrice").html(h),$("#tbQLPrices").html(c)):u=="productPage"&&($(".product-color-wrap",".pdrow_"+a).html(l),i!=""&&$("#"+o+"_imgProductDetailImage").attr("src",i),$("#lblQuartzPrice").html(r),$("#lblMyGroupPrice").html(h),$("#tierTable").html(c))}).catch(function(n){$("#divWait").hide();alertMessage("setComponent: "+n)})}function r(n,t,i,r){ComponentMixMatch.DataService.setProductExtraImages(n,t).then(function(n){var u=n[0],l=n[1][0],a=n[1][1],v=n[2][0],y=n[2][1],e,o,f,s,h;let c=n[3];if(e="",t=="quicklook"&&u!=null&&u.length>0&&u[0].ThumbnailImage!=null&&u[0].LargeImage!=null){for(e=$("#divqlExtraImages"),o="",f=0;f<u.length;f++){s=u[f].ThumbnailImage;let n='ShowProductDetailExtraImage("ctl00_Main_imgProductDetailImage","lnkViewLarger","'+c[f]+'","'+u[f].LargeImage+'");';h="<div class='item'><a id='lnkExtraImage'><img onclick='"+n+"' src='"+s+(u[f].LargeImage!=null?"' onmouseover=\"LoadQuickLookExtraImage('"+s.replace("_"+v,"_"+l).replace("_"+y,"_"+a)+"','"+u[f].LargeImage+"')\"":"")+"' /><\/a> <\/div>";o+=h}e.trigger("replace.owl.carousel",o);e.trigger("refresh.owl.carousel")}else if(t=="cataloguePage"&&u!=null&&u.length>0&&u[0].ThumbnailImage!=null&&u[0].LargeImage!=null){for(e=r=="GetNextPageProducts"?$("#"+i):$("#ctProductImageHover"),e.empty(),o="",f=0;f<u.length;f++){s=u[f].ThumbnailImage;let n='ShowProductDetailExtraImage("ctl00_Main_imgProductDetailImage","lnkViewLarger","'+c[f]+'","'+u[f].LargeImage+'");';h="<div class='item'><a id='lnkExtraImage'><img onclick='"+n+"' src='"+s+"' /><\/a> <\/div>"}e.append(o)}else if(e=$(".pdExtraImages"),o="",u!=null&&u.length>0&&u[0].ThumbnailImage!=null&&u[0].LargeImage!=null!=null){for(f=0;f<u.length;f++){s=u[f].ThumbnailImage;let n='ShowProductDetailExtraImage("ctl00_Main_imgProductDetailImage","lnkViewLarger","'+c[f]+'","'+u[f].LargeImage+'");';h="<div class='item'><a id='lnkExtraImage'><img onclick='"+n+"' src='"+s+"' /><\/a> <\/div>";o+=h}e.trigger("replace.owl.carousel",o);e.trigger("refresh.owl.carousel")}$("#divWait").hide()}).catch(function(n){$("#divWait").hide();alertMessage("SetProductExtraImages: "+n)})}var n={GetComponentMixMatch:t,SetPriceByComponentType:i};return n}(),ArtworkLibrary={};(function(){var n=function(){"use strict";function t(n){var t="An error occured.";try{n.Error?t=n.Error:n.responseJSON&&n.responseJSON.Error?t=n.responseJSON.Error:n.TheData&&(t=n.TheData)}catch(i){"e"}return t}var n=function(){};return n.uploadArtwork=function(n){var i=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"UploadArtwork",artworkInfo:JSON.stringify(n)},type:"POST",dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.ContactArtwork=function(){var n=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"ContactArtwork"},dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.ArtworkFile=function(n){var i=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"ArtworkFile",id:n},dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.AccountArtwork=function(){var n=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"AccountArtwork"},dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.DeleteArtwork=function(n){var i=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"DeleteArtwork",id:n},type:"POST",dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.UpdateContactArtwork=function(n,i){var r=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"UpdateContactArtwork",id:n,name:i},type:"POST",dataType:"json",cache:!1});return Promise.resolve(r).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.SearchContactArtwork=function(n){var i=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"SearchContactArtwork",name:n},method:"GET",dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.DownloadContactArtwork=function(n){var i=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"DownloadContactArtwork",id:n},method:"GET",dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.DownloadContactArtworkThumbnail=function(n){var i=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"DownloadContactArtworkThumbnail",id:n},method:"GET",dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.GetpreviouslySelectedArtwork=function(n,i){var r=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"GetpreviouslySelectedArtwork",uploadType:n,jobCardNumber:i},method:"GET",dataType:"json",cache:!1});return Promise.resolve(r).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n.ValidateBrandingMethodExtensions=function(n){var i=$.ajax({url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",data:{a:"ValidateBrandingMethodExtensions",brandingCode:JSON.stringify(n)},method:"GET",dataType:"json",cache:!1});return Promise.resolve(i).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(t(n))})},n}();ArtworkLibrary.DataService=n})(ArtworkLibrary);var ListAccountArtwork=[],SelectedArtwork=[],SelectedArtwork1=[],DiselectedArtworkCount=[],$tbUploadedFiles="",ArtworkLibraryIntegration=function(){"use strict";function h(n,t){$tbUploadedFiles=$("table#tbUploadedFiles").DataTable({processing:!0,destroy:!0,ajax:{url:"AjaxHandlers/ArtworkLibraryIntegrationAjaxHandler.aspx",type:"POST",dataSrc:function(n){var u=n.TheData,f,r,e;for(ListAccountArtwork=_.clone(u),f=[],r=0,e=u.length;r<e;r++){var t=u[r],o=t.ArtworkFileStorages.find(n=>!n.IsThumbnail),i={};i.Preview="<a class='PreviewIcon' onclick=\"ArtworkLibraryIntegration.DownloadContactArtwork("+t.Id+")\"><i class='fa fa-eye'><\/i><\/a>";i.FileName="<p style='display:none;'>"+t.Name+"<\/p><span class='EditableFileName' data-id='"+t.Id+"'>";i.FileName+='<input type="text" value=\''+t.Name+t.ArtworkFileStorage.Extension+"' data-TxtID='"+t.Id+'\' disabled class="RenameFileName"  onkeypress="ArtworkLibraryIntegration.UpdateArtworkFileNameOnKeypress(\''+t.Id+'\')" /> <i class="fa fa-circle-o-notch fa-spin RanameLoader"><\/i><i class="fa fa-check RenameDone" style="color: #018001;"><\/i>';i.FileName+='<button type="button" class="btn btn-sm btn-circle" data-BtnID=\''+t.Id+"'  onclick=\"ArtworkLibraryIntegration.UpdateArtwork('"+t.Id+'\')"><i class="fa fa-save"><\/i><\/button>';i.FileName+="<\/span>";i.Size=o.Size;i.Select='<input type="checkbox" data-id=\''+t.Id+"' name=\"select\"  data-checkbox='"+t.Id+"' onclick=\"ArtworkLibraryIntegration.CountSelectedArtwork("+t.Id+')" />';i.Select+='<div class="dropdown default-dropdown" style="float: right; cursor: pointer">';i.Select+='<a class="dropbtn" aria-haspopup="true" aria-expanded="false" id="dropdownMenuLink"><i class="fa fa-ellipsis-v"><\/i> <\/a>';i.Select+='<div class="dropdown-content" style="left: -95px; border: 1px solid #b8b8b8;">';i.Select+='<a class="text-primary" onclick="ArtworkLibraryIntegration.ToggleUpdateArtworkFileName('+t.Id+')"> <i class="fa fa-edit"><\/i>Rename<\/a><\/a>';i.Select+='<a class="text-primary" onclick="ArtworkLibraryIntegration.DeleteArtwork('+t.Id+')"> <i class="fa fa-times"><\/i>Delete<\/a><\/a>';i.Select+="<\/div>";f.push(i)}return n.TheData.length==0&&$(".uploadedListItem,#logoUploadSection .ShowProgress").hide(),f},data:{a:"ContactArtwork"},error:function(n,t,i){console.log(t+" - "+i)}},columns:[{data:"Preview"},{data:"FileName"},{data:"Size"},{data:"Select"},],info:!1,ordering:!1,pageLength:5}).on("draw.dt",function(){i($("ol#productPositions").find("li.active").text(),$("#productBtnsContainer").find("span.active").text(),n,t)}).on("destroy.dt",function(){$(this).off("draw.dt")})}function c(){a("Mongwe").then(function(){var t,n,i;if(ListAccountArtwork.length)for(t=0;t<ListAccountArtwork.length;++t)n=ListAccountArtwork[t],i=n.ArtworkFileStorages.find(n=>!n.IsThumbnail),o.loadTemplate(e,{Created:n.Created,Extension:i.Extension,FileBytes:i.FileBytes,Id:n.Id,Name:n.Name,Size:i.Size,selectedArtwork:"ArtworkLibraryIntegration.CountSelectedArtwork('"+n.Id+"');",selectClick:"ArtworkLibraryIntegration.DownloadContactArtwork('"+n.Id+"');",updateClick:"ArtworkLibraryIntegration.UpdateArtwork('"+n.Id+"');",deleteClick:"ArtworkLibraryIntegration.DeleteArtwork('"+n.Id+"');",ToggleRenameClick:"ArtworkLibraryIntegration.ToggleUpdateArtworkFileName('"+n.Id+"');"},{append:!0});else alertInfo("Artwork could be found.")}).catch(function(n){alertMessage(n)})}function l(){var n=null;ArtworkLibrary.DataService.ArtworkFile("126").then(function(t){n=_.clone(t)}).catch(function(n){alertMessage(n)})}function a(n){return new Promise((t,i)=>{ListAccountArtwork!==null&&ListAccountArtwork.length>0?(ListAccountArtwork=_.find(ListAccountArtwork,function(t){return t.Name===n}),t(ListAccountArtwork)):ArtworkLibrary.DataService.SearchContactArtwork(n).then(function(n){ListAccountArtwork=_.clone(n);t(ListAccountArtwork)}).catch(function(n){alertMessage(n);i(n)})})}function v(){ArtworkLibrary.DataService.ContactArtwork().then(function(n){ListAccountArtwork=_.clone(n)}).catch(function(n){alertMessage(n)})}function y(n){$(".ConfirmDialog #deleteLogo").attr("data-id",n);$(".ConfirmDialog").fadeIn()}function p(n){var t=n,i;t!=null&&($(".ConfirmDialog").fadeOut(),i=ArtworkLibrary.DataService.DeleteArtwork(t).then(function(){ListAccountArtwork=_.reject(ListAccountArtwork,function(n){return n.Id===parseInt(t)});$tbUploadedFiles.ajax.reload();u(n,!0)}).catch(function(n){alertMessage(n)}))}function w(n){var t=n;t!=null&&($(".EditableFileName input[data-TxtID='"+n+"']").removeAttr("disabled"),$(".EditableFileName input[data-TxtID='"+n+"']").addClass("active"),$(".EditableFileName input[data-TxtID='"+n+"']").focus(),$(".EditableFileName button[data-BtnID='"+n+"']").fadeIn())}function r(n){var t=n,i=$(".EditableFileName input[data-TxtID='"+n+"']").val();$(".EditableFileName input[data-TxtID='"+n+"']").attr("disabled","true");$(".EditableFileName input[data-TxtID='"+n+"']").removeClass("active");$(".EditableFileName button[data-BtnID='"+n+"']").fadeOut();$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RanameLoader").fadeIn();ArtworkLibrary.DataService.UpdateContactArtwork(t,i).then(function(){var r=_.findIndex(ListAccountArtwork,{Id:t});ListAccountArtwork.splice(r,t,{id:t,name:i});$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RanameLoader").fadeOut("fast",function(){$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RenameDone").fadeIn();setTimeout(function(){$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RenameDone").fadeOut()},3e3)})}).catch(function(n){alertMessage(n)})}function b(n){$(".EditableFileName input[data-TxtID='"+n+"']").keypress(function(t){t.which==13&&r(n)})}function k(i){$("#btnDownloadArtwork").attr("data-BtnID",i);n.hide();$(".ArtworkThumbnailLoader").show();var u=i,r=null,f=null;t.fadeIn();n.attr("src","");ArtworkLibrary.DataService.DownloadContactArtwork(u).then(function(t){r=_.find(t,function(n){return n.IsThumbnail===!0});f=_.find(t,function(n){return n.IsThumbnail===!1});n.attr("src",`data:image/png;base64,${r.FileBytesBase64}`);$(".ArtworkThumbnailLoader").fadeOut();n.fadeIn()}).catch(function(n){alertMessage(n)})}function d(){t.fadeOut("slow");$("#btnDownloadArtwork").attr("href","");nt("","")}function g(){var i=$("#btnDownloadArtwork").attr("data-BtnID"),n=null,r;return r=ArtworkLibrary.DataService.DownloadContactArtworkThumbnail(i).then(function(t){var r,h,c,u,l,f;n=t;var a=n.ArtworkFileStorages.MimeType!=""?n.ArtworkFileStorages.MimeType:"application/pdf",e=window.atob(n.fileBytes),o=e.length,s=new Uint8Array(o);for(r=0;r<o;r++)h=e.charCodeAt(r),s[r]=h;c=new Blob([s],{type:a});u=document.createElement("a");u.href=window.URL.createObjectURL(c);l=$(".EditableFileName input[data-TxtID='"+i+"']").val();u.download=l+t.ArtworkFileStorages.Extension;f=document.createAttribute("target");f.value="_blank";u.setAttributeNode(f);u.click()}).catch(function(n){alertMessage(n)}),r.then(function(){t.modal("hide")}),!1}function nt(t,i){i!==""&&s.attr("href",i);t!==""&&n.attr("src",t)}function u(n,t=false){var f,i,r,u;$("#txtLogoName").val()==""&&t==!1?(alertMessage("Please enter a description or name for the artwork you are uploading."),$("#txtLogoName").addClass("border-red"),$("#tbArtworkData input[type='checkbox'][data-checkbox='"+n+"']").prop("checked",!1)):($("#txtLogoName").removeClass("border-red"),f=0,SelectedArtwork.indexOf(n)>-1?(SelectedArtwork.splice(SelectedArtwork.indexOf(n),1),$("#tbArtworkData input[type='checkbox'][data-checkbox='"+n+"']").prop("checked",!1)):t==!1&&(i=_.find(ListAccountArtwork,function(t){return t.Id==n}),r=i.ArtworkFileStorage.Extension.substr(i.ArtworkFileStorage.Extension.indexOf(".")+1),DashboardJobCardModuleController.FromOnlineApprovals&&ArtworkBrandingMethod.length==0&&(ArtworkBrandingMethod=["pdf","cdr","eps","ai"]),u=_.find(ArtworkBrandingMethod,function(n){return n==r}),u!=null?SelectedArtwork.push(n):(alertMessage("The selected artwork with the extension (<b>"+r.toUpperCase()+"<\/b>) cannot be used for this product."),$("#tbArtworkData input[type='checkbox'][data-checkbox='"+n+"']").prop("checked",!1))),$(".fileselected").text(" "+SelectedArtwork.length),$tbUploadedFiles.data().length==0&&$(".uploadedListItem,#logoUploadSection .ShowProgress").hide())}function tt(n,t=false){if($("#txtLogoName").val()==""&&t==!1)alertMessage("Please enter a description or name for the artwork you are uploading."),$("#txtLogoName").addClass("border-red"),$("#tbArtworkData1 input[type='checkbox'][data-checkbox1='"+n+"']").prop("checked",!1);else{$("#txtLogoName").removeClass("border-red");SelectedArtwork1.indexOf(n)>-1?(SelectedArtwork1.splice(SelectedArtwork1.indexOf(n),1),$("#tbArtworkData1 input[type='checkbox'][data-checkbox1='"+n+"']").prop("checked",!1)):t==!1&&SelectedArtwork1.push(n);$("#fileselected1").text(" "+SelectedArtwork1.length);$tbUploadedFiles.data().length==0&&$(".uploadedListItem,#logoUploadSection .ShowProgress").hide()}$("#tbArtworkData1 input[type='checkbox'][data-checkbox1='"+n+"']").is(":checked")?DiselectedArtworkCount.splice(DiselectedArtworkCount.indexOf(n),1):DiselectedArtworkCount.push(n)}function it(){return SelectedArtwork}function rt(){return SelectedArtwork1}function ut(n,t){return ListAccountArtwork=[],new Promise(r=>{i($("ol#productPositions").find("li.active").text(),$("#productBtnsContainer").find("span.active").text(),n,t),r(!0)})}function ft(){}function i(n,t,i,r){if($(".fileselected").text(" 0"),SelectedArtwork.length===0)loadingService.show(),ArtworkLibrary.DataService.GetpreviouslySelectedArtwork(i,r).then(function(i){if(i!==null){SelectedArtwork=[];for(var r=0;r<i.length;++r)if(n===i[r].Position&&t===i[r].ProductCode){let n=_.find(SelectedArtwork,function(n){return n===i[r].ArtworkId});typeof n=="undefined"&&(SelectedArtwork.push(i[r].ArtworkId),$("#tbArtworkData input[type='checkbox'][data-checkbox='"+i[r].ArtworkId+"']").prop("checked",!0))}if(SelectedArtwork.length>0&&($(".fileselected").text(" "+SelectedArtwork.length),$('a[href="#tab-4"]').click(),$("#logoNameInput").fadeIn()),typeof DashboardJobCardModuleController!="undefined"&&SelectedArtwork.length==0&&DashboardJobCardModuleController.SelectedLogos.length>0){for(let n=0;n<DashboardJobCardModuleController.SelectedLogos.length;++n)$("#tbArtworkData input[type='checkbox'][data-checkbox='"+DashboardJobCardModuleController.SelectedLogos[n]+"']").prop("checked",!0);$(".fileselected").text(" "+DashboardJobCardModuleController.SelectedLogos.length);$('a[href="#tab-4"]').click();$("#logoNameInput").fadeIn();$("#logoNameInput #txtLogoName").val(DashboardJobCardModuleController.LogoName)}}$("#logoNameInput").fadeIn();loadingService.hide()}).catch(function(n){loadingService.hide();alertMessage(n)});else{for(var u=0;u<SelectedArtwork.length;++u)$("#tbArtworkData input[type='checkbox'][data-checkbox='"+SelectedArtwork[u]+"']").prop("checked",!0);$(".fileselected").text(" "+SelectedArtwork.length);$('a[href="#tab-4"]').click();$("#logoNameInput").fadeIn()}SelectedArtwork.length>0&&$(".fileselected").text(" "+SelectedArtwork.length)}function et(){var t,n;if(SelectedArtwork1=[],t=[],SelectedArtworkTab1.length>0){for(n=0;n<SelectedArtworkTab1.length;n++)$("#tbArtworkData1 input[type='checkbox'][data-checkbox1='"+SelectedArtworkTab1[n]+"']").prop("checked",!0),t.push(SelectedArtworkTab1[n]);$.each(t,function(n,t){$.inArray(t,SelectedArtwork1)===-1&&SelectedArtwork1.push(t)})}}function ot(){if(SelectedArtwork.length>0)for(var n=0;n<SelectedArtwork.length;n++)$("#tbArtworkData input[type='checkbox'][data-checkbox='"+SelectedArtwork[n]+"']").prop("checked",!1);$(".fileselected").text(" 0");SelectedArtwork1=[];SelectedArtwork=[]}function st(){$(".ShowProgress").hide();$("#ProgressContainer").empty();$("#tbArtworkData1").empty();SelectedArtwork1=[];DiselectedArtworkCount=[]}ListAccountArtwork=[];var f={GetArtworkLibrary:h,GetContactArtworkFile:l,GetListAccountArtwork:v,DeleteArtwork:y,ConfirmDelete:p,UpdateArtwork:r,SearchContactArtwork:c,DownloadContactArtwork:k,DownloadContactArtworkThumbnail:g,CountSelectedArtwork:u,CountSelectedArtworkTab1:tt,CloseModalPreviewBanner:d,ReloadArtworkData:ut,ToggleUpdateArtworkFileName:w,GetSelectedArtworkData:it,GetpreviouslySelectedArtwork:i,GetSelectedArtworkDataTab1:rt,GetpreviouslySelectedArtworkTab1:et,BindDataTable:ft,TbUploadedFiles:$tbUploadedFiles,ClearSelectedArtwork:ot,ClearSelectedArtworkTab1:st,UpdateArtworkFileNameOnKeypress:b},e=$("#artworkRowTemplate"),o=$("#tbArtworkData"),t=$("#modalPreviewBanner"),s=$("#lnkPreviewArtwork"),n=$("#imgPreviewArtwork");return f}(),DisplayDataService=function(n){"use strict";function t(){}function i(n){var t="An error occured.";try{n.Error?t=n.Error:n.responseJSON&&n.responseJSON.Error?t=n.responseJSON.Error:n.TheData&&(t=n.TheData)}catch(i){console.log(i)}return t}var r="AjaxHandlers/DisplayLogoUploadHandler.aspx";return t.prototype.downloadDisplayTemplate=function(n,t){var u=$.ajax({url:r+"?a=DownloadDisplayTemplate&code="+n+"&position="+t,dataType:"JSON",cache:!1});return Promise.resolve(u).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.loadContactsAndSizes=function(n,t,u,f){var e=$.ajax({url:r+"?a=GetContactsAndBrandingPositionDetails&i="+n+"&c="+t+"&bc="+u+"&colourCode="+f,dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.addJobCardDetails=function(n,t,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){var d=$.ajax({url:r+"?a=SaveLogoBrandingDetails",data:{uploadType:n,finish:t,lId:JSON.stringify(u),p:f,jc:e,pc:o,bp:s,cId:h,si:c,reuseLogo:l,reuseColour:a,numColours:v,flags:y,uploadForJobCardNumber:p,artworkFlag:w,logoName:b,brandingMethod:k},dataType:"json",cache:!1});return Promise.resolve(d).then(function(n){return!n.Success&&n.Error?Promise.reject(n):n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getStepDetails=function(n,t,u,f){var e=$.ajax({url:r+"?a=GetDocumentBrandingDetail",data:{uploadType:n,position:t,productCode:u,jobCardNumber:f},dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){if(n.Success)return n.TheData}).catch(function(n){return Promise.reject(i(n))})},t.prototype.searchRepeatJobCard=function(n,t,u,f,e,o,s,h,c,l){var a=$.ajax({url:r+"?a=LoadExactRepeats",data:{name_startsWith:n,productIndex:f,PrintProcessNumberOfColors:t,PrintDepartmentName:u,itemCode:e,colourCode:o,size:s,StartDate:h,EndDate:c,coloursAndSizes:JSON.stringify(l)},dataType:"json",cache:!1});return Promise.resolve(a).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.canJobCardBeExactRepeat=function(n,t,u,f,e,o,s){var h=$.ajax({url:r+"?a=CanJobCardBeExactRepeat",data:{RepeatJobCardNumber:n,PrintProcessNumberOfColors:t,PrintDepartmentName:u,AccountNumber:f,itemCode:e,colourCode:o,size:s},dataType:"json",cache:!1});return Promise.resolve(h).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.changeLogoName=function(n,t,u,f,e,o){var s=$.ajax({url:r+"?a=ChangeLogoName",data:{logoId:JSON.stringify(n),logoName:t,productCode:u,position:f,uploadType:e,jobCardNumber:o},dataType:"json",cache:!1});return Promise.resolve(s).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getJobCardLogos=function(n,t,u,f,e){var o=$.ajax({url:r+"?a=GetPreviousJobcardsWithLogos",data:{SearchTerm:n,StartDate:t,EndDate:u,Take:f,Skip:e},dataType:"json",cache:!1});return Promise.resolve(o).then(function(n){return n.Success?n:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getAllPantoneColours=function(){var n=$.ajax({url:r+"?a=GetAllPantoneColours",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getAllFoilColours=function(){var n=$.ajax({url:r+"?a=GetAllFoilColours",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.canJobCardLogoBeUsed=function(n,t,u,f){var e=$.ajax({url:r+"?a=CanJobCardLogoBeUsed&AccountNumber="+n+"&JobCardNumber="+f,dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){return n.Success?n:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getPantoneColours=function(n){var t=$.ajax({url:r+"?a=GetPantoneColours&t="+n,dataType:"json"});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getMarathonColours=function(n){var t=$.ajax({url:r+"?a=GetMarathonColours&t="+n,dataType:"json"});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getDocumentBrandingLogos=function(){var n=$.ajax({url:r+"?a=GetDocumentBrandingLogos",dataType:"json"});return Promise.resolve(n).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getShoppingCart=function(){var n=$.ajax({url:"AjaxHandler.aspx?a=LoadShoppingCart",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getJobCardProduct=function(n){var t=$.ajax({url:r+"?a=GetJobCardProduct",data:{jobCardNumber:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getCartProducts=function(){return this.getShoppingCart().then(function(n){var t=[],i=n.CartLinesVO;return productInventoryType=null,i.forEach(function(n){var f,r,u,i;(n.InventoryType==5||n.InventoryType==7||n.InventoryType==9)&&((n.InventoryType===5?productInventoryType=productTypes.DisplayProduct:n.InventoryType===7&&(productInventoryType=productTypes.CustomPackaging),f=_.find(n.CartBrandingVO,function(n){return n.IsNoCoBranding===!0}),f&&n.InventoryType!==7&&n.InventoryType!==9)||(n.InventoryType===9&&(n.CartBrandingVO=_.reject(n.CartBrandingVO,function(n){return n.IsNoCoBranding===!0})),n.CartBrandingVO.length&&(r=[],u=[],n.CartBrandingVO.forEach(function(n){if(n.IsNoCoBranding!==!0||productInventoryType!==productTypes.CustomPackaging){if(productInventoryType===productTypes.CustomPackaging){var t=!1;if((n.BrandMethodCode.startsWith("DCB")||n.BrandMethodCode.startsWith("DCP"))&&(t=!0),!t)return}r.push({position:n.Position,numColours:n.NumberOfColours,brandingMethod:n.BrandMethodCode,description:n.PositionDescription})}}),n.CartItemsVO.forEach(function(n){u.push({Colour:n.ColourCode,Size:n.SizeCode})}),i={productCode:n.ProductCode,productIndex:n.Index,productPositions:r,productName:n.ProductName,imageUrl:n.DefaultImageURL,colourCode:null,size:n.Size,productColoursAndSizes:u,productInventoryType:productInventoryType},n.CartItemsVO.length==1&&(i.colourCode=n.CartItemsVO[0].ColourCode,i.size=n.CartItemsVO[0].SizeCode),t.push(i))))}),t})},t.prototype.getJobCardProductPositions=function(n,t,u=false){var f=$.ajax({url:r+"?a=GetJobCardProductPositions",data:{jobCardNumber:n,brandingMethod:t,FromOnlineApprovals:u},dataType:"json",cache:!1});return Promise.resolve(f).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.isLogoUploadDetailsComplete=function(){var n=$.ajax({url:r+"?a=IsLogoUploadDetailsComplete",method:"GET",dataType:"json",cache:!1});return Promise.resolve(n).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.GetAzureBlobUploadMetadata=function(n){var t=$.ajax({url:r+"?a=GetAzureBlobUploadMetadata",method:"GET",data:{fileName:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.CreateContactArtworkDisplay=function(n){var t=$.ajax({url:r+"?a=CreateContactArtworkDisplay",method:"POST",data:{fileData:JSON.stringify(n)},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.canUploadLogos=function(n){var t=$.ajax({url:r+"?a=CanUploadLogos",method:"GET",data:{uploadType:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n}).catch(function(n){return Promise.reject(i(n))})},t.prototype.getBrandingMethodExtensions=function(n){var t=$.ajax({url:r+"?a=GetBrandingMethodExtensions",method:"GET",data:{brandingCode:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return _.map(n.TheData,function(n){return _.toLower(n)})}).catch(function(n){return Promise.reject(i(n))})},t.prototype.deleteBranding=function(n,t,u){var f=$.ajax({url:r+"?a=DeleteBranding",method:"POST",data:{productCode:n,productIndex:t,position:u},dataType:"json",cache:!1});return Promise.resolve(f).then(function(){return}).catch(function(n){return Promise.reject(i(n))})},t.prototype.deleteJobCardBranding=function(n){var t=$.ajax({url:r+"?a=DeleteJobCardBranding",method:"POST",data:{jobCardNumber:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(){return}).catch(function(n){return Promise.reject(i(n))})},t.prototype.searchContactArtworkDisplay=function(n,t,u){var f=$.ajax({url:r+"?a=SearchContactArtworkDisplay",method:"POST",data:{productCode:n,brandingMethod:t,artworkDescription:u},dataType:"json",cache:!1});return Promise.resolve(f).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.deleteContactArtworkDisplay=function(n){var t=$.ajax({url:r+"?a=DeleteContactArtworkDisplay",method:"POST",data:{artworkId:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.UpdateContactArtwork=function(n,t){var u=$.ajax({url:r+"?a=UpdateContactArtworkDisplay",method:"POST",data:{artworkId:n,artworkData:JSON.stringify(t)},dataType:"json",cache:!1});return Promise.resolve(u).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.downloadArtworkDisplay=function(n){var t=$.ajax({url:r+"?a=DownloadArtworkDisplay",method:"POST",data:{artworkId:n},dataType:"json",cache:!1});return Promise.resolve(t).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(i(n))})},t.prototype.GetpreviouslySelectedArtwork=function(n,t,u,f){var e=$.ajax({url:r,data:{a:"GetpreviouslySelectedArtwork",position:n,productCode:t,uploadType:u,jobcard:f},method:"GET",dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(i(n))})},t.prototype.GetRecentlySelectedArtwork=function(n,t,u,f,e){var o=$.ajax({url:r,data:{a:"GetRecentlySelectedArtwork",productCode:n,logoName:t,brandingMethod:u,uploadType:f,jobCardNumber:e},method:"GET",dataType:"json",cache:!1});return Promise.resolve(o).then(function(n){return n.TheData}).catch(function(n){return Promise.reject(i(n))})},DisplayDataService=t}(alerterService.error),DisplayCartLoading=function(){return CartLoading.prototype.show=function(){$("#displayLogoUploadLoading").show()},CartLoading.prototype.hide=function(){$("#displayLogoUploadLoading").hide()},CartLoading}(),fromArtwork=!1,exactRepeatCheck=!1,ArtworkBrandingMethod=[],SelectedArtworkforDisplay=[],RecentlyAddedArtwork=[],tempArtwork=[],selectedTab,LogoUploadTabs={Upload:1,Library:2,ExactRepeat:3},BrandingPositionsArtwork=[],DisplayLogoUpload=function(n,t,i,r,u,f){"use strict";function re(){return{open:os,showLogoHelp:ss,changeLogoName:cs,stepBack:vo,stepForward:wo,proceed:yi,finish:ns,reuseLogo:ts,reuseColour:is,closeReplicateModal:br,changeJobCardImageUpload:th,clearLogoHeight:fh,clearLogoWidth:eh,searchRepeatJobCard:ks,downloadDocument:dh,submitRepeat:hh,removeUploadedFile:nh,getLogosFromPreviousJobCards:ds,copyJobCardLogo:vh,ValidateUploadArtWork:lo,handleColourChange:ti,generateColourSection:ys,showLogoUploadSection:bi,cancelExactRepeatButUseValues:function(){exactRepeatCheck=!1;bi(!1,!0)},onCartLogoSelected:us,loadProductForLogoUpload:bo,loadPosition:ni,stepToDetailStage:go,close:nr,confirmClose:lh,onMatchColoursChecked:oc,onMatchToneOnToneChecked:sc,validateImageName:ih,resetExactStep:ph,ResetColours:kh,downloadDisplayTemplate:ko,createDropzone:pf,SearchContactArtworkDisplay:wf,DownloadContactArtwork:yc,DownloadContactArtworkThumbnail:pc,DeleteArtwork:wc,ConfirmDelete:bc,UpdateArtwork:bf,ToggleUpdateArtworkFileName:kc,UpdateArtworkFileNameOnKeypress:dc,CountSelectedArtworkDisplay:kf,CountSelectedArtworkDisplayTab1:df,GetpreviouslySelectedArtwork:gf}}function lo(n){switch(n){case"tab1":dt.show();$("#pDescription").show();$("#pDescription4").hide();s.removeClass("border-red");fromArtwork=!0;$("#display-tab-1").fadeIn();$("#tab-2,#tab-3,#display-tab-4").fadeOut();exactRepeatCheck=!1;selectedTab=LogoUploadTabs.Upload;break;case"tab2":displayLogoUpload.searchRepeatJobCard();dt.hide();$("#pDescription").hide();$("#pDescription4").hide();fromArtwork=!1;$("#tab-2").fadeIn();$("#display-tab-1,#tab-3,#display-tab-4").fadeOut();selectedTab=LogoUploadTabs.ExactRepeat;break;case"tab3":dt.show();$("#pDescription").hide();$("#pDescription3").show();$("#pDescription4").hide();fromArtwork=!1;exactRepeatCheck=!1;$("#loadMoreLogoRepeat").hide();s.removeClass("border-red");$("#tab-3").fadeIn();$("#display-tab-1,#tab-2,#display-tab-4").fadeOut();break;case"tab4":exactRepeatCheck=!1;dt.show();$("#pDescription").hide();$("#pDescription4").show();s.removeClass("border-red");fromArtwork=!0;$("#display-tab-4").fadeIn();$("#tab-2,#tab-3,#display-tab-1").fadeOut();ho=[];selectedTab=LogoUploadTabs.Library}}function ef(){var n=!0,t=null,i;return SelectedArtworkforDisplay.length>0?a=SelectedArtworkforDisplay:RecentlyAddedArtwork.length>0&&(a=RecentlyAddedArtwork,SelectedArtworkforDisplay=RecentlyAddedArtwork),ht()&&!lt&&(n=!1,t="please select logo in order to proceed."),i=s.val(),i!==""||$("#exactRepeatTabDisplay").hasClass("active")||(n=!1,t="The artwork description cannot be empty."),$("#logoRepeatTab").hasClass("active")&&!lt&&(n=!1,t="Please select logo in order to proceed."),SelectedArtworkforDisplay.length!=0||of()||(typeof DashboardJobCardModuleController!="undefined"?DashboardJobCardModuleController.SelectedLogos.length>0?a=DashboardJobCardModuleController.SelectedLogos:(n=!1,t="Please select logo in order to proceed.",exactRepeatCheck&&(n=!0,t=null)):(n=!1,t="Please select logo in order to proceed.",exactRepeatCheck&&(n=!0,t=null))),{valid:n,errorMessage:t}}function ao(){return{valid:!0,errorMessage:null}}function of(){var n=!1;return((h&r.IsCopy)>0&&(n=!0),fromArtwork)?!1:n}function ht(){var n=!1;return(h&r.IsRepeat)>0&&(n=!0),exactRepeatCheck&&n==!1&&(n=!0),n}function vo(){$(".ShowProgress").hide();var n=ht();n?hf():k.index==0?hf():cf(pr.Back)}function yo(){if(w.length==1&&w[0].positions.length==1)return!1;return!tr}function po(){var n=!1,t;return w.length==1&&w[0].positions.length==1?!1:hc()?!1:(t=_.sumBy(w,function(n){var t=_.filter(n.positions,function(n){return uc(n.numColours,n.brandingMethod)});return t.length}),t>1&&(n=!ir),n)}function wo(){var n=ht();$(".ShowProgress").hide();n?sf():tu().then(function(n){n.valid?k.index==0&&yo()?yi():k.index==2&&po()?hs():yi():(s.val()!==""?s.removeClass("border-red"):s.addClass("border-red"),l(n.errorMessage))})}function yi(){var n=!0;if(y===LogoUploadType.JobCard){n=!1;let t=_.maxBy(w,function(n){return n.productIndex});o.productIndex===t.productIndex&&c.index===o.positions.length-1&&(n=!0)}wi(n).then(function(){k.index==ft.length-1?sf():cf(pr.Next)}).catch(function(n){l(n);loadingService.hide()})}function sf(){var n,t;c.index==o.positions.length-1?(n=_.find(w,function(n){return n.productIndex==cc()}),n&&pi(n,!0)):(t=_.find(o.positions,function(n){return n.index==c.index+1}),ni(t.position))}function hf(){var n,t;c.index==0?(n=_.find(w,function(n){return n.productIndex==lc()}),n&&pi(n,!0)):(t=_.find(o.positions,function(n){return n.index==c.index-1}),ni(t.position))}function cf(n){var t,i=_.filter(ft,function(n){return n.visible});t=n==pr.Next?_.find(i,function(n){return n.index>k.index}):_.findLast(i,function(n){return n.index<k.index});ui(t.index)}function bo(n){if(loadingService.show(),n==o.productIndex){loadingService.hide();return}var t=_.find(w,function(t){return t.productIndex==n});pi(t,!0)}function pi(n,t){be.loadTemplate(we,{productImgUrl:n.productImgUrl,productName:n.productName,brandingLayoutURL:"ProductLayout.aspx?Code="+n.productCode});$(".product-positions a[data-href='brandingLayoutURL']").attr("href","ProductLayout.aspx?Code="+n.productCode);ku.empty();n.positions.forEach(function(n){ku.loadTemplate(ke,{position:n.position,onClick:n.onClick},{append:!0})});o=n;isDisplayProduct=!0;t&&ni(n.positions[0].position);lr.removeClass("active");var i=_.find(lr,function(t){return $(t).attr("product-index")==n.productIndex});$(i).addClass("active");$(".nav-tabs li.active").removeClass("active");$("#display-tab-1").fadeOut();$("#tab-2").fadeOut();$("#tab-3").fadeOut();$("#display-tab-4").fadeOut();exactRepeatCheck=!1;$("#exactRepeatTabDisplay,#SelectFromLibraryTab").removeAttr("onclick");$("#exactRepeatIcon, #selectFromLibraryIcon").removeClass("TabIcon").addClass("exactRepeatIcon");$("#spnRepeatText, #spnLibraryText").removeClass("blue").addClass("spnRepeatText");$("#spnTooltip, #libraryTooltip").removeClass("blue").addClass("spnTooltip");$("#spnTooltip").attr("data-original-title","The Exact Repeat is not available for Displays and Custom Boxes");$("#libraryTooltip").attr("data-original-title","The Library is not available for Displays and Custom Boxes");$("#tab-2").fadeOut();$("#exactRepeatTabDisplay").hasClass("active")&&$("#exactRepeatTabDisplay").removeClass("active")}function ko(n,i){return t.downloadDisplayTemplate(n,i).then(function(t){if(t.Success)if(t.TheData.isNonCoBranding)l("There are no branding templates available for the product.");else{var r=document.createElement("a");r.setAttribute("target","_blank");r.href=t.TheData.templateDownloadUrl;r.download="Branding Template - "+n+" - "+i+".pdf";r.click()}else l("The template for this branding position is currently unavailable. Please contact your account manager for assistance.")})}function ni(n){var i,u;gc();$(".uploadedListItem,#logoUploadSectionDisplay .ShowProgress").hide();$("#dzUpload").each(function(){let n=$(this)[0].dropzone;n&&n.destroy()});$("#dzUpload").show();wf(o.productCode,n,v,!1);pf(o,n);$("#HideContentLoader").fadeIn();eu=n;bi();i=_.find(o.positions,function(t){return t.position==n});typeof i!="undefined"&&(i.index>0||o.productIndex>0)?rr.show():rr.hide();c=i;$("[product-position]").removeClass("active");$('[product-position="'+n+'"]').addClass("active");$("#positionLetterDisplay").text(n);$("#downloadDisplayTemplateLink1").attr("onclick",'displayLogoUpload.downloadDisplayTemplate("'+o.productCode+'","'+n+'")');$(".download-template-link.downloadDisplayTemplateLink2").attr("onclick",'displayLogoUpload.downloadDisplayTemplate("'+o.productCode+'","'+n+'")');ft.forEach(function(n){n.visible=!0});dr();typeof c!="undefined"?(yf(c.brandingMethod)&&(c.brandingMethod.indexOf("EM-")==0||c.brandingMethod.indexOf("EMB-")===0?(nf.show(),tf.show()):c.brandingMethod.indexOf("FL")==0&&($("#colourSectionDisplay .HideColour,.HideShowMarathonColor").hide(),$("#colourSectionDisplay .ShowFoilColour").show(),$(ut).val(""),$(".palette-color-picker-button.MarathonControlId").removeAttr("style"),$(nt).val(""),$(".cPreview").css("background-color","white"),$(st).val(""),$(".palette-color-picker-button:not(.MarathonControlId)").css("background-color","white"),at(),tt.fadeOut(),at(),tt.fadeOut(),h=r.None,tt.fadeIn())),dr(),fo.html("("+c.description+")"),u=ec(c.brandingMethod),ct.empty(),ct.append($("<option><\/option>").text("Select Location").val("-1")),u.forEach(function(n){ct.append($("<option><\/option>").text(n))}),ct.val(-1),$("#HideContentLoader").fadeOut(),ws().then(function(){return sh(c.position,o.id)}).then(function(){return t.getBrandingMethodExtensions(c.brandingMethod)}).then(function(n){if(n)if(gt=n,yr.empty(),gt.length>0){ArtworkBrandingMethod=n;var t=gt.join(".");yr.text("Acceptable formats: "+t+"")}else ArtworkBrandingMethod=["pdf","cdr","eps","ai"],yr.text("Acceptable formats: .pdf, .cdr.eps or.ai.");ui(0)}).catch(function(n){ui(0);l(n)})):ui(0)}function go(n){var i=ht(),t;if(i){t="You cannot specify branding info if you want to do an exact repeat.";l(t);return}ui(n)}function ui(n){var i=[];return ft.forEach(function(r){var u=$("#"+r.elementId),f=$("#"+r.aboutElementId),e=r.validate().then(function(i){var e=$("[detail-step-index="+r.index+"]"),h,c;i.valid?e.addClass("done"):(h=$("ol#productPositionsDisplay").find("li.active").text(),c=$("#displayProductBtnsContainer").find("span.active").text()+":"+o.productIndex,t.GetRecentlySelectedArtwork(c,s.val(),h,y,p).then(function(n){if(n.length>0)RecentlyAddedArtwork=[],tempArtwork=[],RecentlyAddedArtwork.push(n[0].ArtworkId),tempArtwork.push(n[0].ArtworkId),e.addClass("done");else if(DashboardJobCardModuleController.FromOnlineApprovals&&BrandingPositionsArtwork.length>0){var t=_.find(BrandingPositionsArtwork,function(n){return n.BrandingPosition===$("ol#productPositionsDisplay").find("li.active").text()});typeof t!="undefined"?(RecentlyAddedArtwork=[],tempArtwork=[],RecentlyAddedArtwork.push(t.ArtworkId),tempArtwork.push(t.ArtworkId),e.addClass("done")):(e.removeClass("done"),SelectedArtworkforDisplay=[])}else e.removeClass("done"),SelectedArtworkforDisplay=[]}).catch(function(n){e.removeClass("done");alertMessage(n)}));r.index==n?(k=r,u.show(),f.show()):(u.hide(),f.hide())});i.push(e)}),Promise.all(i).then(function(){$("[detail-step-index]").removeClass("active");var t=$("[detail-step-index="+n+"]");t.addClass("active");wr()}).catch(function(n){l(n)})}function wr(){if(DashboardJobCardModuleController.FromOnlineApprovals&&productInventoryType===productTypes.CustomPackaging)ii.hide(),ri.show();else if(k){k.index>0&&rr.show();ii.hide();ri.hide();var n=_.maxBy(w,function(n){return n.productIndex});typeof c!="undefined"&&(o.productIndex<n.productIndex||c.index<o.positions.length-1?ii.show():k.index<ft.length-1?ht()?ri.show():ii.show():o.productIndex==n.productIndex&&c.index==o.positions.length-1&&ri.show())}}function ns(){loadingService.show();wi(!0).then(function(n){y===LogoUploadType.JobCard&&n.TheData!==null&&(it(n.TheData),CollapseJobCardView());loadingService.hide();nr()}).catch(function(n){loadingService.hide();l(n)})}function ts(){br("modalReuseLogoDisplay");vt=!0}function is(){br("modalReuseLogoDisplay");yt=!0}function br(n){$("#"+n).modal("hide");$("body").addClass("modal-open");yi()}function rs(){h=0;ce.show();vf();vu.hide();bs();oi.hide();li.hide();ur.hide();$("#loadMoreLogoRepeat").hide();vt=!1;tr=!1;yt=!1;ir=!1;ft.forEach(function(n){$("#"+n.elementId).hide();$("#"+n.aboutElementId).hide()})}function us(){var n=ot[0].selectedIndex,t=parseInt(ot.val()),i=ot.find("option:selected").text();rt=null;n>0&&(a=t,v=i,hi.show())}function kr(){var i=this,n,t;ot.html("");ot.append($("<option>Please select a logo<\/option>"));bt.length>0&&(n=_.clone(bt).reverse(),n=_.uniqBy(n,"name"),t="",n.forEach(function(n){if(t!=n.name){var i=$("<option><\/option>");i.html(n.name);i.val(n.id);ot.append(i)}t=n.name}))}function fs(){return bt=[],vi.fnGetLogos().then(function(n){bt=n;kr()})}function es(){return Promise.resolve().then(function(){return vi.fnGetProducts()})}function os(n,r,u,f,e,o){rs();y=n;p=f;rt=f;vi.fnGetProducts=e;vi.fnGetLogos=o;ch();var s=[];i.show();t.canUploadLogos(y).then(function(n){if(!n.Success)throw n.Error;return es()}).then(function(n){if(s=n,o)return fs()}).then(function(){if(dr(),i.hide(),vs(s),u){var n=_.find(w,function(n){return n.productIndex==r});pi(n,!1);ni(u)}fr.modal({backdrop:"static",keyboard:!1});return}).catch(function(n){i.hide();l(n);nr()})}function ss(){var n=su.html();alertMessage(n)}function it(n){u.info(n)}function hs(){oo.modal({backdrop:"static",keyboard:!1})}function l(n){u.error(n)}function cs(n){$("#logoNameInput .RanameLogoDescriptionLoader").fadeIn();s.removeClass("border-red");var i=t;n!==""&&(a=SelectedArtworkforDisplay,a.length===0&&RecentlyAddedArtwork.length>0&&a.push(RecentlyAddedArtwork[0].Id),productInventoryType===productTypes.CustomPackaging&&(i=new CustomPackagingDataService,tempArtwork=[]),(a.length>0||tempArtwork.length>0)&&(y===LogoUploadType.Cart?i.changeLogoName(a,n,o.productCode+":"+o.productIndex,c.position,y,p).then(function(){v=n;s.val(n);$("#logoNameInput .RanameLogoDescriptionLoader").fadeOut();$("body").trigger(ei,{productIndex:o.productIndex,position:c.position,uploadForJobCardNumber:p,logoId:a,logoName:v,productCode:o.productCode,productInventoryType:productInventoryType});it("The logo name has been updated.")}).catch(function(t){t==="The logo name could not be changed."&&a.length>0?s.val(n):(s.val(v),l(t),$("#logoNameInput .RanameLogoDescriptionLoader").fadeOut(),s.addClass("border-red"))}):y===LogoUploadType.JobCard&&p!==null&&t.changeLogoName(a,n,o.productCode+":"+o.productIndex,c.position,y,p).then(function(){v=n;s.val(n);$("#logoNameInput .RanameLogoDescriptionLoader").fadeOut();$("body").trigger(uu,{productIndex:o.productIndex,uploadForJobCardNumber:p,logoId:a,logoName:v,productCode:o.productCode,productInventoryType:productInventoryType});it("The logo name has been updated.")}).catch(function(n){n.includes("The logo name could not be changed.")||(s.val(v),l(n),$("#logoNameInput .RanameLogoDescriptionLoader").fadeOut(),s.addClass("border-red"))})),DashboardJobCardModuleController.FromOnlineApprovals&&BrandingPositionsArtwork.length>0&&(v=n,s.val(n),$("#logoNameInput .RanameLogoDescriptionLoader").fadeOut(),$("body").trigger(ei,{productIndex:o.productIndex,uploadForJobCardNumber:DashboardJobCardApprovalModuleController.JobCardNumber,logoId:a,logoName:v,productCode:o.productCode}),it("The logo name has been updated.")))}function ls(){var n=[];return $(cr,ou).each(function(){var r=$(nt,$(this)),e=$(ut,$(this)),u=$(st,$(this)),f=$(hr,$(this)),i=$(de,$(this)),t=null;r.val()!=""?t=r.val():u.val()!=""?t=u.val():$(hr,$(this)).index()>0?t=f.val()+se:i.val()!=""&&i.val()!="0"&&(t=i.val());t&&n.push(t)}),n}function as(){var n=[];return $(cr,ou).each(function(){var i=$(ut,$(this)),t=null;i.val()!=""&&(t=i.val());t&&n.push(t)}),n}function wi(n){var i=this;return n||(n=!1),s.removeClass("border-red"),tu().then(function(i){var r,f;if(i.valid){var w=ct.val(),e=rt,u=SelectedArtworkforDisplay;return u.length===0&&RecentlyAddedArtwork.length>0&&(u=RecentlyAddedArtwork),DashboardJobCardModuleController.FromOnlineApprovals?(r={DateCached:null,Error:null,FromCache:!1,Success:!1,TheData:null},u.length!==0&&(DashboardJobCardModuleController.SelectedLogos=BrandingPositionsArtwork,DashboardJobCardModuleController.LogoName=s.val(),r.Success=!0,r.TheData="Artwork Uploaded.",$("#ApproveUploadArtwork #EditUpload .logo24-logo").text(s.val()),$("#ApproveUploadArtwork #EditUpload img").attr("onclick","DashboardJobCardModuleController.EditLogoUploader()"),$("#ApproveUploadArtwork #UploadFile").hide(),$("#ApproveUploadArtwork #EditUpload").show()),DashboardJobCardModuleController.SelectedLogos!==0?(BrandingPositionsArtwork=DashboardJobCardModuleController.SelectedLogos,DashboardJobCardModuleController.LogoName=s.val(),r.Success=!0,r.TheData="Artwork Uploaded.",$("#ApproveUploadArtwork #EditUpload .logo24-logo").text(s.val()),$("#ApproveUploadArtwork #EditUpload img").attr("onclick","DashboardJobCardModuleController.EditLogoUploader()"),$("#ApproveUploadArtwork #UploadFile").hide(),$("#ApproveUploadArtwork #EditUpload").show()):(r.Error="Please upload at least one logo.",r.Success=!1,$("#ApproveUploadArtwork #UploadFile").show(),$("#ApproveUploadArtwork #EditUpload").hide(),$("#ApproveUploadArtwork #EditUpload .logo24-logo").text(""),$("#ApproveUploadArtwork #EditUpload img").attr("onclick","")),n&&(DashboardJobCardApprovalModuleController.ApproveRequestLoading(),$.ajax({url:"Dashboard/DashboardAjaxHandler.aspx"+DashboardJobCardApprovalModuleController.GetBuildSetDataAjaxFilter("DashboardRequestJobCardChangeWithRequestType",DashboardJobCardApprovalModuleController.JobCardNumber,null,null,"",DashboardJobCardModuleController.SelectedLogos,0),dataType:"json",type:"GET",cache:!1,success:function(n,t,i){DashboardJobCardApprovalModuleController.RequestComplete(n,t,i)},error:function(n){DashboardJobCardApprovalModuleController.Error(n.responseJSON.Error,2)}})),Promise.resolve(r)):(f=t,productInventoryType===productTypes.CustomPackaging&&(f=new CustomPackagingDataService),Promise.resolve(f.addJobCardDetails(y,n,u,w,e,o.id,c.position,[],"",vt,yt,c.numColours,h,p,fromArtwork,s.val(),c.brandingMethod)).then(function(n){if(n.Success){if((a==null||a.length==0)&&(a=SelectedArtworkforDisplay,a.length==0&&(a=SelectedArtworkforDisplay)),(a||ht())&&(v=s.val(),y===LogoUploadType.JobCard&&p!==null?$("body").trigger(uu,{productIndex:o.productIndex,uploadForJobCardNumber:p,logoId:a,logoName:v,productCode:o.productCode}):$("body").trigger(ei,{productIndex:o.productIndex,position:c.position,uploadForJobCardNumber:p,logoId:a,logoName:v,productCode:o.productCode})),vt){var t=v;of()&&(t="Logo from: "+e);$("body").trigger(ue,{logoId:a,logoName:t})}return yt&&(yt=!1,ir=!0),vt&&(vt=!1,tr=!0),n}l(n.TheData)}).catch(function(n){return l(n),Promise.reject(n)}))}return s.val()===""&&s.addClass("border-red"),l(i.errorMessage),Promise.reject(i.errorMessage)})}function vs(n){w=[];du.empty();n=_.sortBy(n,["productIndex"]);n.forEach(function(n){var i;if(n.productPositions!=0||DashboardJobCardModuleController.FromOnlineApprovals){var u="displayLogoUpload.loadProductForLogoUpload("+n.productIndex+");",r=[],t=!1;(n.productPositions.forEach(function(i,u){(n.productInventoryType!==productTypes.CustomPackaging||(i.brandingMethod.startsWith("DCB")?t=!0:i.brandingMethod.startsWith("DCP")&&(t=!0),t))&&r.push({index:u,position:i.position,numColours:i.numColours,brandingMethod:i.brandingMethod,description:i.description,onClick:"displayLogoUpload.loadPosition('"+i.position+"');"})}),t||n.productInventoryType!==productTypes.CustomPackaging)&&(i={productCode:n.productCode,productName:n.productName,productImgUrl:n.imageUrl,productIndex:n.productIndex,positions:r,colourCode:n.colourCode,size:n.size,id:n.productCode+":"+n.productIndex,onClick:u,productColoursAndSizes:n.productColoursAndSizes,productInventoryType:n.productInventoryType},w.push(i),du.loadTemplate(io,{productIndex:n.productIndex,productCode:n.productCode,onClick:i.onClick},{append:!0}))}});lr=$(".prod-btn","#displayProductBtnsContainer")}function at(){$(nt).val("");$(st).val("");$(ut).val("");$(ge).removeAttr("style");$(to).removeAttr("style");$(no).removeAttr("style")}function bi(n=true){if(a=null,rt=null,n){ot.html("");let n=$("#displayProductBtnsContainer").find("span.active").text()+":"+$("#displayProductBtnsContainer").find("span.active").attr("product-index");n!==o.id&&(s.val(""),tempArtwork=[]);d.val("");kt.val("");$("#txtlogoRepeatJob").val("");g.val("");ct.val(-1);at()}gi();ar.prop("checked",!1);vr.prop("checked",!1);nf.hide();$('.HideShowMarathonColor,div[data-style="HideShowMarathonColor"]').hide();tf.hide();tt.show();pu.hide();bu.hide();vf();kr();h=r.None;gt=[]}function dr(){gu.empty();DashboardJobCardModuleController.FromOnlineApprovals?$("#exactRepeatTabDisplay,#logoRepeatTab,.product-positions .pos-heading,.lblPositionDesc").hide():$("#exactRepeatTabDisplay,#logoRepeatTab,.product-positions .pos-heading,.lblPositionDesc").show();ft.forEach(function(n){n.visible&&gu.loadTemplate(ro,{index:n.index,name:n.name,onClick:"displayLogoUpload.stepToDetailStage("+n.index.toString()+")"},{append:!0})})}function ys(n){var t,e,o,s;if(lu.empty(),n>0){for(t=0;t<n;t++){var i="txtSelectPantoneColour"+(t+1).toString(),a="txtEnterPantoneColour"+(t+1).toString(),u="ddlMatchColour"+(t+1).toString(),v="txtSelectMarathonColour"+(t+1).toString(),f="ddlFoilColour"+(t+1).toString(),y="Mnumber"+(t+1).toString();lu.loadTemplate(uo,{number:t+1,Mnumber:y,exactPantoneControlId:a,selectPantoneControlId:i,ddlMatchColourControlId:u,selectMarathonControlId:v,ddlFoilColourControlId:f,className:"col-md-3 printColourField HideColour",HideShowFoilColor:"display:none;"},{append:!0});e=_.map(pt,function(n){var t={};return t[n.pantone]="#"+n.hex,t});$("#"+i).paletteColorPicker({colors:e,insert:"after"});o=$("#"+u);nc(o);s=$("#"+f);tc(s)}c.brandingMethod.indexOf("FL")==0?($("#colourSectionDisplay .HideColour,.HideShowMarathonColor").hide(),$("#colourSectionDisplay .ShowFoilColour").show(),$(ut).val(""),$(".palette-color-picker-button.MarathonControlId").removeAttr("style"),$(nt).val(""),$(".cPreview").css("background-color","white"),$(st).val(""),$(".palette-color-picker-button:not(.MarathonControlId)").css("background-color","white"),at(),tt.fadeOut(),at(),tt.fadeOut(),h=r.None,tt.fadeIn()):($("#colourSectionDisplay .HideColour,.HideShowMarathonColor").show(),$("#colourSectionDisplay .HideColour,.HideShowMarathonColor").show(),$("#colourSectionDisplay .ShowFoilColour").hide(),yf(c.brandingMethod)?$('.HideShowMarathonColor,div[data-style="HideShowMarathonColor"]').show():$('.HideShowMarathonColor,div[data-style="HideShowMarathonColor"]').hide());rh();uh();$(".swatch").on("click",function(){var n=$(this).parent().parent().prev();ti(n)});$(".MarathonControlId").click(function(){$(".txtEnterPantoneColour,.txtSelectPantoneColour").filter(function(){return $(this).val()}).length>0?l("You may not select a combination of Pantone colours and Marathon Thread colours. Please select only Pantones colours or Marathon Thread colours. You may select a combination of “exact Pantones”, “choose from” and “not sure, match to colour”."):(typeof clickedMarathon=="undefined"?window.clickedMarathon=$(this).attr("id"):clickedMarathon=$(this).attr("id"),$("#MarathonPickerControl").fadeIn(),$("#modalDisplayLogoUpload").animate({scrollTop:0},800))});$('#MarathonPickerControl [data-dismiss="MarathonPickerControl"]').click(function(){$("#MarathonPickerControl").fadeOut()})}}function ps(){return $(nt).removeClass(rf),Promise.resolve().then(function(){var n=[],u=!0;return $(nt).each(function(){var e=$(this),i=$(this).val(),f;((h&r.MatchLogoColour)==0||(h&r.MatchToneOnToneColour)==0)&&(i="");i&&(f=t.getPantoneColours(i).then(function(n){var t=_.find(n,function(n){return n[0]==i});t||(u=!1,e.addClass(rf))}),n.push(f))}),n.length&&i.show(),Promise.all(n).then(function(){return i.hide(),u}).catch(function(){return i.hide(),u})})}function ws(){return t.loadContactsAndSizes(o.productCode,c.position,c.brandingMethod,o.colourCode).then(function(n){var t=n.TheData.BrandingPositionDetails.Width,i=n.TheData.BrandingPositionDetails.Height;t>0?d.attr("placeholder","Width (Max "+t.toString()+"mm)"):d.attr("placeholder","Width");i>0?g.attr("placeholder","Height (Max "+i.toString()+"mm)"):g.attr("placeholder","Height");d.attr("max",t===-1?-1:t);g.attr("max",i===-1?-1:i)}).catch(function(n){l(n)})}function bs(){function n(n){var i=parseFloat(n.val()!=""?n.val():"0"),t=parseFloat(n.get(0).max),r;i<0?n.val(0):t>0&&i>t&&(r="Please note you have entered a value larger than the available amount. Your input has been reverted to the maximum value ("+t.toString()+" mm) allowed.",it(r),n.val(t))}g.unbind("change");d.unbind("change");g.change(function(){n($(this))});d.change(function(){n($(this))})}function ks(){if(fi(),hu.empty(),productInventoryType===productTypes.DisplayProduct||productInventoryType===productTypes.CustomBoxes){var n=c.numColours,r=o.productIndex,u=$("#txtlogoRepeatJob").val().toUpperCase().trim(),f=$("#logoRepeatInputFilterFromOrder").val(),e=$("#logoRepeatInputFilterToOrder").val();si.removeClass("border-red");i.show();c.brandingMethod=="FL"&&(n=1);t.searchRepeatJobCard(u,n,c.brandingMethod,r,o.productCode,o.colourCode,o.size,f,e,o.productColoursAndSizes).then(function(n){i.hide();var t=n.Repeats;t.length?(t.forEach(function(t){var i=lf(t.JobCardCreatedDate),r=i.getFullYear()+"-"+("0"+(i.getMonth()+1)).slice(-2)+"-"+("0"+i.getDate()).slice(-2);hu.loadTemplate(ye,{jobCardNumber:t.JobCardNumber,orderNumber:t.OrderNumber,logoName:t.LogoName,date:r,previewClick:"displayLogoUpload.downloadDocument('LAYOUT', '"+t.JobCardNumber+"');",selectClick:"displayLogoUpload.submitRepeat('"+t.JobCardNumber+"', '"+t.AccountNumber+"','"+t.PrintProcessNumberOfColors+"','"+n.PrintDepartmentName+"','"+t.LogoName.replace(/'/g,"\\'")+"');"},{append:!0})}),ur.show(),li.show()):(lt=!1,it("You have no previous job cards that can be repeated for this particular product. Jobs that have not been completed in production as yet cannot be used as exact repeat references."))}).catch(function(n){i.hide();l("An error occured: "+n)})}}function lf(n){return new Date(parseInt(n.substr(6)))}function ds(n=false){n!=!0?(cu.empty(),ki=1,fi()):oi.show();var r=kt.val().toUpperCase().trim(),u=$("#LogoRepeatInputFilterFrom").val(),f=$("#LogoRepeatInputFilterTo").val();i.show();kt.removeClass("border-red");t.getJobCardLogos(r,u,f,af,ki).then(function(t){i.hide();t.TheData.length?(t.TheData.forEach(function(n){var t=lf(n.JobCardCreatedDate),i=t.getFullYear()+"-"+("0"+(t.getMonth()+1)).slice(-2)+"-"+("0"+t.getDate()).slice(-2),r=n.LogoName.replace(/[^a-zA-Z ]/g,"");cu.loadTemplate(pe,{jobCardNumber:n.JobCardNumber,orderNumber:"ABC",description:n.LogoName,date:i,productCode:n.ProductBaseCode,previewClick:"displayLogoUpload.downloadDocument('LAYOUT', '"+n.JobCardNumber+"');",selectClick:"displayLogoUpload.copyJobCardLogo('"+n.AccountNumber+"','"+r+"','"+n.JobCardId+"','"+n.JobCardNumber+"');"},{append:!0})}),oi.show(),li.show(),t.TotalPages!==t.CurrentPage&&n===!0?($("#loadMoreLogoRepeat").fadeIn(),ki=t.CurrentPage+1):t.TotalPages===t.CurrentPage?$("#loadMoreLogoRepeat").hide():n===!1&&r===""?$("#loadMoreLogoRepeat").fadeIn():$("#loadMoreLogoRepeat").hide()):(it("No logos could be found."),lt=!1,$("#loadMoreLogoRepeat").hide())}).catch(function(){l("An error occured, so the previous logos cannot be retrieved.");i.hide();$("#loadMoreLogoRepeat").hide()})}function gs(n){i.hide();l(n)}function fi(){ur.hide();oi.hide();li.hide()}function nh(n){return $(n).closest(".ProgressContainer").remove(),console.log(n),!1}function di(){(h&r.IsCopy)>0&&(h=h-r.IsCopy)}function gr(){ht()&&(h=h-r.IsRepeat)}function nu(n,t){fu.length>0?(s.val(n),dt.show(),ci.attr("href",t)):(et.show(),et.html("View layout for "+n),et.attr("onclick","displayLogoUpload.downloadDocument('LAYOUT', '"+n+"');"),ci.hide());n!==null&&n.startsWith("JC0")&&(sr.show(),et.show(),et.html("View layout for "+n),et.attr("onclick","displayLogoUpload.downloadDocument('LAYOUT', '"+n+"');"));hi.show();vu.hide();$("#pDescription3").hide();$("#pDescription").hide()}function gi(){au.show();dt.show();fi();hi.hide();ci.hide();ot.removeAttr("selected")}function th(){a=null;di();gi()}function ih(){au.is(":visible")&&(s.val()!=""?($("#logoUploadFileDisplay").click(),s.removeClass("border-red")):(alertMessage("Please enter a description or name for the artwork you are uploading."),s.addClass("border-red")))}function rh(){$(nt).autocomplete({source:function(n,i){t.getPantoneColours(n.term).then(function(n){var t=$.map(n,function(n){return{label:n[0],value:n[1]}});i(t)}).catch(function(n){l(n)})},minLength:2,select:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background-color","#"+t.item.value),ti($(i)),!1},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")},focus:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background-color","#"+t.item.value),ti($(i)),!1}}).autocomplete("instance")._renderItem=function(n,t){return $("<li>").append(t.label).appendTo(n)}}function uh(){$(ut).autocomplete({source:function(n,i){t.getMarathonColours(n.term).then(function(n){var t=$.map(n,function(n){return{label:n[0],value:n[1]}});i(t)}).catch(function(n){l(n)})},minLength:2,select:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background","#"+t.item.value),ti($(i)),!1},open:function(){$(this).removeClass("ui-corner-all").addClass("ui-corner-top")},close:function(){$(this).removeClass("ui-corner-top").addClass("ui-corner-all")},focus:function(n,t){var i="#"+n.target.id;return $(i).val(t.item.label),$(i).next().css("background","#"+t.item.value),ti($(i)),!1}}).autocomplete("instance")._renderItem=function(n,t){return $("<li>").append(t.label).appendTo(n)}}function fh(){d.val()!=""&&(g.val()!=""&&it("You can only specify a width or a height. Because you also entered a width, the height has been cleared."),g.val(""))}function eh(){g.val()!=""&&(d.val()!=""&&it("You can only specify a width or a height. Because you also entered a height, the width has been cleared."),d.val(""))}function oh(n){ve.attr("onclick","displayLogoUpload.downloadDocument('LAYOUT', '"+n+"');")}function sh(n,u){var f=rt;return p&&(f=p),i.show(),t.getStepDetails(y,n,u,f).then(function(n){var t,u,f;n&&(t=n,h=r.None,sr.hide(),et.hide(),n.isRepeat?(h=h|r.IsRepeat,ae.text(t.jobcardNumber),oh(t.jobcardNumber),wh(),fromArtwork=!1,exactRepeatCheck=!0,$('a[href="#tab-2"]').click()):n.isCopyLogo&&(h=h|r.IsCopy,a=-1,ci.hide(),s.val(t.logoName),rt=t.jobcardNumber,et.show(),lt=!0,fromArtwork=!1,nu(t.jobcardNumber,null),$('a[href="#tab-3"]').click()),y==LogoUploadType.Cart&&t.jobcardNumber?rt=t.jobcardNumber:y==LogoUploadType.JobCard&&n.isRepeat&&t.copyJobCardNumber&&(rt=t.copyJobCardNumber),t.artworkIDs!==null&&(fu=t.artworkIDs.split(",")),a=t.logoId,v=t.logoName,nu(v,""),v!==null&&s.val(v),u=t.width,f=t.height,u&&d.val(u),f&&g.val(f),t.position&&ct.val(t.position),h===r.None&&(h=h));i.hide()}).catch(function(n){i.hide();l(n)})}function hh(n,i,r,u,f){v=f;lt=!0;t.canJobCardBeExactRepeat(n,r,u,i,o.productCode,o.colourCode,o.size).then(function(){return exactRepeatCheck=!0,di(),$("body").trigger(ei,{productIndex:o.productIndex,position:c.position,uploadForJobCardNumber:p,logoId:a,logoName:"Logo from: "+n,productCode:o.productCode}),yh(n)}).catch(function(n){l(n);si.val("");si.focus();v=null;exactRepeatCheck=!1})}function ch(){si.keypress(function(n){n.keyCode==13&&displayLogoUpload.searchRepeatJobCard()});kt.keypress(function(n){n.keyCode==13&&displayLogoUpload.getLogosFromPreviousJobCards()});d.keypress(function(n){n.keyCode==13&&(e.preventDefault(),displayLogoUpload.stepForward())});g.keypress(function(n){n.keyCode==13&&(e.preventDefault(),displayLogoUpload.stepForward())})}function lh(){ah().then(function(n){i.hide();n?nr():le.modal({backdrop:"static",keyboard:!1})}).catch(function(n){i.hide();l(n)})}function ah(){return tu().then(function(n){return n.valid&&y==LogoUploadType.Cart?(i.show(),t.isLogoUploadDetailsComplete()):n.valid})}function nr(n){n||(n=!1);$("#dzUpload").each(function(){let n=$(this)[0].dropzone;n&&n.destroy()});s.val("");SelectedArtworkforDisplay=[];tempArtwork=[];$("body").trigger(ee,{finished:n});fr.modal("hide")}function vh(n,u,f,e){oe=u;i.show();lt=!0;exactRepeatCheck=!1;t.canJobCardLogoBeUsed(n,u,f,e).then(function(){return h=h|r.IsCopy,i.hide(),rt=e,wi()}).then(function(){a=null;v=null;nu(e);fi();it("The logo has been copied. Please fill in the remaining details.");sr.show();$("body").trigger(fe,{productIndex:o.productIndex,position:c.position,uploadForJobCardNumber:p,logoName:"Logo from "+e})}).catch(function(n){i.hide();(h&r.IsCopy)>0&&(h=h-r.IsCopy);l(n);kt.val("");kt.focus()});$("#loadMoreLogoRepeat").hide()}function yh(n){return rt=n,a=null,h=h|r.IsRepeat,wi().then(function(){ni(eu)}).catch(function(){gr()})}function vf(){or.show();gi();er.hide();di();gr();wr()}function ph(){$(".nav-tabs li.active").removeClass("active");$("#display-tab-1").fadeOut();$("#tab-2").fadeOut();$("#tab-3").fadeOut();$("#display-tab-4").fadeOut();ri.hide();ii.show();or.show();gi();er.hide();exactRepeatCheck=!1;h=r.None;yt=!1;bi(!0,!1)}function wh(){fi();or.hide();er.show();hi.hide();wr()}function tu(){return Promise.resolve().then(function(){var i=!0,r=k?k.index===ft.length-1:!1,u=ht(),n,t;return u?{valid:!0,errorMessage:null}:(k.index===0||r)&&(n=ef(),!n.valid)?n:i&&(k.index===1||r)&&(t=ao(),!t.valid)?t:{valid:i,errorMessage:null}})}function bh(n){for(var i=null,t=0;t<pt.length;t++)if(pt[t].pantone===n){i=pt[t].hex;break}return i}function kh(){return $(st).val(""),$(nt).val(""),$(".palette-color-picker-button:not(.MarathonControlId)").removeAttr("style"),$(".cPreview").css("background-color","white"),$(st).each(function(){$(this).attr("id",$(this).attr("data-id"));$(this).next().attr("data-target",$(this).attr("data-id"))}),$(nt).val(""),$(".cPreview").css("background-color","white"),$(ut).val(""),$(".palette-color-picker-button.MarathonControlId").removeAttr("style"),!1}function ti(n){function h(){u.val("");$(".cPreview",t).css("background-color","white")}function c(){i.val("");$(".palette-color-picker-button:not(.MarathonControlId)",t).removeAttr("style")}function e(){$(ut).val("");$(".palette-color-picker-button.MarathonControlId").removeAttr("style")}function a(){$(st).val("");$(nt).val("");$(".palette-color-picker-button:not(.MarathonControlId)").removeAttr("style");$(".cPreview").css("background-color","white");r[0].selectedIndex=0}var t=n.closest(cr),u=$(nt,t),o=$(ut,t),i=$(st,t),r=$(hr,t),f,s;if(n.attr("id")!==o.attr("id")&&$(".txtEnterMarathonColour").filter(function(){return $(this).val()}).length>0)a(),i.attr("data-id",i.attr("id")),i.removeAttr("id"),i.next().removeAttr("data-target"),l("You may not select a combination of Pantone colours and Marathon Thread colours. Please select only Pantones colours or Marathon Thread colours. You may select a combination of “exact Pantones”, “choose from” and “not sure, match to colour”.");else switch(n.attr("id")){case u.attr("id"):c();e();r[0].selectedIndex=0;break;case o.attr("id"):a();break;case i.attr("id"):h();e();r[0].selectedIndex=0;break;case r.attr("id"):h();c();e();f=r.val();s=bh(f);u.val(f);u.next().css("background-color","#"+s);r[0].selectedIndex=0}}function dh(n,t){var i="Dashboard/DocumentLoader.aspx"+gh(!1,t,n,!0);document.getElementById("downloadFrame").src=i}function gh(n,t,i,r){var u="";return u+="?Type=JOBCARD",u+="&Widgetid=DashboardJobCards",u+="&CacheMinutes=1000",u+="&FromCache="+n,u+="&DocumentNumber="+t,u+="&DocumentType="+i,u+("&Download="+r)}function nc(n){n.empty();n.append($("<option><\/option>").text("Select a Colour"));f=f.sort(function(n,t){var i=n.name.toLowerCase(),r=t.name.toLowerCase();return i<r?-1:i>r?1:0});f.forEach(function(t){n.append($("<option><\/option>").attr("value",t.pantone).text(t.name))})}function tc(n){n.empty();n.append($("<option><\/option>").attr("value",0).text("Select a Colour"));wt=wt.sort(function(n,t){var i=n.name.toLowerCase(),r=t.name.toLowerCase();return i<r?-1:i>r?1:0});wt.forEach(function(t){n.append($("<option><\/option>").attr("value",t.value).text(t.name))})}function ic(){pu.toggle("slow")}function rc(){bu.toggle("slow")}function uc(n,t){return n<=0&&(n=fc(t)),n}function fc(n){var t=0;return n.indexOf("EM-")===0||n.indexOf("EMB-")===0?t=9:n.indexOf("FL")===0&&(t=1),t}function ec(n){return n.indexOf("EM-")===0||n.indexOf("EMB-")===0?ie:te}function yf(n){return n.indexOf("EM-")===0||n.indexOf("FL")===0||n.indexOf("EMB-")===0?!0:!1}function oc(){var n=ar.prop("checked");n?($("#cbxMatchToneOnToneColourDisplay").prop("checked")?$("#cbxMatchToneOnToneColourDisplay").prop("checked",!1):(at(),tt.fadeOut()),h=h|r.MatchLogoColour):(tt.fadeIn(),h=h&~r.MatchLogoColour)}function sc(){var n=vr.prop("checked");n?($("#cbxMatchLogoColourDisplay").prop("checked")?$("#cbxMatchLogoColourDisplay").prop("checked",!1):(at(),tt.fadeOut()),h=h|r.MatchToneOnToneColour):(tt.fadeIn(),h=h&~r.MatchToneOnToneColour)}function hc(){return(h&r.MatchLogoColour)>0}function cc(){var n=_.map(w,function(n){return n.productIndex});return _.min(_.filter(n,function(n){return n>o.productIndex}))}function lc(){var n=_.map(w,function(n){return n.productIndex});return _.max(_.filter(n,function(n){return n<o.productIndex}))}function pf(n,t){Dropzone.autoDiscover=!1;var u=!0,r=new Dropzone("#dzUpload",{url:"https://file.io",maxFiles:1,maxFilesize:150,method:"PUT",timeout:0,addRemoveLinks:!1,uploadMultiple:!1,disablePreview:!0,acceptedFiles:"application/pdf",autoProcessQueue:!1,headers:{"x-ms-blob-type":"BlockBlob","Content-Type":"application/pdf"},error:function(n,t){$(".ProgressLoader progress#uploadprogress_"+n.FileSize).addClass("error");$(".dz-preview").remove();$(".ShowProgress .circle strong").text("0%");$(".ShowProgress .circle").addClass("error2");$("h3.UploadStatusText").text("Upload Error");$("h3.UploadStatusText").addClass("error");$(".ShowProgress").addClass("error");i.hide();alertMessage(t)},sending:function(n,t){let i=t.send;t.send=()=>{i.call(t,n)}}});r.on("addedfile",function(n){var f,o,t,h,c;$(".ShowProgress .circle").removeClass("error2");$("h3.UploadStatusText").removeClass("error");$(".ShowProgress").removeClass("error");$(".dz-preview").remove();i.show();$("h3.UploadStatusText").text("Uploading");f=co;o=1572864e3;gt.length>0&&(f=gt);s.val()===""&&l("Logo name not found");var a=f.join("|"),v="(.?|/)("+a+"|application/postscript)$",y=new RegExp(v,"i"),e=n.type;if(e&&e.indexOf("image/")===-1||(e=n.name.split(".").pop()),s.val()===""){l("Please enter a description or name for the artwork you are uploading.");s.focus();s.addClass("border-red");$(".dz-preview").remove();let n=Dropzone.forElement("#dzUpload");n.removeAllFiles();$("#tbUploadedFiles2").empty();$(".ShowProgress").hide();i.hide();u=!1}else if(n.size>o)l("The file is too big. Please upload a logo that is smaller than 150 MB."),u=!1;else if(y.test(e))n.context=$("#lblFileUploadResponseDisplay").html("Uploading file"),t=n.name,t.length>25&&(h=t.substring(0,t.lastIndexOf(".")),c=t.substring(t.lastIndexOf(".")),t=h.substring(0,20)+".."+c),uf.empty(),uf.loadTemplate(so,{fileName:t,ProgressValue:10,ProgressID:"uploadprogress_"+n.size,deleteClick:"return displayLogoUpload.removeUploadedFile(this)"},{append:!0}),$("#logoUploadSectionDisplay .ShowProgress,#logoUploadSectionDisplay .uploadedListItem").fadeIn(),$("h3.UploadStatusText").text("Uploading"),vc(n.name).then(function(n){iu=n.UploadSASUri;ru=n;r.processQueue()});else{let t=Dropzone.forElement("#dzUpload");t.removeAllFiles();$("#tbUploadedFiles2").empty();$(".ShowProgress").hide();l(n.name+" - Invalid file type! Please ensure that you supply artwork in one of the following acceptable formats: "+f.join(", "));i.hide();u=!1}s.val()!==""&&s.removeClass("border-red")});if(u){r.on("processing",function(){r.options.url=iu});r.on("uploadprogress",(n,t,i)=>{$(".dz-preview").remove();$(".uploadprogress_"+n.size).each(function(){$(this).hasClass("done")!==!0&&($(this).text(t+"%"),$(this).val(t))});var r=Math.trunc(i/n.size*100);r>=100?$(".ShowProgress .circle strong").text("99%"):$(".ShowProgress .circle strong").text(r+"%");r===100&&($("#ProgressContainer progress").addClass("done"),$("#ProgressContainer progress").text("100%"),$("#ProgressContainer progress").val(100))});r.on("success",function(r){var u={FileName:r.name,Description:s.val(),ProductCode:n.productCode,MetaData:JSON.stringify(ru),FileSize:r.size,BrandingPosition:t},f=$(".ProgressLoader progress#uploadprogress_"+u.FileSize);$("#dzUpload").hide();ac(u).then(function(n){var t,u;if(n!==null){RecentlyAddedArtwork=[];tempArtwork=[];t=n.Id;b.push(n);RecentlyAddedArtwork.push(n);tempArtwork.push(t);$(".dz-preview").remove();$("h3.UploadStatusText").text("Upload Done");$("#circle-a .circle").text("Upload Done");$(".ShowProgress .circle strong").text("100%");$("#lblFileUploadResponseDisplay").html("Artwork successfully uploaded.");u={id:t,name:s.val(),URL:"data.result.TheData.URL"};bt.push(u);kr();di();gr();i.hide();var e=[],o=n,r={};r.FileName="<p style='display:none;'>"+o.Name+"<\/p><span class='EditableFileName' data-id='"+t+"'>";r.FileName+='<input type="text" value=\''+o.Name+"' data-TxtID='"+t+'\' disabled class="RenameFileName"  onkeypress="displayLogoUpload.UpdateArtworkFileNameOnKeypress(\''+t+'\')" /> <i class="fa fa-circle-o-notch fa-spin RanameLoader"><\/i><i class="fa fa-check RenameDone" style="color: #018001;"><\/i>';r.FileName+='<button type="button" class="btn btn-sm btn-circle" data-BtnID=\''+t+"'  onclick=\"displayLogoUpload.UpdateArtwork('"+t+'\')"><i class="fa fa-save"><\/i><\/button>';r.FileName+="<\/span>";r.Size=n.ArtworkFileStorage.Size;r.Select='<input type="checkbox" data-id=\''+t+"' name=\"select\"  data-checkbox1='"+t+"' onclick=\"displayLogoUpload.countSelectedArtworkDisplayTab1("+t+')" checked />';r.Select+='<div class="dropdown default-dropdown" style="float: right; cursor: pointer">';r.Select+='<a class="dropbtn" aria-haspopup="true" aria-expanded="false" id="dropdownMenuLink"><i class="fa fa-ellipsis-v"><\/i> <\/a>';r.Select+='<div class="dropdown-content" style="left: -95px; border: 1px solid #b8b8b8;">';r.Select+='<a class="text-primary" onclick="displayLogoUpload.ToggleUpdateArtworkFileName('+t+')"> <i class="fa fa-edit"><\/i>Rename<\/a><\/a>';r.Select+='<a class="text-primary" onclick="displayLogoUpload.DeleteArtwork('+t+')"> <i class="fa fa-times"><\/i>Delete<\/a><\/a>';r.Select+="<\/div>";e.push(r);SelectedArtworkforDisplay=[];SelectedArtworkforDisplay.push(t);DashboardJobCardModuleController.FromOnlineApprovals&&ne(t);$("table#tbUploadedFiles2").DataTable({processing:!0,destroy:!0,data:e,columns:[{data:"FileName",title:"File Name"},{data:"Size",title:"Size"},{data:"Select",title:"Select"}],info:!1,ordering:!1,pageLength:5}).on("draw.dt",function(){})}else $(".ShowProgress .circle strong").text("0%"),$("h3.UploadStatusText").text("Upload Error"),f.addClass("error"),gs(data.result.Error)})})}}function ac(n){return new Promise((i,r)=>{t.CreateContactArtworkDisplay(n).then(function(n){i(n)}).catch(function(n){alertMessage(n);r(n)})})}function vc(n){return new Promise((i,r)=>{t.GetAzureBlobUploadMetadata(n).then(function(n){i(n)}).catch(function(n){alertMessage(n);r(n)})})}function wf(n,i,r,u){$("table#tbUploadedFilesDisplay").empty();u||(r=null);b=[];t.searchContactArtworkDisplay(n,i,r).then(function(n){var f,r,t,i;if(b=n,b.length>0){for($("#logoUploadSectionDisplay .uploadedListItem").show(),f=[],r=0;r<b.length;r++)t=b[r],i={},i.FileName="<p style='display:none;'>"+t.Name+"<\/p><span class='EditableFileName' data-id='"+t.Id+"'>",i.FileName+='<input type="text" value=\''+t.Name+"' data-TxtID='"+t.Id+'\' disabled class="RenameFileName"  onkeypress="displayLogoUpload.UpdateArtworkFileNameOnKeypress(\''+t.Id+'\')" /> <i class="fa fa-circle-o-notch fa-spin RanameLoader"><\/i><i class="fa fa-check RenameDone" style="color: #018001;"><\/i>',i.FileName+='<button type="button" class="btn btn-sm btn-circle" data-BtnID=\''+t.Id+"'  onclick=\"displayLogoUpload.UpdateArtwork('"+t.Id+'\')"><i class="fa fa-save"><\/i><\/button>',i.FileName+="<\/span>",i.Size=t.ArtworkFileStorage.Size,i.Select='<input type="checkbox" data-id=\''+t.Id+"' name=\"select\"  data-checkbox1='"+t.Id+"' onclick=\"displayLogoUpload.CountSelectedArtworkDisplay("+t.Id+')"/>',i.Select+='<div class="dropdown default-dropdown" style="float: right; cursor: pointer">',i.Select+='<a class="dropbtn" aria-haspopup="true" aria-expanded="false" id="dropdownMenuLink"><i class="fa fa-ellipsis-v"><\/i> <\/a>',i.Select+='<div class="dropdown-content" style="left: -95px; border: 1px solid #b8b8b8;">',i.Select+='<a class="text-primary" onclick="displayLogoUpload.ToggleUpdateArtworkFileName('+t.Id+')"> <i class="fa fa-edit"><\/i>Rename<\/a><\/a>',i.Select+='<a class="text-primary" onclick="displayLogoUpload.DeleteArtwork('+t.Id+')"> <i class="fa fa-times"><\/i>Delete<\/a><\/a>',i.Select+="<\/div>",f.push(i);$("table#tbUploadedFilesDisplay").DataTable({processing:!0,destroy:!0,data:f,columns:[{data:"FileName",title:"File Name"},{data:"Size",title:"Size"},{data:"Select",title:"Select"}],info:!1,ordering:!1,pageLength:5}).on("draw.dt",function(){})}else u&&it("No record available for <b>position "+$("ol#productPositionsDisplay").find("li.active").text()+"<\/b>")}).then(function(){let n=$("ol#productPositionsDisplay").find("li.active").text(),t=$("#displayProductBtnsContainer").find("span.active").text()+":"+$("#displayProductBtnsContainer").find("span.active").attr("product-index");gf(n,t)}).catch(function(n){alertMessage(n)})}function yc(n){$("#btnDownloadArtwork").attr("data-BtnID",n);ai.hide();$(".ArtworkThumbnailLoader").show();var r=n,i=null,u=null;ff.fadeIn();ai.attr("src","");t.downloadArtworkDisplay(r).then(function(n){i=_.find(n,function(n){return n.IsThumbnail===!0});u=_.find(n,function(n){return n.IsThumbnail===!1});ai.attr("src",`data:image/png;base64,${i.FileBytesBase64}`);$(".ArtworkThumbnailLoader").fadeOut();ai.fadeIn()}).catch(function(n){alertMessage(n)})}function pc(){var i=$("#btnDownloadArtwork").attr("data-BtnID"),n=null,r;return r=t.DownloadContactArtworkThumbnail(i).then(function(t){var r,h,c,u,l,f;n=t;var a=n.ArtworkFileStorages.MimeType!=""?n.ArtworkFileStorages.MimeType:"application/pdf",e=window.atob(n.fileBytes),o=e.length,s=new Uint8Array(o);for(r=0;r<o;r++)h=e.charCodeAt(r),s[r]=h;c=new Blob([s],{type:a});u=document.createElement("a");u.href=window.URL.createObjectURL(c);l=$("#tbArtworkDataDisplay .EditableFileName input[data-TxtID='"+i+"']").val();u.download=l+t.ArtworkFileStorages.Extension;f=document.createAttribute("target");f.value="_blank";u.setAttributeNode(f);u.click()}).catch(function(n){alertMessage(n)}),r.then(function(){ff.modal("hide")}),!1}function wc(n){$(".ConfirmDialogDisplay #deleteLogoLib").attr("data-id",n);$(".ConfirmDialogDisplay #deleteLogoDisplay").attr("data-id",n);$(".ConfirmDialogDisplay").fadeIn()}function bc(n){var i=n,r;i!=null&&($(".ConfirmDialogDisplay").fadeOut(),r=t.deleteContactArtworkDisplay(i).then(function(){var e,f,u,t,r;if(b=_.reject(b,function(n){return n.Id===parseInt(i)}),selectedTab===LogoUploadTabs.Upload)df(n,!0),$("#dzUpload").show(),e=Dropzone.forElement("#dzUpload"),e.removeAllFiles(),$(".dz-preview").remove(),$("#tbUploadedFiles2").empty(),$(".ShowProgress").hide(),SelectedArtworkforDisplay.splice(SelectedArtworkforDisplay.indexOf(n),1);else if(selectedTab===LogoUploadTabs.Library){for(kf(n,!0),f=[],u=0;u<b.length;u++)t=b[u],r={},r.FileName="<p style='display:none;'>"+t.Name+"<\/p><span class='EditableFileName' data-id='"+t.Id+"'>",r.FileName+='<input type="text" value=\''+t.Name+"' data-TxtID='"+t.Id+'\' disabled class="RenameFileName"  onkeypress="displayLogoUpload.UpdateArtworkFileNameOnKeypress(\''+t.Id+'\')" /> <i class="fa fa-circle-o-notch fa-spin RanameLoader"><\/i><i class="fa fa-check RenameDone" style="color: #018001;"><\/i>',r.FileName+='<button type="button" class="btn btn-sm btn-circle" data-BtnID=\''+t.Id+"'  onclick=\"displayLogoUpload.UpdateArtwork('"+t.Id+'\')"><i class="fa fa-save"><\/i><\/button>',r.FileName+="<\/span>",r.Size=t.ArtworkFileStorage.Size,r.Select='<input type="checkbox" data-id=\''+t.Id+"' name=\"select\"  data-checkbox1='"+t.Id+"' onclick=\"displayLogoUpload.CountSelectedArtworkDisplay("+t.Id+')"/>',r.Select+='<div class="dropdown default-dropdown" style="float: right; cursor: pointer">',r.Select+='<a class="dropbtn" aria-haspopup="true" aria-expanded="false" id="dropdownMenuLink"><i class="fa fa-ellipsis-v"><\/i> <\/a>',r.Select+='<div class="dropdown-content" style="left: -95px; border: 1px solid #b8b8b8;">',r.Select+='<a class="text-primary" onclick="displayLogoUpload.ToggleUpdateArtworkFileName('+t.Id+')"> <i class="fa fa-edit"><\/i>Rename<\/a><\/a>',r.Select+='<a class="text-primary" onclick="displayLogoUpload.DeleteArtwork('+t.Id+')"> <i class="fa fa-times"><\/i>Delete<\/a><\/a>',r.Select+="<\/div>",f.push(r);$("table#tbUploadedFilesDisplay").DataTable({processing:!0,destroy:!0,data:f,columns:[{data:"FileName",title:"File Name"},{data:"Size",title:"Size"},{data:"Select",title:"Select"}],info:!1,ordering:!1,pageLength:5}).on("draw.dt",function(){})}}).catch(function(n){alertMessage(n)}))}function kc(n){var t=n;t!==null&&($(".EditableFileName input[data-TxtID='"+n+"']").removeAttr("disabled"),$(".EditableFileName input[data-TxtID='"+n+"']").addClass("active"),$(".EditableFileName input[data-TxtID='"+n+"']").focus(),$(".EditableFileName button[data-BtnID='"+n+"']").fadeIn())}function bf(n){var i=n,r=$(".EditableFileName input[data-TxtID='"+n+"']").val(),u;$(".EditableFileName input[data-TxtID='"+n+"']").attr("disabled","true");$(".EditableFileName input[data-TxtID='"+n+"']").removeClass("active");$(".EditableFileName button[data-BtnID='"+n+"']").fadeOut();$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RanameLoader").fadeIn();u={Name:r};t.UpdateContactArtwork(i,u).then(function(){var t=_.findIndex(b,{Id:Number(i)});t>-1&&(b[t].Name=r);$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RanameLoader").fadeOut("fast",function(){$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RenameDone").fadeIn();setTimeout(function(){$(".EditableFileName button[data-BtnID='"+n+"']").siblings(".RenameDone").fadeOut()},3e3)})}).catch(function(n){alertMessage(n)})}function dc(n){$(".EditableFileName input[data-TxtID='"+n+"']").keypress(function(t){t.which==13&&bf(n)})}function kf(n,t=false){var i,r,u,f;s.val()===""&&t===!1?(s.addClass("border-red"),$("[data-id='"+n+"']").prop("checked",!1),alertMessage("Please enter a description or name for the artwork you are uploading.")):(s.removeClass("border-red"),t===!1&&(i=_.find(b,function(t){return t.Id===n}),r=i.ArtworkFileStorage.Extension.substr(i.ArtworkFileStorage.Extension.indexOf(".")+1),DashboardJobCardModuleController.FromOnlineApprovals&&ArtworkBrandingMethod.length==0&&(ArtworkBrandingMethod=["pdf"]),u=_.find(ArtworkBrandingMethod,function(n){return n===r}),u!=null?(SelectedArtworkforDisplay.length>0&&(SelectedArtworkforDisplay=[],f=$("#tbUploadedFilesDisplay input[type='checkbox'][data-checkbox1='"+n+"']").is(":checked"),$("#tbUploadedFilesDisplay input[type='checkbox']").prop("checked",!1),f&&$("#tbUploadedFilesDisplay input[type='checkbox'][data-checkbox1='"+n+"']").prop("checked",!0)),tempArtwork=[],SelectedArtworkforDisplay.push(n),tempArtwork.push(n),DashboardJobCardModuleController.FromOnlineApprovals&&ne(n)):(alertMessage("The selected artwork with the extension (<b>"+r.toUpperCase()+"<\/b>) cannot be used for this product."),$("[data-id='"+n+"']").prop("checked",!1))))}function df(n,t=false){var f,i,r,u;s.val()===""&&t===!1?(alertMessage("Please enter a description or name for the artwork you are uploading."),s.addClass("border-red"),$("#tbArtworkData2 input[type='checkbox'][data-checkbox='"+n+"']").prop("checked",!1)):(s.removeClass("border-red"),f=0,SelectedArtworkforDisplay.indexOf(n)>-1?(SelectedArtworkforDisplay.splice(SelectedArtworkforDisplay.indexOf(n),1),$("#tbArtworkData2 input[type='checkbox'][data-checkbox='"+n+"']").prop("checked",!1)):t==!1&&(i=_.find(b,function(t){return t.Id==n}),r=i.ArtworkFileStorage.Extension.substr(i.ArtworkFileStorage.Extension.indexOf(".")+1),DashboardJobCardModuleController.FromOnlineApprovals&&ArtworkBrandingMethod.length==0&&(ArtworkBrandingMethod=["pdf","cdr","eps","ai"]),u=_.find(ArtworkBrandingMethod,function(n){return n==r}),u!=null?SelectedArtworkforDisplay.push(n):(alertMessage("The selected artwork with the extension (<b>"+r.toUpperCase()+"<\/b>) cannot be used for this product."),$("#tbArtworkData2 input[type='checkbox'][data-checkbox='"+n+"']").prop("checked",!1))))}function gf(n,i){if(SelectedArtworkforDisplay.length===0)n&&i&&t.GetpreviouslySelectedArtwork(n,i,y,p).then(function(t){var r,u;if(t!==null){for(SelectedArtworkforDisplay=[],r=0;r<t.length;++r)n===t[r].Position&&i===t[r].ProductCode&&(SelectedArtworkforDisplay.push(t[r].ArtworkId),$("#tbUploadedFilesDisplay input[type='checkbox'][data-checkbox1='"+t[r].ArtworkId+"']").prop("checked",!0));if(u=_.find(b,function(n){return n.Id===SelectedArtworkforDisplay[0]}),SelectedArtworkforDisplay.length>0&&u&&($('a[href="#display-tab-4"]').click(),$("#logoNameInput").fadeIn()),typeof DashboardJobCardModuleController!="undefined"&&SelectedArtworkforDisplay.length==0&&DashboardJobCardModuleController.SelectedLogos.length>0){for(let n=0;n<DashboardJobCardModuleController.SelectedLogos.length;++n){let t=DashboardJobCardModuleController.SelectedLogos[n];DashboardJobCardModuleController.FromOnlineApprovals&&(t=t.ArtworkId);$("#tbUploadedFilesDisplay input[type='checkbox'][data-checkbox1='"+t+"']").prop("checked",!0)}$('a[href="#display-tab-4"]').click();$("#logoNameInput").fadeIn();$("#logoNameInput #txtLogoName").val(DashboardJobCardModuleController.LogoName)}}$("#logoNameInput").fadeIn()}).catch(function(n){alertMessage(n)});else{for(var r=0;r<SelectedArtworkforDisplay.length;++r)$("#tbUploadedFilesDisplay input[type='checkbox'][data-checkbox1='"+SelectedArtworkforDisplay[r]+"']").prop("checked",!0);$("#logoNameInput").fadeIn()}}function gc(){if(SelectedArtworkforDisplay.length>0)for(var n=0;n<SelectedArtworkforDisplay.length;n++)$("#tbArtworkDataDisplay input[type='checkbox'][data-checkbox='"+SelectedArtworkforDisplay[n]+"']").prop("checked",!1),$("#tbArtworkData2 input[type='checkbox'][data-checkbox='"+SelectedArtworkforDisplay[n]+"']").prop("checked",!1);$(".dz-preview").remove();$("#tbUploadedFiles2").empty();SelectedArtworkforDisplay=[];RecentlyAddedArtwork=[]}function ne(n){var t=_.find(BrandingPositionsArtwork,function(n){return n.BrandingPosition===$("ol#productPositionsDisplay").find("li.active").text()});typeof t!="undefined"&&(BrandingPositionsArtwork=$.grep(BrandingPositionsArtwork,function(n){return n.BrandingPosition!==t.BrandingPosition}));BrandingPositionsArtwork.push({ArtworkId:n,BrandingPosition:$("ol#productPositionsDisplay").find("li.active").text()})}var y,ue="REUSE_LOGO_EVENT",ei="LOGO_UPLOADED_EVENT",uu="LOGO_UPLOADED_EVENT_DASHBOARD",fe="LOGO_COPIED_EVENT",ee="LOGO_UPLOAD_CLOSED",h=0,rt,p,a,fu=[],v,vt,tr,yt,ir,oe=null,w=[],o=null,c=null,eu=null,k=null,pt=[],wt=[],bt=[],se=" (Match Colour)",ou=$("#modalDisplayLogoUpload"),d=$("#txtJCLogoWidth"),g=$("#txtJCLogoHeight"),ct=$("#ddlDisplayPosition"),ii=$("#btnNextBrandStepDisplay"),rr=$("#btnPrevBrandStepDisplay"),ri=$("#btnFinishBrandStepDisplay"),su=$("#logoHelpDisplay"),ur=$(".logoUpload-table"),hu=$("#repeatRowsDisplay"),cu=$("#logoRowsDisplay"),oi=$("#tableLogosDisplay"),lu=$("#printColoursDisplay"),he=null,ce=$("#positionSection"),fr=$("#modalDisplayLogoUpload"),le=$("#modalConfirmCloseDisplay"),kt=$("#txtPreviousJob"),s=$("#txtLogoNameDisplay"),et=$("#linkDownloadCopiedLogoDisplay"),si=$("#txtRepeatJobCard"),er=$("#logoRepeatSectionDisplay"),or=$("#chooseLogoSectionDisplay"),ae=$("#repeatJobCardDisplay"),hi=$("#pnlLogoDetails"),ve=$("#btnViewRepeatJobCard"),au=$("#lnkFileUploadDisplay"),dt=$("#logoNameInput"),ci=$("#lnkDownloadLogoDisplay"),sr=$("#divFileUploadResponseDisplay"),vu=$("#cartLogosDisplay"),ot=$("#ddlCartLogosDisplay"),yu=$("#lnkWhatIsVectorArtDisplay"),pu=$("#vectorArtDescDisplay"),wu=$("#lnkWhatIsConvertedCurvesDisplay"),bu=$("#convertedCurvesDescDisplay"),ye=$("#logoRepeatRowTemplateDisplay"),pe=$("#logoRowTemplateDisplay"),we=$("#productTemplateDisplay"),be=$("#productTemplateContainerDisplay"),ke=$("#productPositionTemplateDisplay"),ku=$("#productPositionsDisplay"),nt=".txtEnterPantoneColour",ut=".txtEnterMarathonColour",de=".ddlFoilColour",st=".txtSelectPantoneColour",hr=".ddlMatchColour",cr=".printColoursRow",ge=".cPreview",no=".palette-color-picker-button",to=".MarathonControlId",io=$("#displayProductBtnTemplate"),du=$("#displayProductBtnsContainer"),ro=$("#detailTabHeaderTemplateDisplay"),uo=$("#printColourTemplateDisplateDisplay"),gu=$("#detailTabHeadersDisplay"),lr=null,fo=$("#lblPositionDescDisplay"),eo=$("#modalReuseLogoDisplay"),oo=$("#modalReuseColourDisplay"),li=$("#lblCompletedJobNoteDisplay"),ar=$("#cbxMatchLogoColourDisplay"),vr=$("#cbxMatchToneOnToneColourDisplay"),nf=$("#pnlMatchColoursDisplay"),tf=$("#pnlMatchToneOnToneColoursDisplay"),tt=$("#pnlSelectColoursDisplay"),rf="invalid-field",uf=$("#ProgressContainerDisplay"),so=$("#UploadProgressTemplateDisplay"),yr=$("#acceptableFilesDisplay"),nl=$("#artworkRowTemplate"),tl=$("#tbArtworkDataDisplay"),ff=$("#modalPreviewBanner"),il=$("#lnkPreviewArtwork"),ai=$("#imgPreviewArtwork"),lt=!1,ho=[],vi={fnGetProducts:null,fnGetLogos:null},co=["pdf","eps","cdr","ai"],gt=[],b=[],ft=[{index:0,name:"Upload Artwork",elementId:"logoUploadSectionDisplay",aboutElementId:"step1AboutDisplay",visible:!0,validate:function(){return Promise.resolve().then(function(){return ef()})}},],pr={Next:1,Back:2},af,ki,iu,ru,te,ie;return $(document).ready(function(){he=$("#logoUploadFileDisplay");su.hide();yu.unbind("click");wu.unbind("click");yu.click(function(){ic()});wu.click(function(){rc()});$("#modalDisplayLogoUpload").on("hidden.bs.modal",function(){$("#tbUploadedFiles_filter input").val("");$("#tbUploadedFiles_filter input").trigger("keyup");$("#chooseLogoSectionDisplay ul.nav-tabs>li").removeClass("active")});$("#modalConfirmCloseDisplay").on("hidden.bs.modal",function(){$(".modal.in").length==1&&$("body").addClass("modal-open")});$("#LogoRepeatInputFilterTo").datepicker({yearRange:"1999:c+1",changeYear:!0,maxDate:"+30Y"});$("#LogoRepeatInputFilterFrom").change(function(){$("#LogoRepeatInputFilterTo").val("");var n=$(this).val(),t={Year:new Date(n).getFullYear(),Month:new Date(n).getMonth()+1,Day:new Date(n).getDate()},i=new Date(t.Year,t.Month-1,t.Day+1);$("#LogoRepeatInputFilterTo").datepicker("setStartDate",i)});$("#LogoRepeatInputFilterTo").datepicker({yearRange:"1999:c+1",changeYear:!0,maxDate:"+30Y"});$("#logoRepeatInputFilterFromOrder").change(function(){$("#logoRepeatInputFilterToOrder").val("");var n=$(this).val(),t={Year:new Date(n).getFullYear(),Month:new Date(n).getMonth()+1,Day:new Date(n).getDate()},i=new Date(t.Year,t.Month-1,t.Day+1);$("#logoRepeatInputFilterToOrder").datepicker("setStartDate",i)})}),af=30,ki=1,iu="",ru="",te=["Top-left of branding area","Top-centre of branding area","Top-right top of branding area","Middle-left of branding area","Middle-centre of branding area","Middle-right of branding area","Bottom-left of branding area","Bottom-centre of branding area","Bottom-right of branding area"],ie=["Left","Right","Centered"],re}(handleLoadError,new DisplayDataService,new DisplayCartLoading,LogoUploadFlags,alerterService,standardColours);displayLogoUpload=new DisplayLogoUpload,function(n,t){"use strict";var i='<a class="add-logo24">Upload Artwork <i class="fa fa-exclamation-triangle" aria-hidden="true"><\/i><\/a>',r='<div class="edit-logo24" logo-id="" logo-name="" style="overflow-wrap: anywhere;"><span class="logo24-logo"><\/span><img class="edit-logo24-btn cartTip" src="images/icn-edit-lg.png" alt="edit" data-toggle="tooltip" data-placement="top" data-original-title="Edit branding information" title="Edit branding information" /><i class="fa fa-times cartTip remove-branding-btn" aria-hidden="true" data-toggle="tooltip" data-placement="top" data-original-title="Remove branding" title="Removing branding"><\/i><\/div>';n.fn.displayLogoColumn=function(u){function d(){n("body").on(v,function(n,t){f.isCustomBoxes?f.productIndex==t.productIndex&&f.position==t.position&&f.jobCardNumber==t.uploadForJobCardNumber&&t.logoName&&(f.logoName=t.logoName,f.logoId=t.logoId,e(t.logoName,t.logoId)):f.productIndex==t.productIndex&&f.productCode===t.productCode&&t.logoName&&(f.logoName=t.logoName,f.logoId=t.logoId,e(t.logoName,t.logoId))})}function g(){n("body").on(y,function(n,t){f.productIndex===t.productIndex&&f.productCode===t.productCode&&f.jobCardNumber===t.uploadForJobCardNumber&&t.logoName&&(f.logoName=t.logoName,f.logoId=t.logoId,e(t.logoName,t.logoId))})}function nt(){n("body").on(p,function(n,t){f.productIndex==t.productIndex&&f.position==t.position&&f.jobCardNumber==t.uploadForJobCardNumber&&(f.logoName=t.logoName,f.logoId=null,e(t.logoName,null))})}function e(n,t){s.show();s.attr("logo-id",t);s.attr("logo-name",n);w.html(n);h.hide()}function c(){h.show();s.hide()}function l(){DashboardJobCardModuleController.FromOnlineApprovals&&(f.jobCardNumber=DashboardJobCardModuleController.LogoJobCardNumber);f.uploadType===LogoUploadType.JobCard&&(f.displayProd?productInventoryType=productTypes.DisplayProduct:f.isCustomBoxes&&(productInventoryType=productTypes.CustomPackaging));t.open(f.uploadType,f.productIndex,f.position,f.jobCardNumber,f.fnGetProducts,f.fnGetLogos,f.logoName)}function tt(){return f.uploadType==LogoUploadType.Cart?dataService.deleteBranding(f.productCode,f.productIndex,f.position).then(function(){c();ArtworkLibraryIntegration.ClearSelectedArtwork();alert("The branding details have been removed.")}).catch(function(n){alert(n)}):dataService.deleteJobCardBranding(f.jobCardNumber).then(function(){c();ArtworkLibraryIntegration.ClearSelectedArtwork();alert("The branding details have been removed.")}).catch(function(n){alert(n)})}var a="REUSE_LOGO_EVENT",v="LOGO_UPLOADED_EVENT",y="LOGO_UPLOADED_EVENT_DASHBOARD",p="LOGO_COPIED_EVENT",f=u,o=this;o.html(i+r);var h=o.find(".add-logo24"),s=o.find(".edit-logo24"),w=o.find(".logo24-logo"),b=s.find(".edit-logo24-btn"),k=o.find(".remove-branding-btn");return d(),nt(),g(),h.click(function(){l()}),b.click(function(){l()}),k.click(function(){tt()}),f.logoId||f.logoName?e(f.logoName,f.logoId):c(),f.openWithModal&&l(),this}}(jQuery,displayLogoUpload);WorkWearProducts=function(n){var t={Get:function(t,i,r,u,f){n.ajax({headers:{},url:"AjaxHandlers/WorkWearAjaxHandler.aspx",data:{a:"GetWorkwearproducts",productCode:t},dataType:"json",contentType:"application/json; charset=utf-8",cache:!1,async:!0,beforeSend:function(){},complete:function(){n.ajax({headers:{},url:"AjaxHandlers/WorkWearAjaxHandler.aspx",data:{a:"GetCombinedStockLevelsOf",productList:t,size:i,divSizeBtnsContainer:r,viewAllSizes:u,setType:f},dataType:"json",cache:!1,contentType:"application/json; charset=utf-8",beforeSend:function(){},complete:function(n){var i=n.responseJSON.Result.TheData;DisplayWorkwearStockLevelsOf(i,t)},success:function(){},error:function(t){t!=null&&alert(t.Error);n("#divWait").hide()}})},success:function(t){var r=t.Result.TheData,u=r.ProductMatches,i=r.MatchCode,f,e;n("#divProductMatch").empty();u!=""?(n.each(u,function(t,i){let r="",u="",f="";i.MatchData==null?(r='onclick=""',u="background-color:"+i.ProductData.TapeColour.Name+";",f="<a "+r+' style="'+u+'" class="selection pdActiveTapeColour">'+i.ProductData.TapeColour.Name+"<\/a>"):i.ProductData.Leadtime.Value=="AI"?n("#divTapeButtons").hide():(n("#divTapeButtons").show(),r="onclick=\"javascript:DisplayCombinedStockLevels('"+i.MatchCode+"', '', '','','',true)\"",u="background-color:"+i.MatchData.TapeColour.Name+";",f="<a "+r+' style="'+u+'" class="selection">'+i.MatchData.TapeColour.Name+"<\/a>");n("#divProductMatch").append(f)}),i!=""?(f="onclick=\"DisplayCombinedStockLevels('"+i+"', '', '','','',true)\"",e="<a "+f+" AI-itemCode='"+i+"'> Click here <\/a>",n("#MO-display").show(),n("#MO-display").empty().html("Stock of this item is also available immediately under the code "+i+" as shown below. "+e+" for full details.")):n("#MO-display").hide()):(n("#divTapeButtons").hide(),n("#lblTape").hide(),n("#MO-display").hide())},error:function(n){alertMessage(n.responseJSON.Error)}})},ComponentLevel:function(t,i,r){n.ajax({headers:{},url:"AjaxHandlers/WorkWearAjaxHandler.aspx",data:{a:"GetComponentLevels",productCode:t,showIncoming:i,setType:r},dataType:"json",cache:!1,contentType:"application/json; charset=utf-8",beforeSend:function(){},complete:function(n){var t=n.responseJSON.Result.TheData;ComponentStockLevels(t)},success:function(){},error:function(t){t!=null&&alert(t.Error);n("#divWait").hide()}})}},i={Initialise:function(n,i,r,u,f){t.Get(n,i,r,u,f)},WorkwearComponentLevel:function(n,i,r){t.ComponentLevel(n,i,r)}};return{Functions:i}}(jQuery);CustomPackagingDataService=function(n){"use strict";function t(){}function r(n){var t="An error occured.";try{n.Error?t=n.Error:n.responseJSON&&n.responseJSON.Error?t=n.responseJSON.Error:n.TheData&&(t=n.TheData)}catch(i){console.log(i)}return t}var i="AjaxHandlers/CustomPackagingAjaxHandler.aspx";return t.prototype.addJobCardDetails=function(n,t,u,f,e,o,s,h,c,l,a,v,y,p,w,b,k){var d=$.ajax({url:i+"?a=SaveLogoBrandingDetails",data:{uploadType:n,finish:t,lId:JSON.stringify(u),p:f,jc:e,pc:o,bp:s,cId:h,si:c,reuseLogo:l,reuseColour:a,numColours:v,flags:y,uploadForJobCardNumber:p,artworkFlag:w,logoName:b,brandingMethod:k},dataType:"json",cache:!1});return Promise.resolve(d).then(function(n){return!n.Success&&n.Error?Promise.reject(n):n}).catch(function(n){return Promise.reject(r(n))})},t.prototype.changeLogoName=function(n,t,u,f){var e=$.ajax({url:i+"?a=ChangeLogoName",data:{logoId:JSON.stringify(n),logoName:t,productCode:u,position:f},dataType:"json",cache:!1});return Promise.resolve(e).then(function(n){return n.Success?n.TheData:Promise.reject(n)}).catch(function(n){return Promise.reject(r(n))})},t}(alerterService.error);